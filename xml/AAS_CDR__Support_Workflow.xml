<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE workflow PUBLIC "-//OpenSymphony Group//DTD OSWorkflow 2.8//EN" "http://www.opensymphony.com/osworkflow/workflow_2_8.dtd">
<workflow>
  <meta name="jira.description">This JIRA Service Desk Support Workflow was generated for Project AAS-CDR</meta>
  <meta name="jira.i18n.description"></meta>
  <meta name="jira.update.author.key">arianna.fabbri</meta>
  <meta name="jira.updated.date">1484129699260</meta>
  <meta name="sd.workflow.key">sdItSupport</meta>
  <meta name="jira.update.author.name">admin</meta>
  <initial-actions>
    <action id="1" name="Create Issue">
      <meta name="opsbar-sequence">0</meta>
      <meta name="jira.description"></meta>
      <meta name="jira.i18n.description"></meta>
      <meta name="jira.i18n.title">common.forms.create</meta>
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="Finished" status="Open" step="11">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">396fb42d340aabf9744b4ff75d1b3ad500c8a94f</arg>
              <arg name="FIELD_NOTES">Set custom field &quot;Customer request description&quot; with the description of the selected request type</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT NAME AS CALL_TO_ACTION FROM AO_54307E_VIEWPORTFORM WHERE VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;) AND ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id
log.debug &quot;sqlStmt 1: &quot; + sqlStmt
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String request_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	request_desc = it.CALL_TO_ACTION
}

//log.debug &quot;Request: &quot; + request_desc.toString()

issue.setCustomFieldValue(request_description, request_desc)
request_description.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(request_description),request_desc),changeHolder)
indexManager.reIndex(issue)
issue.store()

sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 3 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
log.debug &quot;sqlStmt 2: &quot; + sqlStmt
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

//log.debug &quot;Status: &quot; + status_desc.toString()

issue.setCustomFieldValue(status_description, status_desc)
//status_description.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(status_description),status_desc),changeHolder)
indexManager.reIndex(issue) 
issue.store()</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">480678521f6d7e58a01b6236df15dc878585e0f0</arg>
              <arg name="FIELD_NOTES">YCFgU2VsZWN0IGFzc2lnbmVlIGJhc2VkIG9uIGEgYmFsYW5jZWQgc2VhcmNoIG9mIHRoZSB1c2VyIHdpdGggdGhlIGxvd2VyIG51bWJlciBvZiBhc3NpZ25lZCBpc3N1ZXM=</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uY3Jvd2QuZW1iZWRkZWQuYXBpLlVzZXINCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuYmMuaXNzdWUuc2VhcmNoLlNlYXJjaFNlcnZpY2UNCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yDQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlDQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlTWFuYWdlcg0KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS51c2VyLnV0aWwuVXNlclV0aWwNCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEud2ViLmJlYW4uUGFnZXJGaWx0ZXINCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuQ29tcG9uZW50TWFuYWdlcg0KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5DdXN0b21GaWVsZE1hbmFnZXINCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLk9yZGVyYWJsZUZpZWxkDQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZA0KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlDQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuSXNzdWVDaGFuZ2VIb2xkZXINCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXINCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uDQoNCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5DQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQ0KbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpDQoNClN0cmluZyBQcmpLZXkgPSBpc3N1ZS5nZXRQcm9qZWN0T2JqZWN0KCkua2V5DQpTZWFyY2hTZXJ2aWNlIAkJc2VhcmNoU2VydmljZSAJCT0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29tcG9uZW50KFNlYXJjaFNlcnZpY2UuY2xhc3MpDQpVc2VyVXRpbCAJCQl1c2VyVXRpbCAJCQk9IENvbXBvbmVudEFjY2Vzc29yLmdldFVzZXJVdGlsKCkNCklzc3VlTWFuYWdlciAJCWlzc3VlTWFuYWdlciAJCT0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCkNCkNvbXBvbmVudE1hbmFnZXIgCWNvbXBvbmVudE1hbmFnZXIgCT0gQ29tcG9uZW50TWFuYWdlci5nZXRJbnN0YW5jZSgpDQpDdXN0b21GaWVsZE1hbmFnZXIgCWN1c3RvbUZpZWxkTWFuYWdlciAJPSBjb21wb25lbnRNYW5hZ2VyLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpDQpJc3N1ZUNoYW5nZUhvbGRlciAJY2hhbmdlSG9sZGVyIAkJPSBuZXcgRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyKCkNCmRlZiAJCQkJaW5kZXhNYW5hZ2VyIAkJPSBjb21wb25lbnRNYW5hZ2VyLmdldEluZGV4TWFuYWdlcigpDQpkZWYgCQkJCWdyb3VwTWFuYWdlciAJCT0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0R3JvdXBNYW5hZ2VyKCkNCg0KVXNlciBvbGRVc2VyID0gQ29tcG9uZW50TWFuYWdlci5pbnN0YW5jZS5qaXJhQXV0aGVudGljYXRpb25Db250ZXh0LmdldExvZ2dlZEluVXNlcigpCQ0KQ29tcG9uZW50TWFuYWdlci5pbnN0YW5jZS5qaXJhQXV0aGVudGljYXRpb25Db250ZXh0LnNldExvZ2dlZEluVXNlcihDb21wb25lbnRBY2Nlc3Nvci5nZXRVc2VyVXRpbCgpLmdldFVzZXJPYmplY3QoImF0bGFzc2lhbiIpKQ0KDQppbnQgbWluX2Fzc2lnbmVkX2lzc3VlcyA9IDANClN0cmluZyBhc3NpZ25lZQ0KU3RyaW5nIGpxbFNlYXJjaA0KTGlzdCBpc3N1ZXMNClNlYXJjaFNlcnZpY2UuUGFyc2VSZXN1bHQgcGFyc2VSZXN1bHQNCmludCBqID0gMA0KDQpVc2VyIGN1cnJlbnRVc2VyID0gQ29tcG9uZW50TWFuYWdlci5pbnN0YW5jZS5qaXJhQXV0aGVudGljYXRpb25Db250ZXh0LmdldExvZ2dlZEluVXNlcigpCQ0KDQppZiAoUHJqS2V5ID09ICdDRFInICYmIChpc3N1ZS5pc3N1ZVR5cGVPYmplY3QubmFtZSA9PSAnVGVjaG5pY2FsIFN1cHBvcnQgSXNzdWUnIHx8IGlzc3VlLmlzc3VlVHlwZU9iamVjdC5uYW1lID09ICdUZWNobmljYWwgRG9jcycgfHwgaXNzdWUuaXNzdWVUeXBlT2JqZWN0Lm5hbWUgPT0gJ1Rhc2snKSl7DQogICAgYXNzaWduZWUgPSAibWFydGluYS5iZXJnYW1pbmkiDQp9ZWxzZXsNCiAgICBpZiAoUHJqS2V5ID09ICdBQVMnICYmIGlzc3VlLmlzc3VlVHlwZU9iamVjdC5uYW1lID09ICdTcGFyZSBQYXJ0cycpew0KICAgICAgICBhc3NpZ25lZSA9ICJzaW1vbmUuZmluaSINCiAgICB9ZWxzZXsNCiAgICAgICAgaWYgKFByaktleSA9PSAnQUFTJyAmJiBpc3N1ZS5pc3N1ZVR5cGVPYmplY3QubmFtZSA9PSAnVGVjaG5pY2FsIERvY3MnKXsNCiAgICAgICAgICAgIGFzc2lnbmVlID0gInJvYmVydGEuZG9sY2luaSINCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBncm91cE1hbmFnZXIuZ2V0VXNlcnNJbkdyb3VwKCJGQUFDV29ybGRTdXBwb3J0VGVhbSIpLmVhY2h7IHVzZXIgLT4NCiAgICAgICAgICAgICAgICBqcWxTZWFyY2ggPSAiKHByb2plY3QgPSAnQUFTJyBPUiBwcm9qZWN0PSdDRFInKSBBTkQgaXNzdWV0eXBlICE9IFN1Yi10YXNrIEFORCBhc3NpZ25lZSA9ICciICsgdXNlci5nZXROYW1lKCkgKyAiJyBBTkQgc3RhdHVzIE5PVCBJTiAoJ0Nsb3NlZCcsJ0V4cGlyZWQgUmVxdWVzdCcpIg0KICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiQUFTIC0tLS0tLS0+IENoZWNrIHVzZXI6ICIgKyB1c2VyLmdldE5hbWUoKQ0KICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiQUFTIC0tLS0tLS0+IFF1ZXJ5OiAiICsganFsU2VhcmNoDQogICAgICAgICAgICAgICAgLy9yZXF1ZXN0UGFydGljaXBhbnRzTGlzdC5hZGQodXNlclV0aWwuZ2V0VXNlckJ5TmFtZSh1c2VyLmdldE5hbWUoKSkpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHBhcnNlUmVzdWx0ID0gc2VhcmNoU2VydmljZS5wYXJzZVF1ZXJ5KGN1cnJlbnRVc2VyLCBqcWxTZWFyY2gpDQogICAgICAgICAgICAgICAgaWYgKHBhcnNlUmVzdWx0LmlzVmFsaWQoKSkgew0KICAgICAgICAgICAgICAgICAgICBkZWYgc2VhcmNoUmVzdWx0ID0gc2VhcmNoU2VydmljZS5zZWFyY2goY3VycmVudFVzZXIsIHBhcnNlUmVzdWx0LmdldFF1ZXJ5KCksIFBhZ2VyRmlsdGVyLmdldFVubGltaXRlZEZpbHRlcigpKQ0KICAgICAgICAgICAgICAgICAgICAvLyBUcmFuc2Zvcm0gaXNzdWVzIGZyb20gRG9jdW1lbnRJc3N1ZUltcGwgdG8gdGhlICJwdXJlIiBmb3JtIElzc3VlSW1wbCAoc29tZSBtZXRob2RzIGRvbid0IHdvcmsgd2l0aCBEb2N1bWVudElzc3VlSW1wcykNCiAgICAgICAgICAgICAgICAgICAgaXNzdWVzID0gc2VhcmNoUmVzdWx0Lmlzc3Vlcy5jb2xsZWN0IHtpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVPYmplY3QoaXQuaWQpfQ0KICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgIkFBUyAtLS0tLS0tPiBVdGVudGU6ICIgKyB1c2VyLmdldE5hbWUoKQ0KICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgIkFBUyAtLS0tLS0tPiBOdW0uIGlzc3VlIGFzc2VnbmF0ZTogIiArIGlzc3Vlcy5zaXplKCkNCiAgICAgICAgICAgICAgICAgICAgaWYoKGogPT0gMCB8fCBpc3N1ZXMuc2l6ZSgpIDwgbWluX2Fzc2lnbmVkX2lzc3VlcykgJiYgIXVzZXIuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCJyb2JlcnRhLmRvbGNpbmkiKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWluX2Fzc2lnbmVkX2lzc3VlcyA9IGlzc3Vlcy5zaXplKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbmVlID0gdXNlci5nZXROYW1lKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiQUFTIC0tLS0tLS0+IFVwZGF0ZSBtaW5fYXNzaWduZWRfaXNzdWU6ICIgKyBtaW5fYXNzaWduZWRfaXNzdWVzDQogICAgICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgIkFBUyAtLS0tLS0tPiBVcGRhdGUgYXNzaWduZWU6ICIgKyBhc3NpZ25lZQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGorKw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KbG9nLmRlYnVnICJBQVMgLS0tLS0tLT4gU2VsZWN0ZWQgYXNzaWduZWU6ICIgKyBhc3NpZ25lZQ0KaXNzdWUuc2V0QXNzaWduZWUoQ29tcG9uZW50TWFuYWdlci5pbnN0YW5jZS51c2VyVXRpbC5nZXRVc2VyT2JqZWN0KGFzc2lnbmVlKSkNCmlzc3VlLnN0b3JlKCkNCmluZGV4TWFuYWdlci5yZUluZGV4KGlzc3VlKQ0KDQovL2xvZy5kZWJ1ZyAiQXNzaWduZWU6ICIgKyBhc3NpZ25lZQ0KDQpDb21wb25lbnRNYW5hZ2VyLmluc3RhbmNlLmppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQuc2V0TG9nZ2VkSW5Vc2VyKG9sZFVzZXIpDQo=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID"></arg>
              <arg name="FIELD_NOTES"></arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">//Aggiornamento &quot;Request Participants&quot;
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.index.Index.Manager
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.util.UserManager
import com.atlassian.crowd.embedded.api.Group

def groupManager = ComponentAccessor.getGroupManager()

ComponentManager componentManager = ComponentManager.getInstance()
CustomFieldManager customFieldManager = componentManager.getCustomFieldManager()
def indexManager = componentManager.getIndexManager()
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()
CustomField requestParticipants = customFieldManager.getCustomFieldObject(14100)
CustomField ccAddresses = customFieldManager.getCustomFieldObject(14404)

//In produzione aggiungere il cambio utente in modo che la modifica la faccia 'atlassian'
User oldUser = ComponentManager.instance.jiraAuthenticationContext.getLoggedInUser()
ComponentManager.instance.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserUtil().getUserObject(&quot;atlassian&quot;))

userUtil = componentManager.getUserUtil()
List&lt;ApplicationUser&gt; requestParticipantsList = []
List&lt;ApplicationUser&gt; ccAddressesList = []
def v_jiraGroup = null
com.atlassian.crowd.embedded.api.Group not_jiraGroup = null

userUtil.getGroupNamesForUser(issue.reporter.name).each { group -&gt;
    // Ricerco il gruppo di appartenenza dell'utente - non HS-customers a cui appartengono tutti gli utenti ma quello specifico del team di visibilità
	if(group != &quot;AAS-customers&quot; &amp;&amp; group.contains(&quot;AAS-Visibility-&quot;)){
        v_jiraGroup = group
        retValue = groupManager.getUsersInGroup(group).each{ user -&gt;
            if(user.getName() != issue.reporter.name){
            	requestParticipantsList.add(userUtil.getUserByName(user.getName()));
            }
        }
    }
}

if (v_jiraGroup != null){
	n_jiraGroup = &quot;AAS-Notifications-&quot; + v_jiraGroup.substring(0+v_jiraGroup.indexOf(&quot;Visibility-&quot;)+11,v_jiraGroup.size())
	not_jiraGroup = ComponentAccessor.getUserManager().getGroup(n_jiraGroup);
}    

if (not_jiraGroup != null){
    retValue = groupManager.getUsersInGroup(not_jiraGroup).each{ user -&gt;
           	ccAddressesList.add(userUtil.getUserByName(user.getName()));
    }
}

if(requestParticipantsList.size &gt; 0){
	requestParticipants.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(requestParticipants),requestParticipantsList),changeHolder)
    indexManager.reIndex(issue);
}

if(ccAddressesList.size &gt; 0){
	ccAddresses.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(ccAddresses),ccAddressesList),changeHolder)
    indexManager.reIndex(issue);
}

ComponentManager.instance.jiraAuthenticationContext.setLoggedInUser(oldUser)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowreindexissue-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">1</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">CDR Support - Send email notification for Issue Create</arg>
              <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
              <arg name="FIELD_TO_ADDRESSES"></arg>
              <arg name="FIELD_CC_ADDRESSES"></arg>
              <arg name="FIELD_CC_USER_FIELDS"></arg>
              <arg name="FIELD_FUNCTION_ID">c8fdb108f1421f21492f2e27f959124d495c286a</arg>
              <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
                &lt;tbody&gt;
                    &lt;tr&gt;
                        &lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
                            &lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
                                &lt;tbody&gt;
                                    &lt;tr&gt;
                                        &lt;td align=&quot;left&quot;&gt;
                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
                                                &lt;tbody&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
                                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;tr&gt;
                                                                    	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
                        													&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
                        												&lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
                                                                            
                                                                            &lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
                                                                            &lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																			Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
                                                            &lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; &quot;&gt;
                                                            You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
												&lt;/tbody&gt;
											&lt;/table&gt;
											&lt;table border=&quot;0&quot;&gt;
												&lt;tbody&gt;
													&lt;tr&gt;
                                                        &lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
                                                            &lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Details&lt;/h2&gt;
                                                            &lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;){ %&gt;
                                                                                Categoria Prodotto
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;){ %&gt;
                                                                                Product Category
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15802&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Technical Docs&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)){ %&gt;
                                                                                Prodotto
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Technical Docs&quot;){ %&gt;
                                                                                Model
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15803&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Spare Parts&quot;)){ %&gt;
																	&lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)){ %&gt;
                                                                                Codice Prodotto
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Spare Parts&quot;){ %&gt;
                                                                                Product Code
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15804&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Technical Support Issue&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Info&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)){ %&gt;
                                                                                Matricola
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Technical Support Issue&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Info&quot;){ %&gt;
                                                                                Serial Number
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15703&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                                Installation Date
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15805&quot;)).toString().substring(0,10)%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Docs&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                                Garanzia
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15806&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                                Site Description
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15807&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;){ %&gt;
                                                                                Tipologia
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                                Problem Type
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15808&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot;) || (issue.getProjectObject().key == &quot;AAS&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot;){ %&gt;
                                                                                Descrizione della richiesta
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot;){ %&gt;
                                                                                Request description
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.description %&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Support Issue&quot;) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Support Issue&quot;){ %&gt;
                                                                                Revisione
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                                Revision
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15809&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Support Issue&quot;) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Support Issue&quot;){ %&gt;
                                                                                Quando si verifica?
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                                Occurs
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15810&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                        	N° of cases
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15811&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Task&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                        	Numero commessa
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15812&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                &lt;/tbody&gt;
                                            &lt;/table&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px;&quot;&gt;
                            &lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/center&gt;
    &lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE"></arg>
              <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">AAS Support - Send email notification for Issue Create</arg>
              <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
              <arg name="FIELD_TO_ADDRESSES"></arg>
              <arg name="FIELD_CC_ADDRESSES"></arg>
              <arg name="FIELD_CC_USER_FIELDS">customfield_14100</arg>
              <arg name="FIELD_FUNCTION_ID">187f8094b74653366a6fcc3f7bd0a2d7dc6ef310</arg>
              <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
                &lt;tbody&gt;
                    &lt;tr&gt;
                        &lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
                            &lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
                                &lt;tbody&gt;
                                    &lt;tr&gt;
                                        &lt;td align=&quot;left&quot;&gt;
                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
                                                &lt;tbody&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
                                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;tr&gt;
                                                                    	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
                        													&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
                        												&lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
                                                                            
                                                                            &lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
                                                                            &lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																			Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
                                                            &lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; &quot;&gt;
                                                            You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
												&lt;/tbody&gt;
											&lt;/table&gt;
											&lt;table border=&quot;0&quot;&gt;
												&lt;tbody&gt;
													&lt;tr&gt;
                                                        &lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
                                                            &lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Details&lt;/h2&gt;
                                                            &lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;){ %&gt;
                                                                                Categoria Prodotto
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;){ %&gt;
                                                                                Product Category
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15802&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Technical Docs&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)){ %&gt;
                                                                                Prodotto
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Technical Docs&quot;){ %&gt;
                                                                                Model
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15803&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Spare Parts&quot;)){ %&gt;
																	&lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)){ %&gt;
                                                                                Codice Prodotto
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Spare Parts&quot;){ %&gt;
                                                                                Product Code
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15804&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Technical Support Issue&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Info&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name.toString().contains(&quot;Technical&quot;)){ %&gt;
                                                                                Matricola
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Technical Support Issue&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Info&quot;){ %&gt;
                                                                                Serial Number
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15703&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt; align: left;&quot;&gt;
                                                                                Installation Date
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; align: left;&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15805&quot;)).toString().substring(0,10)%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Docs&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                                Garanzia
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15806&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                                Site Description
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15807&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name != &quot;Suggestions&quot;){ %&gt;
                                                                                Tipologia
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                                Problem Type
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15808&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot;) || (issue.getProjectObject().key == &quot;AAS&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot;){ %&gt;
                                                                                Descrizione della richiesta
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot;){ %&gt;
                                                                                Request description
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.description %&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Support Issue&quot;) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Support Issue&quot;){ %&gt;
                                                                                Revisione
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                                Revision
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15809&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if((issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Support Issue&quot;) || (issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;)){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Technical Support Issue&quot;){ %&gt;
                                                                                Quando si verifica?
                                                                            &lt;%}%&gt;
                                                                            &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                                Occurs
                                                                            &lt;%}%&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15810&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;% } %&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;AAS&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Fault&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                        	N° of cases
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15811&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                    
                                                                    &lt;% if(issue.getProjectObject().key == &quot;CDR&quot; &amp;&amp; issue.issueTypeObject.name == &quot;Task&quot;){ %&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 10%; padding-right: 10px; font-size: 10pt&quot;&gt;
                                                                        	Numero commessa
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
                                                                            &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15812&quot;))%&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;%}%&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                &lt;/tbody&gt;
                                            &lt;/table&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px;&quot;&gt;
                            &lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/center&gt;
    &lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">AAS-1</arg>
              <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <common-actions>
    <action id="761" name="Close this issue" view="fieldscreen">
      <meta name="jira.field.resolution.include">1,10301</meta>
      <meta name="opsbar-sequence">30</meta>
      <meta name="jira.i18n.submit">sd.workflow.itsupport.v2.transition.resolve.this.issue.submit</meta>
      <meta name="jira.description"></meta>
      <meta name="jira.i18n.description">sd.workflow.itsupport.v2.transition.resolve.this.issue.description</meta>
      <meta name="jira.i18n.title">sd.workflow.itsupport.v2.transition.resolve.this.issue.title</meta>
      <meta name="jira.fieldscreen.id">14300</meta>
      <meta name="sd.tour.resolve.step">true</meta>
      <results>
        <unconditional-result old-status="Not Done" status="Done" step="13">
          <post-functions>
            <function type="class">
              <arg name="field.name">customfield_15814</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="field.value"></arg>
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdateissuestatus-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowcreatecomment-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowgeneratechangehistory-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">9a52f6c3e64570899907724da46dc2793676ce70</arg>
              <arg name="FIELD_NOTES">Update &quot;Request Status Description&quot; custom field</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
CustomField send_to_customer = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15814&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT NAME AS CALL_TO_ACTION FROM AO_54307E_VIEWPORTFORM WHERE VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;) AND ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String request_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	request_desc = it.CALL_TO_ACTION
}

issue.setCustomFieldValue(request_description, request_desc)
indexManager.reIndex(issue)
issue.store()

sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 6 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()

if(transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;} != null){
    issue.setCustomFieldValue(send_to_customer, transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}[&quot;to&quot;].toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;))
}</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowreindexissue-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Close issue&quot;</arg>
              <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
              <arg name="FIELD_TO_ADDRESSES"></arg>
              <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
              <arg name="FIELD_CC_USER_FIELDS"></arg>
              <arg name="FIELD_FUNCTION_ID">0bc6d7cce2efa3e1a2f364ba7a3d273564c843f6</arg>
              <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
                &lt;tbody&gt;
                    &lt;tr&gt;
                        &lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
                            &lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
                                &lt;tbody&gt;
                                    &lt;tr&gt;
                                        &lt;td align=&quot;left&quot;&gt;
                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
                                                &lt;tbody&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
                                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;tr&gt;
                                                                    	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
                        													&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
                        												&lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
                                                                            
                                                                            &lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
                                                                            &lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																			Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
                                                            &lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
                                                            You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                &lt;/tbody&gt;
                                            &lt;/table&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
									&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
									&lt;tr&gt;
										&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
											&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
											&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
												&lt;tr&gt;
													&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
														&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
														&lt;% out &lt;&lt; lastComment %&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/table&gt;
										&lt;/td&gt;
									&lt;/tr&gt;
									&lt;% } %&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
                            &lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE"></arg>
              <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Close issue&quot;</arg>
              <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
              <arg name="FIELD_TO_ADDRESSES"></arg>
              <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
              <arg name="FIELD_CC_USER_FIELDS"></arg>
              <arg name="FIELD_FUNCTION_ID">432b6c487fe2e26ab11b2a7c460179d64bc3cbaa</arg>
              <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
                &lt;tbody&gt;
                    &lt;tr&gt;
                        &lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
                            &lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
                                &lt;tbody&gt;
                                    &lt;tr&gt;
                                        &lt;td align=&quot;left&quot;&gt;
                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
                                                &lt;tbody&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
                                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;tr&gt;
                                                                    	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
                        													&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
                        												&lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
                                                                            
                                                                            &lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
                                                                            &lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																			Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
                                                            &lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
                                                            You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                &lt;/tbody&gt;
                                            &lt;/table&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
									&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
									&lt;tr&gt;
										&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
											&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
											&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
												&lt;tr&gt;
													&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
														&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
														&lt;% out &lt;&lt; lastComment %&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/table&gt;
										&lt;/td&gt;
									&lt;/tr&gt;
									&lt;% } %&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
                            &lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE"></arg>
              <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
            </function>
            <function type="class">
              <arg name="field.name">customfield_15813</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="field.value">null</arg>
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="911" name="Reopen issue" view="fieldscreen">
      <meta name="sd.resolution.clear"></meta>
      <meta name="jira.description"></meta>
      <meta name="jira.fieldscreen.id">14302</meta>
      <results>
        <unconditional-result old-status="null" status="null" step="11">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value"></arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">5a91e7ab24cef4215bc12d407c6936cae53f902f</arg>
              <arg name="FIELD_NOTES">Update &quot;Request Status Description&quot; custom field</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT NAME AS CALL_TO_ACTION FROM AO_54307E_VIEWPORTFORM WHERE VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;) AND ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String request_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	request_desc = it.CALL_TO_ACTION
}

issue.setCustomFieldValue(request_description, request_desc)
indexManager.reIndex(issue)
issue.store()

sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 3 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">7</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Reopen issue&quot;</arg>
              <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
              <arg name="FIELD_TO_ADDRESSES"></arg>
              <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
              <arg name="FIELD_CC_USER_FIELDS"></arg>
              <arg name="FIELD_FUNCTION_ID">d57139bcf956c24b2aeefa48519b5b5c7662338d</arg>
              <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
                &lt;tbody&gt;
                    &lt;tr&gt;
                        &lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
                            &lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
                                &lt;tbody&gt;
                                    &lt;tr&gt;
                                        &lt;td align=&quot;left&quot;&gt;
                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
                                                &lt;tbody&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
                                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;tr&gt;
                                                                    	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
                        													&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
                        												&lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
                                                                            &lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
                                                                            &lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																			Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
                                                            &lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
                                                            You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                &lt;/tbody&gt;
                                            &lt;/table&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
                            &lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
			&lt;/div&gt;
        &lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE"></arg>
              <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Reopen issue&quot;</arg>
              <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
              <arg name="FIELD_TO_ADDRESSES"></arg>
              <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
              <arg name="FIELD_CC_USER_FIELDS"></arg>
              <arg name="FIELD_FUNCTION_ID">844a2af28916e40e4eddea36c73ea4a196515a6b</arg>
              <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
                &lt;tbody&gt;
                    &lt;tr&gt;
                        &lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
                            &lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
                                &lt;tbody&gt;
                                    &lt;tr&gt;
                                        &lt;td align=&quot;left&quot;&gt;
                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
                                                &lt;tbody&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
                                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;tr&gt;
                                                                    	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
                        													&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
                        												&lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
                                                                            &lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
                                                                            &lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																			Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
                                                            &lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
                                                            You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                &lt;/tbody&gt;
                                            &lt;/table&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
                            &lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
			&lt;/div&gt;
        &lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE"></arg>
              <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </common-actions>
  <steps>
    <step id="10" name="Waiting for customer">
      <meta name="jira.status.id">10024</meta>
      <meta name="sd.step.key">sdWFCustomer</meta>
      <actions>
        <action id="781" name="Customer back to support">
          <meta name="jira.i18n.submit">sd.workflow.itsupport.v2.transition.respond.to.support.submit</meta>
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.i18n.description">sd.workflow.itsupport.v2.transition.respond.to.support.description</meta>
          <meta name="jira.i18n.title">sd.workflow.itsupport.v2.transition.respond.to.support.title</meta>
          <meta name="jira.fieldscreen.id"></meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyReporter</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="Not Done" status="Done" step="11">
              <post-functions>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdateissuestatus-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowcreatecomment-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">5a91e7ab24cef4215bc12d407c6936cae53f902f</arg>
                  <arg name="FIELD_NOTES">Update &quot;Request Status Description&quot; custom field</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT NAME AS CALL_TO_ACTION FROM AO_54307E_VIEWPORTFORM WHERE VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;) AND ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String request_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	request_desc = it.CALL_TO_ACTION
}

issue.setCustomFieldValue(request_description, request_desc)
indexManager.reIndex(issue)
issue.store()

sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 3 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowgeneratechangehistory-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowreindexissue-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Customer Back to Support&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">ce6ac61b881daf3695fea8302db01d5444cf3c1c</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px;&quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal;&quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px;&quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Customer Back to Support&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">6ece8f29d7345c9f47117e50a8f8a363e18bb7ff</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px;&quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal;&quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px;&quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="871" name="Expired">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="12">
              <post-functions>
                <function type="class">
                  <arg name="field.name">resolution</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">10301</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">12dbe5d8132505f742d9ebaff47217fbd8f9e28c</arg>
                  <arg name="FIELD_NOTES">Update &quot;Request Status Description&quot; custom field</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT NAME AS CALL_TO_ACTION FROM AO_54307E_VIEWPORTFORM WHERE VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;) AND ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String request_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	request_desc = it.CALL_TO_ACTION
}

issue.setCustomFieldValue(request_description, request_desc)
indexManager.reIndex(issue)
issue.store()

sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 11927 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Expired&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">bbadfdb0db0f1cf7d9fc5342f9e03511ca2e187c</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
                &lt;tbody&gt;
                    &lt;tr&gt;
                    	&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
                            &lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; line-height: 1,500&quot;&gt;
                                &lt;tbody&gt;
                                    &lt;tr&gt;
                                        &lt;td align=&quot;left&quot;&gt;
                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
                                                &lt;tbody&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; line-height: 1,200&quot;&gt;
                                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;tr&gt;
                                                                    	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
                        													&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
                        												&lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
                                                                            &lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
                                                                            &lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																			Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
                                                            &lt;h1 style=&quot;margin: 0; line-height: 1,200; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
                                                            You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                &lt;/tbody&gt;
                                            &lt;/table&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200&quot;&gt;
                            &lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Expired&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">28acc627ed5d1c865f6bd1247f971afd07133bfa</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
                &lt;tbody&gt;
                    &lt;tr&gt;
                    	&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
                            &lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; line-height: 1,500&quot;&gt;
                                &lt;tbody&gt;
                                    &lt;tr&gt;
                                        &lt;td align=&quot;left&quot;&gt;
                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
                                                &lt;tbody&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; line-height: 1,200&quot;&gt;
                                                            &lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
                                                                &lt;tbody&gt;
                                                                	&lt;tr&gt;
                                                                    	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
                        													&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
                        												&lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                    &lt;tr&gt;
                                                                        &lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
                                                                            &lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
                                                                        &lt;/td&gt;
                                                                        &lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
                                                                            &lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																			Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
                                                                        &lt;/td&gt;
                                                                    &lt;/tr&gt;
                                                                &lt;/tbody&gt;
                                                            &lt;/table&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
                                                            &lt;h1 style=&quot;margin: 0; line-height: 1,200; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                    &lt;tr&gt;
                                                        &lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
                                                            You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                &lt;/tbody&gt;
                                            &lt;/table&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200&quot;&gt;
                            &lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="881" name="Send comment to customer" view="fieldscreen">
          <meta name="opsbar-sequence">30</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">14400</meta>
          <results>
            <unconditional-result old-status="null" status="null" step="10">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_15814</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID"></arg>
                  <arg name="FIELD_NOTES"></arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
CustomField send_to_customer = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15814&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 10024 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;

//log.debug &quot;SQL: &quot; + sqlStmt
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}
//log.debug &quot;Status desc: &quot; + status_desc
issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()

//CustomField cfParent = customFieldManager.getCustomFieldObjectByName('Comment visibility')
/*log.debug &quot;transient vars:&quot; + transientVars.get(&quot;changeItems&quot;)
log.debug &quot;custom field: &quot; + transientVars.get(&quot;issue&quot;)

List changeItems = transientVars[&quot;changeItems&quot;] as List
changeItems.each{Object cib -&gt;
    log.debug cib[&quot;field&quot;]// == &quot;Comment visibility&quot;
}//?.get(&quot;toString&quot;)
/*
log.debug changeItems.find{Object cib -&gt;
    cib[&quot;field&quot;] == &quot;Comment visibility&quot;
}[&quot;to&quot;]
*/
/*
log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
*/
if(transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;} != null){
    //log.debug &quot;aggiorno custom field value&quot;
    issue.setCustomFieldValue(send_to_customer, transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}[&quot;to&quot;].toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;))
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Send comment to customer&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">ce94cb4bf8307512419c8cabc39b0c89cf42398c</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Send comment to customer&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">d5ea16a6c399f218db28d08dd2ba22268c01084a</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="field.name">customfield_15813</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">null</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="11" name="In Progress">
      <meta name="jira.status.id">3</meta>
      <actions>
<common-action id="761" />
        <action id="851" name="Respond to customer" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.i18n.submit">sd.workflow.itsupport.v2.transition.respond.to.customer.submit</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.i18n.description"></meta>
          <meta name="jira.i18n.title">sd.workflow.itsupport.v2.transition.respond.to.customer.title</meta>
          <meta name="jira.fieldscreen.id">14301</meta>
          <results>
            <unconditional-result old-status="Not Done" status="Done" step="10">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_15814</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdateissuestatus-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowcreatecomment-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowgeneratechangehistory-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID"></arg>
                  <arg name="FIELD_NOTES">Update &quot;Request Status Description&quot; custom field</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
CustomField send_to_customer = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15814&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 10024 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;

//log.debug &quot;SQL: &quot; + sqlStmt
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

//log.debug &quot;Status desc: &quot; + status_desc
issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()

//CustomField cfParent = customFieldManager.getCustomFieldObjectByName('Comment visibility')
/*log.debug &quot;transient vars:&quot; + transientVars.get(&quot;changeItems&quot;)
log.debug &quot;custom field: &quot; + transientVars.get(&quot;issue&quot;)

List changeItems = transientVars[&quot;changeItems&quot;] as List
changeItems.each{Object cib -&gt;
    log.debug cib[&quot;field&quot;]// == &quot;Comment visibility&quot;
}//?.get(&quot;toString&quot;)

log.debug changeItems.find{Object cib -&gt;
    cib[&quot;field&quot;] == &quot;Comment visibility&quot;
}[&quot;to&quot;]

log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
*/
if(transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;} != null){
    //log.debug &quot;aggiorno custom field value&quot;
    issue.setCustomFieldValue(send_to_customer, transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}[&quot;to&quot;].toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;))
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowreindexissue-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Respond to customer&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NEW</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">ede64c0b9b14a49000b8274e6fe1f2f2ee2afc8c</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px;&quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal;&quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; &quot;&gt;
														You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px;&quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Respond to customer&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NEW</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">c38937f351f5d9bd73d5554db6decc4260dca0d3</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px;&quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal;&quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; &quot;&gt;
														You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px;&quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="field.name">customfield_15813</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">null</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="891" name="Hold for investigation" view="fieldscreen">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">11201</meta>
          <results>
            <unconditional-result old-status="null" status="null" step="14">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_15814</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">8879a986e7b32cc3653b2b7cd7b2f6670bf45c52</arg>
                  <arg name="FIELD_NOTES"></arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
CustomField send_to_customer = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15814&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT NAME AS CALL_TO_ACTION FROM AO_54307E_VIEWPORTFORM WHERE VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;) AND ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String request_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	request_desc = it.CALL_TO_ACTION
}

issue.setCustomFieldValue(request_description, request_desc)
indexManager.reIndex(issue)
issue.store()

sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 11928 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

//log.debug &quot;SQL: &quot; + sqlStmt
//log.debug &quot;Stato estratto: &quot; + status_desc
issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()

/*List changeItems = transientVars[&quot;changeItems&quot;] as List
changeItems.each{Object cib -&gt;
    log.debug cib[&quot;field&quot;]// == &quot;Comment visibility&quot;
}//?.get(&quot;toString&quot;)

log.debug changeItems
log.debug &quot;Transient vars: &quot; + transientVars

log.debug changeItems.find{Object cib -&gt;
    cib[&quot;field&quot;] == &quot;Comment visibility&quot;
}

log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
*/
if(transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;} != null){
    //log.debug &quot;aggiorno custom field value&quot;
    issue.setCustomFieldValue(send_to_customer, transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}[&quot;to&quot;].toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;))
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Hold for investigation&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">5c2598bb8039be585695621a0d75ad1c22ecd354</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px;&quot;&gt;
														You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt; vertical-align:text-top;&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; vertical-align:text-top;&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Hold for investigation&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">fa62fe42134a152b8e7785f6d6c1da462c1267e3</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px;&quot;&gt;
														You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt; vertical-align:text-top;&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0; vertical-align:text-top;&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="field.name">customfield_15813</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">null</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="901" name="Send comment to customer" view="fieldscreen">
          <meta name="opsbar-sequence">60</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">14400</meta>
          <results>
            <unconditional-result old-status="null" status="null" step="11">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_15814</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID"></arg>
                  <arg name="FIELD_NOTES"></arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
CustomField send_to_customer = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15814&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 3 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()
/*
//CustomField cfParent = customFieldManager.getCustomFieldObjectByName('Comment visibility')
log.debug &quot;transient vars:&quot; + transientVars.get(&quot;changeItems&quot;)
log.debug &quot;custom field: &quot; + transientVars.get(&quot;issue&quot;)

List changeItems = transientVars[&quot;changeItems&quot;] as List
changeItems.each{Object cib -&gt;
    log.debug cib[&quot;field&quot;]// == &quot;Comment visibility&quot;
}//?.get(&quot;toString&quot;)
/*
log.debug changeItems.find{Object cib -&gt;
    cib[&quot;field&quot;] == &quot;Comment visibility&quot;
}[&quot;to&quot;]
*/
/*
log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
*/
if(transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;} != null){
    //log.debug &quot;aggiorno custom field value&quot;
    issue.setCustomFieldValue(send_to_customer, transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}[&quot;to&quot;].toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;))
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Send comment to customer&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">ce94cb4bf8307512419c8cabc39b0c89cf42398c</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Send comment to customer&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">16719128af6e456bf68672571ccc82bdc7d6c0b0</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="field.name">customfield_15813</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">null</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="12" name="Expired Request">
      <meta name="jira.status.id">11927</meta>
      <actions>
<common-action id="761" />
<common-action id="911" />
        <action id="921" name="Send comment to customer" view="fieldscreen">
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">14400</meta>
          <results>
            <unconditional-result old-status="null" status="null" step="12">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_15814</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID"></arg>
                  <arg name="FIELD_NOTES">Update &quot;Request Status Description&quot; custom field</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
CustomField send_to_customer = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15814&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 11927 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()

//CustomField cfParent = customFieldManager.getCustomFieldObjectByName('Comment visibility')
//log.debug &quot;transient vars:&quot; + transientVars.get(&quot;changeItems&quot;)
//log.debug &quot;custom field: &quot; + transientVars.get(&quot;issue&quot;)

/*List changeItems = transientVars[&quot;changeItems&quot;] as List
changeItems.each{Object cib -&gt;
    log.debug cib[&quot;field&quot;]// == &quot;Comment visibility&quot;
}//?.get(&quot;toString&quot;)*/
/*
log.debug changeItems.find{Object cib -&gt;
    cib[&quot;field&quot;] == &quot;Comment visibility&quot;
}[&quot;to&quot;]
*/
//log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
//log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}

if(transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;} != null){
    //log.debug &quot;aggiorno custom field value&quot;
    issue.setCustomFieldValue(send_to_customer, transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}[&quot;to&quot;].toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;))
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Send comment to customer&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">ce94cb4bf8307512419c8cabc39b0c89cf42398c</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Send comment to customer&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">d5ea16a6c399f218db28d08dd2ba22268c01084a</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="field.name">customfield_15813</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">null</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="13" name="Closed">
      <meta name="jira.status.id">6</meta>
      <actions>
<common-action id="911" />
      </actions>
    </step>
    <step id="14" name="Hold for investigation">
      <meta name="jira.status.id">11928</meta>
      <actions>
        <action id="931" name="Restart progress" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">11201</meta>
          <results>
            <unconditional-result old-status="null" status="null" step="11">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_15814</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">198e995619f1f1a24d0115505be6d925726d1e7a</arg>
                  <arg name="FIELD_NOTES">Update &quot;Request Status Description&quot; custom field</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
CustomField send_to_customer = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15814&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT NAME AS CALL_TO_ACTION FROM AO_54307E_VIEWPORTFORM WHERE VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;) AND ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String request_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	request_desc = it.CALL_TO_ACTION
}

issue.setCustomFieldValue(request_description, request_desc)
indexManager.reIndex(issue)
issue.store()

sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 3 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()

if(transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;} != null){
    issue.setCustomFieldValue(send_to_customer, transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}[&quot;to&quot;].toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;))
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Restart progress&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">67bbdf6ab739847034f177e042b11236afab36b5</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px;&quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal;&quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Restart progress&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS"></arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">054131a248fe0d0fdc02bba52b4c21a1561de683</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px;&quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal;&quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="field.name">customfield_15813</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">null</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="941" name="Send comment to customer" view="fieldscreen">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">14400</meta>
          <results>
            <unconditional-result old-status="null" status="null" step="14">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_15814</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID"></arg>
                  <arg name="FIELD_NOTES">Update &quot;Request Status Description&quot; custom field</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.ModifiedValue

import org.apache.log4j.Category
Category log = Category.getInstance(&quot;com.onresolve.jira.groovy.PostFunction&quot;)
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField request_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15800&quot;))
CustomField status_description = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15801&quot;))
CustomField send_to_customer = customFieldManager.getCustomFieldObject(Long.parseLong(&quot;15814&quot;))
Object companyValue = issue.getCustomFieldValue(request_description)
def indexManager = ComponentAccessor.getIssueIndexManager()

IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

ComponentManager componentManager = ComponentManager.getInstance()
DelegatorInterface delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName(&quot;default&quot;);

//Select request description on service desk
def sqlStmt = &quot;SELECT STATUS_NAME FROM AO_54307E_STATUSMAPPING WHERE STATUS_ID = 11928 AND FORM_ID = (SELECT ID FROM AO_54307E_VIEWPORTFORM WHERE ISSUE_TYPE_ID = &quot; + issue.getIssueTypeObject().id + &quot; AND VIEWPORT_ID = (SELECT ID FROM AO_54307E_VIEWPORT WHERE PROJECT_ID = &quot; + issue.getProjectObject().id + &quot;))&quot;
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
String status_desc //= new StringBuffer()
sql.eachRow(sqlStmt) {
	status_desc = it.STATUS_NAME
}

issue.setCustomFieldValue(status_description, status_desc)
indexManager.reIndex(issue)
issue.store()

//log.debug &quot;SQL: &quot; + sqlStmt
//log.debug &quot;Status desc: &quot; + status_desc

//CustomField cfParent = customFieldManager.getCustomFieldObjectByName('Comment visibility')
/*log.debug &quot;transient vars:&quot; + transientVars.get(&quot;changeItems&quot;)
log.debug &quot;custom field: &quot; + transientVars.get(&quot;issue&quot;)

List changeItems = transientVars[&quot;changeItems&quot;] as List
changeItems.each{Object cib -&gt;
    log.debug cib[&quot;field&quot;]// == &quot;Comment visibility&quot;
}//?.get(&quot;toString&quot;)
/*
log.debug changeItems.find{Object cib -&gt;
    cib[&quot;field&quot;] == &quot;Comment visibility&quot;
}[&quot;to&quot;]
*/
/*
log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
log.debug transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}
*/
if(transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;} != null){
    //log.debug &quot;aggiorno custom field value&quot;
    issue.setCustomFieldValue(send_to_customer, transientVars[&quot;changeItems&quot;].find{Object cib -&gt; cib[&quot;field&quot;] == &quot;Comment visibility&quot;}[&quot;to&quot;].toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;))
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">CDR Support - Send email notification for &quot;Send comment to customer&quot;</arg>
                  <arg name="FIELD_FROM">cdr-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">ce94cb4bf8307512419c8cabc39b0c89cf42398c</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://cdr-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://cdr-support.faacgroup.com/servicedesk/customer/portal/6/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;CDR&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">AAS Support - Send email notification for &quot;Send comment to customer&quot;</arg>
                  <arg name="FIELD_FROM">aa-support@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES"></arg>
                  <arg name="FIELD_CC_ADDRESSES">techsupport@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS"></arg>
                  <arg name="FIELD_FUNCTION_ID">d5ea16a6c399f218db28d08dd2ba22268c01084a</arg>
                  <arg name="FIELD_TO_USER_FIELDS">reporter</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK"></arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
		.table-responsive {width: 100%;}

		/* stile del bordo per la tabella (facoltativo) */
		.table-responsive table {
			border: 0px;
			font-family: Verdana; 
			background-color: #FFFFFF; 
			font-size: 16px; 
		}

		/* istruzioni per le celle (alcune sono obbligatorie) */
		.table-responsive table td, .table-responsive table th {min-width: 50px; width: 24%; word-break: break-all; padding: 1%;}

		/* larghezza delle immagini (facoltativo) */
		.table-responsive table td img {max-width: 98%;}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body style=&quot;background-color: #FFFFFF; font-size: 16px; font-family: Verdana&quot;&gt;
	&lt;div class=&quot;table-responsive&quot;&gt;
		&lt;table id=&quot;email-wrap&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;td align=&quot;center&quot; id=&quot;email-wrap-cell&quot; style=&quot;padding: 20px 10px 10px&quot;&gt;
						&lt;table id=&quot;email-container&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 800px; &quot;&gt;
							&lt;tbody&gt;
								&lt;tr&gt;
									&lt;td align=&quot;left&quot;&gt;
										&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;border: solid #ddd; border-width: 2px; width: 100%; font-family: Verdana&quot;&gt;
											&lt;tbody&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-header&quot; style=&quot;padding: 10px 20px; background-color: #fff; font-weight: normal; &quot;&gt;
														&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana; width: 100%&quot;&gt;
															&lt;tbody&gt;
																&lt;tr&gt;
																	&lt;td colspan=&quot;2&quot; background-color:&quot;#FFFFFF&quot; align=&quot;left&quot;&gt;
																		&lt;img src=&quot;http://aa-support.faacgroup.com/images/loghi/logo_Access_Automation.png&quot;/&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
																&lt;tr&gt;
																	&lt;td class=&quot;viewport-details&quot; style=&quot;width: 70%&quot;&gt;
																		
																		&lt;p style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #111111&quot;&gt;&lt;strong style=&quot;font-weight: bold;color:#CF6400;&quot;&gt;$issue.project.name&lt;/strong&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15800&quot;))%&gt;&lt;/p&gt;
																	&lt;/td&gt;
																	&lt;td class=&quot;request-key&quot; style=&quot;width: 30%; text-align: right; font-size: 12px; line-height: 18px; text-decoration: none&quot;&gt;
																		&lt;!-- &lt;a href=&quot;http://support.hubparking.com/servicedesk/customer/portal/2/$issue&quot; style=&quot;font-size: 14px; font-weight: normal; text-decoration: none; color: #707070&quot;&gt;Reference: &lt;strong style=&quot;font-weight: bold&quot;&gt;[$issue]&lt;/strong&gt;&lt;/a&gt; --&gt;
																		Reference: &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; style=&quot;font-size: 12px; font-weight: bold; text-decoration: none; color: #CF6400&quot;&gt;$issue&lt;/a&gt;
																	&lt;/td&gt;
																&lt;/tr&gt;
															&lt;/tbody&gt;
														&lt;/table&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-content-important email-heading&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding-top: 10px; border-top-color: #f5f5f5&quot;&gt;
														&lt;h1 style=&quot;margin: 0; font-size: 14pt; font-weight: normal; color: #111111&quot;&gt;&lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot; class=&quot;header-request-link&quot; style=&quot;color: #111; text-decoration: none&quot;&gt;$issue.summary&lt;/a&gt; &lt;span class=&quot;request-status aui-lozenge aui-lozenge-current&quot; style=&quot;background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #FFFFFF; border-color: #CF6400; color: #111111; margin-left: 5px; font-weight: bold; font-size: 8pt&quot;&gt;&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15801&quot;))%&gt;&lt;/span&gt;&lt;/h1&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
												&lt;tr&gt;
													&lt;td class=&quot;email-actions email-content-important&quot; style=&quot;text-align: left; padding: 20px; background-color: #fff; padding: 20px; padding-top: 0; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px&quot;&gt;
														You can &lt;a href=&quot;http://aa-support.faacgroup.com/servicedesk/customer/portal/5/$issue&quot;&gt;view the full request&lt;/a&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;/tbody&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObject(&quot;customfield_15814&quot;)) != null){ %&gt;
								&lt;tr&gt;
									&lt;td class=&quot;email-details&quot; style=&quot;padding: 20px&quot;&gt;
										&lt;h2 style=&quot;color: #111; margin: 0 0 10px; font-size: 12pt; font-weight: bold&quot;&gt;Last comment added to the request&lt;/h2&gt;
										&lt;table class=&quot;email-request-details&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;width: 100%; font-family: Verdana&quot;&gt;
											&lt;tr&gt;
												&lt;td class=&quot;label&quot; style=&quot;padding: 5px 0; color: #707070; width: 120px; padding-right: 10px; font-size: 10pt&quot;&gt;
													&lt;% out &lt;&lt; componentManager.userUtil.getUserObject(componentManager.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td class=&quot;value&quot; style=&quot;padding: 5px 0&quot;&gt;
													&lt;% out &lt;&lt; lastComment %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;% } %&gt;
							&lt;/tbody&gt;
						&lt;/table&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td id=&quot;foot-note&quot; style=&quot;padding-bottom: 20px; color: #707070; font-size: 12px; &quot;&gt;
						&lt;p style=&quot;width: 600px; text-align: center; margin: 0 auto&quot;&gt;This message is automatically generated by $issue.project.name Portal.&lt;br /&gt;&lt;/p&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">issue.getProjectObject().key == &quot;AAS&quot;</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE"></arg>
                  <arg name="FIELD_EMAIL_FORMAT">HTML</arg>
                </function>
                <function type="class">
                  <arg name="field.name">customfield_15813</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">null</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
  </steps>
</workflow>
