<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE workflow PUBLIC "-//OpenSymphony Group//DTD OSWorkflow 2.8//EN" "http://www.opensymphony.com/osworkflow/workflow_2_8.dtd">
<workflow>
  <meta name="jira.description"></meta>
  <meta name="jira.update.author.key">arianna.fabbri</meta>
  <meta name="jira.updated.date">1631176659553</meta>
  <initial-actions>
    <action id="1" name="Create">
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="null" status="open" step="1">
          <post-functions>
            <function type="class">
              <arg name="FIELD_SECURITY_LEVEL_ID">11600</arg>
              <arg name="FIELD_NOTES">YCFgU2V0ICJPcGVyYXRpb24gUG9ydGFsIC0gRkFBQyBTZXJ2aWNlIiBJc3N1ZSBTZWN1cml0eSBMZXZlbA==</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SetIssueSecurity</arg>
              <arg name="FIELD_CONDITION"></arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
            </function>
            <function type="class">
              <arg name="scopeSource-linkEnd"></arg>
              <arg name="append.value"></arg>
              <arg name="field.value">%%CURRENT_DATETIME%%</arg>
              <arg name="field.name">customfield_22715</arg>
              <arg name="scopeType">SAME</arg>
              <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="scopeDestination-linkEnd"></arg>
              <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="scopeDestination-jql"></arg>
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
              <arg name="scopeSource-jql"></arg>
            </function>
            <function type="class">
              <arg name="conditionList">3</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesvalueField-precondition-function</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="comparisonType">1</arg>
              <arg name="precondition">true</arg>
              <arg name="class.name">ch.beecom.jira.jsu.workflow.function.valuefield.ValueFieldPreconditionFunction</arg>
              <arg name="preconditionNegateResult-booleanValue"></arg>
              <arg name="fieldValue">Maintenance Ticket</arg>
              <arg name="preconditionMode-textValue">DISCARD</arg>
              <arg name="fieldsList">issuetype</arg>
            </function>
            <function type="class">
              <arg name="scopeSource-linkEnd"></arg>
              <arg name="append.value"></arg>
              <arg name="field.value">Yes</arg>
              <arg name="field.name">customfield_22620</arg>
              <arg name="scopeType">SAME</arg>
              <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="scopeDestination-linkEnd"></arg>
              <arg name="preconditionAwareFunctionMode-textValue">FALSE</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="scopeDestination-jql"></arg>
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
              <arg name="scopeSource-jql"></arg>
            </function>
            <function type="class">
              <arg name="scopeSource-linkEnd"></arg>
              <arg name="append.value"></arg>
              <arg name="field.value">New Installation Ticket</arg>
              <arg name="field.name">customfield_22716</arg>
              <arg name="scopeType">SAME</arg>
              <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="scopeDestination-linkEnd"></arg>
              <arg name="preconditionAwareFunctionMode-textValue">FALSE</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="scopeDestination-jql"></arg>
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
              <arg name="scopeSource-jql"></arg>
            </function>
            <function type="class">
              <arg name="scopeSource-linkEnd"></arg>
              <arg name="append.value"></arg>
              <arg name="field.value">Maintenance Ticket</arg>
              <arg name="field.name">customfield_22716</arg>
              <arg name="scopeType">SAME</arg>
              <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="scopeDestination-linkEnd"></arg>
              <arg name="preconditionAwareFunctionMode-textValue">TRUE</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="scopeDestination-jql"></arg>
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
              <arg name="scopeSource-jql"></arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">YCFgTGluayBOZXcgSW5zdGFsbGF0aW9uIFRpY2tldHM=</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXIKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uU2x1cnBlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb25maWcudXRpbC5KaXJhSG9tZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQKaW1wb3J0IGphdmEudGV4dC5QYXJzZUV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLnNlY3VyaXR5LkppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5iYy5pc3N1ZS5Jc3N1ZVNlcnZpY2UuSXNzdWVSZXN1bHQKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5qcWwucGFyc2VyLkpxbFF1ZXJ5UGFyc2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuYmMuaXNzdWUuc2VhcmNoLlNlYXJjaFNlcnZpY2UKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS51c2VyLnV0aWwuVXNlclV0aWwKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS53ZWIuYmVhbi5QYWdlckZpbHRlcgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuTGlua0NvbGxlY3Rpb25JbXBsOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk1vZGlmaWVkVmFsdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS51dGlsLkRlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcgoKaW1wb3J0IGdyb292eS51dGlsLmxvZ2dpbmcuU2xmNGoKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRIYXNoTWFwCmltcG9ydCBqYXZheC5hbm5vdGF0aW9uLlBvc3RDb25zdHJ1Y3QKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuY2FjaGUuYW5ub3RhdGlvbi5DYWNoZWFibGUKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KZGVmIENhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKLypTY3JpcHQgVmFyaWFibGVzKi8KLy9QZXIgUG9zdCBGdW5jdGlvbgppc3N1ZSA9IGlzc3VlCi8vUGVyIHRlc3QgZGEgY29uc29sZQovL0lzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKQovL2lzc3VlID0gaXNzdWVNYW5hZ2VyLmdldElzc3VlQnlLZXlJZ25vcmVDYXNlKCJPUFVULTI0MSIpCgovKkluc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMqLwpDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCkNsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwpvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwovKiBHZXQgSW5zaWdodCBJUUwgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCkNsYXNzIGlxbEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlIik7IAppcWxGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUoaXFsRmFjYWRlQ2xhc3MpOwpDbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5zZXJ2aWNlcy5tb2RlbC5mYWN0b3J5Lk9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Iik7Cm9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5ID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Q2xhc3MpOwovKiBHZXQgSW5zaWdodCBPYmplY3QgVHlwZSBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3Mgb2JqZWN0VHlwZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZSIpOyAKb2JqZWN0VHlwZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlRmFjYWRlQ2xhc3MpOwoKLypDdXN0b21maWVsZHMqLwpkZWYgc3VwcGxpZXJJbnN0YWxsYXRpb24gPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnN1cHBsaWVyTmV3SW5zdGFsbGF0aW9uJ10udG9TdHJpbmcoKSlbMF0KZGVmIHdic1ByaiA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yud2JzUHJqJ10gPyBwcm9wZXJ0aWVzWydjZi53YnNQcmonXS50b1N0cmluZygpIDogIk9QX1dCU19QUkoiKVswXQpkZWYgc2l0ZSA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yuc2l0ZSddLnRvU3RyaW5nKCkpWzBdCmxvZy5kZWJ1ZyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHN1cHBsaWVySW5zdGFsbGF0aW9uKQoKSmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCBhdXRoQ29udGV4dCA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKQpkZWYganFsUXVlcnlQYXJzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDb21wb25lbnQoSnFsUXVlcnlQYXJzZXIpCmRlZiBzZWFyY2hTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29tcG9uZW50KFNlYXJjaFNlcnZpY2UpClVzZXJVdGlsIHVzZXJVdGlsID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0VXNlclV0aWwoKQpkZWYgdXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQubG9nZ2VkSW5Vc2VyCgpkZWYgc3VwcGxpZXIgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHN1cHBsaWVySW5zdGFsbGF0aW9uKS5maXJzdCgpLnRvU3RyaW5nKCkKbG9nLmRlYnVnICJzdXBwbGllcjogIiArIHN1cHBsaWVyCnN1cHBsaWVyID0gc3VwcGxpZXIuc3Vic3RyaW5nKDEsc3VwcGxpZXIuaW5kZXhPZignKCcpLTEpCgpkZWYganFsU2VhcmNoID0gInByb2plY3QgPSAnIiArIGlzc3VlLmdldFByb2plY3RPYmplY3QoKS5uYW1lICsgIicgQU5EIGlzc3VldHlwZSA9ICciICsgaXNzdWUuZ2V0SXNzdWVUeXBlKCkubmFtZSArICInIEFORCBrZXkgIT0gJyIgKyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICInIEFORCAnIiArIHByb3BlcnRpZXNbJ2NmLnN1cHBsaWVyTmV3SW5zdGFsbGF0aW9uJ10udG9TdHJpbmcoKSArICInIGluIGlxbEZ1bmN0aW9uKCciICsgcHJvcGVydGllc1snaW9iai5zdXBwaW5zdC5zdXBwbGllclJlZiddLnRvU3RyaW5nKCkgKyAiIExJS0UgXCIiICsgc3VwcGxpZXIucmVwbGFjZUFsbCgiJyIsIlwnIikgKyAiXCInKSIgKyAiIEFORCAnIiArIHByb3BlcnRpZXNbJ2NmLnNpdGUnXS50b1N0cmluZygpICsgIicgPSAnIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc2l0ZSkuZmlyc3QoKS50b1N0cmluZygpLnJlcGxhY2VBbGwoIiciLCJcJyIpICsgIicgQU5EIHN0YXR1cyBJTiAoJyIgKyBwcm9wZXJ0aWVzWyd3Zi5vcGVuJ10udG9TdHJpbmcoKSArICInKSBBTkQgIiArIChwcm9wZXJ0aWVzWydjZi53YnNQcmonXSA/IHByb3BlcnRpZXNbJ2NmLndic1ByaiddLnRvU3RyaW5nKCkgOiAiT1BfV0JTX1BSSiIpICsgIiA9ICciICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh3YnNQcmopICsgIiciCmxvZy5kZWJ1ZyAicmljZXJjYTogIiArIGpxbFNlYXJjaApkZWYgcXVlcnkgPSBqcWxRdWVyeVBhcnNlci5wYXJzZVF1ZXJ5KGpxbFNlYXJjaCkKbG9nLmRlYnVnICJxdWVyeTogIiArIHF1ZXJ5CmRlZiBzZWFyY2ggPSBzZWFyY2hTZXJ2aWNlLnNlYXJjaCh1c2VyLCBxdWVyeSwgUGFnZXJGaWx0ZXIuZ2V0VW5saW1pdGVkRmlsdGVyKCkpCmRlZiBmb3VuZD1mYWxzZQpkZWYgZm91bmRPdXR3YXJkPWZhbHNlCmRlZiBsaW5rZWRJc3N1ZQppZiAoc2VhcmNoLnJlc3VsdHMpIHsJCiAgICBmb3IgKGkgaW4gc2VhcmNoLnJlc3VsdHMuZmlyc3QoKSl7CiAgICAgICAgLypQZXIgb2duaSBpc3N1ZSByZXN0aXR1aXRhIGRhbGxhIHF1ZXJ5IEpRTCB2ZXJpZmljbyBzZSBoYSBnacOgIGRlaSBsaW5rIFJlbGF0ZXMgVG8qLwogICAgICAgIGxvZy5kZWJ1ZyBpLmtleQoKICAgICAgICBkZWYgaXNzdWVTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVTZXJ2aWNlKCkKCiAgICAgICAgTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGkuZ2V0SWQoKSk7CiAgICAgICAgbG9nLmRlYnVnICJhbGxJbklzc3VlTGluazogIiArIGFsbEluSXNzdWVMaW5rCiAgICAgICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsSW5Jc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWVUZW1wID0gaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpCiAgICAgICAgICAgIFN0cmluZyB0eXBlID0gbGlua2VkSXNzdWVUZW1wLmdldElzc3VlVHlwZSgpLmdldE5hbWUoKTsKCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiaXNzdWVsaW5rIFR5cGU6ICIgKyBpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkKCQkJbG9nLmRlYnVnICJzb3VyY2VJc3N1ZTogIiArIGlzc3VlTGluay5nZXRTb3VyY2VPYmplY3QoKQogICAgICAgICAgICBsb2cuZGVidWcgImRlc3RpbmF0aW9uSXNzdWU6ICIgKyBpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkgJiYgaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpLmtleSE9aXNzdWUua2V5KXsKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAidHJvdmF0byBpbldhcmRMaW5rIC0gcHJlbmRvIGxhIHNvdXJjZSBpc3N1ZSAiICsgbGlua2VkSXNzdWVUZW1wICsgIiBlIGxhIGxlZ28gYWxsYSBpc3N1ZSBjb3JyZW50ZSIKICAgICAgICAgICAgICAgIGZvdW5kPXRydWUKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5jcmVhdGVJc3N1ZUxpbmsobGlua2VkSXNzdWVUZW1wLmdldElkKCksIGlzc3VlLmdldElkKCksIExvbmcucGFyc2VMb25nKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzSWQnXS50b1N0cmluZygpKSwgMSwgdXNlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgTGlzdDxJc3N1ZUxpbms+IGFsbE91dElzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRPdXR3YXJkTGlua3MoaS5nZXRJZCgpKTsKICAgICAgICBsb2cuZGVidWcgImFsbE91dElzc3VlTGluazogIiArIGFsbE91dElzc3VlTGluawogICAgICAgIGZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZVRlbXAgPSBpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKQogICAgICAgICAgICBTdHJpbmcgdHlwZSA9IGxpbmtlZElzc3VlVGVtcC5nZXRJc3N1ZVR5cGUoKS5nZXROYW1lKCk7CgogICAgICAgICAgICBsb2cuZGVidWcgImlzc3VlbGluayBUeXBlOiAiICsgaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpCgkJCWxvZy5kZWJ1ZyAic291cmNlSXNzdWU6ICIgKyBpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkKICAgICAgICAgICAgbG9nLmRlYnVnICJkZXN0aW5hdGlvbklzc3VlOiAiICsgaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpICYmIGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpLmtleSE9aXNzdWUua2V5KXsKICAgICAgICAgICAgICAgIGZvdW5kPXRydWUKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAidHJvdmF0byBvdXRXYXJkTGluayAtIHByZW5kbyBsYSBkZXN0aW5hdGlvbiBpc3N1ZSAiICsgbGlua2VkSXNzdWVUZW1wICsgIiBlIGxhIGxlZ28gYWxsYSBpc3N1ZSBjb3JyZW50ZSIKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5jcmVhdGVJc3N1ZUxpbmsoaXNzdWUuZ2V0SWQoKSwgbGlua2VkSXNzdWVUZW1wLmdldElkKCksIExvbmcucGFyc2VMb25nKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzSWQnXS50b1N0cmluZygpKSwgMSwgdXNlcik7CiAgICAgICAgICAgIH1lbHNlIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpICYmIGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpLmtleT09aXNzdWUua2V5KXsKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiaXNzdWUgZ2nDoCBsaW5rYXRhIgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbG9nLmRlYnVnICJDcmVvIGxpbmsgdHJhIGxhIGlzc3VlIG9nZ2V0dG8gZGkgdHJhbnNpdGlvbiBlIGxhIGlzc3VlIHJpc3VsdGFudGUgZGFsIGZpbHRybyIKICAgICAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuY3JlYXRlSXNzdWVMaW5rKGkuZ2V0SWQoKSwgaXNzdWUuZ2V0SWQoKSwgTG9uZy5wYXJzZUxvbmcocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXNJZCddLnRvU3RyaW5nKCkpLCAxLCB1c2VyKTsKICAgICAgICAgICAgICAKICAgIH0KICAgIAp9IGVsc2UgewogICAgbG9nLmVycm9yKCJJbnZhbGlkIEpRTDogIiArIGpxbFNlYXJjaCk7Cn0g</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">YCFgT1A6IERvYyBUZW1wbGF0ZSBnZW5lcmF0aW9uIC0gc2UgTmV3IEluc3RhbGxhdGlvbiBPUiBGaXJzdCBUaWNrZXQgPSB0cnVl</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuV29ya2Zsb3dFeGNlcHRpb247CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgZ3Jvb3Z5Lmpzb24uSnNvblNsdXJwZXI7CmltcG9ydCBncm9vdnkuanNvbi5TdHJlYW1pbmdKc29uQnVpbGRlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5DdXN0b21GaWVsZE1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlTWFuYWdlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3I7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWU7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29kZWMuYmluYXJ5LkJhc2U2NDsKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eXgubmV0Lmh0dHAuSFRUUEJ1aWxkZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKCmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCgpkZWYgZmlyc3RUaWNrZXQgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmZpcnN0VGt0J10udG9TdHJpbmcoKSlbMF0KCmxvZy5kZWJ1ZyBpc3N1ZS5nZXRJc3N1ZVR5cGUoKS5uYW1lCmxvZy5kZWJ1ZyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGZpcnN0VGlja2V0KQoKCi8qIFJFU1QgQVBJIHBlciBJbnZpbyBOb3RpZmljYSBFbWFpbCBPTlNJVEVfUkVQT1JUICovCnJlcXVlc3RNZXRob2QgPSAiR0VUIjsKCmlmKGlzc3VlLmdldElzc3VlVHlwZSgpLm5hbWUudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaXQubmV3SW5zdGFsbGF0aW9uJ10pIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoZmlyc3RUaWNrZXQpIT1udWxsKXsKICAgIGRlZiBmaXJzdF90aWNrZXQ9ZmFsc2UKICAgIGRlZiB0ZW1wbGF0ZT0iIgogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShmaXJzdFRpY2tldCkhPW51bGwpewogICAgICAgIGZpcnN0X3RpY2tldD10cnVlCiAgICAgICAgdGVtcGxhdGU9IkZJUlNUX1RJQ0tFVCU3Q01BTlVGQUNUVVJFUiIKICAgIH1lbHNlewogICAgICAgIHRlbXBsYXRlPSJORVdfSU5TVEFMTEFUSU9OX0NSRUFURV9US1QlN0NNQU5VRkFDVFVSRVIiCiAgICB9CiAgICBiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1snYXBpLmVudiddLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvYXV0b21hdGlvbi9kb2N1bWVudC9nZW5lcmF0aW9uL2NoZWNrP0lTU1VFX0tFWT0iKyBpc3N1ZS5rZXkgKyImRE9DX0NBVEVHT1JZPSIgKyB0ZW1wbGF0ZSArICImRU5BQkxFRF9GT1JfRklSU1RfVElDS0VUPSIrZmlyc3RfdGlja2V0KyImSU1QT1JUX0ZST009T1BfQVNTRVQiCiAgICBsb2cuZGVidWcgYmFzZVVSTAogICAgVVJMIHVybCA9IG5ldyBVUkwoYmFzZVVSTCkKICAgIEh0dHBVUkxDb25uZWN0aW9uIGNvbm5lY3Rpb24gPSAoSHR0cFVSTENvbm5lY3Rpb24pdXJsLm9wZW5Db25uZWN0aW9uKCk7CiAgICBjb25uZWN0aW9uLnNldFJlcXVlc3RNZXRob2QocmVxdWVzdE1ldGhvZCk7CiAgICBjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJBY2NlcHQiLCAiKi8qIik7CiAgICBjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwogICAgY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwogICAgY29ubmVjdGlvbi5jb25uZWN0KCk7CgogICAgZGVmIG91dHB1dCA9IG5ldyBBcnJheUxpc3QoKQogICAgZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICBkZWYgZUxpc3RFcnJvcnMgPSBuZXcgQXJyYXlMaXN0KCkKICAgIGRlZiBlcnJvck1zZ3MgPSBuZXcgQXJyYXlMaXN0KCkKCiAgICBpZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgICAgICBsb2cuZGVidWcgInVybDogIiArIHVybAogICAgICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VDb2RlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpCiAgICAgICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKICAgICAgICBsb2cuZGVidWcgIkVycm9yU3RyZWFtOiAiICsgY29ubmVjdGlvbi5nZXRFcnJvclN0cmVhbSgpLnRvU3RyaW5nKCkKICAgICAgICBsb2cuZGVidWcgImdldEhlYWRlckZpZWxkcygpOiAiICsgY29ubmVjdGlvbi5nZXRIZWFkZXJGaWVsZHMoKQogICAgICAgIGRlZiBvdXRwdXRNc2cgPSAoKEh0dHBVUkxDb25uZWN0aW9uKWNvbm5lY3Rpb24pLmVycm9yU3RyZWFtLnRleHQKICAgICAgICBsb2cuZGVidWcgIigoSHR0cFVSTENvbm5lY3Rpb24pY29ubmVjdGlvbikuZXJyb3JTdHJlYW0udGV4dDogIiArIG91dHB1dE1zZwoKICAgICAgICBkZWYganNvblNsdXJwZXIgPSBuZXcgSnNvblNsdXJwZXIoKQogICAgICAgIGRlZiBqc29uX29iamVjdCA9IGpzb25TbHVycGVyLnBhcnNlVGV4dChvdXRwdXRNc2cpCiAgICAgICAgYXNzZXJ0IGpzb25fb2JqZWN0IGluc3RhbmNlb2YgTWFwICAKICAgICAgICBsb2cuZGVidWcgIm1lc3NhZ2U6ICIgKyAganNvbl9vYmplY3QubWVzc2FnZQoKICAgICAgICBlTGlzdEVycm9ycy5hZGQoIkUiKQogICAgICAgIGVMaXN0RXJyb3JzLmFkZCgiT1AtRE9DUyIpCiAgICAgICAgZXJyb3JNc2dzLmFkZChjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpICsgIiAiICsganNvbl9vYmplY3QubWVzc2FnZSkKICAgICAgICBlTGlzdEVycm9ycy5hZGQoZXJyb3JNc2dzKQogICAgICAgIGVMaXN0LmFkZChlTGlzdEVycm9ycykKCiAgICAgICAgb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpCiAgICB9Cn0K</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">1</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <global-actions>
    <action id="341" name="Cancella Ticket">
      <meta name="opsbar-sequence">100</meta>
      <meta name="jira.description"></meta>
      <meta name="jira.fieldscreen.id"></meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="FIELD_FUNCTION_ID">00311669deae227a71a37a43c67ff8b63b3ce7b2</arg>
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">YCFgIWlzc3VlLmdldFN0YXR1cygpLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscygiQ2xvc2VkIil8fHw=</arg>
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
            <arg name="FIELD_PREVIEW_ISSUE">AAS-2694</arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="null" status="null" step="15">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value">10103</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="351" name="Sospendi Ticket">
      <meta name="opsbar-sequence">110</meta>
      <meta name="jira.description"></meta>
      <meta name="jira.fieldscreen.id"></meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">YCFgIWlzc3VlLmdldFN0YXR1cygpLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscygiQ2xvc2VkIil8fHw=</arg>
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
            <arg name="FIELD_PREVIEW_ISSUE"></arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="null" status="null" step="16">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value">10401</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="361" name="Annulla Ticket">
      <meta name="opsbar-sequence">120</meta>
      <meta name="jira.description"></meta>
      <meta name="jira.fieldscreen.id"></meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">YCFgIWlzc3VlLmdldFN0YXR1cygpLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscygiQ2xvc2VkIil8fHw=</arg>
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
            <arg name="FIELD_PREVIEW_ISSUE"></arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="null" status="null" step="17">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value">10104</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </global-actions>
  <common-actions>
    <action id="51" name="Assegna a Fornitore" view="fieldscreen">
      <meta name="opsbar-sequence">50</meta>
      <meta name="jira.description"></meta>
      <meta name="jira.fieldscreen.id">19904</meta>
      <validators>
        <validator name="" type="class">
          <arg name="FIELD_FUNCTION_ID">0edcbf2c1701d9f3a9ad279bea831e613d3338a7</arg>
          <arg name="FIELD_NOTES">YCFgT1AgRW1haWwgTm90aWZpY2F0aW9uOiBBU1NJR05fVE9fU1VQUExJRVI=</arg>
          <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgpkZWYgcmVxdWVzdE1ldGhvZCA9ICJQT1NUIjsKZGVmIHJlbGF0ZXNJbklzc3VlTGluaz1mYWxzZQpkZWYgcmVsYXRlc091dElzc3VlTGluaz1mYWxzZQpkZWYgbGlua2VkVGlja2V0cz1uZXcgQXJyYXlMaXN0KCkKCklzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKQ3VzdG9tRmllbGRNYW5hZ2VyIGN1c3RvbUZpZWxkTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpOwpkZWYgYXV0b21hdGljYWxseUNvbmZpcm1lZCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuYXV0b21hdGljYWxseUFzc2lnbmVkJ10gPyBwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5QXNzaWduZWQnXS50b1N0cmluZygpIDogIk9QX0FVVE9NQVRJQ0FMTFlfQVNTSUdORUQiKVswXQoKLypPUC0xMDM4OiB2ZXJpZmljYSB0aWNrZXQgY29sbGVnYXRpKi8KTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgIHJlbGF0ZXNJbklzc3VlTGluaz10cnVlCiAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpLnRvU3RyaW5nKCkpCiAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc0luSXNzdWVMaW5rIgogICAgfQp9Ckxpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICByZWxhdGVzT3V0SXNzdWVMaW5rPXRydWUKICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKS50b1N0cmluZygpKQogICAgICAgIGxvZy5kZWJ1ZyAiSXNzdWUgY29uIHJlbGF0ZXNPdXRJc3N1ZUxpbmsiCiAgICB9Cn0KCmRlZiBib2R5X3JlcQppZihyZWxhdGVzSW5Jc3N1ZUxpbmsgfHwgcmVsYXRlc091dElzc3VlTGluayl7CiAgICBib2R5X3JlcSA9IFsKICAgICAgICAidGVtcGxhdGVOYW1lIjogcHJvcGVydGllc1sndHQuYXNzaWduVG9TdXBwbGllciddLnRvU3RyaW5nKCksCiAgICAgICAgInBlYyI6IGZhbHNlLAogICAgICAgICJpc3N1ZUtleSI6IGlzc3VlLmtleSwKICAgICAgICAibGlua2VkVGlja2V0cyI6IGxpbmtlZFRpY2tldHMKICAgIF0KfWVsc2V7CiAgICBib2R5X3JlcSA9IFsKICAgICAgICAidGVtcGxhdGVOYW1lIjogcHJvcGVydGllc1sndHQuYXNzaWduVG9TdXBwbGllciddLnRvU3RyaW5nKCksCiAgICAgICAgInBlYyI6IGZhbHNlLAogICAgICAgICJpc3N1ZUtleSI6IGlzc3VlLmtleQogICAgXQp9CgppZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpPT1udWxsIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCkudG9TdHJpbmcoKS5lcXVhbHMoIk5vIikpewogICAgZGVmIGJhc2VVUkwgPSAiaHR0cDovLyIgKyBwcm9wZXJ0aWVzWydhcGkuZW52J10udG9TdHJpbmcoKSArICIvb3AvcmVzdC9qaXJhL0FBL3RyYW5zYWN0aW9uL21haWwvc2VuZCIKICAgIFVSTCB1cmwKICAgIHVybCA9IG5ldyBVUkwoYmFzZVVSTCkKCiAgICBIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gKEh0dHBVUkxDb25uZWN0aW9uKXVybC5vcGVuQ29ubmVjdGlvbigpOwogICAgY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwogICAgY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgiKTsKICAgIGNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJBY2NlcHQiLCAiKi8qIik7CiAgICBjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwogICAgY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwogICAgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KICAgIGNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtLndpdGhXcml0ZXIoIlVURi04IikgeyBuZXcgU3RyZWFtaW5nSnNvbkJ1aWxkZXIoaXQsIGJvZHlfcmVxKSB9CiAgICBsb2cuZGVidWcgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KICAgIGNvbm5lY3Rpb24uY29ubmVjdCgpOwoKICAgIGRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgZGVmIGVMaXN0RXJyb3JzID0gbmV3IEFycmF5TGlzdCgpCiAgICBkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgogICAgaWYgKCFjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIyMDAiKSl7CiAgICAgICAgbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKICAgICAgICBsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQogICAgICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VNZXNzYWdlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpCiAgICAgICAgCiAgICAgICAgZGVmIG91dHB1dE1zZyA9ICgoSHR0cFVSTENvbm5lY3Rpb24pY29ubmVjdGlvbikuZXJyb3JTdHJlYW0udGV4dAogICAgCWxvZy5kZWJ1ZyAiKChIdHRwVVJMQ29ubmVjdGlvbiljb25uZWN0aW9uKS5lcnJvclN0cmVhbS50ZXh0OiAiICsgb3V0cHV0TXNnCiAgICAgICAgCiAgICAgICAgZGVmIGpzb25TbHVycGVyID0gbmV3IEpzb25TbHVycGVyKCkKICAgIAlkZWYganNvbl9vYmplY3QgPSBqc29uU2x1cnBlci5wYXJzZVRleHQob3V0cHV0TXNnKQogICAgICAgIGFzc2VydCBqc29uX29iamVjdCBpbnN0YW5jZW9mIE1hcCAgCiAgICAgICAgbG9nLmRlYnVnICJtZXNzYWdlOiAiICsgIGpzb25fb2JqZWN0Lm1lc3NhZ2UKCiAgICAgICAgZUxpc3RFcnJvcnMuYWRkKCJFIikKICAgICAgICBlTGlzdEVycm9ycy5hZGQoIlNFTkRNQUlMIikKICAgICAgICBlcnJvck1zZ3MuYWRkKGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkgKyAiICIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpKQogICAgICAgIC8vZUxpc3RFcnJvcnMuYWRkKGVycm9yTXNncykKICAgICAgICBlTGlzdEVycm9ycy5hZGQoanNvbl9vYmplY3QubWVzc2FnZSkKICAgICAgICBlTGlzdC5hZGQoZUxpc3RFcnJvcnMpCgogICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkKICAgIH0KfQo=</arg>
          <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
          <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
          <arg name="FIELD_SCRIPT_FILE"></arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="null" status="null" step="2">
          <post-functions>
            <function type="class">
              <arg name="scopeSource-linkEnd"></arg>
              <arg name="append.value"></arg>
              <arg name="field.value">%%CURRENT_DATETIME%%</arg>
              <arg name="field.name">customfield_22639</arg>
              <arg name="scopeType">SAME</arg>
              <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="scopeDestination-linkEnd"></arg>
              <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="scopeDestination-jql"></arg>
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
              <arg name="scopeSource-jql"></arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">14b92cea1dc4f22ec42d0ad489a7359b4ad4a858</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IE5ldyBJbnN0YWxsYXRpb24gLSBDaGVjayBsaW5rZWRUaWNrZXRzICYgRmFzdC1UcmFuc2FjdCB0aGVt</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5pbmRleC5Jc3N1ZUluZGV4aW5nU2VydmljZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5XQVJOKQoKbG9nLndhcm4gIiR7aXNzdWUua2V5fSBUcmFuc2F6aW9uZSBBU1NJR04gVE8gU1VQUExJRVIgLSBQb3N0IEZ1bmN0aW9uIGNoZWNrIGxpbmtlZElzc3VlcyIKCklzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKQ3VzdG9tRmllbGRNYW5hZ2VyIGN1c3RvbUZpZWxkTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpOwpkZWYgYXV0b21hdGljYWxseUNvbmZpcm1lZCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuYXV0b21hdGljYWxseUFzc2lnbmVkJ10gPyBwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5QXNzaWduZWQnXS50b1N0cmluZygpIDogIk9QX0FVVE9NQVRJQ0FMTFlfQVNTSUdORUQiKVswXQpJc3N1ZUluZGV4aW5nU2VydmljZSAJaXNzdWVJbmRleGluZ1NlcnZpY2UgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDb21wb25lbnQoSXNzdWVJbmRleGluZ1NlcnZpY2UpCgpJc3N1ZSBpc3N1ZSA9IGlzc3VlCi8vUGVyIHRlc3QgZGEgY29uc29sZQovL2lzc3VlID0gaXNzdWVNYW5hZ2VyLmdldElzc3VlQnlLZXlJZ25vcmVDYXNlKCJPUFVULTI3NiIpCgovKkRFViovCkFTU0lHTl9UT19TVVBQTElFUiA9IHByb3BlcnRpZXNbJ3dmLnRyLmFzc2lnblRvU3VwcGxpZXInXSA/IHByb3BlcnRpZXNbJ3dmLnRyLmFzc2lnblRvU3VwcGxpZXInXSA6IDUxCgovKlBST0QqLwovL0NPTkZJUk1fVE9fQ1VTVE9NRVIKCmRlZiB1c2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCmRlZiBpc3N1ZVNlcnZpY2UgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZVNlcnZpY2UoKQoKLypTZSBlc2VndW8gbGEgY29uZmlybSB0byBjdXN0b21lciBzdSB1biB0aWNrZXQgY29uIDEgbyArIHRpY2tldCBjb2xsZWdhdGksIHZlcmlmaWNvIGUgc3Bvc3RvIGluIGF1dG9tYXRpY28gZ2xpIGV2ZW50dWFsaSB0aWNrZXQgY29sbGVnYXRpKi8KbG9nLndhcm4gInZlcmlmaWNvIGUgc3Bvc3RvIGluIGF1dG9tYXRpY28gZ2xpIGV2ZW50dWFsaSB0aWNrZXQgY29sbGVnYXRpIgoKaWYoaXNzdWUuZ2V0SXNzdWVUeXBlKCkuZ2V0TmFtZSgpID09IHByb3BlcnRpZXNbJ2l0Lm5ld0luc3RhbGxhdGlvbiddLnRvU3RyaW5nKCkgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKT09bnVsbCB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLnRvU3RyaW5nKCkuZXF1YWxzKCJObyIpKXsKICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxJbklzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRJbndhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQogICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsSW5Jc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgbG9nLndhcm4gIklzc3VlIGNvbiByZWxhdGVzSW5Jc3N1ZUxpbmsiCiAgICAgICAgICAgIC8qRXNlZ3VpcmUgdHJhbnNhemlvbmUgZGkgc3RhdG8gZGVsbGEgc291cmNlSXNzdWUqLwogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWUgPSBpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkKICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlU3RhdHVzID0gbGlua2VkSXNzdWUuZ2V0U3RhdHVzKCkKICAgICAgICAgICAgZGVmIHRyYW5zaXRpb25JZAogICAgICAgICAgICBpZihsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lID09IHByb3BlcnRpZXNbJ3dmLm9wZW4nXS50b1N0cmluZygpKXsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb25JZD1BU1NJR05fVE9fU1VQUExJRVIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZih0cmFuc2l0aW9uSWQ9PUFTU0lHTl9UT19TVVBQTElFUil7CiAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIG91ciBpbnB1dCBmb3IgdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgIGRlZiBpc3N1ZUlucHV0UGFyYW1ldGVycyA9IGlzc3VlU2VydmljZS5uZXdJc3N1ZUlucHV0UGFyYW1ldGVycygpCiAgICAgICAgICAgICAgICBpc3N1ZUlucHV0UGFyYW1ldGVycy53aXRoIHsKICAgICAgICAgICAgICAgICAgICBzZXRTa2lwU2NyZWVuQ2hlY2sodHJ1ZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhpc3N1ZSkKICAgICAgICAgICAgICAgIC8vQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIC8vaXNzdWVJbnB1dFBhcmFtZXRlcnMuYWRkQ3VzdG9tRmllbGRWYWx1ZShmaWVsZENvbmZpZy5nZXRJZCgpLCAiWWVzIikgCiAgICAgICAgICAgICAgICAvL2xvZy53YXJuICJpc3N1ZUlucHV0UGFyYW1ldGVyczogIiArIGlzc3VlSW5wdXRQYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgICAgICAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNvbmZpcm1lZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICAgICAgICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCgogICAgICAgICAgICAgICAgLy9kZWYgdmFsaWRhdGlvblJlc3VsdCA9IGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpCiAgICAgICAgICAgICAgICBpZiAoaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgICAgIGRlZiBpc3N1ZVJlc3VsdCA9IGlzc3VlU2VydmljZS50cmFuc2l0aW9uKHVzZXIsIGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpKQogICAgICAgICAgICAgICAgICAgIGlmICghIGlzc3VlUmVzdWx0LmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiRmFpbGVkIHRvIHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIlRyYW5zYXppb25lIGZhdHRhIDc5ICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlUmVzdWx0LmVycm9yQ29sbGVjdGlvbn0sICR7bGlua2VkSXNzdWUuc3RhdHVzfSIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiQ291bGQgbm90IHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBMaXN0PElzc3VlTGluaz4gYWxsT3V0SXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldE91dHdhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQogICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsT3V0SXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgICAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIGxvZy53YXJuICJJc3N1ZSBjb24gcmVsYXRlc091dElzc3VlTGluayIKICAgICAgICAgICAgLypFc2VndWlyZSB0cmFuc2F6aW9uZSBkaSBzdGF0byBkZWxsYSBkZXN0aW5hdGlvbklzc3VlKi8KICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlID0gaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkKICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlU3RhdHVzID0gbGlua2VkSXNzdWUuZ2V0U3RhdHVzKCkKICAgICAgICAgICAgZGVmIHRyYW5zaXRpb25JZAogICAgICAgICAgICBsb2cud2FybiAibGlua2VkSXNzdWU6ICIgKyBsaW5rZWRJc3N1ZQogICAgICAgICAgICBsb2cud2FybiAibGlua2VkSXNzdWVTdGF0dXMubmFtZTogIiArIGxpbmtlZElzc3VlU3RhdHVzLm5hbWUKICAgICAgICAgICAgaWYobGlua2VkSXNzdWVTdGF0dXMubmFtZSA9PSBwcm9wZXJ0aWVzWyd3Zi5vcGVuJ10udG9TdHJpbmcoKSl7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9QVNTSUdOX1RPX1NVUFBMSUVSCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKHRyYW5zaXRpb25JZD09QVNTSUdOX1RPX1NVUFBMSUVSKXsKICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgb3VyIGlucHV0IGZvciB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgZGVmIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICAgICAgICAgIHNldFNraXBTY3JlZW5DaGVjayh0cnVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9kZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q2xvc2VkLmdldFJlbGV2YW50Q29uZmlnKGlzc3VlKQogICAgICAgICAgICAgICAgLy9Db21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKCiAgICAgICAgICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgICAgICAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNvbmZpcm1lZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICAgICAgICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCgogICAgICAgICAgICAgICAgaWYgKGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICBkZWYgaXNzdWVSZXN1bHQgPSBpc3N1ZVNlcnZpY2UudHJhbnNpdGlvbih1c2VyLCBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKSkKICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkZhaWxlZCB0byB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSAxMjIgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSwgJHtsaW5rZWRJc3N1ZS5zdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJDb3VsZCBub3QgdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgIH0KfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="371" name="Recupera Tkt">
      <meta name="opsbar-sequence">10</meta>
      <meta name="jira.description"></meta>
      <meta name="jira.fieldscreen.id"></meta>
      <results>
        <unconditional-result old-status="null" status="null" step="1">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value"></arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </common-actions>
  <steps>
    <step id="1" name="Open">
      <meta name="jira.status.id">1</meta>
      <actions>
<common-action id="51" />
        <action id="11" name="Richiedi Preventivo">
          <meta name="opsbar-sequence">40</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="8">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="field.copyFieldSource2"></arg>
                  <arg name="field.copyFieldSource1">customfield_22603</arg>
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="field.createTargetValue1"></arg>
                  <arg name="field.copyFieldMode1">OVERWRITE</arg>
                  <arg name="field.copyFieldDestination1">customfield_22656</arg>
                  <arg name="field.copyFieldSeparator1"></arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiescopyValueFromOtherField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.CopyValueFromOtherFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="field.type">8</arg>
                  <arg name="full.module.key">com.riadalabs.jira.plugins.insightinsight-post-function</arg>
                  <arg name="field.groovyScript">   import com.atlassian.jira.component.ComponentAccessor;
import java.util.ArrayList;
import com.atlassian.jira.config.util.JiraHome
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.MutableIssue;
import com.atlassian.jira.event.type.EventDispatchOption;

Properties relativePath = new Properties()
File relativePathFile = new File('/var/atlassian/application-data/jira/insightPathToScript.properties')
relativePathFile.withInputStream {
	relativePath.load(it)
}
Properties properties = new Properties()
File propertiesFile = new File('/var/atlassian/application-data/jira' + relativePath['pathToScripts'] + 'opproject.properties')
propertiesFile.withInputStream {
	properties.load(it)
}

/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade&quot;); 
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
 
/* Get Insight Object Type Facade from plugin accessor */
Class objectTypeFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectTypeFacade&quot;); 
def objectTypeFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectTypeFacadeClass);
 
/* Get Insight Object Attribute Facade from plugin accessor */
Class objectTypeAttributeFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectTypeAttributeFacade&quot;); 
def objectTypeAttributeFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectTypeAttributeFacadeClass);

/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade&quot;); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);

Class objectAttributeBeanFactoryClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.services.model.factory.ObjectAttributeBeanFactory&quot;); 
def objectAttributeBeanFactory = ComponentAccessor.getOSGiComponentInstanceOfType(objectAttributeBeanFactoryClass);

def OPAA = properties['ischema.aa.id'].toString().toInteger()
def quoteLabourRatesField = ComponentAccessor.getCustomFieldManager().getCustomFieldObjectsByName(properties['cf.quoteLabourRates'].toString())[0];
def OnSiteRateObjects = new ArrayList();

def ONSITE_RATE_REPORT_OBJ_TYPE = properties['iobj.onSiteRateReport'].toString().toInteger()
def ONSITE_RATE_REPORT_ATTR_NAME = properties['iobj.onSiteRateReport.name.id'] ? properties['iobj.onSiteRateReport.name.id'].toString().toInteger() : 2766
def ONSITE_RATE_REPORT_ATTR_RATE_REF = properties['iobj.onSiteRateReport.rateRef.id'] ? properties['iobj.onSiteRateReport.rateRef.id'].toString().toInteger() : 3186
def ONSITE_RATE_REPORT_ATTR_APPLIED_TO = properties['iobj.onSiteRateReport.appliedTo.id'] ? properties['iobj.onSiteRateReport.appliedTo.id'].toString().toInteger() : 3194
def ONSITE_RATE_REPORT_ATTR_SAP = properties['iobj.onSiteRateReport.sap.id'] ? properties['iobj.onSiteRateReport.sap.id'].toString().toInteger() : 3196
def ONSITE_RATE_REPORT_ATTR_QUOTE_FROM_TKT = properties['iobj.onSiteRateReport.quoteFromTkt.id'] ? properties['iobj.onSiteRateReport.quoteFromTkt.id'].toString().toInteger() : 3203
def ONSITE_RATE_REPORT_ATTR_QUANTITY_CUSTOMER = properties['iobj.onSiteRateReport.qtyCustomer.id'] ? properties['iobj.onSiteRateReport.qtyCustomer.id'].toString().toInteger() : 3189

Issue issue = issue

def objects = iqlFacade.findObjectsByIQLAndSchema(OPAA, &quot;objectType=\&quot;Rates\&quot; AND \&quot;QUOTE_ENABLED\&quot; = true&quot;); // See the complete list of possible IQL on the Insight Query Language documentation page
for (obj in objects){
	log.info obj.toString()
    obj = obj.toString()
    def rateName = obj.substring(0,obj.indexOf('(')-1)
    def rateKey = obj.substring(obj.indexOf('(')+1,obj.indexOf(')'))
    
    /*Set Name*/
    def objectTypeOnSiteRateReport = objectTypeFacade.loadObjectTypeBean(ONSITE_RATE_REPORT_OBJ_TYPE);
    def newObjectBean = objectTypeOnSiteRateReport.createMutableObjectBean();
    
    def objectAttributeBeans = new ArrayList();
    log.info ONSITE_RATE_REPORT_ATTR_NAME.toString()
    def nameObjectTypeAttributeBean = objectTypeAttributeFacade.loadObjectTypeAttributeBean(ONSITE_RATE_REPORT_ATTR_NAME); 
    
    objectAttributeBeans.add(objectAttributeBeanFactory.createObjectAttributeBeanForObject(newObjectBean, nameObjectTypeAttributeBean, rateName));
    
    newObjectBean.setObjectAttributeBeans(objectAttributeBeans);
        
    /*Set APPLIED_TO*/
    def appliedToObjectTypeAttributeBean = objectTypeAttributeFacade.loadObjectTypeAttributeBean(ONSITE_RATE_REPORT_ATTR_APPLIED_TO); 
    
    objectAttributeBeans.add(objectAttributeBeanFactory.createObjectAttributeBeanForObject(newObjectBean, appliedToObjectTypeAttributeBean, &quot;BOTH&quot;));
    
    newObjectBean.setObjectAttributeBeans(objectAttributeBeans);
    
    /*Set SAP*/
    def sapObjectTypeAttributeBean = objectTypeAttributeFacade.loadObjectTypeAttributeBean(ONSITE_RATE_REPORT_ATTR_SAP); 
    
    objectAttributeBeans.add(objectAttributeBeanFactory.createObjectAttributeBeanForObject(newObjectBean, sapObjectTypeAttributeBean, &quot;false&quot;));
    
    newObjectBean.setObjectAttributeBeans(objectAttributeBeans);
    
    /*Set QUOTE_FROM_TKT*/
    def quoteObjectTypeAttributeBean = objectTypeAttributeFacade.loadObjectTypeAttributeBean(ONSITE_RATE_REPORT_ATTR_QUOTE_FROM_TKT); 
    
    objectAttributeBeans.add(objectAttributeBeanFactory.createObjectAttributeBeanForObject(newObjectBean, quoteObjectTypeAttributeBean, &quot;true&quot;));
    
    newObjectBean.setObjectAttributeBeans(objectAttributeBeans);
    
    /*Set QUANTITY_CUSTOMER*/
    def qtyCustomerObjectTypeAttributeBean = objectTypeAttributeFacade.loadObjectTypeAttributeBean(ONSITE_RATE_REPORT_ATTR_QUANTITY_CUSTOMER); 
    
    objectAttributeBeans.add(objectAttributeBeanFactory.createObjectAttributeBeanForObject(newObjectBean, qtyCustomerObjectTypeAttributeBean, &quot;1&quot;));
    
    newObjectBean.setObjectAttributeBeans(objectAttributeBeans);
    
    
    /* Store the object into Insight. The new ObjectBean will be updated with an unique ID */
    try {
        newObjectBean = objectFacade.storeObjectBean(newObjectBean);
        log.warn(&quot;newObjectBean: &quot; + newObjectBean);
    } catch (Exception vie) {
        log.warn(&quot;Could not create issue due to validation exception:&quot; + vie.getMessage());
    }
    
    /* Update RATE_REF on the newObject */		        
    def objectTypeAttributeBean = objectTypeAttributeFacade.loadObjectTypeAttributeBean(ONSITE_RATE_REPORT_ATTR_RATE_REF).createMutable() //The id of the attribute
    
    /* Create the new attribute bean based on the value */
    def newObjectAttributeBean = objectAttributeBeanFactory.createObjectAttributeBeanForObject(newObjectBean, objectTypeAttributeBean, rateKey);
    /* Load the attribute bean */
    def objectAttributeBean = objectFacade.loadObjectAttributeBean(newObjectBean.getId(), rateKey);
    if (objectAttributeBean != null) {
        /* If attribute exist reuse the old id for the new attribute */
        newObjectAttributeBean.setId(objectAttributeBean.getId());
    }
    /* Store the object attribute into Insight. */
    try {
        objectTypeAttributeBean = objectFacade.storeObjectAttributeBean(newObjectAttributeBean);
    } catch (Exception vie) {
        log.warn(&quot;Could not update object attribute due to validation exception:&quot; + vie.getMessage());
    }  
    
    OnSiteRateObjects.add(newObjectBean)
}
log.info (&quot;OnSiteRateObjects: &quot; + OnSiteRateObjects)
def currentUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()

if (!OnSiteRateObjects.isEmpty()) {
    MutableIssue mi = (MutableIssue) issue;
    mi.setCustomFieldValue(quoteLabourRatesField, OnSiteRateObjects);
    ComponentAccessor.getIssueManager().updateIssue(currentUser, mi, EventDispatchOption.DO_NOT_DISPATCH, false);
}      </arg>
                  <arg name="field.filepath"></arg>
                  <arg name="class.name">com.riadalabs.jira.plugins.insight.services.jira.postfunction.InsightPostFunction</arg>
                  <arg name="field.description">OP: Automatically create Labour Rates for offer Tkt</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="21" name="Tkt Risolto Telefonicamente">
          <meta name="opsbar-sequence">30</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1A6IEVuYWJsZWQgb25seSBmb3IgTWFpbnRlbmFuY2UgVGlja2V0</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="null" status="null" step="7">
              <post-functions>
                <function type="class">
                  <arg name="field.name">resolution</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">1</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="31" name="Converti in Nuova Installazione">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgQ2hhbmdlIHRvIE5ldyBJbnN0YWxsYXRpb24gaWYgaXNzdWUgdHlwZSA9IE1haW50ZW5hbmNl</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="null" status="null" step="1">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1A6IENoYW5nZSBpc3N1ZSB0eXBlIGZyb20gTWFpbnRlbmFuY2UgdG8gTmV3IEluc3RhbGxhdGlvbg==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaXNzdWV0eXBlLklzc3VlVHlwZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQoKLyogRGVmaW5lIGEgTG9nZ2VyICovCmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCmRlZiBjb25zdGFudHNNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29uc3RhbnRzTWFuYWdlcigpCgpJc3N1ZSBpc3N1ZSA9IGlzc3VlICAvLyBUaGlzIHdoYXQgSSB3YXMgbG9va2luZyBmb3IgOi0pLiBBcyBzaW1wbGUgYXMgaXQgaXMsIGJ1dCBJIGRpZG4ndCBrbm93IHRoYXQuCgpJc3N1ZVR5cGUgdGFyZ2V0SXNzdWVUeXBlID0gbnVsbApkZWYgaXNzdWVUeXBlCgpsb2cuZGVidWcgIklzc3VlVHlwZSBvbGQgPSAiICsgaXNzdWUuaXNzdWVUeXBlLm5hbWUKCmRlZiBjb2xsZWN0aW9uID0gY29uc3RhbnRzTWFuYWdlci5nZXRBbGxJc3N1ZVR5cGVPYmplY3RzKCkKZGVmIGl0ZXJhdG9yID0gY29sbGVjdGlvbi5pdGVyYXRvcigpCndoaWxlKGl0ZXJhdG9yLmhhc05leHQoKSl7Cglpc3N1ZVR5cGUgPSBpdGVyYXRvci5uZXh0KCkKCWlmKGlzc3VlVHlwZS5uYW1lID09IHByb3BlcnRpZXNbJ2l0Lm5ld0luc3RhbGxhdGlvbiddLnRvU3RyaW5nKCkpewoJCXRhcmdldElzc3VlVHlwZSA9IGlzc3VlVHlwZQoJfQp9Cgpsb2cuZGVidWcgdGFyZ2V0SXNzdWVUeXBlLm5hbWUKaXNzdWUuc2V0SXNzdWVUeXBlT2JqZWN0KHRhcmdldElzc3VlVHlwZSkKbG9nLmRlYnVnICJJc3N1ZVR5cGUgbmV3ID0gIiArIGlzc3VlLmlzc3VlVHlwZS5uYW1l</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="conditionList">3</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesvalueField-precondition-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="comparisonType">1</arg>
                  <arg name="precondition">true</arg>
                  <arg name="class.name">ch.beecom.jira.jsu.workflow.function.valuefield.ValueFieldPreconditionFunction</arg>
                  <arg name="preconditionNegateResult-booleanValue"></arg>
                  <arg name="fieldValue">New Installation</arg>
                  <arg name="preconditionMode-textValue">DISCARD</arg>
                  <arg name="fieldsList">issuetype</arg>
                </function>
                <function type="class">
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="append.value"></arg>
                  <arg name="field.value">New Installation Ticket</arg>
                  <arg name="field.name">summary</arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="preconditionAwareFunctionMode-textValue">TRUE</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="append.value"></arg>
                  <arg name="field.value">New Installation Ticket</arg>
                  <arg name="field.name">customfield_22716</arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="preconditionAwareFunctionMode-textValue">TRUE</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="41" name="Converti in Manutenzione Riparativa">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgQ2hhbmdlIHRvIE1haW50ZW5hbmNlIGlmIGlzc3VlIHR5cGUgPSBOZXcgSW5zdGFsbGF0aW9u</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ05ldyBJbnN0YWxsYXRpb24nfHx8</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="null" status="null" step="1">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">bee29a4ffd9e55a6f278af205f741799fc63bbef</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IENoYW5nZSBpc3N1ZSB0eXBlIGZyb20gTmV3IEluc3RhbGxhdGlvbiB0byBNYWludGVuYW5jZQ==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaXNzdWV0eXBlLklzc3VlVHlwZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQoKLyogRGVmaW5lIGEgTG9nZ2VyICovCmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCmRlZiBjb25zdGFudHNNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29uc3RhbnRzTWFuYWdlcigpCgpJc3N1ZSBpc3N1ZSA9IGlzc3VlICAvLyBUaGlzIHdoYXQgSSB3YXMgbG9va2luZyBmb3IgOi0pLiBBcyBzaW1wbGUgYXMgaXQgaXMsIGJ1dCBJIGRpZG4ndCBrbm93IHRoYXQuCgpJc3N1ZVR5cGUgdGFyZ2V0SXNzdWVUeXBlID0gbnVsbApkZWYgaXNzdWVUeXBlCgpsb2cuZGVidWcgIklzc3VlVHlwZSBvbGQgPSAiICsgaXNzdWUuaXNzdWVUeXBlLm5hbWUKbG9nLmRlYnVnIHByb3BlcnRpZXNbJ2l0Lm1haW50ZW5hbmNlJ10udG9TdHJpbmcoKQpkZWYgY29sbGVjdGlvbiA9IGNvbnN0YW50c01hbmFnZXIuZ2V0QWxsSXNzdWVUeXBlT2JqZWN0cygpCmRlZiBpdGVyYXRvciA9IGNvbGxlY3Rpb24uaXRlcmF0b3IoKQp3aGlsZShpdGVyYXRvci5oYXNOZXh0KCkpewoJaXNzdWVUeXBlID0gaXRlcmF0b3IubmV4dCgpCglpZihpc3N1ZVR5cGUubmFtZSA9PSAocHJvcGVydGllc1snaXQubWFpbnRlbmFuY2UnXSA/IHByb3BlcnRpZXNbJ2l0Lm1haW50ZW5hbmNlJ10udG9TdHJpbmcoKSA6ICJNYWludGVuYW5jZSBUaWNrZXQiKSl7CgkJdGFyZ2V0SXNzdWVUeXBlID0gaXNzdWVUeXBlCgl9Cn0KCmxvZy5kZWJ1ZyB0YXJnZXRJc3N1ZVR5cGUubmFtZQppc3N1ZS5zZXRJc3N1ZVR5cGVPYmplY3QodGFyZ2V0SXNzdWVUeXBlKQpsb2cuZGVidWcgIklzc3VlVHlwZSBuZXcgPSAiICsgaXNzdWUuaXNzdWVUeXBlLm5hbWU=</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="conditionList">3</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesvalueField-precondition-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="comparisonType">1</arg>
                  <arg name="precondition">true</arg>
                  <arg name="class.name">ch.beecom.jira.jsu.workflow.function.valuefield.ValueFieldPreconditionFunction</arg>
                  <arg name="preconditionNegateResult-booleanValue"></arg>
                  <arg name="fieldValue">Maintenance Ticket</arg>
                  <arg name="preconditionMode-textValue">DISCARD</arg>
                  <arg name="fieldsList">issuetype</arg>
                </function>
                <function type="class">
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="append.value"></arg>
                  <arg name="field.value">Maintenance Ticket</arg>
                  <arg name="field.name">customfield_22716</arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="preconditionAwareFunctionMode-textValue">TRUE</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="append.value"></arg>
                  <arg name="field.value">Maintenance Ticket</arg>
                  <arg name="field.name">summary</arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="preconditionAwareFunctionMode-textValue">TRUE</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="61" name="Chiusura Massiva FAAC Service">
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="7">
              <post-functions>
                <function type="class">
                  <arg name="field.name">resolution</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">6</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="2" name="Assigned To Supplier">
      <meta name="jira.status.id">14327</meta>
      <actions>
        <action id="71" name="Accetta Intervento" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19905</meta>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">9ea9661d5b7954626bd1f3b6b542df62f7afc3dd</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIGVycm9ycyAmIHdhcm5pbmdz</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQogCklzc3VlIGlzc3VlID0gaXNzdWUKCmRlZiBlcnJvcnMgPSBmYWxzZQpkZWYgd2FybmluZ3MgPSBmYWxzZQoKZGVmIHN1cHBsaWVyTGFiZWwgPSBwcm9wZXJ0aWVzWydjZi5zdXBwbGllciddID8gcHJvcGVydGllc1snY2Yuc3VwcGxpZXInXS50b1N0cmluZygpIDogIk9QX1NVUFBMSUVSIgpkZWYgc3VwcGxpZXIgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHN1cHBsaWVyTGFiZWwpWzBdCgpkZWYgZXJyb3JNYW5kYXRvcnlGaWVsZHMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIHdhcm5pbmdFbXB0eUZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKQogCi8vT1BfU1VQUExJRVJfUkVQQUlSIHZzIE9QX1NVUFBMSUVSX05FV0lOU1QKbG9nLmRlYnVnICJzdXBwbGllckxhYmVsOiAiICsgc3VwcGxpZXJMYWJlbAppZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHN1cHBsaWVyKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc3VwcGxpZXIpID09ICIiIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc3VwcGxpZXIpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CgllcnJvcnMgPSB0cnVlCgllcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQoc3VwcGxpZXJMYWJlbCkKICAgIGxvZy5kZWJ1ZyAiZXJyb3JNYW5kYXRvcnlGaWVsZHM6ICIgKyBlcnJvck1hbmRhdG9yeUZpZWxkcwp9CgoKZGVmIG91dHB1dCA9IG5ldyBBcnJheUxpc3QoKQoKaWYgKCFlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgIHJldHVybiB0cnVlCn1lbHNlewogICAgaWYoIWVycm9ycyAmJiB3YXJuaW5ncyl7CiAgICAgICAgZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgCiAgICAgICAgaWYod2FybmluZ0VtcHR5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHkgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJXIikKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJDT05GSVJNX0VNUFRZX0ZJRUxEUyIpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZChudWxsKQogICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQod2FybmluZ0VtcHR5RmllbGRzKQoKICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5KQogICAgICAgIH0KICAgICAgICAKICAgICAgICBvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siVyI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAgCiAgICB9CiAgICBpZihlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgICAgICBkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAKICAgICAgICBpZihlcnJvck1hbmRhdG9yeUZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgZGVmIGVMaXN0TWFuZGF0b3J5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiRSIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiTUFOREFUT1JZX0ZJRUxEUyIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChudWxsKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoZXJyb3JNYW5kYXRvcnlGaWVsZHMpCiAgICAgICAgICAgIGVMaXN0LmFkZChlTGlzdE1hbmRhdG9yeSkKICAgICAgICB9CiAgICAgICAgb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKSAgIAogICAgfQogICAgaWYoZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICBkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICBkZWYgd0xpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAKICAgICAgICBpZihlcnJvck1hbmRhdG9yeUZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgZGVmIGVMaXN0TWFuZGF0b3J5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiRSIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiTUFOREFUT1JZX0ZJRUxEUyIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChudWxsKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoZXJyb3JNYW5kYXRvcnlGaWVsZHMpCiAgICAgICAgICAgIGVMaXN0LmFkZChlTGlzdE1hbmRhdG9yeSkKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYod2FybmluZ0VtcHR5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHkgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJXIikKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJDT05GSVJNX0VNUFRZX0ZJRUxEUyIpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZChudWxsKQogICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQod2FybmluZ0VtcHR5RmllbGRzKQoKICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5KQogICAgICAgIH0KICAgICAgICAKICAgICAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgICAgIG91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXRSIsIG91dHB1dC50b1N0cmluZygpKSAgCiAgICB9Cn0=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="3">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1A6IE5ldyBJbnN0YWxsYXRpb24gLSBDaGVjayBsaW5rZWRUaWNrZXRzICYgRmFzdC1UcmFuc2FjdCB0aGVt</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5pbmRleC5Jc3N1ZUluZGV4aW5nU2VydmljZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5XQVJOKQoKbG9nLndhcm4gIiR7aXNzdWUua2V5fSBUcmFuc2F6aW9uZSBBQ0NFUFRFRCBCWSBTVVBQTElFUiAtIFBvc3QgRnVuY3Rpb24gY2hlY2sgbGlua2VkSXNzdWVzIgoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiBhdXRvbWF0aWNhbGx5Q29uZmlybWVkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5QWNjZXB0ZWQnXSA/IHByb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlBY2NlcHRlZCddLnRvU3RyaW5nKCkgOiAiT1BfQVVUT01BVElDQUxMWV9BQ0NFUFRFRCIpWzBdCklzc3VlSW5kZXhpbmdTZXJ2aWNlIAlpc3N1ZUluZGV4aW5nU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChJc3N1ZUluZGV4aW5nU2VydmljZSkKCklzc3VlIGlzc3VlID0gaXNzdWUKLy9QZXIgdGVzdCBkYSBjb25zb2xlCi8vaXNzdWUgPSBpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVCeUtleUlnbm9yZUNhc2UoIk9QVVQtMjc2IikKCi8qREVWKi8KQUNDRVBUID0gcHJvcGVydGllc1snd2YudHIuYWNjZXB0J10gPyBwcm9wZXJ0aWVzWyd3Zi50ci5hY2NlcHQnXSA6IDcxCgovKlBST0QqLwovL0NPTkZJUk1fVE9fQ1VTVE9NRVIKCmRlZiB1c2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCmRlZiBpc3N1ZVNlcnZpY2UgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZVNlcnZpY2UoKQoKLypTZSBlc2VndW8gbGEgY29uZmlybSB0byBjdXN0b21lciBzdSB1biB0aWNrZXQgY29uIDEgbyArIHRpY2tldCBjb2xsZWdhdGksIHZlcmlmaWNvIGUgc3Bvc3RvIGluIGF1dG9tYXRpY28gZ2xpIGV2ZW50dWFsaSB0aWNrZXQgY29sbGVnYXRpKi8KbG9nLndhcm4gInZlcmlmaWNvIGUgc3Bvc3RvIGluIGF1dG9tYXRpY28gZ2xpIGV2ZW50dWFsaSB0aWNrZXQgY29sbGVnYXRpIgoKaWYoaXNzdWUuZ2V0SXNzdWVUeXBlKCkuZ2V0TmFtZSgpID09IHByb3BlcnRpZXNbJ2l0Lm5ld0luc3RhbGxhdGlvbiddLnRvU3RyaW5nKCkgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKT09bnVsbCB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLnRvU3RyaW5nKCkuZXF1YWxzKCJObyIpKXsKICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxJbklzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRJbndhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQogICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsSW5Jc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgbG9nLndhcm4gIklzc3VlIGNvbiByZWxhdGVzSW5Jc3N1ZUxpbmsiCiAgICAgICAgICAgIC8qRXNlZ3VpcmUgdHJhbnNhemlvbmUgZGkgc3RhdG8gZGVsbGEgc291cmNlSXNzdWUqLwogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWUgPSBpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkKICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlU3RhdHVzID0gbGlua2VkSXNzdWUuZ2V0U3RhdHVzKCkKICAgICAgICAgICAgZGVmIHRyYW5zaXRpb25JZAogICAgICAgICAgICBpZihsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lID09IChwcm9wZXJ0aWVzWyd3Zi5hc3NpZ25lZFRvU3VwcGxpZXInXSA/IHByb3BlcnRpZXNbJ3dmLmFzc2lnbmVkVG9TdXBwbGllciddLnRvU3RyaW5nKCkgOiAiQXNzaWduZWQgVG8gU3VwcGxpZXIiKSl7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9QUNDRVBUCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYodHJhbnNpdGlvbklkPT1BQ0NFUFQpewogICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBvdXIgaW5wdXQgZm9yIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICBkZWYgaXNzdWVJbnB1dFBhcmFtZXRlcnMgPSBpc3N1ZVNlcnZpY2UubmV3SXNzdWVJbnB1dFBhcmFtZXRlcnMoKQogICAgICAgICAgICAgICAgaXNzdWVJbnB1dFBhcmFtZXRlcnMud2l0aCB7CiAgICAgICAgICAgICAgICAgICAgc2V0U2tpcFNjcmVlbkNoZWNrKHRydWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2RlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDbG9zZWQuZ2V0UmVsZXZhbnRDb25maWcoaXNzdWUpCiAgICAgICAgICAgICAgICAvL0NvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICAvL2lzc3VlSW5wdXRQYXJhbWV0ZXJzLmFkZEN1c3RvbUZpZWxkVmFsdWUoZmllbGRDb25maWcuZ2V0SWQoKSwgIlllcyIpIAogICAgICAgICAgICAgICAgLy9sb2cud2FybiAiaXNzdWVJbnB1dFBhcmFtZXRlcnM6ICIgKyBpc3N1ZUlucHV0UGFyYW1ldGVycwogICAgICAgICAgICAgICAgZGVmIGN1cnJlbnRVc2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCiAgICAgICAgICAgICAgICBkZWYgbWkgPSAoTXV0YWJsZUlzc3VlKSBsaW5rZWRJc3N1ZQoKICAgICAgICAgICAgICAgIGRlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDb25maXJtZWQuZ2V0UmVsZXZhbnRDb25maWcobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiZmllbGRDb25maWc6ICIgKyBmaWVsZENvbmZpZwogICAgICAgICAgICAgICAgZGVmIGNmTmV3VmFsdWUgPSBDb21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgYXV0b21hdGljYWxseUNvbmZpcm1lZC51cGRhdGVWYWx1ZShudWxsLCBsaW5rZWRJc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUobGlua2VkSXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKSwgY2ZOZXdWYWx1ZSksIG5ldyBEZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIoKSkKCiAgICAgICAgICAgICAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpc3N1ZUluZGV4aW5nU2VydmljZS5yZUluZGV4KGxpbmtlZElzc3VlKQogICAgICAgICAgICAgICAgbG9nLndhcm4gIlVwZGF0ZWQgY3VzdG9tZmllbGQgLSBpc3N1ZSBsaW5rYXRhIgoKICAgICAgICAgICAgICAgIC8vZGVmIHZhbGlkYXRpb25SZXN1bHQgPSBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKQogICAgICAgICAgICAgICAgaWYgKGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICBkZWYgaXNzdWVSZXN1bHQgPSBpc3N1ZVNlcnZpY2UudHJhbnNpdGlvbih1c2VyLCBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKSkKICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkZhaWxlZCB0byB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSA3OSAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259LCAke2xpbmtlZElzc3VlLnN0YXR1c30iKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkNvdWxkIG5vdCB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgTGlzdDxJc3N1ZUxpbms+IGFsbE91dElzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRPdXR3YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKICAgIGZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICAgICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICAgICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBsb2cud2FybiAiSXNzdWUgY29uIHJlbGF0ZXNPdXRJc3N1ZUxpbmsiCiAgICAgICAgICAgIC8qRXNlZ3VpcmUgdHJhbnNhemlvbmUgZGkgc3RhdG8gZGVsbGEgZGVzdGluYXRpb25Jc3N1ZSovCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZSA9IGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZVN0YXR1cyA9IGxpbmtlZElzc3VlLmdldFN0YXR1cygpCiAgICAgICAgICAgIGRlZiB0cmFuc2l0aW9uSWQKICAgICAgICAgICAgbG9nLndhcm4gImxpbmtlZElzc3VlOiAiICsgbGlua2VkSXNzdWUKICAgICAgICAgICAgbG9nLndhcm4gImxpbmtlZElzc3VlU3RhdHVzLm5hbWU6ICIgKyBsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lCiAgICAgICAgICAgIGlmKGxpbmtlZElzc3VlU3RhdHVzLm5hbWUgPT0gKHByb3BlcnRpZXNbJ3dmLmFzc2lnbmVkVG9TdXBwbGllciddID8gcHJvcGVydGllc1snd2YuYXNzaWduZWRUb1N1cHBsaWVyJ10udG9TdHJpbmcoKSA6ICJBc3NpZ25lZCBUbyBTdXBwbGllciIpKXsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb25JZD1BQ0NFUFQKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYodHJhbnNpdGlvbklkPT1BQ0NFUFQpewogICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBvdXIgaW5wdXQgZm9yIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICBkZWYgaXNzdWVJbnB1dFBhcmFtZXRlcnMgPSBpc3N1ZVNlcnZpY2UubmV3SXNzdWVJbnB1dFBhcmFtZXRlcnMoKQogICAgICAgICAgICAgICAgaXNzdWVJbnB1dFBhcmFtZXRlcnMud2l0aCB7CiAgICAgICAgICAgICAgICAgICAgc2V0U2tpcFNjcmVlbkNoZWNrKHRydWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2RlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDbG9zZWQuZ2V0UmVsZXZhbnRDb25maWcoaXNzdWUpCiAgICAgICAgICAgICAgICAvL0NvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICAvL2lzc3VlSW5wdXRQYXJhbWV0ZXJzLmFkZEN1c3RvbUZpZWxkVmFsdWUoZmllbGRDb25maWcuZ2V0SWQoKSwgIlllcyIpIAoKICAgICAgICAgICAgICAgIGRlZiBjdXJyZW50VXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKQogICAgICAgICAgICAgICAgZGVmIG1pID0gKE11dGFibGVJc3N1ZSkgbGlua2VkSXNzdWUKCiAgICAgICAgICAgICAgICBkZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLmdldFJlbGV2YW50Q29uZmlnKGxpbmtlZElzc3VlKQogICAgICAgICAgICAgICAgbG9nLndhcm4gImZpZWxkQ29uZmlnOiAiICsgZmllbGRDb25maWcKICAgICAgICAgICAgICAgIGRlZiBjZk5ld1ZhbHVlID0gQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHlDb25maXJtZWQudXBkYXRlVmFsdWUobnVsbCwgbGlua2VkSXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGxpbmtlZElzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCksIGNmTmV3VmFsdWUpLCBuZXcgRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyKCkpCgogICAgICAgICAgICAgICAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCkudXBkYXRlSXNzdWUoY3VycmVudFVzZXIsIG1pLCBFdmVudERpc3BhdGNoT3B0aW9uLkRPX05PVF9ESVNQQVRDSCwgZmFsc2UpOwogICAgICAgICAgICAgICAgaXNzdWVJbmRleGluZ1NlcnZpY2UucmVJbmRleChsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJVcGRhdGVkIGN1c3RvbWZpZWxkIC0gaXNzdWUgbGlua2F0YSIKCiAgICAgICAgICAgICAgICBpZiAoaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgICAgIGRlZiBpc3N1ZVJlc3VsdCA9IGlzc3VlU2VydmljZS50cmFuc2l0aW9uKHVzZXIsIGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpKQogICAgICAgICAgICAgICAgICAgIGlmICghIGlzc3VlUmVzdWx0LmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiRmFpbGVkIHRvIHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIlRyYW5zYXppb25lIGZhdHRhIDEyMiAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259LCAke2xpbmtlZElzc3VlLnN0YXR1c30iKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkNvdWxkIG5vdCB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgfQp9</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">c78e1ae3244cda5eddd8f7276fcd5db77569ce43</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IExpbmtlZCBUaWNrZXRzOiBjaGVjayBhbmQgbGluayByZWxhdGVkIGlzc3Vlcw==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXIKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uU2x1cnBlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb25maWcudXRpbC5KaXJhSG9tZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQKaW1wb3J0IGphdmEudGV4dC5QYXJzZUV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLnNlY3VyaXR5LkppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5iYy5pc3N1ZS5Jc3N1ZVNlcnZpY2UuSXNzdWVSZXN1bHQKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5qcWwucGFyc2VyLkpxbFF1ZXJ5UGFyc2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuYmMuaXNzdWUuc2VhcmNoLlNlYXJjaFNlcnZpY2UKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS51c2VyLnV0aWwuVXNlclV0aWwKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS53ZWIuYmVhbi5QYWdlckZpbHRlcgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuTGlua0NvbGxlY3Rpb25JbXBsOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk1vZGlmaWVkVmFsdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS51dGlsLkRlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcgoKaW1wb3J0IGdyb292eS51dGlsLmxvZ2dpbmcuU2xmNGoKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRIYXNoTWFwCmltcG9ydCBqYXZheC5hbm5vdGF0aW9uLlBvc3RDb25zdHJ1Y3QKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuY2FjaGUuYW5ub3RhdGlvbi5DYWNoZWFibGUKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KZGVmIENhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKLypTY3JpcHQgVmFyaWFibGVzKi8KLy9QZXIgUG9zdCBGdW5jdGlvbgppc3N1ZSA9IGlzc3VlCi8vUGVyIHRlc3QgZGEgY29uc29sZQovL0lzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKQovL2lzc3VlID0gaXNzdWVNYW5hZ2VyLmdldElzc3VlQnlLZXlJZ25vcmVDYXNlKCJPUFVULTI0MSIpCgovKkluc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMqLwpDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCkNsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwpvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwovKiBHZXQgSW5zaWdodCBJUUwgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCkNsYXNzIGlxbEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlIik7IAppcWxGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUoaXFsRmFjYWRlQ2xhc3MpOwpDbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5zZXJ2aWNlcy5tb2RlbC5mYWN0b3J5Lk9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Iik7Cm9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5ID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Q2xhc3MpOwovKiBHZXQgSW5zaWdodCBPYmplY3QgVHlwZSBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3Mgb2JqZWN0VHlwZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZSIpOyAKb2JqZWN0VHlwZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlRmFjYWRlQ2xhc3MpOwoKLypDdXN0b21maWVsZHMqLwpkZWYgc3VwcGxpZXJJbnN0YWxsYXRpb24gPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnN1cHBsaWVyUmVwYWlyJ10udG9TdHJpbmcoKSlbMF0KZGVmIHN1cHBsaWVyTmV3SW5zdGFsbGF0aW9uID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5zdXBwbGllck5ld0luc3RhbGxhdGlvbiddLnRvU3RyaW5nKCkpWzBdCmRlZiBwbGFubmVkRGF0ZSA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YucGxhbm5lZERhdGUnXS50b1N0cmluZygpKVswXQpkZWYgc2l0ZSA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yuc2l0ZSddLnRvU3RyaW5nKCkpWzBdCmRlZiB3YnNQcmogPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLndic1ByaiddID8gcHJvcGVydGllc1snY2Yud2JzUHJqJ10udG9TdHJpbmcoKSA6ICJPUF9XQlNfUFJKIilbMF0KbG9nLmRlYnVnIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc3VwcGxpZXJJbnN0YWxsYXRpb24pCgpKaXJhQXV0aGVudGljYXRpb25Db250ZXh0IGF1dGhDb250ZXh0ID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpCmRlZiBqcWxRdWVyeVBhcnNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChKcWxRdWVyeVBhcnNlcikKZGVmIHNlYXJjaFNlcnZpY2UgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDb21wb25lbnQoU2VhcmNoU2VydmljZSkKVXNlclV0aWwgdXNlclV0aWwgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRVc2VyVXRpbCgpCmRlZiB1c2VyID0gQ29tcG9uZW50QWNjZXNzb3IuamlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dC5sb2dnZWRJblVzZXIKCmRlZiBzdXBwbGllciA9IChpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHN1cHBsaWVySW5zdGFsbGF0aW9uKSA/IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc3VwcGxpZXJJbnN0YWxsYXRpb24pLmZpcnN0KCkudG9TdHJpbmcoKSA6IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc3VwcGxpZXJOZXdJbnN0YWxsYXRpb24pLmZpcnN0KCkudG9TdHJpbmcoKSkKbG9nLmRlYnVnICJzdXBwbGllcjogIiArIHN1cHBsaWVyCnN1cHBsaWVyID0gc3VwcGxpZXIuc3Vic3RyaW5nKDEsc3VwcGxpZXIuaW5kZXhPZignKCcpLTEpCgpMaXN0PElzc3VlTGluaz4gYWxsSW5DdXJyZW50SXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpOwpMaXN0PElzc3VlTGluaz4gYWxsT3V0Q3VycmVudElzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRPdXR3YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSk7CmRlZiBhbHJlYWR5TGlua2VkPWZhbHNlCgpkZWYganFsU2VhcmNoID0gInByb2plY3QgPSAnIiArIGlzc3VlLmdldFByb2plY3RPYmplY3QoKS5uYW1lICsgIicgQU5EIGlzc3VldHlwZSA9ICciICsgaXNzdWUuZ2V0SXNzdWVUeXBlKCkubmFtZSArICInIEFORCBrZXkgIT0gJyIgKyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICInIEFORCAnIiArIChpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHN1cHBsaWVySW5zdGFsbGF0aW9uKSA/IHByb3BlcnRpZXNbJ2NmLnN1cHBsaWVyUmVwYWlyJ10udG9TdHJpbmcoKSA6IHByb3BlcnRpZXNbJ2NmLnN1cHBsaWVyTmV3SW5zdGFsbGF0aW9uJ10udG9TdHJpbmcoKSkgKyAiJyBpbiBpcWxGdW5jdGlvbignIiArIHByb3BlcnRpZXNbJ2lvYmouc3VwcGluc3Quc3VwcGxpZXJSZWYnXS50b1N0cmluZygpICsgIiBMSUtFIFwiIiArIHN1cHBsaWVyLnJlcGxhY2VBbGwoIiciLCJcJyIpICsgIlwiJykiICsgIiBBTkQgJyIgKyBwcm9wZXJ0aWVzWydjZi5zaXRlJ10udG9TdHJpbmcoKSArICInID0gJyIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNpdGUpLmZpcnN0KCkudG9TdHJpbmcoKS5yZXBsYWNlQWxsKCInIiwiXCciKSArICInIEFORCBzdGF0dXMgSU4gKCciICsgcHJvcGVydGllc1snd2YuYWNjZXB0ZWRCeVN1cHBsaWVyJ10udG9TdHJpbmcoKSArICInKSBBTkQgIiArIChpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHN1cHBsaWVySW5zdGFsbGF0aW9uKSA/IChwcm9wZXJ0aWVzWydjZi5wbGFubmVkRGF0ZSddLnRvU3RyaW5nKCkgKyAiID49ICciICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShwbGFubmVkRGF0ZSkuZm9ybWF0KCJ5eXl5LU1NLWRkIEhIOm1tIikgKyAiJyBBTkQgIiArIHByb3BlcnRpZXNbJ2NmLnBsYW5uZWREYXRlJ10udG9TdHJpbmcoKSArICIgPD0gJyIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHBsYW5uZWREYXRlKS5mb3JtYXQoInl5eXktTU0tZGQiKS50b1N0cmluZygpICsgIiAyMzo1OSIgKyAiJyIpIDogKHByb3BlcnRpZXNbJ2NmLndic1ByaiddID8gcHJvcGVydGllc1snY2Yud2JzUHJqJ10udG9TdHJpbmcoKSA6ICJPUF9XQlNfUFJKIikgKyAiID0gJyIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHdic1ByaikgKyAiJyIpCmxvZy5kZWJ1ZyAicmljZXJjYTogIiArIGpxbFNlYXJjaApkZWYgcXVlcnkgPSBqcWxRdWVyeVBhcnNlci5wYXJzZVF1ZXJ5KGpxbFNlYXJjaCkKbG9nLmRlYnVnICJxdWVyeTogIiArIHF1ZXJ5CmRlZiBzZWFyY2ggPSBzZWFyY2hTZXJ2aWNlLnNlYXJjaCh1c2VyLCBxdWVyeSwgUGFnZXJGaWx0ZXIuZ2V0VW5saW1pdGVkRmlsdGVyKCkpCmRlZiBmb3VuZD1mYWxzZQpkZWYgZm91bmRPdXR3YXJkPWZhbHNlCmRlZiBsaW5rZWRJc3N1ZQppZiAoc2VhcmNoLnJlc3VsdHMpIHsJCiAgICBmb3IgKGkgaW4gc2VhcmNoLnJlc3VsdHMpewogICAgICAgIC8qUGVyIG9nbmkgaXNzdWUgcmVzdGl0dWl0YSBkYWxsYSBxdWVyeSBKUUwgdmVyaWZpY28gc2UgaGEgZ2nDoCBkZWkgbGluayBSZWxhdGVzIFRvKi8KICAgICAgICBsb2cuZGVidWcgaS5rZXkKCiAgICAgICAgZGVmIGlzc3VlU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlU2VydmljZSgpCgogICAgICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxJbklzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRJbndhcmRMaW5rcyhpLmdldElkKCkpOwogICAgICAgIGxvZy5kZWJ1ZyAiYWxsSW5Jc3N1ZUxpbms6ICIgKyBhbGxJbklzc3VlTGluawogICAgICAgIGZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgICAgICAgICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlVGVtcCA9IGlzc3VlTGluay5nZXRTb3VyY2VPYmplY3QoKQogICAgICAgICAgICBTdHJpbmcgdHlwZSA9IGxpbmtlZElzc3VlVGVtcC5nZXRJc3N1ZVR5cGUoKS5nZXROYW1lKCk7CgogICAgICAgICAgICBsb2cuZGVidWcgImlzc3VlbGluayBUeXBlOiAiICsgaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpCgkJCWxvZy5kZWJ1ZyAic291cmNlSXNzdWU6ICIgKyBpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkKICAgICAgICAgICAgbG9nLmRlYnVnICJkZXN0aW5hdGlvbklzc3VlOiAiICsgaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpICYmIGlzc3VlTGluay5nZXRTb3VyY2VPYmplY3QoKS5rZXkhPWlzc3VlLmtleSl7CiAgICAgICAgICAgICAgICBsb2cuZGVidWcgInRyb3ZhdG8gaW5XYXJkTGluayAtIHByZW5kbyBsYSBzb3VyY2UgaXNzdWUgIiArIGxpbmtlZElzc3VlVGVtcCArICIgZSBsYSBsZWdvIGFsbGEgaXNzdWUgY29ycmVudGUgc29sbyBzZSBub24gw6ggZ2nDoCBsaW5rYXRhIgogICAgICAgICAgICAgICAgYWxyZWFkeUxpbmtlZD1mYWxzZQogICAgICAgICAgICAgICAgZm9yKGxpIGluIGFsbEluQ3VycmVudElzc3VlTGluayl7CiAgICAgICAgICAgICAgICAgICAgaWYobGlua2VkSXNzdWVUZW1wLmdldElkKCkgPT0gbGkuZ2V0U291cmNlT2JqZWN0KCkuZ2V0SWQoKSB8fCBsaW5rZWRJc3N1ZVRlbXAuZ2V0SWQoKSA9PSBsaS5nZXREZXN0aW5hdGlvbk9iamVjdCgpLmdldElkKCkpewogICAgICAgICAgICAgICAgICAgICAgICBhbHJlYWR5TGlua2VkPXRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IobGkgaW4gYWxsT3V0Q3VycmVudElzc3VlTGluayl7CiAgICAgICAgICAgICAgICAgICAgaWYobGlua2VkSXNzdWVUZW1wLmdldElkKCkgPT0gbGkuZ2V0U291cmNlT2JqZWN0KCkuZ2V0SWQoKSB8fCBsaW5rZWRJc3N1ZVRlbXAuZ2V0SWQoKSA9PSBsaS5nZXREZXN0aW5hdGlvbk9iamVjdCgpLmdldElkKCkpewogICAgICAgICAgICAgICAgICAgICAgICBhbHJlYWR5TGlua2VkPXRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3VuZD10cnVlCiAgICAgICAgICAgICAgICBpZighYWxyZWFkeUxpbmtlZCl7CiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnICJub24gw6ggbGlua2F0YSwgbGEgbGlua28iCiAgICAgICAgICAgICAgICAgCUNvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5jcmVhdGVJc3N1ZUxpbmsobGlua2VkSXNzdWVUZW1wLmdldElkKCksIGlzc3VlLmdldElkKCksIExvbmcucGFyc2VMb25nKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzSWQnXS50b1N0cmluZygpKSwgMSwgdXNlcik7ICAgCiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgImdpw6AgbGlua2F0YSwgbm9uIGxhIGxpbmtvIGRpIG51b3ZvIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGkuZ2V0SWQoKSk7CiAgICAgICAgbG9nLmRlYnVnICJhbGxPdXRJc3N1ZUxpbms6ICIgKyBhbGxPdXRJc3N1ZUxpbmsKICAgICAgICBmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxPdXRJc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWVUZW1wID0gaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkKICAgICAgICAgICAgU3RyaW5nIHR5cGUgPSBsaW5rZWRJc3N1ZVRlbXAuZ2V0SXNzdWVUeXBlKCkuZ2V0TmFtZSgpOwoKICAgICAgICAgICAgbG9nLmRlYnVnICJpc3N1ZWxpbmsgVHlwZTogIiArIGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKQoJCQlsb2cuZGVidWcgInNvdXJjZUlzc3VlOiAiICsgaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVzdGluYXRpb25Jc3N1ZTogIiArIGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSAmJiBpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKS5rZXkhPWlzc3VlLmtleSl7CiAgICAgICAgICAgICAgICBmb3VuZD10cnVlCiAgICAgICAgICAgICAgICBsb2cuZGVidWcgInRyb3ZhdG8gb3V0V2FyZExpbmsgLSBwcmVuZG8gbGEgZGVzdGluYXRpb24gaXNzdWUgIiArIGxpbmtlZElzc3VlVGVtcCArICIgZSBsYSBsZWdvIGFsbGEgaXNzdWUgY29ycmVudGUgc29sbyBzZSBub24gw6ggZ2nDoCBsaW5rYXRhIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhbHJlYWR5TGlua2VkPWZhbHNlCiAgICAgICAgICAgICAgICBmb3IobGkgaW4gYWxsSW5DdXJyZW50SXNzdWVMaW5rKXsKICAgICAgICAgICAgICAgICAgICBpZihsaW5rZWRJc3N1ZVRlbXAuZ2V0SWQoKSA9PSBsaS5nZXRTb3VyY2VPYmplY3QoKS5nZXRJZCgpIHx8IGxpbmtlZElzc3VlVGVtcC5nZXRJZCgpID09IGxpLmdldERlc3RpbmF0aW9uT2JqZWN0KCkuZ2V0SWQoKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGFscmVhZHlMaW5rZWQ9dHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvcihsaSBpbiBhbGxPdXRDdXJyZW50SXNzdWVMaW5rKXsKICAgICAgICAgICAgICAgICAgICBpZihsaW5rZWRJc3N1ZVRlbXAuZ2V0SWQoKSA9PSBsaS5nZXRTb3VyY2VPYmplY3QoKS5nZXRJZCgpIHx8IGxpbmtlZElzc3VlVGVtcC5nZXRJZCgpID09IGxpLmdldERlc3RpbmF0aW9uT2JqZWN0KCkuZ2V0SWQoKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGFscmVhZHlMaW5rZWQ9dHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvdW5kPXRydWUKICAgICAgICAgICAgICAgIGlmKCFhbHJlYWR5TGlua2VkKXsKICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgIm5vbiDDqCBsaW5rYXRhLCBsYSBsaW5rbyIKICAgICAgICAgICAgICAgICAJQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmNyZWF0ZUlzc3VlTGluayhpc3N1ZS5nZXRJZCgpLCBsaW5rZWRJc3N1ZVRlbXAuZ2V0SWQoKSwgTG9uZy5wYXJzZUxvbmcocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXNJZCddLnRvU3RyaW5nKCkpLCAxLCB1c2VyKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZ2nDoCBsaW5rYXRhLCBub24gbGEgbGlua28gZGkgbnVvdm8iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1lbHNlIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpICYmIGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpLmtleT09aXNzdWUua2V5KXsKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiaXNzdWUgZ2nDoCBsaW5rYXRhIgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbG9nLmRlYnVnICJDcmVvIGxpbmsgdHJhIGxhIGlzc3VlIG9nZ2V0dG8gZGkgdHJhbnNpdGlvbiBlIGxhIGlzc3VlIHJpc3VsdGFudGUgZGFsIGZpbHRybyBzZSBub24gw6ggZ2nDoCBsaW5rYXRhIgogICAgICAgIGFscmVhZHlMaW5rZWQ9ZmFsc2UKICAgICAgICBmb3IobGkgaW4gYWxsSW5DdXJyZW50SXNzdWVMaW5rKXsKICAgICAgICAgICAgaWYoaS5nZXRJZCgpID09IGxpLmdldFNvdXJjZU9iamVjdCgpLmdldElkKCkgfHwgaS5nZXRJZCgpID09IGxpLmdldERlc3RpbmF0aW9uT2JqZWN0KCkuZ2V0SWQoKSl7CiAgICAgICAgICAgICAgICBhbHJlYWR5TGlua2VkPXRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IobGkgaW4gYWxsT3V0Q3VycmVudElzc3VlTGluayl7CiAgICAgICAgICAgIGlmKGkuZ2V0SWQoKSA9PSBsaS5nZXRTb3VyY2VPYmplY3QoKS5nZXRJZCgpIHx8IGkuZ2V0SWQoKSA9PSBsaS5nZXREZXN0aW5hdGlvbk9iamVjdCgpLmdldElkKCkpewogICAgICAgICAgICAgICAgYWxyZWFkeUxpbmtlZD10cnVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYoIWFscmVhZHlMaW5rZWQpewogICAgICAgICAgICBsb2cuZGVidWcgIm5vbiDDqCBsaW5rYXRhLCBsYSBsaW5rbyIKICAgICAgICAgICAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmNyZWF0ZUlzc3VlTGluayhpLmdldElkKCksIGlzc3VlLmdldElkKCksIExvbmcucGFyc2VMb25nKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzSWQnXS50b1N0cmluZygpKSwgMSwgdXNlcik7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZ2nDoCBsaW5rYXRhLCBub24gbGEgbGlua28gZGkgbnVvdm8iCiAgICAgICAgfQogICAgICAgIAogICAgICAgICAgICAgIAogICAgfQogICAgCn0gZWxzZSB7CiAgICBsb2cuZXJyb3IoIkludmFsaWQgSlFMOiAiICsganFsU2VhcmNoKTsKfSA=</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1AgRW1haWwgTm90aWZpY2F0aW9uOiBBQ0NFUFRFRF9CWV9TVVBQTElFUiAtIG1hbnRlbnV0YSBjb21lIHBvc3QgZnVuY3Rpb24gcGVyIGV2aXRhcmUgZGkgZ2VuZXJhcmUgYmxvY2NoaSBhbCBmb3JuaXRvcmUgbGVnYXRpIGFsbCdpbnZpbyBkaSBub3RpZmljaGUgaW50ZXJuZQ==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpkZWYgcmVxdWVzdE1ldGhvZCA9ICJQT1NUIjsKCklzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKQ3VzdG9tRmllbGRNYW5hZ2VyIGN1c3RvbUZpZWxkTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpOwoKZGVmIGJvZHlfcmVxID0gWwoJInRlbXBsYXRlTmFtZSI6IHByb3BlcnRpZXNbJ3R0LmFjY2VwdGVkQnlTdXBwbGllciddLnRvU3RyaW5nKCksCgkicGVjIjogZmFsc2UsCiAgICAiaXNzdWVLZXkiOiBpc3N1ZS5rZXkKXQoKZGVmIGJhc2VVUkwgPSAiaHR0cDovLyIgKyBwcm9wZXJ0aWVzWydhcGkuZW52J10udG9TdHJpbmcoKSArICIvb3AvcmVzdC9qaXJhL0FBL3RyYW5zYWN0aW9uL21haWwvc2VuZCIKVVJMIHVybAp1cmwgPSBuZXcgVVJMKGJhc2VVUkwpCgpIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gKEh0dHBVUkxDb25uZWN0aW9uKXVybC5vcGVuQ29ubmVjdGlvbigpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RNZXRob2QocmVxdWVzdE1ldGhvZCk7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PVVURi04Iik7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJBY2NlcHQiLCAiKi8qIik7CmNvbm5lY3Rpb24uc2V0RG9PdXRwdXQodHJ1ZSk7CmNvbm5lY3Rpb24uc2V0RG9JbnB1dCh0cnVlKTsKY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0ud2l0aFdyaXRlcigiVVRGLTgiKSB7IG5ldyBTdHJlYW1pbmdKc29uQnVpbGRlcihpdCwgYm9keV9yZXEpIH0KbG9nLmRlYnVnIGNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtCmNvbm5lY3Rpb24uY29ubmVjdCgpOwoKbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKbG9nLmRlYnVnICJSZXNwb25zZUNvZGU6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkKbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKbG9nLmRlYnVnICJnZXRSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKCg==</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="81" name="Rifiuta Intervento" view="fieldscreen">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19906</meta>
          <results>
            <unconditional-result old-status="null" status="null" step="1">
              <post-functions>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1A6IE5ldyBJbnN0YWxsYXRpb24gLSBDaGVjayBsaW5rZWRUaWNrZXRzICYgRmFzdC1UcmFuc2FjdCB0aGVt</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5pbmRleC5Jc3N1ZUluZGV4aW5nU2VydmljZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5XQVJOKQoKbG9nLndhcm4gIiR7aXNzdWUua2V5fSBUcmFuc2F6aW9uZSBSRUpFQ1QgRlJPTSBTVVBQTElFUiAtIFBvc3QgRnVuY3Rpb24gY2hlY2sgbGlua2VkSXNzdWVzIgoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiBhdXRvbWF0aWNhbGx5Q29uZmlybWVkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5UmVqZWN0ZWQnXSA/IHByb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlSZWplY3RlZCddLnRvU3RyaW5nKCkgOiAiT1BfQVVUT01BVElDQUxMWV9SRUpFQ1RFRCIpWzBdCklzc3VlSW5kZXhpbmdTZXJ2aWNlIAlpc3N1ZUluZGV4aW5nU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChJc3N1ZUluZGV4aW5nU2VydmljZSkKCklzc3VlIGlzc3VlID0gaXNzdWUKLy9QZXIgdGVzdCBkYSBjb25zb2xlCi8vaXNzdWUgPSBpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVCeUtleUlnbm9yZUNhc2UoIk9QVVQtMjc2IikKCi8qREVWKi8KUkVKRUNUID0gcHJvcGVydGllc1snd2YudHIucmVqZWN0J10gPyBwcm9wZXJ0aWVzWyd3Zi50ci5yZWplY3QnXSA6IDgxCgovKlBST0QqLwovL0NPTkZJUk1fVE9fQ1VTVE9NRVIKCmRlZiB1c2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCmRlZiBpc3N1ZVNlcnZpY2UgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZVNlcnZpY2UoKQoKLypTZSBlc2VndW8gbGEgY29uZmlybSB0byBjdXN0b21lciBzdSB1biB0aWNrZXQgY29uIDEgbyArIHRpY2tldCBjb2xsZWdhdGksIHZlcmlmaWNvIGUgc3Bvc3RvIGluIGF1dG9tYXRpY28gZ2xpIGV2ZW50dWFsaSB0aWNrZXQgY29sbGVnYXRpKi8KbG9nLndhcm4gInZlcmlmaWNvIGUgc3Bvc3RvIGluIGF1dG9tYXRpY28gZ2xpIGV2ZW50dWFsaSB0aWNrZXQgY29sbGVnYXRpIgoKaWYoaXNzdWUuZ2V0SXNzdWVUeXBlKCkuZ2V0TmFtZSgpID09IHByb3BlcnRpZXNbJ2l0Lm5ld0luc3RhbGxhdGlvbiddLnRvU3RyaW5nKCkgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKT09bnVsbCB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLnRvU3RyaW5nKCkuZXF1YWxzKCJObyIpKXsKICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxJbklzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRJbndhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQogICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsSW5Jc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgbG9nLndhcm4gIklzc3VlIGNvbiByZWxhdGVzSW5Jc3N1ZUxpbmsiCiAgICAgICAgICAgIC8qRXNlZ3VpcmUgdHJhbnNhemlvbmUgZGkgc3RhdG8gZGVsbGEgc291cmNlSXNzdWUqLwogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWUgPSBpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkKICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlU3RhdHVzID0gbGlua2VkSXNzdWUuZ2V0U3RhdHVzKCkKICAgICAgICAgICAgZGVmIHRyYW5zaXRpb25JZAogICAgICAgICAgICBpZihsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lID09IChwcm9wZXJ0aWVzWyd3Zi5hc3NpZ25lZFRvU3VwcGxpZXInXSA/IHByb3BlcnRpZXNbJ3dmLmFzc2lnbmVkVG9TdXBwbGllciddLnRvU3RyaW5nKCkgOiAiQXNzaWduZWQgVG8gU3VwcGxpZXIiKSApewogICAgICAgICAgICAgICAgdHJhbnNpdGlvbklkPVJFSkVDVAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHRyYW5zaXRpb25JZD09UkVKRUNUKXsKICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgb3VyIGlucHV0IGZvciB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgZGVmIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICAgICAgICAgIHNldFNraXBTY3JlZW5DaGVjayh0cnVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9kZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q2xvc2VkLmdldFJlbGV2YW50Q29uZmlnKGlzc3VlKQogICAgICAgICAgICAgICAgLy9Db21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKICAgICAgICAgICAgICAgIC8vbG9nLndhcm4gImlzc3VlSW5wdXRQYXJhbWV0ZXJzOiAiICsgaXNzdWVJbnB1dFBhcmFtZXRlcnMKICAgICAgICAgICAgICAgIGRlZiBjdXJyZW50VXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKQogICAgICAgICAgICAgICAgZGVmIG1pID0gKE11dGFibGVJc3N1ZSkgbGlua2VkSXNzdWUKCiAgICAgICAgICAgICAgICBkZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLmdldFJlbGV2YW50Q29uZmlnKGxpbmtlZElzc3VlKQogICAgICAgICAgICAgICAgbG9nLndhcm4gImZpZWxkQ29uZmlnOiAiICsgZmllbGRDb25maWcKICAgICAgICAgICAgICAgIGRlZiBjZk5ld1ZhbHVlID0gQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHlDb25maXJtZWQudXBkYXRlVmFsdWUobnVsbCwgbGlua2VkSXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGxpbmtlZElzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCksIGNmTmV3VmFsdWUpLCBuZXcgRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyKCkpCgogICAgICAgICAgICAgICAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCkudXBkYXRlSXNzdWUoY3VycmVudFVzZXIsIG1pLCBFdmVudERpc3BhdGNoT3B0aW9uLkRPX05PVF9ESVNQQVRDSCwgZmFsc2UpOwogICAgICAgICAgICAgICAgaXNzdWVJbmRleGluZ1NlcnZpY2UucmVJbmRleChsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJVcGRhdGVkIGN1c3RvbWZpZWxkIC0gaXNzdWUgbGlua2F0YSIKCiAgICAgICAgICAgICAgICAvL2RlZiB2YWxpZGF0aW9uUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykKICAgICAgICAgICAgICAgIGlmIChpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgZGVmIGlzc3VlUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnRyYW5zaXRpb24odXNlciwgaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykpCiAgICAgICAgICAgICAgICAgICAgaWYgKCEgaXNzdWVSZXN1bHQuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJGYWlsZWQgdG8gdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlUmVzdWx0LmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiVHJhbnNhemlvbmUgZmF0dGEgNzkgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSwgJHtsaW5rZWRJc3N1ZS5zdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJDb3VsZCBub3QgdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpCiAgICBmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxPdXRJc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgbG9nLndhcm4gIklzc3VlIGNvbiByZWxhdGVzT3V0SXNzdWVMaW5rIgogICAgICAgICAgICAvKkVzZWd1aXJlIHRyYW5zYXppb25lIGRpIHN0YXRvIGRlbGxhIGRlc3RpbmF0aW9uSXNzdWUqLwogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWUgPSBpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKQogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWVTdGF0dXMgPSBsaW5rZWRJc3N1ZS5nZXRTdGF0dXMoKQogICAgICAgICAgICBkZWYgdHJhbnNpdGlvbklkCiAgICAgICAgICAgIGxvZy53YXJuICJsaW5rZWRJc3N1ZTogIiArIGxpbmtlZElzc3VlCiAgICAgICAgICAgIGxvZy53YXJuICJsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lOiAiICsgbGlua2VkSXNzdWVTdGF0dXMubmFtZQogICAgICAgICAgICBpZihsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lID09IChwcm9wZXJ0aWVzWyd3Zi5hc3NpZ25lZFRvU3VwcGxpZXInXSA/IHByb3BlcnRpZXNbJ3dmLmFzc2lnbmVkVG9TdXBwbGllciddLnRvU3RyaW5nKCkgOiAiQXNzaWduZWQgVG8gU3VwcGxpZXIiKSl7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9UkVKRUNUCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKHRyYW5zaXRpb25JZD09UkVKRUNUKXsKICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgb3VyIGlucHV0IGZvciB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgZGVmIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICAgICAgICAgIHNldFNraXBTY3JlZW5DaGVjayh0cnVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9kZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q2xvc2VkLmdldFJlbGV2YW50Q29uZmlnKGlzc3VlKQogICAgICAgICAgICAgICAgLy9Db21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKCiAgICAgICAgICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgICAgICAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNvbmZpcm1lZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICAgICAgICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCgogICAgICAgICAgICAgICAgaWYgKGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICBkZWYgaXNzdWVSZXN1bHQgPSBpc3N1ZVNlcnZpY2UudHJhbnNpdGlvbih1c2VyLCBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKSkKICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkZhaWxlZCB0byB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSAxMjIgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSwgJHtsaW5rZWRJc3N1ZS5zdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJDb3VsZCBub3QgdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgIH0KfQ==</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22756</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1AgRW1haWwgTm90aWZpY2F0aW9uOiBSRUpFQ1RFRF9CWV9TVVBQTElFUiAtIE1hbnRlbnV0YSBjb21lIHBvc3QgZnVuY3Rpb24gcGVyIG5vbiBnZW5lcmFyZSBibG9jY2hpIGFsIGZvcm5pdG9yZSBsZWdhdGkgYSBlcnJvcmkgZGkgaW52aW8gbWFpbCBpbnRlcm5l</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKZGVmIHJlcXVlc3RNZXRob2QgPSAiUE9TVCI7CgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKCmRlZiBib2R5X3JlcSA9IFsKCSJ0ZW1wbGF0ZU5hbWUiOiBwcm9wZXJ0aWVzWyd0dC5yZWplY3RlZEJ5U3VwcGxpZXInXS50b1N0cmluZygpLAoJInBlYyI6IGZhbHNlLAogICAgImlzc3VlS2V5IjogaXNzdWUua2V5Cl0KCmRlZiBiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1snYXBpLmVudiddLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvamlyYS9BQS90cmFuc2FjdGlvbi9tYWlsL3NlbmQiClVSTCB1cmwKdXJsID0gbmV3IFVSTChiYXNlVVJMKQoKSHR0cFVSTENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IChIdHRwVVJMQ29ubmVjdGlvbil1cmwub3BlbkNvbm5lY3Rpb24oKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCIpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQWNjZXB0IiwgIiovKiIpOwpjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwpjb25uZWN0aW9uLnNldERvSW5wdXQodHJ1ZSk7CmNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtCmNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtLndpdGhXcml0ZXIoIlVURi04IikgeyBuZXcgU3RyZWFtaW5nSnNvbkJ1aWxkZXIoaXQsIGJvZHlfcmVxKSB9CmxvZy5kZWJ1ZyBjb25uZWN0aW9uLm91dHB1dFN0cmVhbQpjb25uZWN0aW9uLmNvbm5lY3QoKTsKCmxvZy5kZWJ1ZyAidXJsOiAiICsgdXJsCmxvZy5kZWJ1ZyAiUmVzcG9uc2VDb2RlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpCmxvZy5kZWJ1ZyAiUmVzcG9uc2VNZXNzYWdlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpCmxvZy5kZWJ1ZyAiZ2V0UmVzcG9uc2VNZXNzYWdlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpCgo=</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="3" name="Accepted By Supplier">
      <meta name="jira.status.id">14328</meta>
      <actions>
        <action id="91" name="Invia Conferma Intervento al Cliente" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19907</meta>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">9c15d3e06c08c288db8be2a197da43b6cfcf9624</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcyAtIG9ubHkgZXJyb3JzLCBubyB3YXJuaW5ncyAtIFNPTE8gU0UgT1BBQV9BVVRPTUFUSUNBTExZX0NPTkZJUk1FRD09bnVsbCBPUiAhPVllcw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQogCklzc3VlIGlzc3VlID0gaXNzdWUKCmRlZiBlcnJvcnMgPSBmYWxzZQpkZWYgd2FybmluZ3MgPSBmYWxzZQoKZGVmIHN1cHBsaWVyTGFiZWwgPSBwcm9wZXJ0aWVzWydjZi5zdXBwbGllciddID8gcHJvcGVydGllc1snY2Yuc3VwcGxpZXInXS50b1N0cmluZygpIDogIk9QX1NVUFBMSUVSIgpkZWYgc3VwcGxpZXIgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHN1cHBsaWVyTGFiZWwpWzBdCgpkZWYgcGxhbm5lZERhdGUgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnBsYW5uZWREYXRlJ10udG9TdHJpbmcoKSlbMF0KZGVmIHBsYW5uZWRIb3VyID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5wbGFubmVkSG91ciddLnRvU3RyaW5nKCkpWzBdCmRlZiBwbGFubmVkVGVjaHMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnRlY2huaWNpYW5zJ10udG9TdHJpbmcoKSlbMF0KCmRlZiB0cmFuc2l0aW9uQ2hlY2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmNoZWNrQW5kQ29uZmlybSddLnRvU3RyaW5nKCkpWzBdCmxvZy5kZWJ1ZyAidHJhbnNpdGlvbkNoZWNrOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spCmRlZiBhdXRvbWF0aWNhbGx5Q29uZmlybWVkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5Q29uZmlybWVkJ10udG9TdHJpbmcoKSlbMF0KCmRlZiBlcnJvck1hbmRhdG9yeUZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgd2FybmluZ0VtcHR5RmllbGRzID0gbmV3IEFycmF5TGlzdCgpCgppZigoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKT09bnVsbCB8fCAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpICYmICFpc3N1ZS5nZXRJc3N1ZVR5cGUoKS5nZXROYW1lKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2l0Lm5ld0luc3RhbGxhdGlvbiddKSl7CiAgICAvL09QX1NVUFBMSUVSCiAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHN1cHBsaWVyKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc3VwcGxpZXIpID09ICIiIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc3VwcGxpZXIpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CgkJZXJyb3JzID0gdHJ1ZQoJCWVycm9yTWFuZGF0b3J5RmllbGRzLmFkZChzdXBwbGllckxhYmVsKQoJfQogICAgLy9PUEFBX1BMQU5ORURfREFURQogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShwbGFubmVkRGF0ZSk9PW51bGwgfHwgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHBsYW5uZWREYXRlKSA9PSAiIiB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHBsYW5uZWREYXRlKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIGVycm9ycyA9IHRydWUKICAgICAgICBlcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQocHJvcGVydGllc1snY2YucGxhbm5lZERhdGUnXS50b1N0cmluZygpKQogICAgfQogICAgLy9PUEFBX1BMQU5ORURfSE9VUgogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShwbGFubmVkSG91cik9PW51bGwgfHwgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHBsYW5uZWRIb3VyKSA9PSAiIiB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHBsYW5uZWRIb3VyKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIGVycm9ycyA9IHRydWUKICAgICAgICBlcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQocHJvcGVydGllc1snY2YucGxhbm5lZEhvdXInXS50b1N0cmluZygpKQogICAgfQogICAgLy9PUEFBX1RFQ0hOSUNJQU5TCiAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHBsYW5uZWRUZWNocyk9PW51bGwgfHwgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHBsYW5uZWRUZWNocykgPT0gIiIgfHwgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShwbGFubmVkVGVjaHMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgLy9lcnJvcnMgPSB0cnVlCiAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgIC8vZXJyb3JNYW5kYXRvcnlGaWVsZHMuYWRkKCJPUEFBX1RFQ0hOSUNJQU5TIikKICAgICAgICB3YXJuaW5nRW1wdHlGaWVsZHMuYWRkKHByb3BlcnRpZXNbJ2NmLnRlY2huaWNpYW5zJ10udG9TdHJpbmcoKSkKICAgIH0KCiAgICBkZWYgb3V0cHV0ID0gbmV3IEFycmF5TGlzdCgpCgogICAgaWYgKCFlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfWVsc2V7CiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CiAgICAgICAgICAgIC8vbG9nLmRlYnVnICJyZXR1cm4gdHJ1ZSAtIHRyYW5zaXRpb25DaGVjayA9IFllcyIKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgaWYoIWVycm9ycyAmJiB3YXJuaW5ncyl7CiAgICAgICAgICAgICAgICBkZWYgd0xpc3QgPSBuZXcgQXJyYXlMaXN0KCkKCiAgICAgICAgICAgICAgICBpZih3YXJuaW5nRW1wdHlGaWVsZHMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJXIikKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQoIkNPTkZJUk1fRU1QVFlfRklFTERTIikKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQobnVsbCkKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQod2FybmluZ0VtcHR5RmllbGRzKQoKICAgICAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHkpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siVyI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIlciLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKICAgICAgICAgICAgfQogICAgICAgICAgICBpZihlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgICAgICAgICAgICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICAgICAgICAgIGlmKGVycm9yTWFuZGF0b3J5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIGRlZiBlTGlzdE1hbmRhdG9yeSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiRSIpCiAgICAgICAgICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKCJNQU5EQVRPUllfRklFTERTIikKICAgICAgICAgICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQobnVsbCkKICAgICAgICAgICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoZXJyb3JNYW5kYXRvcnlGaWVsZHMpCiAgICAgICAgICAgICAgICAgICAgZUxpc3QuYWRkKGVMaXN0TWFuZGF0b3J5KQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgICAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICAgICAgICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgogICAgICAgICAgICAgICAgaWYoZXJyb3JNYW5kYXRvcnlGaWVsZHMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgZGVmIGVMaXN0TWFuZGF0b3J5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKCJFIikKICAgICAgICAgICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoIk1BTkRBVE9SWV9GSUVMRFMiKQogICAgICAgICAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChudWxsKQogICAgICAgICAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChlcnJvck1hbmRhdG9yeUZpZWxkcykKICAgICAgICAgICAgICAgICAgICBlTGlzdC5hZGQoZUxpc3RNYW5kYXRvcnkpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYod2FybmluZ0VtcHR5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZCgiVyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJDT05GSVJNX0VNUFRZX0ZJRUxEUyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKG51bGwpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKHdhcm5pbmdFbXB0eUZpZWxkcykKCiAgICAgICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5KQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgICAgICAgICBvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIldFIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">bc182ea265c648453eb3ce3ec1d06e9d7cbe1ec6</arg>
              <arg name="FIELD_NOTES">YCFgT1AgRW1haWwgTm90aWZpY2F0aW9uOiBDT05GSVJNX1RPX0NVU1RPTUVSIC0gU2UgT1BBQV9BVVRPTUFUSUNBTExZX0NPTkZJUk1FRCA9IG51bGwgT1IgIT0gWWVz</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTW9kaWZpZWRWYWx1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKZGVmIHJlcXVlc3RNZXRob2QgPSAiUE9TVCI7CmRlZiByZWxhdGVzSW5Jc3N1ZUxpbms9ZmFsc2UKZGVmIHJlbGF0ZXNPdXRJc3N1ZUxpbms9ZmFsc2UKZGVmIGxpbmtlZFRpY2tldHM9bmV3IEFycmF5TGlzdCgpCgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKSXNzdWVJbmRleGluZ1NlcnZpY2UgCWlzc3VlSW5kZXhpbmdTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29tcG9uZW50KElzc3VlSW5kZXhpbmdTZXJ2aWNlKQoKZGVmIGF1dG9tYXRpY2FsbHlDb25maXJtZWQgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlDb25maXJtZWQnXS50b1N0cmluZygpKVswXQoKbG9nLmRlYnVnICJpc3N1ZTogIiArIGlzc3VlLmtleSArICIgLSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKQoKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKT09bnVsbCB8fCAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpewogICAgCiAgICAvKk9QLTEwMzg6IHZlcmlmaWNhIHRpY2tldCBjb2xsZWdhdGkqLwogICAgTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCiAgICBmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxJbklzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICAgICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICAgICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICByZWxhdGVzSW5Jc3N1ZUxpbms9dHJ1ZQogICAgICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkudG9TdHJpbmcoKSkKICAgICAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc0luSXNzdWVMaW5rIgogICAgICAgIH0KICAgIH0KICAgIGxvZy5kZWJ1ZyBsaW5rZWRUaWNrZXRzCiAgICBMaXN0PElzc3VlTGluaz4gYWxsT3V0SXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldE91dHdhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQogICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsT3V0SXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgICAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIHJlbGF0ZXNPdXRJc3N1ZUxpbms9dHJ1ZQogICAgICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKS50b1N0cmluZygpKQogICAgICAgICAgICBsb2cuZGVidWcgIklzc3VlIGNvbiByZWxhdGVzT3V0SXNzdWVMaW5rIgogICAgICAgIH0KICAgIH0KICAgIGxvZy5kZWJ1ZyBsaW5rZWRUaWNrZXRzCiAgICAKICAgIGRlZiBib2R5X3JlcQogICAgaWYocmVsYXRlc0luSXNzdWVMaW5rIHx8IHJlbGF0ZXNPdXRJc3N1ZUxpbmspewogICAgICAgIGJvZHlfcmVxID0gWwogICAgICAgIAkidGVtcGxhdGVOYW1lIjogcHJvcGVydGllc1sndHQuY29uZmlybVRvQ3VzdG9tZXInXS50b1N0cmluZygpLAogICAgICAgIAkicGVjIjogZmFsc2UsCiAgICAgICAgCSJpc3N1ZUtleSI6IGlzc3VlLmtleSwKICAgICAgICAgICAgImxpbmtlZFRpY2tldHMiOiBsaW5rZWRUaWNrZXRzCiAgICAJXQogICAgfWVsc2V7CiAgICAgICAgYm9keV9yZXEgPSBbCiAgICAgICAgICAgICJ0ZW1wbGF0ZU5hbWUiOiBwcm9wZXJ0aWVzWyd0dC5jb25maXJtVG9DdXN0b21lciddLnRvU3RyaW5nKCksCiAgICAgICAgICAgICJwZWMiOiBmYWxzZSwKICAgICAgICAgICAgImlzc3VlS2V5IjogaXNzdWUua2V5CiAgICAgICAgXQogICAgfQogICAgCgogICAgZGVmIGJhc2VVUkwgPSAiaHR0cDovLyIgKyBwcm9wZXJ0aWVzWydhcGkuZW52J10udG9TdHJpbmcoKSArICIvb3AvcmVzdC9qaXJhL0FBL3RyYW5zYWN0aW9uL21haWwvc2VuZCIKICAgIFVSTCB1cmwKICAgIHVybCA9IG5ldyBVUkwoYmFzZVVSTCkKCiAgICBIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gKEh0dHBVUkxDb25uZWN0aW9uKXVybC5vcGVuQ29ubmVjdGlvbigpOwogICAgY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwogICAgY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgiKTsKICAgIGNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJBY2NlcHQiLCAiKi8qIik7CiAgICBjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwogICAgY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwogICAgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KICAgIGNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtLndpdGhXcml0ZXIoIlVURi04IikgeyBuZXcgU3RyZWFtaW5nSnNvbkJ1aWxkZXIoaXQsIGJvZHlfcmVxKSB9CiAgICBsb2cuZGVidWcgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KICAgIGNvbm5lY3Rpb24uY29ubmVjdCgpOwoKICAgIGRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgZGVmIGVMaXN0RXJyb3JzID0gbmV3IEFycmF5TGlzdCgpCiAgICBkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgogICAgbG9nLmRlYnVnIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKQogICAgCiAgICBpZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgICAgICBsb2cuZGVidWcgInVybDogIiArIHVybAogICAgICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VDb2RlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpCiAgICAgICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKCiAgICAgICAgZGVmIG91dHB1dE1zZyA9ICgoSHR0cFVSTENvbm5lY3Rpb24pY29ubmVjdGlvbikuZXJyb3JTdHJlYW0udGV4dAogICAgICAgIGxvZy5kZWJ1ZyAiKChIdHRwVVJMQ29ubmVjdGlvbiljb25uZWN0aW9uKS5lcnJvclN0cmVhbS50ZXh0OiAiICsgb3V0cHV0TXNnCgogICAgICAgIGRlZiBqc29uU2x1cnBlciA9IG5ldyBKc29uU2x1cnBlcigpCiAgICAgICAgZGVmIGpzb25fb2JqZWN0ID0ganNvblNsdXJwZXIucGFyc2VUZXh0KG91dHB1dE1zZykKICAgICAgICBhc3NlcnQganNvbl9vYmplY3QgaW5zdGFuY2VvZiBNYXAgIAogICAgICAgIGxvZy5kZWJ1ZyAibWVzc2FnZTogIiArICBqc29uX29iamVjdC5tZXNzYWdlCgogICAgICAgIGVMaXN0RXJyb3JzLmFkZCgiRSIpCiAgICAgICAgZUxpc3RFcnJvcnMuYWRkKCJTRU5ETUFJTCIpCiAgICAgICAgZXJyb3JNc2dzLmFkZChjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpICsgIiAiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKSkKICAgICAgICBlTGlzdEVycm9ycy5hZGQoanNvbl9vYmplY3QubWVzc2FnZSkKICAgICAgICBlTGlzdC5hZGQoZUxpc3RFcnJvcnMpCgogICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkKICAgIH1lbHNlewogICAgICAgIGRlZiBjdXJyZW50VXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKQogICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGlzc3VlCgogICAgICAgIGRlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDb25maXJtZWQuZ2V0UmVsZXZhbnRDb25maWcoaXNzdWUpCiAgICAgICAgbG9nLmRlYnVnICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnICsgIiBkYSBhZ2dpb3JuYXJlIHN1IGlzc3VlICR7aXNzdWV9IgogICAgICAgIGRlZiBjZk5ld1ZhbHVlID0gQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJObyIgfQogICAgICAgIGxvZy5kZWJ1ZyAiY2ZOZXdWYWx1ZTogIiArIGNmTmV3VmFsdWUKICAgICAgICBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLnVwZGF0ZVZhbHVlKG51bGwsIGlzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICAgICAgaXNzdWVJbmRleGluZ1NlcnZpY2UucmVJbmRleChpc3N1ZSkKICAgICAgICBsb2cuZGVidWcgIlVwZGF0ZWQgY3VzdG9tZmllbGQgLSBpc3N1ZSBwcmluY2lwYWxlOiAke2lzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCl9IgogICAgfQp9</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_NOTES">YCFgT1A6IFNldCBPUEFBX0FVVE9NQVRJQ0FMTFlfQ09ORklSTUVEPU5vIGlmIE9QQUFfQVVUT01BVElDQUxMWV9DT05GSVJNRUQ9bnVsbCBPUiAhPVllcw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTW9kaWZpZWRWYWx1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCgppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCmRlZiByZXF1ZXN0TWV0aG9kID0gIlBPU1QiOwoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7Cklzc3VlSW5kZXhpbmdTZXJ2aWNlIAlpc3N1ZUluZGV4aW5nU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChJc3N1ZUluZGV4aW5nU2VydmljZSkKCmRlZiBhdXRvbWF0aWNhbGx5Q29uZmlybWVkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5Q29uZmlybWVkJ10udG9TdHJpbmcoKSlbMF0KCmxvZy5kZWJ1ZyAiaXNzdWU6ICIgKyBpc3N1ZS5rZXkgKyAiIC0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKTogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCkKCmlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCk9PW51bGwgfHwgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCkudG9TdHJpbmcoKS5lcXVhbHMoIlllcyIpKXsKICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICBkZWYgbWkgPSAoTXV0YWJsZUlzc3VlKSBpc3N1ZQoKICAgICAgICBkZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLmdldFJlbGV2YW50Q29uZmlnKGlzc3VlKQogICAgICAgIGxvZy5kZWJ1ZyAiZmllbGRDb25maWc6ICIgKyBmaWVsZENvbmZpZyArICIgZGEgYWdnaW9ybmFyZSBzdSBpc3N1ZSAke2lzc3VlfSIKICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiTm8iIH0KICAgICAgICBsb2cuZGVidWcgImNmTmV3VmFsdWU6ICIgKyBjZk5ld1ZhbHVlCiAgICAgICAgYXV0b21hdGljYWxseUNvbmZpcm1lZC51cGRhdGVWYWx1ZShudWxsLCBpc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKSwgY2ZOZXdWYWx1ZSksIG5ldyBEZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIoKSkKCiAgICAgICAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCkudXBkYXRlSXNzdWUoY3VycmVudFVzZXIsIG1pLCBFdmVudERpc3BhdGNoT3B0aW9uLkRPX05PVF9ESVNQQVRDSCwgZmFsc2UpOwogICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgoaXNzdWUpCiAgICAgICAgbG9nLmRlYnVnICJVcGRhdGVkIGN1c3RvbWZpZWxkIC0gaXNzdWUgcHJpbmNpcGFsZTogJHtpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpfSIKfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="4">
              <post-functions>
                <function type="class">
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="append.value"></arg>
                  <arg name="field.value">%%CURRENT_DATETIME%%</arg>
                  <arg name="field.name">customfield_22640</arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">4dcfdd4f11f7d9ea3966d7c23e98027086a2ee90</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIGxpbmtlZFRpY2tldHMgJiBGYXN0LVRyYW5zYWN0IHRoZW0=</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5pbmRleC5Jc3N1ZUluZGV4aW5nU2VydmljZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5XQVJOKQoKbG9nLndhcm4gIiR7aXNzdWUua2V5fSBUcmFuc2F6aW9uZSBDb21wbGV0ZSAtIFBvc3QgRnVuY3Rpb24gY2hlY2sgbGlua2VkSXNzdWVzIgoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiBhdXRvbWF0aWNhbGx5Q29uZmlybWVkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5Q29uZmlybWVkJ10udG9TdHJpbmcoKSlbMF0KSXNzdWVJbmRleGluZ1NlcnZpY2UgCWlzc3VlSW5kZXhpbmdTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29tcG9uZW50KElzc3VlSW5kZXhpbmdTZXJ2aWNlKQoKSXNzdWUgaXNzdWUgPSBpc3N1ZQovL1BlciB0ZXN0IGRhIGNvbnNvbGUKLy9pc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiT1BVVC0yNzYiKQoKLypERVYqLwpDT05GSVJNX1RPX0NVU1RPTUVSPXByb3BlcnRpZXNbJ3dmLnRyLmNvbmZpcm1Ub0N1c3RvbWVyJ10udG9JbnRlZ2VyKCkKCi8qUFJPRCovCi8vQ09ORklSTV9UT19DVVNUT01FUgoKZGVmIHVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKZGVmIGlzc3VlU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlU2VydmljZSgpCgovKlNlIGVzZWd1byBsYSBjb25maXJtIHRvIGN1c3RvbWVyIHN1IHVuIHRpY2tldCBjb24gMSBvICsgdGlja2V0IGNvbGxlZ2F0aSwgdmVyaWZpY28gZSBzcG9zdG8gaW4gYXV0b21hdGljbyBnbGkgZXZlbnR1YWxpIHRpY2tldCBjb2xsZWdhdGkqLwpsb2cud2FybiAidmVyaWZpY28gZSBzcG9zdG8gaW4gYXV0b21hdGljbyBnbGkgZXZlbnR1YWxpIHRpY2tldCBjb2xsZWdhdGkiCgppZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpPT1udWxsIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCkudG9TdHJpbmcoKS5lcXVhbHMoIk5vIikpewogICAgTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCiAgICBmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxJbklzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICAgICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICAgICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBsb2cud2FybiAiSXNzdWUgY29uIHJlbGF0ZXNJbklzc3VlTGluayIKICAgICAgICAgICAgLypFc2VndWlyZSB0cmFuc2F6aW9uZSBkaSBzdGF0byBkZWxsYSBzb3VyY2VJc3N1ZSovCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZSA9IGlzc3VlTGluay5nZXRTb3VyY2VPYmplY3QoKQogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWVTdGF0dXMgPSBsaW5rZWRJc3N1ZS5nZXRTdGF0dXMoKQogICAgICAgICAgICBkZWYgdHJhbnNpdGlvbklkCiAgICAgICAgICAgIGlmKGxpbmtlZElzc3VlU3RhdHVzLm5hbWUgPT0gcHJvcGVydGllc1snd2YuYWNjZXB0ZWRCeVN1cHBsaWVyJ10udG9TdHJpbmcoKSl7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9Q09ORklSTV9UT19DVVNUT01FUgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHRyYW5zaXRpb25JZD09Q09ORklSTV9UT19DVVNUT01FUil7CiAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIG91ciBpbnB1dCBmb3IgdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgIGRlZiBpc3N1ZUlucHV0UGFyYW1ldGVycyA9IGlzc3VlU2VydmljZS5uZXdJc3N1ZUlucHV0UGFyYW1ldGVycygpCiAgICAgICAgICAgICAgICBpc3N1ZUlucHV0UGFyYW1ldGVycy53aXRoIHsKICAgICAgICAgICAgICAgICAgICBzZXRTa2lwU2NyZWVuQ2hlY2sodHJ1ZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhpc3N1ZSkKICAgICAgICAgICAgICAgIC8vQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIC8vaXNzdWVJbnB1dFBhcmFtZXRlcnMuYWRkQ3VzdG9tRmllbGRWYWx1ZShmaWVsZENvbmZpZy5nZXRJZCgpLCAiWWVzIikgCiAgICAgICAgICAgICAgICAvL2xvZy53YXJuICJpc3N1ZUlucHV0UGFyYW1ldGVyczogIiArIGlzc3VlSW5wdXRQYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgICAgICAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNvbmZpcm1lZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICAgICAgICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCgogICAgICAgICAgICAgICAgLy9kZWYgdmFsaWRhdGlvblJlc3VsdCA9IGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpCiAgICAgICAgICAgICAgICBpZiAoaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgICAgIGRlZiBpc3N1ZVJlc3VsdCA9IGlzc3VlU2VydmljZS50cmFuc2l0aW9uKHVzZXIsIGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpKQogICAgICAgICAgICAgICAgICAgIGlmICghIGlzc3VlUmVzdWx0LmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiRmFpbGVkIHRvIHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIlRyYW5zYXppb25lIGZhdHRhIDc5ICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlUmVzdWx0LmVycm9yQ29sbGVjdGlvbn0sICR7bGlua2VkSXNzdWUuc3RhdHVzfSIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiQ291bGQgbm90IHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBMaXN0PElzc3VlTGluaz4gYWxsT3V0SXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldE91dHdhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQogICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsT3V0SXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgICAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIGxvZy53YXJuICJJc3N1ZSBjb24gcmVsYXRlc091dElzc3VlTGluayIKICAgICAgICAgICAgLypFc2VndWlyZSB0cmFuc2F6aW9uZSBkaSBzdGF0byBkZWxsYSBkZXN0aW5hdGlvbklzc3VlKi8KICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlID0gaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkKICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlU3RhdHVzID0gbGlua2VkSXNzdWUuZ2V0U3RhdHVzKCkKICAgICAgICAgICAgZGVmIHRyYW5zaXRpb25JZAogICAgICAgICAgICBsb2cud2FybiAibGlua2VkSXNzdWU6ICIgKyBsaW5rZWRJc3N1ZQogICAgICAgICAgICBsb2cud2FybiAibGlua2VkSXNzdWVTdGF0dXMubmFtZTogIiArIGxpbmtlZElzc3VlU3RhdHVzLm5hbWUKICAgICAgICAgICAgaWYobGlua2VkSXNzdWVTdGF0dXMubmFtZSA9PSBwcm9wZXJ0aWVzWyd3Zi5hY2NlcHRlZEJ5U3VwcGxpZXInXS50b1N0cmluZygpKXsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb25JZD1DT05GSVJNX1RPX0NVU1RPTUVSCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKHRyYW5zaXRpb25JZD09Q09ORklSTV9UT19DVVNUT01FUil7CiAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIG91ciBpbnB1dCBmb3IgdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgIGRlZiBpc3N1ZUlucHV0UGFyYW1ldGVycyA9IGlzc3VlU2VydmljZS5uZXdJc3N1ZUlucHV0UGFyYW1ldGVycygpCiAgICAgICAgICAgICAgICBpc3N1ZUlucHV0UGFyYW1ldGVycy53aXRoIHsKICAgICAgICAgICAgICAgICAgICBzZXRTa2lwU2NyZWVuQ2hlY2sodHJ1ZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhpc3N1ZSkKICAgICAgICAgICAgICAgIC8vQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIC8vaXNzdWVJbnB1dFBhcmFtZXRlcnMuYWRkQ3VzdG9tRmllbGRWYWx1ZShmaWVsZENvbmZpZy5nZXRJZCgpLCAiWWVzIikgCgogICAgICAgICAgICAgICAgZGVmIGN1cnJlbnRVc2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCiAgICAgICAgICAgICAgICBkZWYgbWkgPSAoTXV0YWJsZUlzc3VlKSBsaW5rZWRJc3N1ZQoKICAgICAgICAgICAgICAgIGRlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDb25maXJtZWQuZ2V0UmVsZXZhbnRDb25maWcobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiZmllbGRDb25maWc6ICIgKyBmaWVsZENvbmZpZwogICAgICAgICAgICAgICAgZGVmIGNmTmV3VmFsdWUgPSBDb21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgYXV0b21hdGljYWxseUNvbmZpcm1lZC51cGRhdGVWYWx1ZShudWxsLCBsaW5rZWRJc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUobGlua2VkSXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKSwgY2ZOZXdWYWx1ZSksIG5ldyBEZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIoKSkKCiAgICAgICAgICAgICAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpc3N1ZUluZGV4aW5nU2VydmljZS5yZUluZGV4KGxpbmtlZElzc3VlKQogICAgICAgICAgICAgICAgbG9nLndhcm4gIlVwZGF0ZWQgY3VzdG9tZmllbGQgLSBpc3N1ZSBsaW5rYXRhIgoKICAgICAgICAgICAgICAgIGlmIChpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgZGVmIGlzc3VlUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnRyYW5zaXRpb24odXNlciwgaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykpCiAgICAgICAgICAgICAgICAgICAgaWYgKCEgaXNzdWVSZXN1bHQuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJGYWlsZWQgdG8gdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlUmVzdWx0LmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiVHJhbnNhemlvbmUgZmF0dGEgMTIyICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlUmVzdWx0LmVycm9yQ29sbGVjdGlvbn0sICR7bGlua2VkSXNzdWUuc3RhdHVzfSIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiQ291bGQgbm90IHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICB9CiAgICB9Cn0=</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="101" name="Conferma senza Notifica al Cliente" view="fieldscreen">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19923</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">3f2fe9ea0b98294db32d475986c17366260064ed</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="disabled">true</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ05ldyBJbnN0YWxsYXRpb24nfHx8</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="null" status="null" step="4">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIGxpbmtlZFRpY2tldHMgJiBGYXN0LVRyYW5zYWN0IHRoZW0=</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5pbmRleC5Jc3N1ZUluZGV4aW5nU2VydmljZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5XQVJOKQoKbG9nLndhcm4gIiR7aXNzdWUua2V5fSBUcmFuc2F6aW9uZSBDb21wbGV0ZSAtIFBvc3QgRnVuY3Rpb24gY2hlY2sgbGlua2VkSXNzdWVzIgoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiBhdXRvbWF0aWNhbGx5Q29uZmlybWVkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5Q29uZmlybWVkJ10udG9TdHJpbmcoKSlbMF0KSXNzdWVJbmRleGluZ1NlcnZpY2UgCWlzc3VlSW5kZXhpbmdTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29tcG9uZW50KElzc3VlSW5kZXhpbmdTZXJ2aWNlKQoKSXNzdWUgaXNzdWUgPSBpc3N1ZQovL1BlciB0ZXN0IGRhIGNvbnNvbGUKLy9pc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiT1BVVC0yNzYiKQoKLypERVYqLwpDT05GSVJNX1RPX0NVU1RPTUVSID0gcHJvcGVydGllc1snd2YudHIuY29uZmlybVRvQ3VzdG9tZXJOb0VtYWlsJ10gPyBwcm9wZXJ0aWVzWyd3Zi50ci5jb25maXJtVG9DdXN0b21lck5vRW1haWwnXSA6IDEwMQoKLypQUk9EKi8KLy9DT05GSVJNX1RPX0NVU1RPTUVSCgpkZWYgdXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKQpkZWYgaXNzdWVTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVTZXJ2aWNlKCkKCi8qU2UgZXNlZ3VvIGxhIGNvbmZpcm0gdG8gY3VzdG9tZXIgc3UgdW4gdGlja2V0IGNvbiAxIG8gKyB0aWNrZXQgY29sbGVnYXRpLCB2ZXJpZmljbyBlIHNwb3N0byBpbiBhdXRvbWF0aWNvIGdsaSBldmVudHVhbGkgdGlja2V0IGNvbGxlZ2F0aSovCmxvZy53YXJuICJ2ZXJpZmljbyBlIHNwb3N0byBpbiBhdXRvbWF0aWNvIGdsaSBldmVudHVhbGkgdGlja2V0IGNvbGxlZ2F0aSIKCmlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCk9PW51bGwgfHwgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKS50b1N0cmluZygpLmVxdWFscygiTm8iKSl7CiAgICBMaXN0PElzc3VlTGluaz4gYWxsSW5Jc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0SW53YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKICAgIGZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgICAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIGxvZy53YXJuICJJc3N1ZSBjb24gcmVsYXRlc0luSXNzdWVMaW5rIgogICAgICAgICAgICAvKkVzZWd1aXJlIHRyYW5zYXppb25lIGRpIHN0YXRvIGRlbGxhIHNvdXJjZUlzc3VlKi8KICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlID0gaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZVN0YXR1cyA9IGxpbmtlZElzc3VlLmdldFN0YXR1cygpCiAgICAgICAgICAgIGRlZiB0cmFuc2l0aW9uSWQKICAgICAgICAgICAgaWYobGlua2VkSXNzdWVTdGF0dXMubmFtZSA9PSBwcm9wZXJ0aWVzWyd3Zi5hY2NlcHRlZEJ5U3VwcGxpZXInXS50b1N0cmluZygpKXsKICAgICAgICAgICAgICAgIHRyYW5zaXRpb25JZD1DT05GSVJNX1RPX0NVU1RPTUVSCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYodHJhbnNpdGlvbklkPT1DT05GSVJNX1RPX0NVU1RPTUVSKXsKICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgb3VyIGlucHV0IGZvciB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgZGVmIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICAgICAgICAgIHNldFNraXBTY3JlZW5DaGVjayh0cnVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9kZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q2xvc2VkLmdldFJlbGV2YW50Q29uZmlnKGlzc3VlKQogICAgICAgICAgICAgICAgLy9Db21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKICAgICAgICAgICAgICAgIC8vbG9nLndhcm4gImlzc3VlSW5wdXRQYXJhbWV0ZXJzOiAiICsgaXNzdWVJbnB1dFBhcmFtZXRlcnMKICAgICAgICAgICAgICAgIGRlZiBjdXJyZW50VXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKQogICAgICAgICAgICAgICAgZGVmIG1pID0gKE11dGFibGVJc3N1ZSkgbGlua2VkSXNzdWUKCiAgICAgICAgICAgICAgICBkZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLmdldFJlbGV2YW50Q29uZmlnKGxpbmtlZElzc3VlKQogICAgICAgICAgICAgICAgbG9nLndhcm4gImZpZWxkQ29uZmlnOiAiICsgZmllbGRDb25maWcKICAgICAgICAgICAgICAgIGRlZiBjZk5ld1ZhbHVlID0gQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHlDb25maXJtZWQudXBkYXRlVmFsdWUobnVsbCwgbGlua2VkSXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGxpbmtlZElzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCksIGNmTmV3VmFsdWUpLCBuZXcgRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyKCkpCgogICAgICAgICAgICAgICAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCkudXBkYXRlSXNzdWUoY3VycmVudFVzZXIsIG1pLCBFdmVudERpc3BhdGNoT3B0aW9uLkRPX05PVF9ESVNQQVRDSCwgZmFsc2UpOwogICAgICAgICAgICAgICAgaXNzdWVJbmRleGluZ1NlcnZpY2UucmVJbmRleChsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJVcGRhdGVkIGN1c3RvbWZpZWxkIC0gaXNzdWUgbGlua2F0YSIKCiAgICAgICAgICAgICAgICAvL2RlZiB2YWxpZGF0aW9uUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykKICAgICAgICAgICAgICAgIGlmIChpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgZGVmIGlzc3VlUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnRyYW5zaXRpb24odXNlciwgaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykpCiAgICAgICAgICAgICAgICAgICAgaWYgKCEgaXNzdWVSZXN1bHQuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJGYWlsZWQgdG8gdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlUmVzdWx0LmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiVHJhbnNhemlvbmUgZmF0dGEgNzkgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSwgJHtsaW5rZWRJc3N1ZS5zdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJDb3VsZCBub3QgdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpCiAgICBmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxPdXRJc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgbG9nLndhcm4gIklzc3VlIGNvbiByZWxhdGVzT3V0SXNzdWVMaW5rIgogICAgICAgICAgICAvKkVzZWd1aXJlIHRyYW5zYXppb25lIGRpIHN0YXRvIGRlbGxhIGRlc3RpbmF0aW9uSXNzdWUqLwogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWUgPSBpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKQogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWVTdGF0dXMgPSBsaW5rZWRJc3N1ZS5nZXRTdGF0dXMoKQogICAgICAgICAgICBkZWYgdHJhbnNpdGlvbklkCiAgICAgICAgICAgIGxvZy53YXJuICJsaW5rZWRJc3N1ZTogIiArIGxpbmtlZElzc3VlCiAgICAgICAgICAgIGxvZy53YXJuICJsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lOiAiICsgbGlua2VkSXNzdWVTdGF0dXMubmFtZQogICAgICAgICAgICBpZihsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lID09ICJBY2NlcHRlZCBCeSBTdXBwbGllciIpewogICAgICAgICAgICAgICAgdHJhbnNpdGlvbklkPUNPTkZJUk1fVE9fQ1VTVE9NRVIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYodHJhbnNpdGlvbklkPT1DT05GSVJNX1RPX0NVU1RPTUVSKXsKICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgb3VyIGlucHV0IGZvciB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgZGVmIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICAgICAgICAgIHNldFNraXBTY3JlZW5DaGVjayh0cnVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9kZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q2xvc2VkLmdldFJlbGV2YW50Q29uZmlnKGlzc3VlKQogICAgICAgICAgICAgICAgLy9Db21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKCiAgICAgICAgICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgICAgICAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNvbmZpcm1lZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICAgICAgICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCgogICAgICAgICAgICAgICAgaWYgKGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICBkZWYgaXNzdWVSZXN1bHQgPSBpc3N1ZVNlcnZpY2UudHJhbnNpdGlvbih1c2VyLCBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKSkKICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkZhaWxlZCB0byB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSAxMjIgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSwgJHtsaW5rZWRJc3N1ZS5zdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJDb3VsZCBub3QgdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgIH0KfQ==</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="4" name="Confirmed and Planned">
      <meta name="jira.status.id">14329</meta>
      <actions>
        <action id="111" name="Compila Rapporto di Intervento" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19908</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">fdff8da8847f0cecf612f8079bbc8937a21ddfe5</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcyAtIHNvbG8gZXJyb3JzLCBubyB3YXJuaW5ncw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQogCklzc3VlIGlzc3VlID0gaXNzdWUKCmRlZiBlcnJvcnMgPSBmYWxzZQpkZWYgd2FybmluZ3MgPSBmYWxzZQoKZGVmIHBsYW5uZWRUZWNocyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YudGVjaG5pY2lhbnMnXS50b1N0cmluZygpKVswXQpkZWYgYXV0b21hdGljYWxseUNsb3NlZCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuYXV0b21hdGljYWxseUNsb3NlZCddLnRvU3RyaW5nKCkpWzBdCmRlZiB0cmFuc2l0aW9uQ2hlY2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmNoZWNrQW5kQ29uZmlybSddLnRvU3RyaW5nKCkpWzBdCgpkZWYgZXJyb3JNYW5kYXRvcnlGaWVsZHMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIHdhcm5pbmdFbXB0eUZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKQogCi8vT1BBQV9URUNITklDSUFOUwppZigoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKT09bnVsbCB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpLnRvU3RyaW5nKCkuZXF1YWxzKCJObyIpKSAmJiAoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShwbGFubmVkVGVjaHMpPT1udWxsIHx8IChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShwbGFubmVkVGVjaHMpID09ICIiIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocGxhbm5lZFRlY2hzKS50b1N0cmluZygpLmVxdWFscygiIikpKXsKICAgIHdhcm5pbmdzID0gdHJ1ZQogICAgd2FybmluZ0VtcHR5RmllbGRzLmFkZChwcm9wZXJ0aWVzWydjZi50ZWNobmljaWFucyddLnRvU3RyaW5nKCkpCn0KCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghZXJyb3JzICYmICF3YXJuaW5ncyl7CiAgICByZXR1cm4gdHJ1ZQp9ZWxzZXsKICAgIGlmKCFlcnJvcnMgJiYgd2FybmluZ3MpewogICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpewogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAicmV0dXJuIHRydWUiCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICAgICAgaWYod2FybmluZ0VtcHR5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQoIlciKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJDT05GSVJNX0VNUFRZX0ZJRUxEUyIpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQobnVsbCkKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZCh3YXJuaW5nRW1wdHlGaWVsZHMpCgogICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5KQogICAgICAgICAgICB9CgogICAgICAgICAgICBvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IlciOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIlciLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKICAgICAgICB9CiAgICB9CiAgICBpZihlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgICAgICBkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAKICAgICAgICBpZihlcnJvck1hbmRhdG9yeUZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgZGVmIGVMaXN0TWFuZGF0b3J5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiRSIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiTUFOREFUT1JZX0ZJRUxEUyIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChudWxsKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoZXJyb3JNYW5kYXRvcnlGaWVsZHMpCiAgICAgICAgICAgIGVMaXN0LmFkZChlTGlzdE1hbmRhdG9yeSkKICAgICAgICB9CiAgICAgICAgCgkJb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKSAgIAogICAgfQogICAgaWYoZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICBkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICBkZWYgd0xpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAKICAgICAgICBpZihlcnJvck1hbmRhdG9yeUZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgZGVmIGVMaXN0TWFuZGF0b3J5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiRSIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiTUFOREFUT1JZX0ZJRUxEUyIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChudWxsKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoZXJyb3JNYW5kYXRvcnlGaWVsZHMpCiAgICAgICAgICAgIGVMaXN0LmFkZChlTGlzdE1hbmRhdG9yeSkKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYod2FybmluZ0VtcHR5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHkgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJXIikKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJDT05GSVJNX0VNUFRZX0ZJRUxEUyIpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZChudWxsKQogICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQod2FybmluZ0VtcHR5RmllbGRzKQoKICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5KQogICAgICAgIH0KICAgICAgICAKICAgICAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgICAgIG91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXRSIsIG91dHB1dC50b1N0cmluZygpKSAgCiAgICB9Cn0=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="5">
              <post-functions>
                <function type="class">
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="append.value"></arg>
                  <arg name="field.value">%%CURRENT_DATETIME%%</arg>
                  <arg name="field.name">customfield_22628</arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="field.type">8</arg>
                  <arg name="full.module.key">com.riadalabs.jira.plugins.insightinsight-post-function</arg>
                  <arg name="field.groovyScript"> import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.MutableIssue;
import com.atlassian.jira.event.type.EventDispatchOption;
import org.apache.log4j.Level

Properties relativePath = new Properties()
File relativePathFile = new File('/var/atlassian/application-data/jira/insightPathToScript.properties')
relativePathFile.withInputStream {
	relativePath.load(it)
}

Properties properties = new Properties()
File propertiesFile = new File('/var/atlassian/application-data/jira' + relativePath['pathToScripts'] + 'opproject.properties')
propertiesFile.withInputStream {
	properties.load(it)
}
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade&quot;); 
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
  
/* Get Insight Object Type Facade from plugin accessor */
Class objectTypeFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectTypeFacade&quot;); 
def objectTypeFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectTypeFacadeClass);
  
/* Get Insight Object Attribute Facade from plugin accessor */
Class objectTypeAttributeFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectTypeAttributeFacade&quot;); 
def objectTypeAttributeFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectTypeAttributeFacadeClass);
  
Class objectAttributeBeanFactoryClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(&quot;com.riadalabs.jira.plugins.insight.services.model.factory.ObjectAttributeBeanFactory&quot;); 
def objectAttributeBeanFactory = ComponentAccessor.getOSGiComponentInstanceOfType(objectAttributeBeanFactoryClass);

Issue issue = issue

def plannedTechsField = issue.getCustomFieldValue(ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName(properties['cf.technicians'].toString()))
def onSiteTechsField = ComponentAccessor.getCustomFieldManager().getCustomFieldObjectsByName(properties['cf.techniciansOnsite'].toString())[0];
def OnSiteTechObjects = new ArrayList();

def automaticallyClosedField = issue.getCustomFieldValue(ComponentAccessor.getCustomFieldManager().getCustomFieldObjectsByName(properties['cf.automaticallyClosed'].toString()))

def ONSITE_TECH_REPORT_OBJ_TYPE=properties['iobj.onSiteTechReport'].toString().toInteger()
def ONSITE_TECH_REPORT_ATTR_NAME=properties['iobj.onSiteTechReport.name.id'].toString().toInteger()
def ONSITE_TECH_REPORT_ATTR_TECHNICIAN_REF=properties['iobj.onSiteTechReport.technicianRef.id'].toString().toInteger()

if(automaticallyClosedField==null || automaticallyClosedField.toString().equals(&quot;No&quot;)){
    if(plannedTechsField){
        
        for(technician in plannedTechsField){
            
            //extract insight key ang get object
            def tech=technician.toString()
            def techKey = tech.substring(tech.indexOf('(')+1,tech.indexOf(')'))
            def techName = tech.substring(0,tech.indexOf('(')-1)
            def techObject = objectFacade.loadObjectBean(techKey)
            log.info (&quot;techName: &quot; + techName)
            log.info (&quot;techObject: &quot; + techObject)
            
            def objectTypeOnSiteTechReport = objectTypeFacade.loadObjectTypeBean(ONSITE_TECH_REPORT_OBJ_TYPE);
            def newObjectBean = objectTypeOnSiteTechReport.createMutableObjectBean();
            
            def objectAttributeBeans = new ArrayList();
            def nameObjectTypeAttributeBean = objectTypeAttributeFacade.loadObjectTypeAttributeBean(ONSITE_TECH_REPORT_ATTR_NAME); 
            
            objectAttributeBeans.add(objectAttributeBeanFactory.createObjectAttributeBeanForObject(newObjectBean, nameObjectTypeAttributeBean, techName));
                    
            newObjectBean.setObjectAttributeBeans(objectAttributeBeans);
            /* Store the object into Insight. The new ObjectBean will be updated with an unique ID */
            try {
                newObjectBean = objectFacade.storeObjectBean(newObjectBean);
                log.warn(&quot;newObjectBean: &quot; + newObjectBean);
            } catch (Exception vie) {
                log.warn(&quot;Could not create issue due to validation exception:&quot; + vie.getMessage());
            }
    
            /* Update TECHNICIAN_REF on the newObject */		        
            def objectTypeAttributeBean = objectTypeAttributeFacade.loadObjectTypeAttributeBean(ONSITE_TECH_REPORT_ATTR_TECHNICIAN_REF).createMutable() //The id of the attribute
            
            /* Create the new attribute bean based on the value */
            def newObjectAttributeBean = objectAttributeBeanFactory.createObjectAttributeBeanForObject(newObjectBean, objectTypeAttributeBean, techKey);
            /* Load the attribute bean */
            def objectAttributeBean = objectFacade.loadObjectAttributeBean(newObjectBean.getId(), techKey);
            if (objectAttributeBean != null) {
               /* If attribute exist reuse the old id for the new attribute */
               newObjectAttributeBean.setId(objectAttributeBean.getId());
            }
            /* Store the object attribute into Insight. */
            try {
                objectTypeAttributeBean = objectFacade.storeObjectAttributeBean(newObjectAttributeBean);
            } catch (Exception vie) {
                log.warn(&quot;Could not update object attribute due to validation exception:&quot; + vie.getMessage());
            }  
            
            OnSiteTechObjects.add(newObjectBean)
         }
    }
    log.info (&quot;OnSiteTechObjects: &quot; + OnSiteTechObjects)
    def currentUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()
    
    if (!OnSiteTechObjects.isEmpty()) {
        MutableIssue mi = (MutableIssue) issue;
        mi.setCustomFieldValue(onSiteTechsField, OnSiteTechObjects);
        ComponentAccessor.getIssueManager().updateIssue(currentUser, mi, EventDispatchOption.DO_NOT_DISPATCH, false);
    }   
}       </arg>
                  <arg name="field.filepath"></arg>
                  <arg name="class.name">com.riadalabs.jira.plugins.insight.services.jira.postfunction.InsightPostFunction</arg>
                  <arg name="field.description">OP: Create OnSite_Tech_Report objects to be associated to the issue's customfield OP_TECHNICIANS_ONSITE</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="121" name="Ripianifica Tkt">
          <meta name="opsbar-sequence">30</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="1">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="131" name="Intervento Eseguito" view="fieldscreen">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19909</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ05ldyBJbnN0YWxsYXRpb24nfHx8</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="null" status="null" step="6">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="5" name="In Progress">
      <meta name="jira.status.id">3</meta>
      <actions>
        <action id="141" name="Chiudi Rapporto di Intervento" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19910</meta>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">fa37467a9382f8924cd169d5ba599dcb71925405</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcyAtIHNvbG8gZXJyb3JzLCBubyB3YXJuaW5ncw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCklzc3VlIGlzc3VlID0gaXNzdWUKCmxvZy5kZWJ1ZyAiVHJhbnNhemlvbmUgQ29tcGxldGUgLSBQcmltbyB2YWxpZGF0b3IiCmxvZy5kZWJ1ZyAiVHJhbnNhemlvbmUgQ29tcGxldGUgLSBQcmltbyB2YWxpZGF0b3IgLSBJc3N1ZTogIiArIGlzc3VlCgpkZWYgZXJyb3JzID0gZmFsc2UKZGVmIHdhcm5pbmdzID0gZmFsc2UKCmRlZiBhdXRvbWF0aWNhbGx5Q2xvc2VkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5Q2xvc2VkJ10udG9TdHJpbmcoKSlbMF0KCmRlZiBhc3NldCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuYXNzZXQnXS50b1N0cmluZygpKVswXQpkZWYgYXNzZXRTdGF0dXNQcmUgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmFzc2V0U3RhdHVzUHJlJ10udG9TdHJpbmcoKSlbMF0KZGVmIGFzc2V0U3RhdHVzUG9zdCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuYXNzZXRTdGF0dXNQb3N0J10udG9TdHJpbmcoKSlbMF0KZGVmIHJpc2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnJpc2tPbnNpdGUnXS50b1N0cmluZygpKVswXQpkZWYgcmlza0Rlc2NyaXB0aW9uID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5yaXNrRGVzY3JpcHRpb24nXS50b1N0cmluZygpKVswXQpkZWYgY3VzdFNpZ25hdHVyZSA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuY3VzdG9tZXJTaWduYXR1cmUnXS50b1N0cmluZygpKVswXQpkZWYgY3VzdFJlZiA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuY3VzdENvbnRhY3RPbnNpdGUnXS50b1N0cmluZygpKVswXQpkZWYgdGVjaFNpZ25hdHVyZSA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YudGVjaG5pY2lhblNpZ25hdHVyZSddLnRvU3RyaW5nKCkpWzBdCmRlZiBrbXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmttcyddLnRvU3RyaW5nKCkpWzBdCmRlZiB0cmF2ZWxIID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi50cmF2ZWxIb3VycyddLnRvU3RyaW5nKCkpWzBdCmRlZiBleGVjdXRpb25EYXRlID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5leGVjdXRpb25EYXRlJ10udG9TdHJpbmcoKSlbMF0KZGVmIHRlY2hzT25zaXRlID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi50ZWNobmljaWFuc09uc2l0ZSddLnRvU3RyaW5nKCkpWzBdCgpkZWYgcmVwTWF0ZXJpYWxzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5yZXBsYWNlZE1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdCmRlZiByZXFNYXRlcmlhbHMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnJlcXVpcmVkTWF0ZXJpYWxzJ10udG9TdHJpbmcoKSlbMF0KCmRlZiB0cmFuc2l0aW9uQ2hlY2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmNoZWNrQW5kQ29uZmlybSddLnRvU3RyaW5nKCkpWzBdCgpkZWYgbHVtcFN1bVByaWNlID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5sdW1wU3VtUHJpY2UnXS50b1N0cmluZygpKVswXQoKZGVmIGVycm9yTWFuZGF0b3J5RmllbGRzID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlcnJvckpvYlN0YXJ0ZWRDb21wbGV0ZWRGaWVsZHMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIHdhcm5pbmdFbXB0eUZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKQoKLypPUC0xMDM4OiBFc2VndW8gbGEgdmVyaWZpY2EgZGVpIGNhbXBpIG9iYmxpZ2F0b3JpIHNvbG8gc2UgaWwgdGlja2V0IHN1IGN1aSBzdG8gZXNlZ3VlbmRvIGxhIHRyYW5zYXppb25lIG5vbiDDqCBzdGF0byBjaGl1c28gaW4gYXV0b21hdGljbyBkYWwgc2lzdGVtYSovCmxvZy5kZWJ1ZyAiaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKTogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNsb3NlZCkKbG9nLmRlYnVnICJjaGVjazogIiArICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKQppZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpPT1udWxsIHx8ICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CiAgICAvL09QQUFfTFVNUF9TVU1fUFJJQ0UKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVByaWNlKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVByaWNlKSA9PSAiIiB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1QcmljZSkudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICBlcnJvcnMgPSB0cnVlCiAgICAgICAgZXJyb3JNYW5kYXRvcnlGaWVsZHMuYWRkKHByb3BlcnRpZXNbJ2NmLmx1bXBTdW1QcmljZSddLnRvU3RyaW5nKCkpCiAgICB9CgogICAgLy9PUEFBX1JFUExBQ0VEX01BVEVSSUFMUwogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpPT1udWxsIHx8IChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpID09ICIiIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIGxvZy5kZWJ1ZyAid2FybmluZ3MgdHJ1ZSIKICAgICAgICB3YXJuaW5ncyA9IHRydWUKICAgICAgICB3YXJuaW5nRW1wdHlGaWVsZHMuYWRkKHByb3BlcnRpZXNbJ2NmLnJlcGxhY2VkTWF0ZXJpYWxzJ10udG9TdHJpbmcoKSkKICAgIH0KICAgIC8vT1BBQV9SRVFVSVJFRF9NQVRFUklBTFMKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVxTWF0ZXJpYWxzKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVxTWF0ZXJpYWxzKSA9PSAiIiB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcU1hdGVyaWFscykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICBsb2cuZGVidWcgIndhcm5pbmdzIHRydWUiCiAgICAgICAgd2FybmluZ3MgPSB0cnVlCiAgICAgICAgd2FybmluZ0VtcHR5RmllbGRzLmFkZChwcm9wZXJ0aWVzWydjZi5yZXF1aXJlZE1hdGVyaWFscyddLnRvU3RyaW5nKCkpCiAgICB9CgoKICAgIC8vT1BBQV9BU1NFVAogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhc3NldCk9PW51bGwgfHwgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGFzc2V0KSA9PSAiIiB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGFzc2V0KS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIGVycm9ycyA9IHRydWUKICAgICAgICBlcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQocHJvcGVydGllc1snY2YuYXNzZXQnXS50b1N0cmluZygpKQogICAgfQogICAgLy9PUEFBX0FTU0VUX1NUQVRVU19QUkUKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXNzZXRTdGF0dXNQcmUpPT1udWxsIHx8IChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhc3NldFN0YXR1c1ByZSkgPT0gIiIgfHwgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhc3NldFN0YXR1c1ByZSkudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICBlcnJvcnMgPSB0cnVlCiAgICAgICAgZXJyb3JNYW5kYXRvcnlGaWVsZHMuYWRkKHByb3BlcnRpZXNbJ2NmLmFzc2V0U3RhdHVzUHJlJ10udG9TdHJpbmcoKSkKICAgIH0KICAgIC8vT1BBQV9BU1NFVF9TVEFUVVNfUE9TVAogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhc3NldFN0YXR1c1Bvc3QpPT1udWxsIHx8IChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhc3NldFN0YXR1c1Bvc3QpID09ICIiIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXNzZXRTdGF0dXNQb3N0KS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIGVycm9ycyA9IHRydWUKICAgICAgICBlcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQocHJvcGVydGllc1snY2YuYXNzZXRTdGF0dXNQb3N0J10udG9TdHJpbmcoKSkKICAgIH0KICAgIC8vT1BBQV9SSVNLX09OU0lURQogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyaXNrKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmlzaykgPT0gIiIgfHwgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyaXNrKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIGVycm9ycyA9IHRydWUKICAgICAgICBlcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQocHJvcGVydGllc1snY2Yucmlza09uc2l0ZSddLnRvU3RyaW5nKCkpCiAgICB9CiAgICAvL09QQUFfUklTS19ERVNDUklQVElPTgogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyaXNrKS50b1N0cmluZygpLmVxdWFscygiWWVzIikgJiYgKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmlza0Rlc2NyaXB0aW9uKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmlza0Rlc2NyaXB0aW9uKSA9PSAiIiB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJpc2tEZXNjcmlwdGlvbikudG9TdHJpbmcoKS5lcXVhbHMoIiIpKSl7CiAgICAgICAgZXJyb3JzID0gdHJ1ZQogICAgICAgIGVycm9yTWFuZGF0b3J5RmllbGRzLmFkZChwcm9wZXJ0aWVzWydjZi5yaXNrRGVzY3JpcHRpb24nXS50b1N0cmluZygpKQogICAgfQogICAgLy9PUEFBX0NVU1RPTUVSX1NJR05BVFVSRQogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShjdXN0U2lnbmF0dXJlKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoY3VzdFNpZ25hdHVyZSkgPT0gIiIgfHwgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShjdXN0U2lnbmF0dXJlKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIGVycm9ycyA9IHRydWUKICAgICAgICBlcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQocHJvcGVydGllc1snY2YuY3VzdG9tZXJTaWduYXR1cmUnXS50b1N0cmluZygpKQogICAgfQogICAgLy9PUEFBX0NVU1RPTUVSX0NPTlRBQ1RfT05TSVRFCiAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGN1c3RSZWYpPT1udWxsIHx8IChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShjdXN0UmVmKSA9PSAiIiB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGN1c3RSZWYpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgZXJyb3JzID0gdHJ1ZQogICAgICAgIGVycm9yTWFuZGF0b3J5RmllbGRzLmFkZChwcm9wZXJ0aWVzWydjZi5jdXN0Q29udGFjdE9uc2l0ZSddLnRvU3RyaW5nKCkpCiAgICB9CiAgICAvL09QQUFfVEVDSE5JQ0lBTl9TSUdOQVRVUkUKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodGVjaFNpZ25hdHVyZSk9PW51bGwgfHwgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRlY2hTaWduYXR1cmUpID09ICIiIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodGVjaFNpZ25hdHVyZSkudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICBlcnJvcnMgPSB0cnVlCiAgICAgICAgZXJyb3JNYW5kYXRvcnlGaWVsZHMuYWRkKHByb3BlcnRpZXNbJ2NmLnRlY2huaWNpYW5TaWduYXR1cmUnXS50b1N0cmluZygpKQogICAgfQogICAgLy8xNS4xMi4yMDIwIEFGIC0gdG9sdGEgb2JibGlnYXRvcmlldMOgIHN1aSBjYW1waSBPUF9LTVMgZSBPUF9UUkFWRUxfSE9VUlMgcG9pY2jDqCBvcmEgbGEgcmljaGllc3RhIHV0ZW50aSDDqCBkaSBpbXBsZW1lbnRhcmU6CiAgICAvL0NpbnppYSBTYWxpdHVybzogZG92cmViYmVybyBlc3NlcmUgb2JibGlnYXRvcmkgbGFkZG92ZSBkYSBjb250cmF0dG8gaWwgZm9ybml0b3JlIG5vbiBoYSBpbCBkaXJpdHRvIGZpc3NvIGRpIGNoaWFtYXRhCiAgICAvL09QQUFfS01TCiAgICAvKmlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoa21zKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoa21zKSA9PSAiIiB8fCBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGttcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICBlcnJvcnMgPSB0cnVlCiAgICAgICAgZXJyb3JNYW5kYXRvcnlGaWVsZHMuYWRkKHByb3BlcnRpZXNbJ2NmLmttcyddLnRvU3RyaW5nKCkpCiAgICB9Ki8KICAgIC8vT1BBQV9UUkFWRUxfSE9VUlMKICAgIC8qaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxIKT09bnVsbCB8fCAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsSCkgPT0gIiIgfHwgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxIKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIGVycm9ycyA9IHRydWUKICAgICAgICBlcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQocHJvcGVydGllc1snY2YudHJhdmVsSG91cnMnXS50b1N0cmluZygpKQogICAgfSovCiAgICAvL09QQUFfRVhFQ1VUSU9OX0RBVEUKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoZXhlY3V0aW9uRGF0ZSk9PW51bGwgfHwgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGV4ZWN1dGlvbkRhdGUpID09ICIiIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoZXhlY3V0aW9uRGF0ZSkudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICBlcnJvcnMgPSB0cnVlCiAgICAgICAgZXJyb3JNYW5kYXRvcnlGaWVsZHMuYWRkKHByb3BlcnRpZXNbJ2NmLmV4ZWN1dGlvbkRhdGUnXS50b1N0cmluZygpKQogICAgfQoKICAgIC8vSm9iIFN0YXJ0ZWQgKyBKb2IgQ29tcGxldGVkIGRpIG9nbmkgb2dnZXR0byBUZWNoX09uU2l0ZV9SZXBvcnQgYXNzb2NpYXRvIGFsIGNhbXBvIE9QQUFfVEVDSFNfT05TSVRFCiAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRlY2hzT25zaXRlKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodGVjaHNPbnNpdGUpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRlY2hzT25zaXRlKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgIENsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCiAgICAgICAgZGVmIHRlY2hzT25zaXRlRmllbGQgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRlY2hzT25zaXRlKQoJCWxvZy5kZWJ1ZyAidGVjaHNPbnNpdGVGaWVsZDogIiArIHRlY2hzT25zaXRlRmllbGQKICAgICAgICBmb3IodGVjaG5pY2lhbiBpbiB0ZWNoc09uc2l0ZUZpZWxkKXsKICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgICAgIGRlZiB0ZWNoT25zaXRlPXRlY2huaWNpYW4udG9TdHJpbmcoKQogICAgICAgICAgICBkZWYgdGVjaE9uc2l0ZUtleSA9IHRlY2hPbnNpdGUuc3Vic3RyaW5nKHRlY2hPbnNpdGUuaW5kZXhPZignKCcpKzEsdGVjaE9uc2l0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIGRlZiB0ZWNoT25zaXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHRlY2hPbnNpdGVLZXkpCiAgICAgICAgICAgIC8vZ2V0ICJKb2IgU3RhcnRlZCIgZm9yIHRoYXQgVGVjaG5pY2lhbgogICAgICAgICAgICBkZWYgb2JUcmlhZ2UKICAgICAgICAgICAgZGVmIHRlY2hKb2JTdGFydGVkCiAgICAgICAgICAgIGRlZiB0ZWNoSm9iQ29tcGxldGVkCiAgICAgICAgICAgIGRlZiB0ZWNoUmVmLCB0ZWNoLCB0ZWNoUmVmS2V5LCB0ZWNoUmVmT2JqZWN0LCB0ZWNoUmVmTmFtZQogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odGVjaE9uc2l0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnRlY2hPblNpdGUuam9iU3RhcnRlZCddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRlY2hPbnNpdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai50ZWNoT25TaXRlLmpvYlN0YXJ0ZWQnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKICAgICAgICAgICAgICAgIHRlY2hKb2JTdGFydGVkID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nLmRlYnVnIHRlY2hKb2JTdGFydGVkIAogICAgICAgICAgICAvL2dldCAiSm9iIENvbXBsZXRlZCIgZm9yIHRoYXQgVGVjaG5pY2lhbgogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odGVjaE9uc2l0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnRlY2hPblNpdGUuam9iQ29tcGxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odGVjaE9uc2l0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnRlY2hPblNpdGUuam9iQ29tcGxldGVkJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpCiAgICAgICAgICAgICAgICB0ZWNoSm9iQ29tcGxldGVkID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nLmRlYnVnIHRlY2hKb2JDb21wbGV0ZWQKICAgICAgICAgICAgLy9nZXQgIlRlY2huaWNpYW5fUkVGIiBmb3IgdGhhdCBUZWNobmljaWFuCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAidGVjaE9uc2l0ZU9iamVjdDogIiArIHRlY2hPbnNpdGVPYmplY3QKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0ZWNoT25zaXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoudGVjaE9uc2l0ZS50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0ZWNoT25zaXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoudGVjaE9uc2l0ZS50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpCiAgICAgICAgICAgICAgICB0ZWNoUmVmID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIHRlY2ggPSB0ZWNoUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAidGVjaDogIiArIHRlY2gKICAgICAgICAgICAgICAgIHRlY2hSZWZLZXkgPSB0ZWNoLnN1YnN0cmluZyh0ZWNoLmluZGV4T2YoJygnKSsxLHRlY2guaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJ0ZWNoUmVmS2V5OiAiICsgdGVjaFJlZktleQogICAgICAgICAgICAgICAgdGVjaFJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihwcm9wZXJ0aWVzWydpc2NoZW1hLmFhJ10udG9TdHJpbmcoKSArICItIiArIHRlY2hSZWZLZXkpCiAgICAgICAgICAgICAgICB0ZWNoUmVmTmFtZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0ZWNoUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoudGVjaG5pY2lhbi5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgIAkJbG9nLmRlYnVnIHRlY2hSZWZOYW1lCgogICAgICAgICAgICBpZighdGVjaEpvYlN0YXJ0ZWQgfHwgIXRlY2hKb2JDb21wbGV0ZWQpewogICAgICAgICAgICAgICAgZXJyb3JzID0gdHJ1ZQogICAgICAgICAgICAgICAgZXJyb3JKb2JTdGFydGVkQ29tcGxldGVkRmllbGRzLmFkZCh0ZWNoUmVmTmFtZS5zdWJzdHJpbmcodGVjaFJlZk5hbWUuaW5kZXhPZignKCcpKzEsdGVjaFJlZk5hbWUuaW5kZXhPZignKScpKSkKICAgICAgICAgICAgfSAgICAKICAgICAgICAgfSAgICAKICAgIH0KCiAgICBkZWYgb3V0cHV0ID0gbmV3IEFycmF5TGlzdCgpCgogICAgaWYgKCFlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfWVsc2V7CiAgICAgICAgaWYoIWVycm9ycyAmJiB3YXJuaW5ncyl7CiAgICAgICAgICAgIC8vU2UgY2kgc29ubyBzb2xvIHdhcm5pbmdzIHZlcmlmaWNvIHNlIGwndXRlbnRlIGhhIGdpw6AgZGljaGlhcmF0byBkaSB2b2xlciBwcm9zZWd1aXJlIGNvbXVucXVlCiAgICAgICAgICAgIC8vIC0gdHJhbnNpdGlvbiBmaWVsZCAiT1BBQV9DSEVDS19BTkRfQ09ORklSTSI9IlllcyIKICAgICAgICAgICAgLy8gLSBpbiBjYXNvIGNvbnRyYXJpbyBpbnZpbyBpIHdhcm5pbmcgYSBGRQoKICAgICAgICAgICAgLy9sb2cuZGVidWcgInRyYW5zaXRpb25DaGVjazogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKQogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAicmVzdWx0OiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKQogICAgICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykudG9TdHJpbmcoKS5lcXVhbHMoIlllcyIpKXsKICAgICAgICAgICAgICAgIC8vbG9nLmRlYnVnICJyZXR1cm4gdHJ1ZSIKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgogICAgICAgICAgICAgICAgaWYod2FybmluZ0VtcHR5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZCgiVyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJDT05GSVJNX0VNUFRZX0ZJRUxEUyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKG51bGwpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKHdhcm5pbmdFbXB0eUZpZWxkcykKCiAgICAgICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5KQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgICAgICAgICBsb2cuZGVidWcgInRocm93IGV4Y2VwdGlvbjogIiArIG91dHB1dC50b1N0cmluZygpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IlciOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgICAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAgCiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIGlmKGVycm9ycyAmJiAhd2FybmluZ3MpewogICAgICAgICAgICBkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKCiAgICAgICAgICAgIGlmKGVycm9yTWFuZGF0b3J5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgZGVmIGVMaXN0TWFuZGF0b3J5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoIkUiKQogICAgICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKCJNQU5EQVRPUllfRklFTERTIikKICAgICAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChudWxsKQogICAgICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKGVycm9yTWFuZGF0b3J5RmllbGRzKQogICAgICAgICAgICAgICAgZUxpc3QuYWRkKGVMaXN0TWFuZGF0b3J5KQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihlcnJvckpvYlN0YXJ0ZWRDb21wbGV0ZWRGaWVsZHMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBkZWYgZUxpc3RTdGFydEVuZCA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgZUxpc3RTdGFydEVuZC5hZGQoIkUiKQogICAgICAgICAgICAgICAgZUxpc3RTdGFydEVuZC5hZGQoIk1JU1NJTkdfT05TSVRFX1NUQVJUX0VORF9ERVRBSUxTIikKICAgICAgICAgICAgICAgIGVMaXN0U3RhcnRFbmQuYWRkKG51bGwpCiAgICAgICAgICAgICAgICBlTGlzdFN0YXJ0RW5kLmFkZChlcnJvckpvYlN0YXJ0ZWRDb21wbGV0ZWRGaWVsZHMpCiAgICAgICAgICAgICAgICBlTGlzdC5hZGQoZUxpc3RTdGFydEVuZCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICAgICAgbG9nLmRlYnVnICJ0aHJvdyBleGNlcHRpb246ICIgKyBvdXRwdXQudG9TdHJpbmcoKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKICAgICAgICB9CiAgICAgICAgaWYoZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICAgICAgZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIGRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICBpZihlcnJvck1hbmRhdG9yeUZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIGRlZiBlTGlzdE1hbmRhdG9yeSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKCJFIikKICAgICAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiTUFOREFUT1JZX0ZJRUxEUyIpCiAgICAgICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQobnVsbCkKICAgICAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChlcnJvck1hbmRhdG9yeUZpZWxkcykKICAgICAgICAgICAgICAgIGVMaXN0LmFkZChlTGlzdE1hbmRhdG9yeSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoZXJyb3JKb2JTdGFydGVkQ29tcGxldGVkRmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgZGVmIGVMaXN0U3RhcnRFbmQgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgICAgIGVMaXN0U3RhcnRFbmQuYWRkKCJFIikKICAgICAgICAgICAgICAgIGVMaXN0U3RhcnRFbmQuYWRkKCJNSVNTSU5HX09OU0lURV9TVEFSVF9FTkRfREVUQUlMUyIpCiAgICAgICAgICAgICAgICBlTGlzdFN0YXJ0RW5kLmFkZChudWxsKQogICAgICAgICAgICAgICAgZUxpc3RTdGFydEVuZC5hZGQoZXJyb3JKb2JTdGFydGVkQ29tcGxldGVkRmllbGRzKQogICAgICAgICAgICAgICAgZUxpc3QuYWRkKGVMaXN0U3RhcnRFbmQpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKHdhcm5pbmdFbXB0eUZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJXIikKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZCgiQ09ORklSTV9FTVBUWV9GSUVMRFMiKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKG51bGwpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQod2FybmluZ0VtcHR5RmllbGRzKQoKICAgICAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICAgICAgb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICAgICAgbG9nLmRlYnVnICJ0aHJvdyBleGNlcHRpb246ICIgKyBvdXRwdXQudG9TdHJpbmcoKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IldFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgICAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXRSIsIG91dHB1dC50b1N0cmluZygpKSAgCiAgICAgICAgfQogICAgfQp9Cg==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">9fe0fa5191d4b6a91ba7485380ff8d0a9fda8fe7</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IFJFU1QgQVBJOiBPUCBnZW5lcmF6aW9uZSBSYXBwb3J0byBkaSBpbnRlcnZlbnRv</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCklzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKQ3VzdG9tRmllbGRNYW5hZ2VyIGN1c3RvbUZpZWxkTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpOwpkZWYgcmVxdWVzdE1ldGhvZApkZWYgYmFzZVVSTApsb2cuZGVidWcgIk9uU2l0ZSBSZXBvcnQgcGVyIGlzc3VlOiAiICsgaXNzdWUua2V5Ci8qIFJFU1QgQVBJIHBlciBHZW5lcmF6aW9uZSBBbGxlZ2F0byBSYXBwb3J0byBkaSBJbnRlcnZlbnRvICovCnJlcXVlc3RNZXRob2QgPSAiUFVUIjsKCmJhc2VVUkwgPSAiaHR0cDovLyIgKyBwcm9wZXJ0aWVzWydhcGkuZW52J10udG9TdHJpbmcoKSArICIvb3AvcmVzdC9hdXRvbWF0aW9uL0FBL3RpY2tldC8iICsgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiL2F0dGFjaG1lbnQvb25zaXRlIgpsb2cuZGVidWcgImJhc2VVcmw6ICIgKyBiYXNlVVJMCgpVUkwgdXJsCnVybCA9IG5ldyBVUkwoYmFzZVVSTCkKSHR0cFVSTENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IChIdHRwVVJMQ29ubmVjdGlvbil1cmwub3BlbkNvbm5lY3Rpb24oKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb24iKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkFjY2VwdCIsICIqLyoiKTsKY29ubmVjdGlvbi5zZXREb091dHB1dCh0cnVlKTsKY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwpjb25uZWN0aW9uLmNvbm5lY3QoKTsKbG9nLmRlYnVnICJSZXNwb25zZUNvZGU6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkKbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdEVycm9ycyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgIGxvZy5kZWJ1ZyAidXJsOiAiICsgdXJsCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQogICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKICAgIGVMaXN0RXJyb3JzLmFkZCgiRSIpCiAgICBlTGlzdEVycm9ycy5hZGQoIkdFTkVSQVRFLU9OU0lURVJFUE9SVCIpCiAgICBlcnJvck1zZ3MuYWRkKGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkgKyAiICIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpKQogICAgZUxpc3RFcnJvcnMuYWRkKGVycm9yTXNncykKICAgIGVMaXN0LmFkZChlTGlzdEVycm9ycykKCiAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKQp9Cg==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">df15a75e93b4c124a70f49e69dbcae9d48e2e8e4</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IFJFU1QgQVBJOiBPUCBwZXIgY29uc3VudGl2YXppb25lIHRpY2tldA==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKCklzc3VlSW5kZXhpbmdTZXJ2aWNlIAlpc3N1ZUluZGV4aW5nU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChJc3N1ZUluZGV4aW5nU2VydmljZSkKZGVmIGF1dG9tYXRpY2FsbHlDbG9zZWQgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlDbG9zZWQnXS50b1N0cmluZygpKVswXQoKZGVmIHJlcXVlc3RNZXRob2QKZGVmIGJhc2VVUkwKCmludCBPUEFBID0gcHJvcGVydGllc1snaXNjaGVtYS5hYS5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKaW50IERCTyA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuZGJvLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQpib29sZWFuIHVuYXRhbnR1bT10cnVlCgovKk9QLTEwMzg6IGxhIGNvbnRhYmlsaXp6YXppb25lIGRvdnLDoCBwcmV2ZWRlcmUgbGUgdW5hdGFudHVtIHJhdGVzIHNvbG8gc2UgaWwgdGlja2V0IG5vbiDDqCBzdGF0byBjaGl1c28gaW4gYXV0b21hdGljbyovCmlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNsb3NlZCkhPW51bGwgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpewoJdW5hdGFudHVtPWZhbHNlICAgIAp9CmxvZy5kZWJ1ZyAiQ29uc3VudGl2YXppb25lIHRpY2tldCAiICsgaXNzdWUua2V5ICsgIiBjb24gdW5hdGFudHVtOiAiICsgdW5hdGFudHVtCgovKiBSRVNUIEFQSSBwZXIgQ29udGFiaWxpenphemlvbmUgSW50ZXJ2ZW50byAqLwpyZXF1ZXN0TWV0aG9kID0gIkdFVCI7CgpiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1snYXBpLmVudiddLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvQUEvdGlja2V0L2lzc3VlS2V5LyIgKyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIvY2xvc2U/dW09Iit1bmF0YW50dW0udG9TdHJpbmcoKQpsb2cuZGVidWcgImJhc2VVcmw6ICIgKyBiYXNlVVJMCgovKkRlZmluaXJlIHBhcmFtZXRybyBkaSBpbnB1dCB1bmF0YW50dW09dHJ1ZXxmYWxzZSBpbiBiYXNlIGFsIHZhbG9yZSBkZWxsYSB2YXJpYWJpbGUgYm9vbGVhbmEgdW5hdGFudHVtKi8KVVJMIHVybCA9IG5ldyBVUkwoYmFzZVVSTCkKSHR0cFVSTENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IChIdHRwVVJMQ29ubmVjdGlvbil1cmwub3BlbkNvbm5lY3Rpb24oKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb24iKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkFjY2VwdCIsICIqLyoiKTsKY29ubmVjdGlvbi5zZXREb091dHB1dCh0cnVlKTsKY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwpjb25uZWN0aW9uLmNvbm5lY3QoKTsKbG9nLmRlYnVnICJSZXNwb25zZUNvZGU6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkKbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKCi8vSXNzdWVJbmRleGluZ1NlcnZpY2UgaXNzdWVJbmRleGluZ1NlcnZpY2UgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDb21wb25lbnQoSXNzdWVJbmRleGluZ1NlcnZpY2UpCi8vaXNzdWVJbmRleGluZ1NlcnZpY2UucmVJbmRleChpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVPYmplY3QoaXNzdWUua2V5LnRvU3RyaW5nKCkpKQoKLy9kZWYgdW5hVGFudHVtUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKCJPUEFBX1VOQVRBTlRVTV9SQVRFUyIpWzBdCi8vbG9nLndhcm4gInVuYVRhbnR1bVJhdGVzOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykKCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdEVycm9ycyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgIGxvZy5kZWJ1ZyAidXJsOiAiICsgdXJsCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQogICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2U6ICIgKyBjb25uZWN0aW9uCgogICAgLypST0xMQkFDSyovCiAgICAvKlJpbW96aW9uZSBhbGxlZ2F0byByYXBwb3J0byBkaSBpbnRlcnZlbnRvIGFwcGVuYSBjcmVhdG8qLwogICAgLyogR2V0IEluc2lnaHQgSVFMIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwogICAgQ2xhc3MgaXFsRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5JUUxGYWNhZGUiKTsgCiAgICBkZWYgaXFsRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKGlxbEZhY2FkZUNsYXNzKTsKCiAgICAvKiBHZXQgSW5zaWdodCBPYmplY3QgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCiAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOwogICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgLyogR2V0IEluc2lnaHQgT2JqZWN0IFR5cGUgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCiAgICBDbGFzcyBvYmplY3RUeXBlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlRmFjYWRlQ2xhc3MpOwoKICAgIC8qIEdldCBJbnNpZ2h0IE9iamVjdCBBdHRyaWJ1dGUgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCiAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwoKICAgIENsYXNzIG9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Q2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LnNlcnZpY2VzLm1vZGVsLmZhY3RvcnkuT2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnkiKTsKICAgIGRlZiBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzKTsKCiAgICAvKiBTcGVjaWZ5IHRoZSBzY2hlbWEgaWQgYXMgd2VsbCBhcyB0aGUgSVFMIHRoYXQgd2lsbCBmZXRjaCBvYmplY3RzLiBJbiB0aGlzIGNhc2UgYWxsIG9iamVjdHMgd2l0aCBOYW1lIG1hdGNoaW5nIHRoZSB2YWx1ZUNGLCBiZSBzdXJlIHRvIGluY2x1ZGUgIiBhcm91bmQgdmFsdWUgKi8KICAgIGRlZiBvYmplY3RzID0gaXFsRmFjYWRlLmZpbmRPYmplY3RzQnlJUUxBbmRTY2hlbWEoREJPLCAiXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuY2F0ZWdvcnlSZWYnXS50b1N0cmluZygpICsgIlwiLlwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm5hbWUnXS50b1N0cmluZygpICsgIlwiID0gXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5yYXBwSW50RkFBQyddLnRvU3RyaW5nKCkgKyAiXCIgQU5EICIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5kZWxldGVkJ10udG9TdHJpbmcoKSArICIhPXRydWUgQU5EIG9iamVjdCBIQVZJTkcgY29ubmVjdGVkVGlja2V0cyhrZXkgPSAiICsgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiKSIpOyAvLyBTZWUgdGhlIGNvbXBsZXRlIGxpc3Qgb2YgcG9zc2libGUgSVFMIG9uIHRoZSBJbnNpZ2h0IFF1ZXJ5IExhbmd1YWdlIGRvY3VtZW50YXRpb24gcGFnZQogICAgLyogSWYgdGhpcyBpcyBhIG1hbmRhdG9yeSBmaWVsZCB5b3Ugc2hvdWxkIGJlIGFibGUgdG8gZG8gdGhpczogKi8KICAgIGxvZy5pbmZvKCJJbnNpZ2h0IG9iamVjdDogIiArIG9iamVjdHNbMF0pOwoKICAgIGlmKG9iamVjdHNbMF0pewogICAgICAgIC8qIFVQREFURSBPSkJFQ1QgREVMRVRFRCBWQUxVRSAqLwogICAgICAgIGRlZiBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihvYmplY3RzWzBdLmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmRlbGV0ZWQnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkgIAogICAgICAgIGRlZiB2YWx1ZSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoKICAgICAgICBkZWYgdmFsdWVCZWFuID0gb2JUcmlhZ2UuY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCkKICAgICAgICB2YWx1ZUJlYW4uc2V0VmFsdWUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4ob2JUcmlhZ2UuZ2V0T2JqZWN0VHlwZUF0dHJpYnV0ZUlkKCkpLCB0cnVlKQogICAgICAgIC8qQ2xlYW4gYWN0dWFsIHZhbHVlKi8KICAgICAgICB2YWx1ZS5jbGVhcigpCiAgICAgICAgdmFsdWUuYWRkKHZhbHVlQmVhbik7CiAgICAgICAgb2JUcmlhZ2Uuc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZSkKCiAgICAgICAgLy9VcGRhdGUgT0pCRUNUIGF0dHJpYnV0ZSB2YWx1ZQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLnN0b3JlT2JqZWN0QXR0cmlidXRlQmVhbihvYlRyaWFnZSk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIHZpZSkgewogICAgICAgICAgICBsb2cud2FybigiQ291bGQgbm90IHVwZGF0ZSBvYmplY3QgYXR0cmlidXRlIGR1ZSB0byB2YWxpZGF0aW9uIGV4Y2VwdGlvbjoiICsgdmllLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIGVMaXN0RXJyb3JzLmFkZCgiRSIpCiAgICBlTGlzdEVycm9ycy5hZGQoIk9QLVRLVC1BQ0NPVU5USU5HIikKICAgIGVycm9yTXNncy5hZGQoY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKSArICIgIiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkpCiAgICBlTGlzdEVycm9ycy5hZGQoZXJyb3JNc2dzKQogICAgZUxpc3QuYWRkKGVMaXN0RXJyb3JzKQoKICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpCn1lbHNlewogICAgLypPUC0xMDM4OiBjb25zdW50aXZhemlvbmUgdGVybWluYXRhIGNvcnJldHRhbWVudGUgLSBzZSDDqCBzdGF0YSBlc2VndWl0YSBjb24gdW5hdGFudHVtPXRydWUgc2V0dG8gYSBObyBpbCBjYW1wbyBPUEFBX0FVVE9NQVRJQ0FMTFlfQ0xPU0VEKi8KICAgIGlmKHVuYXRhbnR1bSl7CiAgICAgICAgZGVmIGN1cnJlbnRVc2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCiAgICAgICAgZGVmIG1pID0gKE11dGFibGVJc3N1ZSkgaXNzdWUKCiAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhpc3N1ZSkKICAgICAgICBsb2cuZGVidWcgImZpZWxkQ29uZmlnOiAiICsgZmllbGRDb25maWcKICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiTm8iIH0KICAgICAgICBhdXRvbWF0aWNhbGx5Q2xvc2VkLnVwZGF0ZVZhbHVlKG51bGwsIGlzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICAgICAgaXNzdWVJbmRleGluZ1NlcnZpY2UucmVJbmRleChpc3N1ZSkKICAgICAgICBsb2cuZGVidWcgIlVwZGF0ZWQgY3VzdG9tZmllbGQgLSBpc3N1ZSBwcmluY2lwYWxlICR7aXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKX0iCiAgICB9Cn0K</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">37c2d78492ac54794b8917d58342d465c219be98</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IFJFU1QgQVBJOiBPUCBFbWFpbCBOb3RpZmljYXRpb246IE9OU0lURV9SRVBPUlQgLSBvbmx5IElGIE9QQUFfQVVUT01BVElDQUxMWV9DTE9TRUQhPVllcyBBTkQgc2VuZE1haWwhPU5PIE1BSUwgQU5EIGNpIHNvbm8gdGlja2V0IGNvbGxlZ2F0aS4gLS0tLT4gRElTQUJMRUQgc3UgdHJhbnNhemlvbmUgY29tcGxldGUgLSB2aWVuZSBmYXR0byBtYW51YWxtZW50ZSBkYSBTRU5EIE9OU0lURSBSRVBPUlQ=</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk1vZGlmaWVkVmFsdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS51dGlsLkRlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiBhdXRvbWF0aWNhbGx5Q2xvc2VkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5Q2xvc2VkJ10udG9TdHJpbmcoKSlbMF0KZGVmIHNlbmRNYWlsVG8gPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnNlbmRNYWlsVG8nXS50b1N0cmluZygpKVswXQpkZWYgc2VuZE1haWxUb1JlYyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yuc2VuZE1haWxUb1JlY2lwaWVudHMnXS50b1N0cmluZygpKVswXQpkZWYgb25zaXRlUmVwb3J0RGF0ZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi53Zk9uc2l0ZVJlcG9ydCddLnRvU3RyaW5nKCkpWzBdCgpkZWYgcmVxdWVzdE1ldGhvZApkZWYgYmFzZVVSTAoKaW50IE9QQUEgPSBwcm9wZXJ0aWVzWydpc2NoZW1hLmFhLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQppbnQgREJPID0gcHJvcGVydGllc1snaXNjaGVtYS5kYm8uaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiByZWxhdGVzSW5Jc3N1ZUxpbms9ZmFsc2UKZGVmIHJlbGF0ZXNPdXRJc3N1ZUxpbms9ZmFsc2UKZGVmIGxpbmtlZFRpY2tldHM9bmV3IEFycmF5TGlzdCgpCmRlZiBib2R5X3JlcQpkZWYgc2VuZG1haWw9dHJ1ZQoKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKT09bnVsbCB8fCAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpewoKICAgIC8qT1AtMTAzODogdmVyaWZpY2EgdGlja2V0IGNvbGxlZ2F0aSovCiAgICBMaXN0PElzc3VlTGluaz4gYWxsSW5Jc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0SW53YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKICAgIGZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgICAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIHJlbGF0ZXNJbklzc3VlTGluaz10cnVlCiAgICAgICAgICAgIGxpbmtlZFRpY2tldHMuYWRkKGlzc3VlTGluay5nZXRTb3VyY2VPYmplY3QoKS50b1N0cmluZygpKQogICAgICAgICAgICBsb2cuZGVidWcgIklzc3VlIGNvbiByZWxhdGVzSW5Jc3N1ZUxpbmsiCiAgICAgICAgfQogICAgfQogICAgTGlzdDxJc3N1ZUxpbms+IGFsbE91dElzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRPdXR3YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKICAgIGZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICAgICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICAgICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICByZWxhdGVzT3V0SXNzdWVMaW5rPXRydWUKICAgICAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkudG9TdHJpbmcoKSkKICAgICAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc091dElzc3VlTGluayIKICAgICAgICB9CiAgICB9CiAgICAKICAgIGxvZy5kZWJ1ZyAiaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShzZW5kTWFpbFRvKS50b1N0cmluZygpOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShzZW5kTWFpbFRvKS50b1N0cmluZygpCiAgICBpZigocmVsYXRlc0luSXNzdWVMaW5rIHx8IHJlbGF0ZXNPdXRJc3N1ZUxpbmspICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2NmLm9wdGlvbi5zZW5kTWFpbFRvLm5vRW1haWwnXS50b1N0cmluZygpKSAmJiBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2NmLm9wdGlvbi5zZW5kTWFpbFRvLmN1cnJlbnRSZXBvcnQnXS50b1N0cmluZygpKSl7CiAgICAgICAgLy9PUC0xMDM4OiBpbnZpYXJlIHNvbG8gbGEgbWFpbCBjb24gaWwgcmFwcG9ydG8gZGkgaW50ZXJ2ZW50byBkZWwgdGlja2V0IGNvcnJlbnRlCiAgICAgICAgYm9keV9yZXEgPSBbCiAgICAgICAgICAgICJ0ZW1wbGF0ZU5hbWUiOiBwcm9wZXJ0aWVzWyd0dC5vblNpdGVSZXBvcnQnXS50b1N0cmluZygpLAogICAgICAgICAgICAicGVjIjogZmFsc2UsCiAgICAgICAgICAgICJpc3N1ZUtleSI6IGlzc3VlLmtleSwKICAgICAgICAgICAgImFkZGl0aW9uYWxSZWNpcGllbnRzIjogaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShzZW5kTWFpbFRvUmVjKS50b1N0cmluZygpCiAgICAgICAgXQogICAgICAgIC8qMzEuMDcuMjAyMCBBRjogbmVsbGEgdHJhbnNhemlvbmUgY29tcGxldGUgTk9OIGludmlhcmUgbWFpbCBsYSBtYWlsIHBlciBpIHRpY2tldCBjb24gY29sbGVnYXRpIC0gaWwgcmFwcG9ydG8gZGkgaW50ZXJ2ZW50byBkZWkgdGlja2V0ICJmaWdsaSIgdmllbmUgZ2VuZXJhdG8gZG9wbyBsJ2ludmlvIGRlbGxhIG1haWwgc3VsICJwYWRyZSIgcXVpbmRpIG5vbiB2ZXJyZWJiZSBpbmNsdXNvIG5lbGxhIG1haWwqLwogICAgICAgIC8qTCdpbnZpbyBkZWxsYSBtYWlsIHZlcnLDoCBmYXR0byBzdWNjZXNzaXZhbWVudGUgcmlzcGV0dG8gYWxsYSBjaGl1c3VyYSBjb24gIlNlbmQgT25TaXRlIFJlcG9ydCIqLwogICAgICAgIHNlbmRtYWlsPWZhbHNlCiAgICB9ZWxzZSBpZigocmVsYXRlc0luSXNzdWVMaW5rIHx8IHJlbGF0ZXNPdXRJc3N1ZUxpbmspICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2NmLm9wdGlvbi5zZW5kTWFpbFRvLm5vRW1haWwnXS50b1N0cmluZygpKSAmJiBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2NmLm9wdGlvbi5zZW5kTWFpbFRvLmN1cnJlbnRSZXBvcnQnXS50b1N0cmluZygpKSl7CiAgICAgICAgLy9PUC0xMDM4OiBpbnZpYXJlIGxhIG1haWwgY29uIHR1dHRpIGkgcmFwcG9ydGkgZGkgaW50ZXJ2ZW50byBkZWkgdGlja2V0IGNvbGxlZ2F0aQogICAgICAgIGJvZHlfcmVxID0gWwogICAgICAgICAgICAidGVtcGxhdGVOYW1lIjogcHJvcGVydGllc1sndHQub25TaXRlUmVwb3J0J10udG9TdHJpbmcoKSwKICAgICAgICAgICAgInBlYyI6IGZhbHNlLAogICAgICAgICAgICAiaXNzdWVLZXkiOiBpc3N1ZS5rZXksCiAgICAgICAgICAgICJsaW5rZWRUaWNrZXRzIjogbGlua2VkVGlja2V0cywKICAgICAgICAgICAgImFkZGl0aW9uYWxSZWNpcGllbnRzIjogaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShzZW5kTWFpbFRvUmVjKS50b1N0cmluZygpCiAgICAgICAgXQogICAgICAgIC8qMzEuMDcuMjAyMCBBRjogbmVsbGEgdHJhbnNhemlvbmUgY29tcGxldGUgTk9OIGludmlhcmUgbWFpbCBsYSBtYWlsIHBlciBpIHRpY2tldCBjb24gY29sbGVnYXRpIC0gaWwgcmFwcG9ydG8gZGkgaW50ZXJ2ZW50byBkZWkgdGlja2V0ICJmaWdsaSIgdmllbmUgZ2VuZXJhdG8gZG9wbyBsJ2ludmlvIGRlbGxhIG1haWwgc3VsICJwYWRyZSIgcXVpbmRpIG5vbiB2ZXJyZWJiZSBpbmNsdXNvIG5lbGxhIG1haWwqLwogICAgICAgIC8qTCdpbnZpbyBkZWxsYSBtYWlsIHZlcnLDoCBmYXR0byBzdWNjZXNzaXZhbWVudGUgcmlzcGV0dG8gYWxsYSBjaGl1c3VyYSBjb24gIlNlbmQgT25TaXRlIFJlcG9ydCIqLwogICAgICAgIHNlbmRtYWlsPWZhbHNlCiAgICB9ZWxzZSBpZighcmVsYXRlc0luSXNzdWVMaW5rICYmICFyZWxhdGVzT3V0SXNzdWVMaW5rKXsKICAgICAgICAvKkFGIDIwMjAwNzI5IC0gc3UgRkFBQyBTZXJ2aWNlIGxhIG5vdGlmaWNhIGNvbiBpbCByYXBwb3J0byBkaSBpbnRlcnZlbnRvIHZpZW5lIGludmlhdGEgc29sbyBzdSBlc3BsaWNpdGEgZGVjaXNpb25lIGRlbGwndXRlbnRlIC0gY2hlIHNwaW5nZXLDoCBTRU5EIE9OU0lURSBSRVBPUlQgZG9wbyBhdmVyIGNoaXVzbyBpbCB0aWNrZXQuIFF1aW5kaSBzZSBub24gY2kgc29ubyB0aWNrZXQgY29sbGVnYXRpIHNldHRpYW1vIHNlbmRtYWlsPWZhbHNlKi8KICAgICAgICBzZW5kbWFpbD1mYWxzZQogICAgICAgIGJvZHlfcmVxID0gWwogICAgICAgICAgICAidGVtcGxhdGVOYW1lIjogcHJvcGVydGllc1sndHQub25TaXRlUmVwb3J0J10udG9TdHJpbmcoKSwKICAgICAgICAgICAgInBlYyI6IGZhbHNlLAogICAgICAgICAgICAiaXNzdWVLZXkiOiBpc3N1ZS5rZXksCiAgICAgICAgICAgICJhZGRpdGlvbmFsUmVjaXBpZW50cyI6IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc2VuZE1haWxUb1JlYykudG9TdHJpbmcoKQogICAgICAgIF0KICAgIH1lbHNlewogICAgICAgIC8vT1AtMTAzODogbm9uIGludmlhcmUgbGEgbWFpbAogICAgICAgIHNlbmRtYWlsPWZhbHNlCiAgICB9CiAgICAKICAgIGxvZy5kZWJ1ZyAic2VuZG1haWw6ICIgKyBzZW5kbWFpbAogICAgaWYoc2VuZG1haWwpewogICAgICAgIC8qIFJFU1QgQVBJIHBlciBJbnZpbyBOb3RpZmljYSBFbWFpbCBPTlNJVEVfUkVQT1JUICovCiAgICAgICAgcmVxdWVzdE1ldGhvZCA9ICJQT1NUIjsKCiAgICAgICAgYmFzZVVSTCA9ICJodHRwOi8vIiArIHByb3BlcnRpZXNbJ2FwaS5lbnYnXS50b1N0cmluZygpICsgIi9vcC9yZXN0L2ppcmEvQUEvdHJhbnNhY3Rpb24vbWFpbC9zZW5kIgogICAgICAgIFVSTCB1cmwgPSBuZXcgVVJMKGJhc2VVUkwpCiAgICAgICAgSHR0cFVSTENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IChIdHRwVVJMQ29ubmVjdGlvbil1cmwub3BlbkNvbm5lY3Rpb24oKTsKICAgICAgICBjb25uZWN0aW9uLnNldFJlcXVlc3RNZXRob2QocmVxdWVzdE1ldGhvZCk7CiAgICAgICAgY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgiKTsKICAgICAgICBjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQWNjZXB0IiwgIiovKiIpOwogICAgICAgIGNvbm5lY3Rpb24uc2V0RG9PdXRwdXQodHJ1ZSk7CiAgICAgICAgY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwogICAgICAgIGNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtCiAgICAgICAgbG9nLmRlYnVnICJib2R5X3JlcTogIiArIGJvZHlfcmVxCiAgICAgICAgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0ud2l0aFdyaXRlcigiVVRGLTgiKSB7IG5ldyBTdHJlYW1pbmdKc29uQnVpbGRlcihpdCwgYm9keV9yZXEpIH0KICAgICAgICBsb2cuZGVidWcgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KICAgICAgICBjb25uZWN0aW9uLmNvbm5lY3QoKTsKICAgICAgICAKICAgICAgICBsb2cuZGVidWcgInVybDogIiArIHVybAogICAgICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VDb2RlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpCiAgICAgICAgLy9sb2cuZGVidWcgIlJlc3BvbnNlTWVzc2FnZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKQoKICAgICAgICBkZWYgb3V0cHV0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgZGVmIGVMaXN0RXJyb3JzID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgZGVmIGVycm9yTXNncyA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICBpZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgICAgICAgICAgbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKICAgICAgICAgICAgbG9nLmRlYnVnICJSZXNwb25zZUNvZGU6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkKICAgICAgICAgICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKCiAgICAgICAgICAgIAogICAgICAgICAgICAvKiBHZXQgSW5zaWdodCBJUUwgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCiAgICAgICAgICAgIENsYXNzIGlxbEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlIik7IAogICAgICAgICAgICBkZWYgaXFsRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKGlxbEZhY2FkZUNsYXNzKTsKCiAgICAgICAgICAgIC8qIEdldCBJbnNpZ2h0IE9iamVjdCBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsKICAgICAgICAgICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgICAgICAgICAvKiBHZXQgSW5zaWdodCBPYmplY3QgVHlwZSBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0VHlwZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZSIpOwogICAgICAgICAgICBkZWYgb2JqZWN0VHlwZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlRmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgLyogR2V0IEluc2lnaHQgT2JqZWN0IEF0dHJpYnV0ZSBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwogICAgICAgICAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnlDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuc2VydmljZXMubW9kZWwuZmFjdG9yeS5PYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeSIpOwogICAgICAgICAgICBkZWYgb2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnkgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnlDbGFzcyk7CgogICAgICAgICAgICAvKiBTcGVjaWZ5IHRoZSBzY2hlbWEgaWQgYXMgd2VsbCBhcyB0aGUgSVFMIHRoYXQgd2lsbCBmZXRjaCBvYmplY3RzLiBJbiB0aGlzIGNhc2UgYWxsIG9iamVjdHMgd2l0aCBOYW1lIG1hdGNoaW5nIHRoZSB2YWx1ZUNGLCBiZSBzdXJlIHRvIGluY2x1ZGUgIiBhcm91bmQgdmFsdWUgKi8KICAgICAgICAgICAgLypST0xMQkFDSyovCiAgICAgICAgICAgIC8qUmltb3ppb25lIGFsbGVnYXRvIHJhcHBvcnRvIGRpIGludGVydmVudG8gYXBwZW5hIGNyZWF0byovCiAgICAgICAgICAgIGRlZiBvYmplY3RzID0gaXFsRmFjYWRlLmZpbmRPYmplY3RzQnlJUUxBbmRTY2hlbWEoREJPLCAiXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuY2F0ZWdvcnlSZWYnXS50b1N0cmluZygpICsgIlwiLlwiTmFtZVwiID0gXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5yYXBwSW50RkFBQyddLnRvU3RyaW5nKCkgKyAiXCIgQU5EICIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5kZWxldGVkJ10udG9TdHJpbmcoKSArICIhPXRydWUgQU5EIG9iamVjdCBIQVZJTkcgY29ubmVjdGVkVGlja2V0cyhrZXkgPSAiICsgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiKSIpOyAvLyBTZWUgdGhlIGNvbXBsZXRlIGxpc3Qgb2YgcG9zc2libGUgSVFMIG9uIHRoZSBJbnNpZ2h0IFF1ZXJ5IExhbmd1YWdlIGRvY3VtZW50YXRpb24gcGFnZQogICAgICAgICAgICAvKiBJZiB0aGlzIGlzIGEgbWFuZGF0b3J5IGZpZWxkIHlvdSBzaG91bGQgYmUgYWJsZSB0byBkbyB0aGlzOiAqLwogICAgICAgICAgICAvL2xvZy5pbmZvKCJJbnNpZ2h0IG9iamVjdDogIiArIG9iamVjdHNbMF0pOwoKICAgICAgICAgICAgaWYob2JqZWN0c1swXSl7CiAgICAgICAgICAgICAgICAvKiBVUERBVEUgT0pCRUNUIERFTEVURUQgVkFMVUUgKi8KICAgICAgICAgICAgICAgIGRlZiBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihvYmplY3RzWzBdLmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmRlbGV0ZWQnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkgIAogICAgICAgICAgICAgICAgZGVmIHZhbHVlID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCgogICAgICAgICAgICAgICAgZGVmIHZhbHVlQmVhbiA9IG9iVHJpYWdlLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpCiAgICAgICAgICAgICAgICB2YWx1ZUJlYW4uc2V0VmFsdWUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4ob2JUcmlhZ2UuZ2V0T2JqZWN0VHlwZUF0dHJpYnV0ZUlkKCkpLCB0cnVlKQogICAgICAgICAgICAgICAgLypDbGVhbiBhY3R1YWwgdmFsdWUqLwogICAgICAgICAgICAgICAgdmFsdWUuY2xlYXIoKQogICAgICAgICAgICAgICAgdmFsdWUuYWRkKHZhbHVlQmVhbik7CiAgICAgICAgICAgICAgICBvYlRyaWFnZS5zZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKHZhbHVlKQoKICAgICAgICAgICAgICAgIC8vVXBkYXRlIE9KQkVDVCBhdHRyaWJ1dGUgdmFsdWUKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUuc3RvcmVPYmplY3RBdHRyaWJ1dGVCZWFuKG9iVHJpYWdlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiB2aWUpIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiMS4gQ291bGQgbm90IHVwZGF0ZSBvYmplY3QgYXR0cmlidXRlIGR1ZSB0byB2YWxpZGF0aW9uIGV4Y2VwdGlvbjoiICsgdmllLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qUm9sbGJhY2sgY29udGFiaWxpenphemlvbmUgaW50ZXJ2ZW50byovCiAgICAgICAgICAgIC8qQ2FuY2VsbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBPblNpdGVfUmF0ZV9SZXBvcnQgcmVnaXN0cmF0aSBuZWkgY2FtcGkgT1BBQV9MVU1QX1NVTV9SQVRFUywgT1BBQV9VTkFfVEFOVFVNX1JBVEVTLCBPUEFBX1RSQVZFTF9SQVRFUywgT1BBQV9MQUJPVVJfUkFURVMqLwogICAgICAgICAgICAvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi8KCiAgICAgICAgICAgIC8qIFNwZWNpZnkgdGhlIHNjaGVtYSBpZCBhcyB3ZWxsIGFzIHRoZSBJUUwgdGhhdCB3aWxsIGZldGNoIG9iamVjdHMuIEluIHRoaXMgY2FzZSBhbGwgb2JqZWN0cyB3aXRoIE5hbWUgbWF0Y2hpbmcgdGhlIHZhbHVlQ0YsIGJlIHN1cmUgdG8gaW5jbHVkZSAiIGFyb3VuZCB2YWx1ZSAqLwogICAgICAgICAgICBvYmplY3RzID0gaXFsRmFjYWRlLmZpbmRPYmplY3RzQnlJUUxBbmRTY2hlbWEoT1BBQSwgIm9iamVjdFR5cGUgPSAiICsgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0J10udG9TdHJpbmcoKSArICIgQU5EIG9iamVjdCBIQVZJTkcgY29ubmVjdGVkVGlja2V0cyhrZXk9IiArIGlzc3VlLmtleS50b1N0cmluZygpICsgIikgQU5EIFwiIiArIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSArICJcIiAhPSB0cnVlIik7IC8vIFNlZSB0aGUgY29tcGxldGUgbGlzdCBvZiBwb3NzaWJsZSBJUUwgb24gdGhlIEluc2lnaHQgUXVlcnkgTGFuZ3VhZ2UgZG9jdW1lbnRhdGlvbiBwYWdlCiAgICAgICAgICAgIC8qIElmIHRoaXMgaXMgYSBtYW5kYXRvcnkgZmllbGQgeW91IHNob3VsZCBiZSBhYmxlIHRvIGRvIHRoaXM6ICovCiAgICAgICAgICAgIC8vbG9nLmluZm8oIkluc2lnaHQgb2JqZWN0cyBkYSBjYW5jZWxsYXJlOiAiICsgb2JqZWN0cyk7CgogICAgICAgICAgICBmb3Iob2JqIGluIG9iamVjdHMpewogICAgICAgICAgICAgICAgLyogREVMRVRFIENPTk5FQ1RFRCBPQkpFQ1RTICovCiAgICAgICAgICAgICAgICBvYmplY3RGYWNhZGUuZGVsZXRlT2JqZWN0QmVhbihvYmouZ2V0SWQoKSk7ICAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLypDYW5jZWxsYXJlIGdsaSBpbXBvcnRpIGZvcm5pdG9yZSwgY2xpZW50ZSBlIGkgdG90YWxpIHN1IHR1dHRpIGdsaSBvZ2dldHRpIENvbXBvbmVudCBpbiBPUEFBX1JFUExBQ0VEX01BVEVSSUFMUyovCiAgICAgICAgICAgIGRlZiByZXBNYXRlcmlhbHMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnJlcGxhY2VkTWF0ZXJpYWxzJ10udG9TdHJpbmcoKSlbMF0KICAgICAgICAgICAgZGVmIHJlcE1hdExpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKCiAgICAgICAgICAgIGZvcihtYXQgaW4gcmVwTWF0TGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5kIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiBjb21wb25lbnQ9bWF0LnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGRlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgZGVmIGNvbXBvbmVudE9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihjb21wb25lbnRLZXkpCiAgICAgICAgICAgICAgICAvL3NldCAiQVBQTElFRF9UTyIsICJBQ0NPVU5USU5HX1NVUFBMSUVSX01BVEVSSUFMX1JFRiIsICJBQ0NPVU5USU5HX0NVU1RPTUVSX01BVEVSSUFMX1JFRiIsICJUT1RBTF9BTU9VTlRfU1VQUExJRVIiLCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiB0byBudWxsIGZvciB0aGF0IGNvbXBvbmVudAoKICAgICAgICAgICAgICAgIC8vQVBQTElFRF9UTwogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgZGVmIG9iVHJpYWdlQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKICAgICAgICAgICAgICAgICAgICBkZWYgdmFsdWVBcHBsaWVkVG8gPSBvYlRyaWFnZUFwcGxpZWRUby5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgICAgICAgICBsb2cud2FybiAidmFsdWVBcHBsaWVkVG86ICIgKyB2YWx1ZUFwcGxpZWRUbwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZUFwcGxpZWRUby5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcHBsaWVkVG8uY2xlYXIoKSAKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYlRyaWFnZUFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5kZWxldGVPYmplY3RBdHRyaWJ1dGVCZWFuKG9iVHJpYWdlQXBwbGllZFRvLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIHZpZSl7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKCJDb3VsZCBub3QgdXBkYXRlIG9iamVjdCBhdHRyaWJ1dGUgZHVlIHRvIHZhbGlkYXRpb24gZXhjZXB0aW9uOiIgKyB2aWUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0FDQ09VTlRJTkdfU1VQUExJRVJfTUFURVJJQUxfUkVGCiAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFjY291bnRpbmdTdXBwTWF0ZXJpYWwnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgZGVmIG9iVHJpYWdlTWF0UyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYWNjb3VudGluZ1N1cHBNYXRlcmlhbCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQogICAgICAgICAgICAgICAgICAgIGRlZiB2YWx1ZU1hdFMgPSBvYlRyaWFnZU1hdFMuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4gInZhbHVlTWF0UzogIiArIHZhbHVlTWF0UwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZU1hdFMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlTWF0Uy5jbGVhcigpIAoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iVHJpYWdlTWF0UyA9IG9iamVjdEZhY2FkZS5kZWxldGVPYmplY3RBdHRyaWJ1dGVCZWFuKG9iVHJpYWdlTWF0Uy5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiB2aWUpeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5lcnJvcigiQ291bGQgbm90IHVwZGF0ZSBvYmplY3QgYXR0cmlidXRlIGR1ZSB0byB2YWxpZGF0aW9uIGV4Y2VwdGlvbjoiICsgdmllLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9BQ0NPVU5USU5HX0NVU1RPTUVSX01BVEVSSUFMX1JFRgogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hY2NvdW50aW5nQ3VzdE1hdGVyaWFsJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIGRlZiBvYlRyaWFnZU1hdEMgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFjY291bnRpbmdDdXN0TWF0ZXJpYWwnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKICAgICAgICAgICAgICAgICAgICBkZWYgdmFsdWVNYXRDID0gb2JUcmlhZ2VNYXRDLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuICJ2YWx1ZU1hdEM6ICIgKyB2YWx1ZU1hdEMKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVNYXRDLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZU1hdEMuY2xlYXIoKSAKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYlRyaWFnZU1hdEMgPSBvYmplY3RGYWNhZGUuZGVsZXRlT2JqZWN0QXR0cmlidXRlQmVhbihvYlRyaWFnZU1hdEMuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gdmllKXsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cuZXJyb3IoIkNvdWxkIG5vdCB1cGRhdGUgb2JqZWN0IGF0dHJpYnV0ZSBkdWUgdG8gdmFsaWRhdGlvbiBleGNlcHRpb246IiArIHZpZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvL1RPVEFMX0FNT1VOVF9TVVBQTElFUgogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RTdXBwJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIGRlZiBvYlRyaWFnZVRvdFMgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdFN1cHAnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKICAgICAgICAgICAgICAgICAgICBkZWYgdmFsdWVUb3RTID0gb2JUcmlhZ2VUb3RTLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuICJ2YWx1ZVRvdFM6ICIgKyB2YWx1ZVRvdFMKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVUb3RTLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVRvdFMuY2xlYXIoKSAKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYlRyaWFnZVRvdFMgPSBvYmplY3RGYWNhZGUuZGVsZXRlT2JqZWN0QXR0cmlidXRlQmVhbihvYlRyaWFnZVRvdFMuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gdmllKXsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cuZXJyb3IoIkNvdWxkIG5vdCB1cGRhdGUgb2JqZWN0IGF0dHJpYnV0ZSBkdWUgdG8gdmFsaWRhdGlvbiBleGNlcHRpb246IiArIHZpZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy9UT1RBTF9BTU9VTlRfQ1VTVE9NRVIKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgICAgICAgICBkZWYgb2JUcmlhZ2VUb3RDID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RDdXN0J10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpCiAgICAgICAgICAgICAgICAgICAgZGVmIHZhbHVlVG90QyA9IG9iVHJpYWdlVG90Qy5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgICAgICAgICBsb2cud2FybiAidmFsdWVUb3RDOiAiICsgdmFsdWVUb3RDCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlVG90Qy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVUb3RDLmNsZWFyKCkgCgogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JUcmlhZ2VUb3RDID0gb2JqZWN0RmFjYWRlLmRlbGV0ZU9iamVjdEF0dHJpYnV0ZUJlYW4ob2JUcmlhZ2VUb3RDLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIHZpZSl7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKCJDb3VsZCBub3QgdXBkYXRlIG9iamVjdCBhdHRyaWJ1dGUgZHVlIHRvIHZhbGlkYXRpb24gZXhjZXB0aW9uOiIgKyB2aWUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAKCiAgICAgICAgICAgIGRlZiBvdXRwdXRNc2cgPSAoKEh0dHBVUkxDb25uZWN0aW9uKWNvbm5lY3Rpb24pLmVycm9yU3RyZWFtLnRleHQKICAgICAgICAgICAgbG9nLmRlYnVnICIoKEh0dHBVUkxDb25uZWN0aW9uKWNvbm5lY3Rpb24pLmVycm9yU3RyZWFtLnRleHQ6ICIgKyBvdXRwdXRNc2cKCiAgICAgICAgICAgIGRlZiBqc29uU2x1cnBlciA9IG5ldyBKc29uU2x1cnBlcigpCiAgICAgICAgICAgIGRlZiBqc29uX29iamVjdCA9IGpzb25TbHVycGVyLnBhcnNlVGV4dChvdXRwdXRNc2cpCiAgICAgICAgICAgIGFzc2VydCBqc29uX29iamVjdCBpbnN0YW5jZW9mIE1hcCAgCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAibWVzc2FnZTogIiArICBqc29uX29iamVjdC5tZXNzYWdlCiAgICAgICAgICAgIAogICAgICAgICAgICBlTGlzdEVycm9ycy5hZGQoIkUiKQogICAgICAgICAgICBlTGlzdEVycm9ycy5hZGQoIlNFTkRNQUlMIikKICAgICAgICAgICAgZXJyb3JNc2dzLmFkZChjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpICsgIiAiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKSkKICAgICAgICAgICAgZUxpc3RFcnJvcnMuYWRkKGpzb25fb2JqZWN0Lm1lc3NhZ2UpCiAgICAgICAgICAgIGVMaXN0LmFkZChlTGlzdEVycm9ycykKCiAgICAgICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKQogICAgICAgIH1lbHNlewogICAgICAgICAgICAvKkwnZW1haWwgw6ggc3RhdGEgaW52aWF0YSBjb3JyZXR0YW1lbnRlLCBhZ2dpb3JubyBpbCBjYW1wbyBPTlNJVEVfUkVQT1JUIGNvbiBsYSBkYXRhIGNvcnJlbnRlKi8KCiAgICAgICAgICAgIC8vIGxvZy53YXJuICJpc3N1ZSAiK2lzc3VlLmdldEtleSgpCiAgICAgICAgICAgIGRlZiBjZnYgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKG9uc2l0ZVJlcG9ydERhdGUpCiAgICAgICAgICAgIGlmICghY2Z2KSB7CiAgICAgICAgICAgICAgZGVmIHQwICA9IG5ldyBqYXZhLnNxbC5UaW1lc3RhbXAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpCiAgICAgICAgICAgICAgbG9nLndhcm4gIlN0YXJ0VGltZSA9PiAnIit0MC50b1N0cmluZygpKyInIgogICAgICAgICAgICAgIGRlZiBtdiA9IG5ldyBNb2RpZmllZFZhbHVlKG9uc2l0ZVJlcG9ydERhdGUsIHQwKQogICAgICAgICAgICAgIGRlZiBjaCA9IG5ldyBEZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIoKQogICAgICAgICAgICAgIG9uc2l0ZVJlcG9ydERhdGUudXBkYXRlVmFsdWUobnVsbCwgaXNzdWUsIG12LCBjaCkgCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbG9nLndhcm4gIlN0YXJ0VGltZSA9PSAnIitjZnYudG9TdHJpbmcoKSsiJyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="6">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIGxpbmtlZFRpY2tldHMgJiBGYXN0LVRyYW5zYWN0IHRoZW0=</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5pbmRleC5Jc3N1ZUluZGV4aW5nU2VydmljZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5XQVJOKQoKbG9nLndhcm4gIiR7aXNzdWUua2V5fSBUcmFuc2F6aW9uZSBDb21wbGV0ZSAtIFBvc3QgRnVuY3Rpb24gY2hlY2sgbGlua2VkSXNzdWVzIgoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiBhdXRvbWF0aWNhbGx5Q2xvc2VkID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5Q2xvc2VkJ10udG9TdHJpbmcoKSlbMF0KSXNzdWVJbmRleGluZ1NlcnZpY2UgCWlzc3VlSW5kZXhpbmdTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29tcG9uZW50KElzc3VlSW5kZXhpbmdTZXJ2aWNlKQoKSXNzdWUgaXNzdWUgPSBpc3N1ZQovL1BlciB0ZXN0IGRhIGNvbnNvbGUKLy9pc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiT1BVVC0yNzYiKQoKU1RBUlRfUFJPR1JFU1M9cHJvcGVydGllc1snd2YudHIuc3RhcnRQcm9ncmVzcyddCkNPTVBMRVRFPXByb3BlcnRpZXNbJ3dmLnRyLmNvbXBsZXRlJ10KCmRlZiB1c2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCmRlZiBpc3N1ZVNlcnZpY2UgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZVNlcnZpY2UoKQoKbG9nLndhcm4gImlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNsb3NlZCk6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpCgppZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpPT1udWxsIHx8IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNsb3NlZCkudG9TdHJpbmcoKS5lcXVhbHMoIk5vIikpewogICAgLypPUC0xMDM4OiBzZSBobyBlc2VndWl0byBsYSBDb21wbGV0ZSBzdWwgdGlja2V0ICJwYWRyZSIgdmVyaWZpY28gZSBzcG9zdG8gaW4gYXV0b21hdGljbyBnbGkgZXZlbnR1YWxpIHRpY2tldCBjb2xsZWdhdGkqLwogICAgCiAgICBsb2cud2FybiAidmVyaWZpY28gZSBzcG9zdG8gaW4gYXV0b21hdGljbyBnbGkgZXZlbnR1YWxpIHRpY2tldCBjb2xsZWdhdGkiCiAgICAKICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxJbklzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRJbndhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQogICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsSW5Jc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgLypFc2VndWlyZSB0cmFuc2F6aW9uZSBkaSBzdGF0byBjb24gT1BBQV9BVVRPTUFUSUNBTExZX0NMT1NFRD1ZZXMgZGVsbGEgc291cmNlSXNzdWUqLwogICAgICAgICAgICBkZWYgbGlua2VkSXNzdWUgPSBpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkKICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlU3RhdHVzID0gbGlua2VkSXNzdWUuZ2V0U3RhdHVzKCkKICAgICAgICAgICAgbG9nLndhcm4gIklzc3VlIGNvbiByZWxhdGVzSW5Jc3N1ZUxpbmsgJHtsaW5rZWRJc3N1ZX0gY29uIHN0YXRvICR7bGlua2VkSXNzdWVTdGF0dXN9IgogICAgICAgICAgICBkZWYgdHJhbnNpdGlvbklkCiAgICAgICAgICAgIGlmKGxpbmtlZElzc3VlU3RhdHVzLm5hbWUgPT0gcHJvcGVydGllc1snd2YuY29uZmlybWVkQW5kUGxhbm5lZCddLnRvU3RyaW5nKCkpewogICAgICAgICAgICAgICAgdHJhbnNpdGlvbklkPVNUQVJUX1BST0dSRVNTCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYobGlua2VkSXNzdWVTdGF0dXMubmFtZSA9PSBwcm9wZXJ0aWVzWyd3Zi5pblByb2dyZXNzJ10udG9TdHJpbmcoKSl7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9Q09NUExFVEUKICAgICAgICAgICAgfQogICAgICAgICAgICBpZih0cmFuc2l0aW9uSWQ9PVNUQVJUX1BST0dSRVNTKXsKICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgb3VyIGlucHV0IGZvciB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgZGVmIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICAgICAgICAgIHNldFNraXBTY3JlZW5DaGVjayhmYWxzZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhpc3N1ZSkKICAgICAgICAgICAgICAgIC8vQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIC8vaXNzdWVJbnB1dFBhcmFtZXRlcnMuYWRkQ3VzdG9tRmllbGRWYWx1ZShmaWVsZENvbmZpZy5nZXRJZCgpLCAiWWVzIikgCiAgICAgICAgICAgICAgICAvL2xvZy53YXJuICJpc3N1ZUlucHV0UGFyYW1ldGVyczogIiArIGlzc3VlSW5wdXRQYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgICAgICAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICAgICAgICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5Q2xvc2VkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vZGVmIHZhbGlkYXRpb25SZXN1bHQgPSBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKQogICAgICAgICAgICAgICAgaWYgKGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICBkZWYgaXNzdWVSZXN1bHQgPSBpc3N1ZVNlcnZpY2UudHJhbnNpdGlvbih1c2VyLCBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKSkKICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkZhaWxlZCB0byB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSA5NiAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259LCAke2xpbmtlZElzc3VlLnN0YXR1c30iKQogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9Q09NUExFVEUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBvdXIgaW5wdXQgZm9yIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgICAgICAgICAgaXNzdWVJbnB1dFBhcmFtZXRlcnMud2l0aCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTa2lwU2NyZWVuQ2hlY2soZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy9maWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDbG9zZWQuZ2V0UmVsZXZhbnRDb25maWcoaXNzdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKICAgICAgICAgICAgICAgICAgICAgICAgLy92YWxpZGF0aW9uUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgICAgICAgICAgbWkgPSAoTXV0YWJsZUlzc3VlKSBsaW5rZWRJc3N1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgLy9maWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDbG9zZWQuZ2V0UmVsZXZhbnRDb25maWcobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9nLndhcm4gImZpZWxkQ29uZmlnOiAiICsgZmllbGRDb25maWcKICAgICAgICAgICAgICAgICAgICAgICAgLy9jZk5ld1ZhbHVlID0gQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy9hdXRvbWF0aWNhbGx5Q2xvc2VkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgICAgICAgICAgLy9Db21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vaXNzdWVJbmRleGluZ1NlcnZpY2UucmVJbmRleChsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgLy9sb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzc3VlUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnRyYW5zaXRpb24odXNlciwgaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiRmFpbGVkIHRvIHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSAxMjQgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSwgJHtsaW5rZWRJc3N1ZS5zdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJDb3VsZCBub3QgdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiQ291bGQgbm90IHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2UgaWYgKHRyYW5zaXRpb25JZD09Q09NUExFVEUpewogICAgICAgICAgICAgICAgZGVmIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICAgICAgICAgIHNldFNraXBTY3JlZW5DaGVjayhmYWxzZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhpc3N1ZSkKICAgICAgICAgICAgICAgIC8vQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIC8vaXNzdWVJbnB1dFBhcmFtZXRlcnMuYWRkQ3VzdG9tRmllbGRWYWx1ZShmaWVsZENvbmZpZy5nZXRJZCgpLCAiWWVzIikgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRlZiBjdXJyZW50VXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKQogICAgICAgICAgICAgICAgZGVmIG1pID0gKE11dGFibGVJc3N1ZSkgbGlua2VkSXNzdWUKCiAgICAgICAgICAgICAgICBkZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q2xvc2VkLmdldFJlbGV2YW50Q29uZmlnKGxpbmtlZElzc3VlKQogICAgICAgICAgICAgICAgbG9nLndhcm4gImZpZWxkQ29uZmlnOiAiICsgZmllbGRDb25maWcKICAgICAgICAgICAgICAgIGRlZiBjZk5ld1ZhbHVlID0gQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHlDbG9zZWQudXBkYXRlVmFsdWUobnVsbCwgbGlua2VkSXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGxpbmtlZElzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNsb3NlZCksIGNmTmV3VmFsdWUpLCBuZXcgRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyKCkpCgogICAgICAgICAgICAgICAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCkudXBkYXRlSXNzdWUoY3VycmVudFVzZXIsIG1pLCBFdmVudERpc3BhdGNoT3B0aW9uLkRPX05PVF9ESVNQQVRDSCwgZmFsc2UpOwogICAgICAgICAgICAgICAgaXNzdWVJbmRleGluZ1NlcnZpY2UucmVJbmRleChsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJVcGRhdGVkIGN1c3RvbWZpZWxkIC0gaXNzdWUgbGlua2F0YSIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy9kZWYgdmFsaWRhdGlvblJlc3VsdCA9IGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpCiAgICAgICAgICAgICAgICBpZiAoaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgICAgIGRlZiBpc3N1ZVJlc3VsdCA9IGlzc3VlU2VydmljZS50cmFuc2l0aW9uKHVzZXIsIGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpKQogICAgICAgICAgICAgICAgICAgIGlmICghIGlzc3VlUmVzdWx0LmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiRmFpbGVkIHRvIHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIlRyYW5zYXppb25lIGZhdHRhIDE2MSAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259LCAke2xpbmtlZElzc3VlLnN0YXR1c30iKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkNvdWxkIG5vdCB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBMaXN0PElzc3VlTGluaz4gYWxsT3V0SXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldE91dHdhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQogICAgZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsT3V0SXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgICAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIGxvZy53YXJuICJJc3N1ZSBjb24gcmVsYXRlc091dElzc3VlTGluayIKICAgICAgICAgICAgLypFc2VndWlyZSB0cmFuc2F6aW9uZSBkaSBzdGF0byBjb24gT1BBQV9BVVRPTUFUSUNBTExZX0NMT1NFRD1ZZXMgZGVsbGEgZGVzdGluYXRpb25Jc3N1ZSovCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZSA9IGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZVN0YXR1cyA9IGxpbmtlZElzc3VlLmdldFN0YXR1cygpCiAgICAgICAgICAgIGRlZiB0cmFuc2l0aW9uSWQKICAgICAgICAgICAgbG9nLndhcm4gImxpbmtlZElzc3VlOiAiICsgbGlua2VkSXNzdWUKICAgICAgICAgICAgbG9nLndhcm4gImxpbmtlZElzc3VlU3RhdHVzLm5hbWU6ICIgKyBsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lCiAgICAgICAgICAgIGlmKGxpbmtlZElzc3VlU3RhdHVzLm5hbWUgPT0gIkNvbmZpcm1lZCBhbmQgUGxhbm5lZCIpewogICAgICAgICAgICAgICAgdHJhbnNpdGlvbklkPVNUQVJUX1BST0dSRVNTCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYobGlua2VkSXNzdWVTdGF0dXMubmFtZSA9PSBwcm9wZXJ0aWVzWyd3Zi5pblByb2dyZXNzJ10udG9TdHJpbmcoKSl7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9Q09NUExFVEUKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2cud2FybiAidHJhbnNpdGlvbklkOiAiICsgdHJhbnNpdGlvbklkCiAgICAgICAgICAgIGlmKHRyYW5zaXRpb25JZD09U1RBUlRfUFJPR1JFU1MpewogICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBvdXIgaW5wdXQgZm9yIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICBkZWYgaXNzdWVJbnB1dFBhcmFtZXRlcnMgPSBpc3N1ZVNlcnZpY2UubmV3SXNzdWVJbnB1dFBhcmFtZXRlcnMoKQogICAgICAgICAgICAgICAgaXNzdWVJbnB1dFBhcmFtZXRlcnMud2l0aCB7CiAgICAgICAgICAgICAgICAgICAgc2V0U2tpcFNjcmVlbkNoZWNrKGZhbHNlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9kZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q2xvc2VkLmdldFJlbGV2YW50Q29uZmlnKGlzc3VlKQogICAgICAgICAgICAgICAgLy9Db21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGVmIGN1cnJlbnRVc2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCiAgICAgICAgICAgICAgICBkZWYgbWkgPSAoTXV0YWJsZUlzc3VlKSBsaW5rZWRJc3N1ZQoKICAgICAgICAgICAgICAgIGRlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDbG9zZWQuZ2V0UmVsZXZhbnRDb25maWcobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiZmllbGRDb25maWc6ICIgKyBmaWVsZENvbmZpZwogICAgICAgICAgICAgICAgZGVmIGNmTmV3VmFsdWUgPSBDb21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgYXV0b21hdGljYWxseUNsb3NlZC51cGRhdGVWYWx1ZShudWxsLCBsaW5rZWRJc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUobGlua2VkSXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKSwgY2ZOZXdWYWx1ZSksIG5ldyBEZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIoKSkKCiAgICAgICAgICAgICAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpc3N1ZUluZGV4aW5nU2VydmljZS5yZUluZGV4KGxpbmtlZElzc3VlKQogICAgICAgICAgICAgICAgbG9nLndhcm4gIlVwZGF0ZWQgY3VzdG9tZmllbGQgLSBpc3N1ZSBsaW5rYXRhIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvL2RlZiB2YWxpZGF0aW9uUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykKICAgICAgICAgICAgICAgIGxvZy53YXJuICJpc3N1ZUlucHV0UGFyYW1ldGVyczogIiArIGlzc3VlSW5wdXRQYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICBpZiAoaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgICAgIGRlZiBpc3N1ZVJlc3VsdCA9IGlzc3VlU2VydmljZS50cmFuc2l0aW9uKHVzZXIsIGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpKQogICAgICAgICAgICAgICAgICAgIGlmICghIGlzc3VlUmVzdWx0LmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiRmFpbGVkIHRvIHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIlRyYW5zYXppb25lIGZhdHRhIDIxOCAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259LCAke2xpbmtlZElzc3VlLnN0YXR1c30iKQogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9Q09NUExFVEUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBvdXIgaW5wdXQgZm9yIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgICAgICAgICAgaXNzdWVJbnB1dFBhcmFtZXRlcnMud2l0aCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTa2lwU2NyZWVuQ2hlY2soZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy9maWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDbG9zZWQuZ2V0UmVsZXZhbnRDb25maWcoaXNzdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29tcG9uZW50QWNjZXNzb3Iub3B0aW9uc01hbmFnZXIuZ2V0T3B0aW9ucyhmaWVsZENvbmZpZyk/LmZpbmQgeyBpdC50b1N0cmluZygpID09ICJZZXMiIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRVc2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCiAgICAgICAgICAgICAgICAgICAgICAgIG1pID0gKE11dGFibGVJc3N1ZSkgbGlua2VkSXNzdWUKCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4gImZpZWxkQ29uZmlnOiAiICsgZmllbGRDb25maWcKICAgICAgICAgICAgICAgICAgICAgICAgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHlDbG9zZWQudXBkYXRlVmFsdWUobnVsbCwgbGlua2VkSXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGxpbmtlZElzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNsb3NlZCksIGNmTmV3VmFsdWUpLCBuZXcgRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyKCkpCgogICAgICAgICAgICAgICAgICAgICAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuICJVcGRhdGVkIGN1c3RvbWZpZWxkIC0gaXNzdWUgbGlua2F0YSIKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFsaWRhdGlvblJlc3VsdCA9IGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzc3VlUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnRyYW5zaXRpb24odXNlciwgaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiRmFpbGVkIHRvIHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSAyNDggJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSwgJHtsaW5rZWRJc3N1ZS5zdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJDb3VsZCBub3QgdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiQ291bGQgbm90IHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBsb2cud2FybiAiaXNzdWUgZGEgY29tcGxldGFyZSIKICAgICAgICAgICAgICAgIGRlZiBpc3N1ZUlucHV0UGFyYW1ldGVycyA9IGlzc3VlU2VydmljZS5uZXdJc3N1ZUlucHV0UGFyYW1ldGVycygpCiAgICAgICAgICAgICAgICBpc3N1ZUlucHV0UGFyYW1ldGVycy53aXRoIHsKICAgICAgICAgICAgICAgICAgICBzZXRTa2lwU2NyZWVuQ2hlY2soZmFsc2UpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2RlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDbG9zZWQuZ2V0UmVsZXZhbnRDb25maWcoaXNzdWUpCiAgICAgICAgICAgICAgICAvL0NvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICAvL2lzc3VlSW5wdXRQYXJhbWV0ZXJzLmFkZEN1c3RvbUZpZWxkVmFsdWUoZmllbGRDb25maWcuZ2V0SWQoKSwgIlllcyIpIAogICAgICAgICAgICAgICAgLy9sb2cud2FybiAidmFsaWRhdGVSZXN1bHQiCiAgICAgICAgICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgICAgICAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNsb3NlZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICAgICAgICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5Q2xvc2VkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgZGVmIGlzc3VlUmVzdWx0ID0gaXNzdWVTZXJ2aWNlLnRyYW5zaXRpb24odXNlciwgaXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykpCiAgICAgICAgICAgICAgICAgICAgaWYgKCEgaXNzdWVSZXN1bHQuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJGYWlsZWQgdG8gdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlUmVzdWx0LmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiVHJhbnNhemlvbmUgZmF0dGEgMjg1ICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlUmVzdWx0LmVycm9yQ29sbGVjdGlvbn0sICR7bGlua2VkSXNzdWUuc3RhdHVzfSIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2FybigiQ291bGQgbm90IHRyYW5zaXRpb24gdGFzayAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKS5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCn0=</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="151" name="Annulla Rapporto di Intervento">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="4">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="6" name="Completed to be Closed">
      <meta name="jira.status.id">14330</meta>
      <actions>
        <action id="161" name="ODV" view="fieldscreen">
          <meta name="opsbar-sequence">40</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19908</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="FIELD_NOTES">YCFg</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIE9QX1NBTEVTX09SREVSX0RBVEUgLSBJZiBub3QgbnVsbCAtIHRyYW5zaXRpb24gaGFzIGFscmVhZHkgYmVlbiBleGVjdXRlZA==</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KY2ZWYWx1ZXNbcHJvcGVydGllc1snY2Yuc2FsZXNPcmRlckRhdGUnXV0gPT0gbnVsbHx8fA==</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIE9QX0FVVE9NQVRJQ0FMTFlfQ0xPU0VEIC0gaWYgWWVzIGRvbid0IGFsbG93IHRyYW5zaXRpb24=</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KY2ZWYWx1ZXNbcHJvcGVydGllc1snY2YuYXV0b21hdGljYWxseUNsb3NlZCddXSA9PSBudWxsIHx8IGNmVmFsdWVzW3Byb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlDbG9zZWQnXV0/LnZhbHVlID09ICdObyd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">3d74ebaab228199aff706fc0e35573a6d6df31fb</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcyAtIHNvbG8gZXJyb3JzLCBubyB3YXJuaW5ncw==</arg>
              <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">YCFgeyJzY3JpcHQiOiJpbXBvcnQgZ3Jvb3Z5Lmpzb24uSnNvblNsdXJwZXJcbmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlclxuaW1wb3J0IGdyb292eS5qc29uLlN0cmVhbWluZ0pzb25CdWlsZGVyXG5cbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZFxuaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXJcbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZVxuaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGlua1xuXG5pbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb25cbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2VcblxuaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnlcbmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyXG5pbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGxcblxuUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKVxuRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJylcbnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7XG5cdHByb3BlcnRpZXMubG9hZChpdClcbn1cbmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZShcImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uXCIpXG5sb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRylcbiBcbklzc3VlIGlzc3VlID0gaXNzdWVcbi8vUGVyIHRlc3QgZGEgY29uc29sZVxuLy9Jc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7XG4vL2lzc3VlID0gaXNzdWVNYW5hZ2VyLmdldElzc3VlQnlLZXlJZ25vcmVDYXNlKFwiT1BVVC0xNDA2NVwiKVxuXG5kZWYgZXJyb3JzID0gZmFsc2VcbmRlZiB3YXJuaW5ncyA9IGZhbHNlXG5kZWYgcmVsYXRlc0luSXNzdWVMaW5rPWZhbHNlXG5kZWYgcmVsYXRlc091dElzc3VlTGluaz1mYWxzZVxuZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGVMaW5rZWQgPSBuZXcgQXJyYXlMaXN0KClcbmRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGVRdW90ZUxpbmtlZCA9IG5ldyBBcnJheUxpc3QoKVxuXG5kZWYgbHVtcFN1bVByaWNlID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5sdW1wU3VtUHJpY2UnXS50b1N0cmluZygpKVswXVxuXG4vKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgbm9uIGEgY29ycG8qL1xuZGVmIHJlcE1hdGVyaWFscyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YucmVwbGFjZWRNYXRlcmlhbHMnXS50b1N0cmluZygpKVswXVxuZGVmIHVuYVRhbnR1bVJhdGVzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi51bmF0YW50dW1SYXRlcyddLnRvU3RyaW5nKCkpWzBdXG5kZWYgbGFib3VyUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmxhYm91clJhdGVzJ10udG9TdHJpbmcoKSlbMF1cbmRlZiB0cmF2ZWxSYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YudHJhdmVsUmF0ZXMnXS50b1N0cmluZygpKVswXVxuXG4vKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgYSBjb3JwbyovXG5kZWYgbHVtcFN1bVJhdGVzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5sdW1wU3VtUmF0ZXMnXS50b1N0cmluZygpKVswXVxuXG4vKkNvbmZlcm1hIHV0ZW50ZSBzdSB3YXJuaW5ncyovXG5kZWYgdHJhbnNpdGlvbkNoZWNrID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5jaGVja0FuZENvbmZpcm0nXS50b1N0cmluZygpKVswXVxuZGVmIHRyYW5zaXRpb25DaGVja1ZhbHVlID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spXG5cbi8qSW5zaWdodCBTY2hlbWEgSURzKi9cbmRlZiBEQk9iamVjdHMgPSBwcm9wZXJ0aWVzWydpc2NoZW1hLmRibyddLnRvU3RyaW5nKCkgKyBcIi1cIlxuZGVmIE9QQUEgPSBwcm9wZXJ0aWVzWydpc2NoZW1hLmFhJ10udG9TdHJpbmcoKSArIFwiLVwiXG5cbi8qQXJyYXkgd2FybmluZ3MgZWQgZXJyb3JzIHBlciBsYSBpc3N1ZSBwcmluY2lwYWxlLCB1bm8gcGVyIG9nbmkgdGlwb2xvZ2lhIGRpIGVycm9yZSBvIHdhcm5pbmcqL1xuZGVmIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lciA9IG5ldyBBcnJheUxpc3QoKVxuZGVmIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIgPSBuZXcgQXJyYXlMaXN0KClcbi8vZGVmIGlzc3VlRXJyb3IuLi5cblxuLypWZXJpZmljYSBjYW1waSBzdSB0aWNrZXQgb2dnZXR0byBkZWxsYSB0cmFuc2F6aW9uZSovXG5pZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1QcmljZSkhPW51bGwgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUHJpY2UpLnRvU3RyaW5nKCkuZXF1YWxzKFwiWWVzXCIpKXtcblx0LypDb250YWJpbGl6emF6aW9uZSBhIGNvcnBvKi9cblx0bG9nLmRlYnVnIFwiQ29udGFiaWxpenphemlvbmUgYSBjb3Jwb1wiXG5cdC8vT1BBQV9MVU1QX1NVTV9SQVRFU1xuXHRpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykgIT0gXCJcIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKFwiXCIpKXtcblx0XHQvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi9cblx0XHQvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHNcblx0XHRDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoXCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGVcIik7ICBcblx0XHRDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZVwiKTtcblx0XHRkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpO1xuXHRcdGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpO1xuXG5cdFx0ZGVmIGxzUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpXG5cblx0XHRmb3IobHMgaW4gbHNSYXRlc0xpc3Qpe1xuXHRcdFx0Ly9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0XG5cdFx0XHRkZWYgbHNSYXRlPWxzLnRvU3RyaW5nKClcblx0XHRcdGRlZiBsc1JhdGVLZXkgPSBsc1JhdGUuc3Vic3RyaW5nKGxzUmF0ZS5pbmRleE9mKCcoJykrMSxsc1JhdGUuaW5kZXhPZignKScpKVxuXHRcdFx0ZGVmIGxzUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihsc1JhdGVLZXkpXG5cdFx0XHQvL2dldCBcIkFQUExJRURfVE9cIiBmb3IgdGhhdCByYXRlXG5cdFx0XHRkZWYgbHNBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuXHRcdFx0ZGVmIGxzQXBwbGllZFRvVmFsdWVcblx0XHRcdGlmIChsc0FwcGxpZWRUbyl7XG5cdFx0XHRcdGxzQXBwbGllZFRvVmFsdWUgPSBsc0FwcGxpZWRUby5zdWJzdHJpbmcobHNBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsbHNBcHBsaWVkVG8uaW5kZXhPZignKScpKVxuXHRcdFx0fVxuICAgICAgICAgICAgLy9nZXQgXCJERUxFVEVEXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgZGVmIGRlbGV0ZWRcbiAgICAgICAgICAgIGRlZiBkZWxldGVkVmFsdWVcbiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgZGVsZXRlZCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBcImRlbGV0ZWQ6IFwiICsgZGVsZXRlZFxuICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZFZhbHVlID0gZGVsZXRlZC5zdWJzdHJpbmcoZGVsZXRlZC5pbmRleE9mKCcoJykrMSxkZWxldGVkLmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cdFx0XHRcblx0XHRcdGRlZiBsc1JhdGVSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcblx0XHRcdFxuXHRcdFx0ZGVmIGxzUmF0ZVJlZktleVxuXHRcdFx0ZGVmIGxzUmF0ZVJlZlZhbHVlXG5cdFx0XHRpZihsc1JhdGVSZWYuc2l6ZSgpID4gMCl7XG5cdFx0XHRcdGxzUmF0ZVJlZiA9IGxzUmF0ZVJlZi50b1N0cmluZygpXG5cdFx0XHRcdGxzUmF0ZVJlZktleSA9IGxzUmF0ZVJlZi5zdWJzdHJpbmcobHNSYXRlUmVmLmluZGV4T2YoJygnKSsxLGxzUmF0ZVJlZi5pbmRleE9mKCcpJykpXG5cdFx0XHRcdGRlZiBsc1JhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIGxzUmF0ZVJlZktleSlcblx0XHRcdFx0bHNSYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5OYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcblx0XHRcdFx0bHNSYXRlUmVmVmFsdWUgPSBsc1JhdGVSZWZWYWx1ZS5zdWJzdHJpbmcobHNSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsbHNSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKVxuXHRcdFx0fVxuXG5cdFx0XHRpZigobHNBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscyhcIkJPVEhcIikgfHwgbHNBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscyhcIkNVU1RPTUVSXCIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwidHJ1ZVwiKSl7XG5cdFx0XHRcdC8vZ2V0IFwiVE9UQUxfQU1PVU5UX0NVU1RPTUVSXCIgZm9yIHRoYXQgY29tcG9uZW50XG5cdFx0XHRcdGRlZiB0b3RDdXN0b21lciBcblx0XHRcdFx0aWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7XG5cdFx0XHRcdFx0dG90Q3VzdG9tZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRcdFx0XHR9XG5cdFx0XHRcdGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKFwiMC4wXCIpKXtcblx0XHRcdFx0XHR3YXJuaW5ncz10cnVlXG5cdFx0XHRcdFx0aXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5hZGQobHNSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSlcblx0XHRcdFx0XHRsb2cuZGVidWcgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyBcIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyOiBcIiArIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXJcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCB9ICAgIFxuXHR9XG5cbn1lbHNle1xuXHQvKkNvbnRhYmlsaXp6YXppb25lIG5vbiBhIGNvcnBvKi9cblx0bG9nLmRlYnVnIFwiQ29udGFiaWxpenphemlvbmUgTk9OIGEgY29ycG9cIlxuXG5cdC8vT1BBQV9SRVBMQUNFRF9NQVRFUklBTFNcblx0aWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpICE9IFwiXCIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKS50b1N0cmluZygpLmVxdWFscyhcIlwiKSl7XG5cdFx0Ly9sb2cuZGVidWcgXCJNYXRlcmlhbGk6IFwiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpXG5cdFx0LypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovXG5cdFx0Ly9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzXG5cdFx0Q2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlXCIpOyAgXG5cdFx0Q2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcyhcImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVcIik7XG5cdFx0ZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTtcblx0XHRkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTtcblxuXHRcdGRlZiByZXBNYXRMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpXG5cblx0XHRmb3IobWF0IGluIHJlcE1hdExpc3Qpe1xuXHRcdFx0Ly9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0XG5cdFx0XHRkZWYgY29tcG9uZW50PW1hdC50b1N0cmluZygpXG5cdFx0XHQvL2RlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgZGVmIGNvbXBvbmVudEtleSA9IGNvbXBvbmVudC5zdWJzdHJpbmcoY29tcG9uZW50LmluZGV4T2YoJygnK09QQUEpKzEsY29tcG9uZW50Lmxlbmd0aCgpLTEpXG5cdFx0XHRkZWYgY29tcG9uZW50T2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGNvbXBvbmVudEtleSlcblx0XHRcdC8vZ2V0IFwiQVBQTElFRF9UT1wiIGZvciB0aGF0IGNvbXBvbmVudFxuXHRcdFx0ZGVmIGFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdFxuXHRcdFx0ZGVmIGFwcGxpZWRUb1ZhbHVlXG5cdFx0XHRpZihhcHBsaWVkVG8uc2l6ZSgpID4gMCl7XG5cdFx0XHRcdGFwcGxpZWRUbyA9IGFwcGxpZWRUby50b1N0cmluZygpXG5cdFx0XHRcdGFwcGxpZWRUb1ZhbHVlID0gYXBwbGllZFRvLnN1YnN0cmluZyhhcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsYXBwbGllZFRvLmluZGV4T2YoJyknKSlcblx0XHRcdFx0Ly9sb2cuZGVidWcgXCJhcHBsaWVkVG9WYWx1ZTogXCIgKyBhcHBsaWVkVG9WYWx1ZVxuXHRcdFx0fVxuICAgICAgICAgICAgLy9nZXQgXCJERUxFVEVEXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgZGVmIGRlbGV0ZWRcbiAgICAgICAgICAgIGRlZiBkZWxldGVkVmFsdWVcbiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICBsb2cuZGVidWcgXCJkZWxldGVkOiBcIiArIGRlbGV0ZWRcbiAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZCl7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXHRcdFx0XG5cdFx0XHRkZWYgbWF0TnVtYmVyXG5cdFx0XHRkZWYgbWF0TnVtYmVyS2V5XG5cdFx0XHRkZWYgbWF0TnVtYmVyVmFsdWVcblx0XHRcdGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKSl7XG5cdFx0XHRcdG1hdE51bWJlciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0XG5cdFx0XHRcdGlmKG1hdE51bWJlci5zaXplKCkgPiAwKXtcblx0XHRcdFx0XHRtYXROdW1iZXIgPSBtYXROdW1iZXIudG9TdHJpbmcoKVxuXHRcdFx0XHRcdG1hdE51bWJlcktleSA9IG1hdE51bWJlci5zdWJzdHJpbmcobWF0TnVtYmVyLmluZGV4T2YoJygnKSsxLG1hdE51bWJlci5pbmRleE9mKCcpJykpXG5cdFx0XHRcdFx0ZGVmIG1hdE51bWJlck9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihEQk9iamVjdHMgKyBtYXROdW1iZXJLZXkpXG5cdFx0XHRcdFx0bWF0TnVtYmVyVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obWF0TnVtYmVyT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoubWF0ZXJpYWwubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG5cdFx0XHRcdFx0bWF0TnVtYmVyVmFsdWUgPSBtYXROdW1iZXJWYWx1ZS5zdWJzdHJpbmcobWF0TnVtYmVyVmFsdWUuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyVmFsdWUuaW5kZXhPZignKScpKVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGRlZiBzZXJpYWxOdW1iZXJcblx0XHRcdGRlZiBzZXJpYWxOdW1iZXJWYWx1ZVxuXHRcdFx0aWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zZXJpYWxOdW1iZXInXS50b1N0cmluZygpKSl7XG5cdFx0XHRcdHNlcmlhbE51bWJlciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdFxuXHRcdFx0XHRpZihzZXJpYWxOdW1iZXIuc2l6ZSgpID4gMCl7XG5cdFx0XHRcdFx0c2VyaWFsTnVtYmVyID0gc2VyaWFsTnVtYmVyLnRvU3RyaW5nKClcblx0XHRcdFx0XHRzZXJpYWxOdW1iZXJWYWx1ZSA9IHNlcmlhbE51bWJlci5zdWJzdHJpbmcoc2VyaWFsTnVtYmVyLmluZGV4T2YoJygnKSsxLHNlcmlhbE51bWJlci5pbmRleE9mKCcpJykpXG5cdFx0XHRcdH0gIFxuXHRcdFx0fVx0XHRcdFx0XG5cblx0XHRcdGlmKChhcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscyhcIkJPVEhcIikgfHwgYXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJDVVNUT01FUlwiKSkgJiYgIWRlbGV0ZWRWYWx1ZS50b1N0cmluZygpLmVxdWFscyhcInRydWVcIikpe1xuXHRcdFx0XHQvL2dldCBcIlRPVEFMX0FNT1VOVF9DVVNUT01FUlwiIGZvciB0aGF0IGNvbXBvbmVudFxuXHRcdFx0XHRkZWYgdG90Q3VzdG9tZXIgXG5cdFx0XHRcdGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpKXtcblx0XHRcdFx0XHR0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRcdFx0XHR9XG5cdFx0XHRcdGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKFwiMC4wXCIpKXtcblx0XHRcdFx0XHR3YXJuaW5ncz10cnVlXG5cdFx0XHRcdFx0aXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLmFkZChtYXROdW1iZXJWYWx1ZS50b1N0cmluZygpICsgKCFzZXJpYWxOdW1iZXIudG9TdHJpbmcoKS5lcXVhbHMoXCJbXVwiKSA/IFwiIChcIiArIHNlcmlhbE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyBcIilcIiA6IFwiICgpXCIpKSAgIFxuXHRcdFx0XHRcdGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArIFwiIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lcjogXCIgKyBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXJcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCB9ICAgIFxuXHR9ICBcblxuXHQvL09QQUFfVU5BVEFOVFVNX1JBVEVTXG5cdGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykgIT0gXCJcIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoXCJcIikpe1xuXHRcdGxvZy5kZWJ1ZyBcIlVuYSB0YW50dW0gcmF0ZXM6IFwiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcylcblx0XHQvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi9cblx0XHQvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHNcblx0XHRDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoXCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGVcIik7ICBcblx0XHRDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZVwiKTtcblx0XHRkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpO1xuXHRcdGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpO1xuXG5cdFx0ZGVmIHVtUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcylcblxuXHRcdGZvcih1bSBpbiB1bVJhdGVzTGlzdCl7XG5cdFx0XHQvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3Rcblx0XHRcdGRlZiB1bVJhdGU9dW0udG9TdHJpbmcoKVxuXHRcdFx0ZGVmIHVtUmF0ZUtleSA9IHVtUmF0ZS5zdWJzdHJpbmcodW1SYXRlLmluZGV4T2YoJygnKSsxLHVtUmF0ZS5pbmRleE9mKCcpJykpXG5cdFx0XHRkZWYgdW1SYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHVtUmF0ZUtleSlcblx0XHRcdC8vZ2V0IFwiQVBQTElFRF9UT1wiIGZvciB0aGF0IHJhdGVcblx0XHRcdGRlZiB1bUFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG5cdFx0XHRkZWYgdW1BcHBsaWVkVG9WYWx1ZSA9IHVtQXBwbGllZFRvLnN1YnN0cmluZyh1bUFwcGxpZWRUby5pbmRleE9mKCcoJykrMSx1bUFwcGxpZWRUby5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vZ2V0IFwiREVMRVRFRFwiIGZvciB0aGF0IHJhdGVcblx0XHRcdGRlZiBkZWxldGVkXG4gICAgICAgICAgICBkZWYgZGVsZXRlZFZhbHVlXG4gICAgICAgICAgICBpZiAob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnIFwiZGVsZXRlZDogXCIgKyBkZWxldGVkXG4gICAgICAgICAgICAgICAgaWYgKGRlbGV0ZWQpe1xuICAgICAgICAgICAgICAgICAgICBkZWxldGVkVmFsdWUgPSBkZWxldGVkLnN1YnN0cmluZyhkZWxldGVkLmluZGV4T2YoJygnKSsxLGRlbGV0ZWQuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuXHRcdFx0ZGVmIHVtUmF0ZVJlZlxuXHRcdFx0aWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpKXtcblx0XHRcdFx0dW1SYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRkZWYgdW1SYXRlUmVmS2V5XG5cdFx0XHRkZWYgdW1SYXRlUmVmVmFsdWVcblx0XHRcdGlmKHVtUmF0ZVJlZil7XG5cdFx0XHRcdHVtUmF0ZVJlZiA9IHVtUmF0ZVJlZi50b1N0cmluZygpXG5cdFx0XHRcdHVtUmF0ZVJlZktleSA9IHVtUmF0ZVJlZi5zdWJzdHJpbmcodW1SYXRlUmVmLmluZGV4T2YoJygnKSsxLHVtUmF0ZVJlZi5pbmRleE9mKCcpJykpXG5cdFx0XHRcdGRlZiB1bVJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIHVtUmF0ZVJlZktleSlcblx0XHRcdFx0dW1SYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5OYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcblx0XHRcdFx0dW1SYXRlUmVmVmFsdWUgPSB1bVJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcodW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZigodW1BcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscyhcIkJPVEhcIikgfHwgdW1BcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscyhcIkNVU1RPTUVSXCIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwidHJ1ZVwiKSl7XG5cdFx0XHRcdC8vZ2V0IFwiVE9UQUxfQU1PVU5UX0NVU1RPTUVSXCIgZm9yIHRoYXQgY29tcG9uZW50XG5cdFx0XHRcdGRlZiB0b3RDdXN0b21lclxuXHRcdFx0XHRpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpKXtcblx0XHRcdFx0XHR0b3RDdXN0b21lcj1vYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRcdFx0XHR9XG5cdFx0XHRcdGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKFwiMC4wXCIpKXtcblx0XHRcdFx0XHR3YXJuaW5ncz10cnVlXG5cdFx0XHRcdFx0aXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5hZGQodW1SYXRlUmVmVmFsdWUudG9TdHJpbmcoKSlcblx0XHRcdFx0XHRsb2cuZGVidWcgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyBcIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyOiBcIiArIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXJcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdCB9ICAgIFxuXHR9XG5cblx0Ly9PUEFBX0xBQk9VUl9SQVRFU1xuXHRpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpICE9IFwiXCIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKFwiXCIpKXtcblx0XHRsb2cuZGVidWcgXCJMYWJvdXIgcmF0ZXM6IFwiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcylcblx0XHQvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi9cblx0XHQvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHNcblx0XHRDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoXCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGVcIik7ICBcblx0XHRDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZVwiKTtcblx0XHRkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpO1xuXHRcdGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpO1xuXG5cdFx0ZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpXG5cblx0XHRmb3IobGIgaW4gbGFib3VyUmF0ZXNMaXN0KXtcblx0XHRcdC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdFxuXHRcdFx0ZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpXG5cdFx0XHRkZWYgbGJSYXRlS2V5ID0gbGJSYXRlLnN1YnN0cmluZyhsYlJhdGUuaW5kZXhPZignKCcpKzEsbGJSYXRlLmluZGV4T2YoJyknKSlcblx0XHRcdGRlZiBsYlJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obGJSYXRlS2V5KVxuXHRcdFx0Ly9nZXQgXCJBUFBMSUVEX1RPXCIgZm9yIHRoYXQgcmF0ZVxuXHRcdFx0ZGVmIGxiQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuXHRcdFx0ZGVmIGxiQXBwbGllZFRvVmFsdWUgPSBsYkFwcGxpZWRUby5zdWJzdHJpbmcobGJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsbGJBcHBsaWVkVG8uaW5kZXhPZignKScpKVxuICAgICAgICAgICAgLy9nZXQgXCJERUxFVEVEXCIgZm9yIHRoYXQgcmF0ZVxuXHRcdFx0ZGVmIGRlbGV0ZWRcbiAgICAgICAgICAgIGRlZiBkZWxldGVkVmFsdWVcbiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICBsb2cuZGVidWcgXCJkZWxldGVkOiBcIiArIGRlbGV0ZWRcbiAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZCl7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG5cdFx0XHRkZWYgbGJSYXRlUmVmXG5cdFx0XHRpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkpe1xuXHRcdFx0XHRsYlJhdGVSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGRlZiB0ZWNoUmVmXG4gICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkpe1xuICAgICAgICAgICAgICAgIHRlY2hSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudGVjaG5pY2lhblJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG4gICAgICAgICAgICB9XG5cdFx0XHRcbiAgICAgICAgICAgIGRlZiBsYlJhdGVSZWZLZXlcbiAgICAgICAgICAgIGRlZiBsYlJhdGVSZWZWYWx1ZVxuICAgICAgICAgICAgaWYobGJSYXRlUmVmICYmIGxiUmF0ZVJlZi5zaXplKCkgPiAwKXtcbiAgICAgICAgICAgICAgICBsYlJhdGVSZWYgPSBsYlJhdGVSZWYudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIGxiUmF0ZVJlZktleSA9IGxiUmF0ZVJlZi5zdWJzdHJpbmcobGJSYXRlUmVmLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZi5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgbGJSYXRlUmVmS2V5KVxuICAgICAgICAgICAgICAgIGxiUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnJhdGUuTmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgbGJSYXRlUmVmVmFsdWUgPSBsYlJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcobGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgfVxuXHRcdFx0XG5cdFx0XHRkZWYgdGVjaFJlZktleVxuICAgICAgICAgICAgZGVmIHRlY2hSZWZWYWx1ZVxuICAgICAgICAgICAgaWYodGVjaFJlZil7XG4gICAgICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBcInRlY2hSZWY6IFwiICsgdGVjaFJlZlxuICAgICAgICAgICAgICAgIHRlY2hSZWZLZXkgPSB0ZWNoUmVmLnN1YnN0cmluZyh0ZWNoUmVmLmluZGV4T2YoJygnKSsxLHRlY2hSZWYuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgIGRlZiB0ZWNoUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB0ZWNoUmVmS2V5KVxuICAgICAgICAgICAgICAgIHRlY2hSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0ZWNoUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoudGVjaG5pY2lhbi5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICBpZih0ZWNoUmVmVmFsdWUpe1xuICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmVmFsdWUgPSB0ZWNoUmVmVmFsdWUuc3Vic3RyaW5nKHRlY2hSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx0ZWNoUmVmVmFsdWUuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblx0XHRcdFxuXHRcdFx0aWYoKGxiQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJCT1RIXCIpIHx8IGxiQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJDVVNUT01FUlwiKSkgJiYgIWRlbGV0ZWRWYWx1ZS50b1N0cmluZygpLmVxdWFscyhcInRydWVcIikpe1xuXHRcdFx0XHQvL2dldCBcIlRPVEFMX0FNT1VOVF9DVVNUT01FUlwiIGZvciB0aGF0IGNvbXBvbmVudFxuXHRcdFx0XHRkZWYgdG90Q3VzdG9tZXJcblx0XHRcdFx0aWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7XG5cdFx0XHRcdFx0dG90Q3VzdG9tZXI9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcblx0XHRcdFx0fVxuXHRcdFx0XHRpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscyhcIjAuMFwiKSl7XG5cdFx0XHRcdFx0d2FybmluZ3M9dHJ1ZVxuXHRcdFx0XHRcdGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKGxiUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpXG5cdFx0XHRcdFx0bG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgXCIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogXCIgKyBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyXG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQgfSAgICBcblx0fVxuXG5cdC8vT1BBQV9UUkFWRUxfUkFURVNcblx0aWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKSAhPSBcIlwiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKS50b1N0cmluZygpLmVxdWFscyhcIlwiKSl7XG5cdFx0bG9nLmRlYnVnIFwiVHJhdmVsIHJhdGVzOiBcIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpXG5cdFx0LypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovXG5cdFx0Ly9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzXG5cdFx0Q2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlXCIpOyAgXG5cdFx0Q2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcyhcImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVcIik7XG5cdFx0ZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTtcblx0XHRkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTtcblxuXHRcdGRlZiB0cmF2ZWxSYXRlc0xpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKVxuXG5cdFx0Zm9yKHRyIGluIHRyYXZlbFJhdGVzTGlzdCl7XG5cdFx0XHQvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3Rcblx0XHRcdGRlZiB0clJhdGU9dHIudG9TdHJpbmcoKVxuXHRcdFx0ZGVmIHRyUmF0ZUtleSA9IHRyUmF0ZS5zdWJzdHJpbmcodHJSYXRlLmluZGV4T2YoJygnKSsxLHRyUmF0ZS5pbmRleE9mKCcpJykpXG5cdFx0XHRkZWYgdHJSYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHRyUmF0ZUtleSlcblx0XHRcdC8vZ2V0IFwiQVBQTElFRF9UT1wiIGZvciB0aGF0IHJhdGVcbiAgICAgICAgICAgIGRlZiB0ckFwcGxpZWRUb1xuICAgICAgICAgICAgZGVmIHRyQXBwbGllZFRvVmFsdWVcbiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5jb21wb25lbnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkpe1xuICAgICAgICAgICAgICAgIHRyQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIHRyQXBwbGllZFRvVmFsdWUgPSB0ckFwcGxpZWRUby5zdWJzdHJpbmcodHJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsdHJBcHBsaWVkVG8uaW5kZXhPZignKScpKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9nZXQgXCJERUxFVEVEXCIgZm9yIHRoYXQgcmF0ZVxuXHRcdFx0ZGVmIGRlbGV0ZWRcbiAgICAgICAgICAgIGRlZiBkZWxldGVkVmFsdWVcbiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgZGVsZXRlZCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBcImRlbGV0ZWQ6IFwiICsgZGVsZXRlZFxuICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZFZhbHVlID0gZGVsZXRlZC5zdWJzdHJpbmcoZGVsZXRlZC5pbmRleE9mKCcoJykrMSxkZWxldGVkLmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cblx0XHRcdGRlZiB0clJhdGVSZWZcblx0XHRcdGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKSl7XG5cdFx0XHRcdHRyUmF0ZVJlZj1vYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0ZGVmIHRyUmF0ZVJlZktleVxuXHRcdFx0ZGVmIHRyUmF0ZVJlZlZhbHVlXG5cdFx0XHRpZih0clJhdGVSZWYgIT0gbnVsbCAmJiB0clJhdGVSZWYuc2l6ZSgpID4gMCl7XG5cdFx0XHRcdHRyUmF0ZVJlZiA9IHRyUmF0ZVJlZi50b1N0cmluZygpXG5cdFx0XHRcdHRyUmF0ZVJlZktleSA9IHRyUmF0ZVJlZi5zdWJzdHJpbmcodHJSYXRlUmVmLmluZGV4T2YoJygnKSsxLHRyUmF0ZVJlZi5pbmRleE9mKCcpJykpXG5cdFx0XHRcdGRlZiB0clJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIHRyUmF0ZVJlZktleSlcblx0XHRcdFx0dHJSYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcblx0XHRcdFx0dHJSYXRlUmVmVmFsdWUgPSB0clJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcodHJSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdHJSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKVxuXHRcdFx0fVxuXG5cdFx0XHRpZih0ckFwcGxpZWRUb1ZhbHVlICE9IG51bGwgJiYgIWRlbGV0ZWRWYWx1ZS50b1N0cmluZygpLmVxdWFscyhcInRydWVcIikgJiYgKHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJCT1RIXCIpIHx8IHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJDVVNUT01FUlwiKSkpe1xuXHRcdFx0XHQvL2dldCBcIlRPVEFMX0FNT1VOVF9DVVNUT01FUlwiIGZvciB0aGF0IGNvbXBvbmVudFxuXHRcdFx0XHRkZWYgdG90Q3VzdG9tZXJcblx0XHRcdFx0aWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7XG5cdFx0XHRcdFx0dG90Q3VzdG9tZXI9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcblx0XHRcdFx0fVxuXHRcdFx0XHRpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscyhcIjAuMFwiKSl7XG5cdFx0XHRcdFx0d2FybmluZ3M9dHJ1ZVxuXHRcdFx0XHRcdGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKHRyUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpXG5cdFx0XHRcdFx0bG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgXCIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogXCIgKyBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyXG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQgfSAgICBcblx0fVxuXG59XG5cbmRlZiBsaW5rZWRUaWNrZXRzPW5ldyBBcnJheUxpc3QoKVxuXG4vKk9QLTEwMzg6IHZlcmlmaWNhIHRpY2tldCBjb2xsZWdhdGkgLSAgZSBzdSBjaWFzY3VubyB2ZXJpZmljYSBjYW1waSBvYmJsaWdhdG9yaSovXG5MaXN0PElzc3VlTGluaz4gYWxsSW5Jc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0SW53YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSlcbmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHtcbiAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpO1xuXG4gICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpe1xuICAgICAgICByZWxhdGVzSW5Jc3N1ZUxpbms9dHJ1ZVxuICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkpXG4gICAgICAgIGxvZy5kZWJ1ZyBcIklzc3VlIGNvbiByZWxhdGVzSW5Jc3N1ZUxpbmtcIlxuICAgIH1cbn1cbkxpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpXG5mb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxPdXRJc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykge1xuICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7XG5cbiAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7XG4gICAgICAgIHJlbGF0ZXNPdXRJc3N1ZUxpbms9dHJ1ZVxuICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKSlcbiAgICAgICAgbG9nLmRlYnVnIFwiSXNzdWUgY29uIHJlbGF0ZXNPdXRJc3N1ZUxpbmtcIlxuICAgIH1cbn1cblxuLypBcnJheSB3YXJuaW5ncyBlZCBlcnJvcnMgcGVyIGxlIGlzc3VlIGxpbmthdGUsIHVubyBwZXIgb2duaSB0aXBvbG9naWEgZGkgZXJyb3JlIG8gd2FybmluZyovXG5kZWYgd2FybmluZ3NNYXRMaW5rZWRJc3N1ZXMgPSBuZXcgQXJyYXlMaXN0KClcbmRlZiB3YXJuaW5nc1JhdGVMaW5rZWRJc3N1ZXMgPSBuZXcgQXJyYXlMaXN0KClcbi8vZGVmIGVycm9yc0xpbmtlZElzc3VlcyA9IG5ldyBBcnJheUxpc3QoKVxuXG5mb3IoaSBpbiBsaW5rZWRUaWNrZXRzKXtcbiAgICBpc3N1ZT1pIGFzIElzc3VlXG5cbiAgICAvKkFycmF5IHdhcm5pbmdzIGVkIGVycm9ycyBwZXIgbGEgc2luZ29sYSBpc3N1ZSBsaW5rYXRhLCB1bm8gcGVyIG9nbmkgdGlwb2xvZ2lhIGRpIGVycm9yZSBvIHdhcm5pbmcqL1xuICAgIGRlZiB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lciA9IG5ldyBBcnJheUxpc3QoKVxuICAgIGRlZiB3YXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpIFxuICAgIC8vZGVmIGVycm9yLi4uXG4gICAgXG4gICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUHJpY2UpIT1udWxsICYmIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVByaWNlKS50b1N0cmluZygpLmVxdWFscyhcIlllc1wiKSl7XG4gICAgICAgIC8qQ29udGFiaWxpenphemlvbmUgYSBjb3JwbyovXG4gICAgICAgIGxvZy5kZWJ1ZyBcIkNvbnRhYmlsaXp6YXppb25lIGEgY29ycG9cIlxuICAgICAgICAvL09QQUFfTFVNUF9TVU1fUkFURVNcbiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpICE9IFwiXCIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVJhdGVzKS50b1N0cmluZygpLmVxdWFscyhcIlwiKSl7XG4gICAgICAgICAgICAvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi9cbiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50c1xuICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlXCIpOyAgXG4gICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZVwiKTtcbiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7XG4gICAgICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTtcblxuICAgICAgICAgICAgZGVmIGxzUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpXG5cbiAgICAgICAgICAgIGZvcihscyBpbiBsc1JhdGVzTGlzdCl7XG4gICAgICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0XG4gICAgICAgICAgICAgICAgZGVmIGxzUmF0ZT1scy50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgZGVmIGxzUmF0ZUtleSA9IGxzUmF0ZS5zdWJzdHJpbmcobHNSYXRlLmluZGV4T2YoJygnKSsxLGxzUmF0ZS5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgZGVmIGxzUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihsc1JhdGVLZXkpXG4gICAgICAgICAgICAgICAgLy9nZXQgXCJBUFBMSUVEX1RPXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgICAgIGRlZiBsc0FwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgZGVmIGxzQXBwbGllZFRvVmFsdWVcbiAgICAgICAgICAgICAgICBpZiAobHNBcHBsaWVkVG8pe1xuICAgICAgICAgICAgICAgICAgICBsc0FwcGxpZWRUb1ZhbHVlID0gbHNBcHBsaWVkVG8uc3Vic3RyaW5nKGxzQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLGxzQXBwbGllZFRvLmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy9nZXQgXCJERUxFVEVEXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgICAgIGRlZiBkZWxldGVkXG4gICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZVxuICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZWQgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIFwiZGVsZXRlZDogXCIgKyBkZWxldGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBkZWYgbHNSYXRlUmVmID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG5cbiAgICAgICAgICAgICAgICBkZWYgbHNSYXRlUmVmS2V5XG4gICAgICAgICAgICAgICAgZGVmIGxzUmF0ZVJlZlZhbHVlXG4gICAgICAgICAgICAgICAgaWYobHNSYXRlUmVmLnNpemUoKSA+IDApe1xuICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWYgPSBsc1JhdGVSZWYudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWZLZXkgPSBsc1JhdGVSZWYuc3Vic3RyaW5nKGxzUmF0ZVJlZi5pbmRleE9mKCcoJykrMSxsc1JhdGVSZWYuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgICAgICBkZWYgbHNSYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyBsc1JhdGVSZWZLZXkpXG4gICAgICAgICAgICAgICAgICAgIGxzUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnJhdGUubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgICAgIGxzUmF0ZVJlZlZhbHVlID0gbHNSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZigobHNBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscyhcIkJPVEhcIikgfHwgbHNBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscyhcIkNVU1RPTUVSXCIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwidHJ1ZVwiKSl7XG4gICAgICAgICAgICAgICAgICAgIC8vZ2V0IFwiVE9UQUxfQU1PVU5UX0NVU1RPTUVSXCIgZm9yIHRoYXQgY29tcG9uZW50XG4gICAgICAgICAgICAgICAgICAgIGRlZiB0b3RDdXN0b21lclxuICAgICAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgICAgICAgICAgICAgXHR0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoIXRvdEN1c3RvbWVyIHx8IHRvdEN1c3RvbWVyWzBdLmdldFZhbHVlKCkudG9TdHJpbmcoKS5lcXVhbHMoXCIwLjBcIikpe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZSAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZChsc1JhdGVSZWZWYWx1ZS50b1N0cmluZygpKVxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgXCIgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXI6IFwiICsgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gICAgXG4gICAgICAgIH1cblxuICAgIH1lbHNle1xuICAgICAgICAvKkNvbnRhYmlsaXp6YXppb25lIG5vbiBhIGNvcnBvKi9cbiAgICAgICAgbG9nLmRlYnVnIFwiQ29udGFiaWxpenphemlvbmUgTk9OIGEgY29ycG9cIlxuXG4gICAgICAgIC8vT1BBQV9SRVBMQUNFRF9NQVRFUklBTFNcbiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpICE9IFwiXCIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKS50b1N0cmluZygpLmVxdWFscyhcIlwiKSl7XG4gICAgICAgICAgICBsb2cuZGVidWcgXCJNYXRlcmlhbGk6IFwiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpXG4gICAgICAgICAgICAvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi9cbiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50c1xuICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlXCIpOyAgXG4gICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZVwiKTtcbiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7XG4gICAgICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTtcblxuICAgICAgICAgICAgZGVmIHJlcE1hdExpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscylcblxuICAgICAgICAgICAgZm9yKG1hdCBpbiByZXBNYXRMaXN0KXtcbiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3RcbiAgICAgICAgICAgICAgICBkZWYgY29tcG9uZW50PW1hdC50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgLy9kZWYgY29tcG9uZW50S2V5ID0gY29tcG9uZW50LnN1YnN0cmluZyhjb21wb25lbnQuaW5kZXhPZignKCcpKzEsY29tcG9uZW50LmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICBkZWYgY29tcG9uZW50S2V5ID0gY29tcG9uZW50LnN1YnN0cmluZyhjb21wb25lbnQuaW5kZXhPZignKCcrT1BBQSkrMSxjb21wb25lbnQubGVuZ3RoKCktMSlcbiAgICAgICAgICAgICAgICBkZWYgY29tcG9uZW50T2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGNvbXBvbmVudEtleSlcbiAgICAgICAgICAgICAgICAvL2dldCBcIkFQUExJRURfVE9cIiBmb3IgdGhhdCBjb21wb25lbnRcbiAgICAgICAgICAgICAgICBkZWYgYXBwbGllZFRvXG4gICAgICAgICAgICAgICAgZGVmIGFwcGxpZWRUb1ZhbHVlXG4gICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgICAgIGFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdFxuICAgICAgICAgICAgICAgICAgICBpZihhcHBsaWVkVG8uc2l6ZSgpID4gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWVkVG8gPSBhcHBsaWVkVG8udG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbGllZFRvVmFsdWUgPSBhcHBsaWVkVG8uc3Vic3RyaW5nKGFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxhcHBsaWVkVG8uaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIFwiYXBwbGllZFRvVmFsdWU6IFwiICsgYXBwbGllZFRvVmFsdWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL2dldCBcIkRFTEVURURcIiBmb3IgdGhhdCByYXRlXG4gICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWRcbiAgICAgICAgICAgICAgICBkZWYgZGVsZXRlZFZhbHVlXG4gICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkpe1xuICAgICAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIFwiZGVsZXRlZDogXCIgKyBkZWxldGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZGVmIG1hdE51bWJlclxuICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJLZXlcbiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyVmFsdWVcbiAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkpe1xuICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdFxuICAgICAgICAgICAgICAgICAgICBpZihtYXROdW1iZXIuc2l6ZSgpID4gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXIgPSBtYXROdW1iZXIudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyS2V5ID0gbWF0TnVtYmVyLnN1YnN0cmluZyhtYXROdW1iZXIuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyLmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oREJPYmplY3RzICsgbWF0TnVtYmVyS2V5KVxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obWF0TnVtYmVyT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoubWF0ZXJpYWwubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG1hdE51bWJlclZhbHVlLnN1YnN0cmluZyhtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcoJykrMSxtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBkZWYgc2VyaWFsTnVtYmVyXG4gICAgICAgICAgICAgICAgZGVmIHNlcmlhbE51bWJlclZhbHVlXG4gICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zZXJpYWxOdW1iZXInXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdFxuICAgICAgICAgICAgICAgICAgICBpZihzZXJpYWxOdW1iZXIuc2l6ZSgpID4gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXIgPSBzZXJpYWxOdW1iZXIudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyVmFsdWUgPSBzZXJpYWxOdW1iZXIuc3Vic3RyaW5nKHNlcmlhbE51bWJlci5pbmRleE9mKCcoJykrMSxzZXJpYWxOdW1iZXIuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoYXBwbGllZFRvVmFsdWUgJiYgIWRlbGV0ZWRWYWx1ZS50b1N0cmluZygpLmVxdWFscyhcInRydWVcIikgJiYgKGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwiQk9USFwiKSB8fCBhcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscyhcIkNVU1RPTUVSXCIpKSl7XG4gICAgICAgICAgICAgICAgICAgIC8vZ2V0IFwiVE9UQUxfQU1PVU5UX0NVU1RPTUVSXCIgZm9yIHRoYXQgY29tcG9uZW50XG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBcIkFwcGxpZWRUbyB2ZXJpZmljYXRvID0+IFwiICsgb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RDdXN0J10udG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyIFxuICAgICAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgICAgIFx0dG90Q3VzdG9tZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscyhcIjAuMFwiKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLmFkZChtYXROdW1iZXJWYWx1ZS50b1N0cmluZygpICsgKCFzZXJpYWxOdW1iZXIudG9TdHJpbmcoKS5lcXVhbHMoXCJbXVwiKSA/IFwiIChcIiArIHNlcmlhbE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyBcIilcIiA6IFwiICgpXCIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgXCIgd2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lcjogXCIrIHdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gICAgXG4gICAgICAgIH0gIFxuXG4gICAgICAgIC8vT1BBQV9VTkFUQU5UVU1fUkFURVNcbiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKSAhPSBcIlwiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKS50b1N0cmluZygpLmVxdWFscyhcIlwiKSl7XG4gICAgICAgICAgICBsb2cuZGVidWcgXCJVbmEgdGFudHVtIHJhdGVzOiBcIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpXG4gICAgICAgICAgICAvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi9cbiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50c1xuICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlXCIpOyAgXG4gICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZVwiKTtcbiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7XG4gICAgICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTtcblxuICAgICAgICAgICAgZGVmIHVtUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcylcblxuICAgICAgICAgICAgZm9yKHVtIGluIHVtUmF0ZXNMaXN0KXtcbiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3RcbiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlPXVtLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlS2V5ID0gdW1SYXRlLnN1YnN0cmluZyh1bVJhdGUuaW5kZXhPZignKCcpKzEsdW1SYXRlLmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHVtUmF0ZUtleSlcbiAgICAgICAgICAgICAgICAvL2dldCBcIkFQUExJRURfVE9cIiBmb3IgdGhhdCByYXRlXG4gICAgICAgICAgICAgICAgZGVmIHVtQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICBkZWYgdW1BcHBsaWVkVG9WYWx1ZSA9IHVtQXBwbGllZFRvLnN1YnN0cmluZyh1bUFwcGxpZWRUby5pbmRleE9mKCcoJykrMSx1bUFwcGxpZWRUby5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy9nZXQgXCJERUxFVEVEXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgICAgIGRlZiBkZWxldGVkXG4gICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZVxuICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZWQgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIFwiZGVsZXRlZDogXCIgKyBkZWxldGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmXG4gICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZLZXlcbiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmVmFsdWVcbiAgICAgICAgICAgICAgICBpZih1bVJhdGVSZWYpe1xuICAgICAgICAgICAgICAgICAgICB1bVJhdGVSZWYgPSB1bVJhdGVSZWYudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICB1bVJhdGVSZWZLZXkgPSB1bVJhdGVSZWYuc3Vic3RyaW5nKHVtUmF0ZVJlZi5pbmRleE9mKCcoJykrMSx1bVJhdGVSZWYuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB1bVJhdGVSZWZLZXkpXG4gICAgICAgICAgICAgICAgICAgIHVtUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBcIk5hbWVcIikuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmVmFsdWUgPSB1bVJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcodW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKCh1bUFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwiQk9USFwiKSB8fCB1bUFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwiQ1VTVE9NRVJcIikpICYmICFkZWxldGVkVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJ0cnVlXCIpKXtcbiAgICAgICAgICAgICAgICAgICAgLy9nZXQgXCJUT1RBTF9BTU9VTlRfQ1VTVE9NRVJcIiBmb3IgdGhhdCBjb21wb25lbnRcbiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyIFxuICAgICAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdEN1c3RvbWVyPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoIXRvdEN1c3RvbWVyIHx8IHRvdEN1c3RvbWVyWzBdLmdldFZhbHVlKCkudG9TdHJpbmcoKS5lcXVhbHMoXCIwLjBcIikpe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKHVtUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyBcIiB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogXCIgKyB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lclxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIC8vT1BBQV9MQUJPVVJfUkFURVNcbiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSAhPSBcIlwiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKS50b1N0cmluZygpLmVxdWFscyhcIlwiKSl7XG4gICAgICAgICAgICBsb2cuZGVidWcgXCJMYWJvdXIgcmF0ZXM6IFwiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcylcbiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qL1xuICAgICAgICAgICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzXG4gICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoXCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGVcIik7ICBcbiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoXCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlXCIpO1xuICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTtcbiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpO1xuXG4gICAgICAgICAgICBkZWYgbGFib3VyUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcylcblxuICAgICAgICAgICAgZm9yKGxiIGluIGxhYm91clJhdGVzTGlzdCl7XG4gICAgICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0XG4gICAgICAgICAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgZGVmIGxiUmF0ZUtleSA9IGxiUmF0ZS5zdWJzdHJpbmcobGJSYXRlLmluZGV4T2YoJygnKSsxLGxiUmF0ZS5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgZGVmIGxiUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihsYlJhdGVLZXkpXG4gICAgICAgICAgICAgICAgLy9nZXQgXCJBUFBMSUVEX1RPXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgICAgIGRlZiBsYkFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgZGVmIGxiQXBwbGllZFRvVmFsdWUgPSBsYkFwcGxpZWRUby5zdWJzdHJpbmcobGJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsbGJBcHBsaWVkVG8uaW5kZXhPZignKScpKVxuXG4gICAgICAgICAgICAgICAgLy9nZXQgXCJERUxFVEVEXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgICAgIGRlZiBkZWxldGVkXG4gICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZVxuICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZWQgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIFwiZGVsZXRlZDogXCIgKyBkZWxldGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuXG4gICAgICAgICAgICAgICAgZGVmIHRlY2hSZWZcbiAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkpe1xuICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRlY2huaWNpYW5SZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGRlZiBsYlJhdGVSZWZLZXlcbiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlUmVmVmFsdWVcbiAgICAgICAgICAgICAgICBpZihsYlJhdGVSZWYuc2l6ZSgpID4gMCl7XG4gICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZiA9IGxiUmF0ZVJlZi50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZktleSA9IGxiUmF0ZVJlZi5zdWJzdHJpbmcobGJSYXRlUmVmLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZi5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgICAgIGRlZiBsYlJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIGxiUmF0ZVJlZktleSlcbiAgICAgICAgICAgICAgICAgICAgbGJSYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgbGJSYXRlUmVmVmFsdWUgPSBsYlJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcobGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGRlZiB0ZWNoUmVmS2V5XG4gICAgICAgICAgICAgICAgZGVmIHRlY2hSZWZWYWx1ZVxuICAgICAgICAgICAgICAgIGlmKHRlY2hSZWYpe1xuICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmID0gdGVjaFJlZi50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBcInRlY2hSZWY6IFwiICsgdGVjaFJlZlxuICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmS2V5ID0gdGVjaFJlZi5zdWJzdHJpbmcodGVjaFJlZi5pbmRleE9mKCcoJykrMSx0ZWNoUmVmLmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICAgICAgZGVmIHRlY2hSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIHRlY2hSZWZLZXkpXG4gICAgICAgICAgICAgICAgICAgIHRlY2hSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0ZWNoUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoudGVjaG5pY2lhbi5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gbGJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKHRlY2hSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx0ZWNoUmVmVmFsdWUuaW5kZXhPZignKScpKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKChsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwiQk9USFwiKSB8fCBsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwiQ1VTVE9NRVJcIikpICYmICFkZWxldGVkVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJ0cnVlXCIpKXtcbiAgICAgICAgICAgICAgICAgICAgLy9nZXQgXCJUT1RBTF9BTU9VTlRfQ1VTVE9NRVJcIiBmb3IgdGhhdCBjb21wb25lbnRcbiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyIFxuICAgICAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdEN1c3RvbWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscyhcIjAuMFwiKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5hZGQobGJSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSArIFwiIChcIiArIHRlY2hSZWZWYWx1ZS50b1N0cmluZygpICsgXCIpXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyBcIiB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogXCIgKyB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lclxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIC8vT1BBQV9UUkFWRUxfUkFURVNcbiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKSAhPSBcIlwiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKS50b1N0cmluZygpLmVxdWFscyhcIlwiKSl7XG4gICAgICAgICAgICBsb2cuZGVidWcgXCJUcmF2ZWwgcmF0ZXM6IFwiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcylcbiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qL1xuICAgICAgICAgICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzXG4gICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoXCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGVcIik7ICBcbiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoXCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlXCIpO1xuICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTtcbiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpO1xuXG4gICAgICAgICAgICBkZWYgdHJhdmVsUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcylcblxuICAgICAgICAgICAgZm9yKHRyIGluIHRyYXZlbFJhdGVzTGlzdCl7XG4gICAgICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0XG4gICAgICAgICAgICAgICAgZGVmIHRyUmF0ZT10ci50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgZGVmIHRyUmF0ZUtleSA9IHRyUmF0ZS5zdWJzdHJpbmcodHJSYXRlLmluZGV4T2YoJygnKSsxLHRyUmF0ZS5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgZGVmIHRyUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbih0clJhdGVLZXkpXG4gICAgICAgICAgICAgICAgLy9nZXQgXCJBUFBMSUVEX1RPXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgICAgIGRlZiB0ckFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpXG4gICAgICAgICAgICAgICAgZGVmIHRyQXBwbGllZFRvVmFsdWUgPSB0ckFwcGxpZWRUby5zdWJzdHJpbmcodHJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsdHJBcHBsaWVkVG8uaW5kZXhPZignKScpKVxuXG4gICAgICAgICAgICAgICAgLy9nZXQgXCJERUxFVEVEXCIgZm9yIHRoYXQgcmF0ZVxuICAgICAgICAgICAgICAgIGRlZiBkZWxldGVkXG4gICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZVxuICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZWQgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIFwiZGVsZXRlZDogXCIgKyBkZWxldGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuXG4gICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZktleVxuICAgICAgICAgICAgICAgIGRlZiB0clJhdGVSZWZWYWx1ZVxuICAgICAgICAgICAgICAgIGlmKHRyUmF0ZVJlZi5zaXplKCkgPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgdHJSYXRlUmVmID0gdHJSYXRlUmVmLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgdHJSYXRlUmVmS2V5ID0gdHJSYXRlUmVmLnN1YnN0cmluZyh0clJhdGVSZWYuaW5kZXhPZignKCcpKzEsdHJSYXRlUmVmLmluZGV4T2YoJyknKSlcbiAgICAgICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdHJSYXRlUmVmS2V5KVxuICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWZWYWx1ZSA9IHRyUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyh0clJhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx0clJhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoKHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJCT1RIXCIpIHx8IHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoXCJDVVNUT01FUlwiKSkgJiYgIWRlbGV0ZWRWYWx1ZS50b1N0cmluZygpLmVxdWFscyhcInRydWVcIikpe1xuICAgICAgICAgICAgICAgICAgICAvL2dldCBcIlRPVEFMX0FNT1VOVF9DVVNUT01FUlwiIGZvciB0aGF0IGNvbXBvbmVudFxuICAgICAgICAgICAgICAgICAgICBkZWYgdG90Q3VzdG9tZXJcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RDdXN0b21lcj1vYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKFwiMC4wXCIpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZCh0clJhdGVSZWZWYWx1ZS50b1N0cmluZygpKVxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgXCIgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXI6IFwiICsgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gICAgXG4gICAgICAgIH1cblxuICAgIH1cbiAgICBcbiAgICAvKlZlcmlmaWNvIGxhIHByZXNlbnphIGRpIGVycm9yaSBlIHdhcm5pbmcgc3VsbGEgaXNzdWUgY29ycmVudGUgZSwgc2UgcHJlc2VudGksIGxpIGFnZ2l1bmdvIGFnbGkgYXJyYXkgZGVnbGkgZXJyb3JpIGUgd2FybmluZyBkZWxsZSBpc3N1ZSBsaW5rYXRlKi9cbiAgICBpZih3YXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLnNpemUoKT4wKXtcbiAgICAgICAgZGVmIG9iakxpc3QgPSBuZXcgQXJyYXlMaXN0KClcbiAgICAgICAgb2JqTGlzdC5hZGQoaXNzdWUpXG4gICAgICAgIG9iakxpc3QuYWRkKHdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIpXG4gICAgICAgIHdhcm5pbmdzTWF0TGlua2VkSXNzdWVzLmFkZChvYmpMaXN0KVxuICAgIH1cbiAgICBcbiAgICBpZih3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5zaXplKCk+MCl7XG4gICAgICAgIGRlZiBvYmpMaXN0ID0gbmV3IEFycmF5TGlzdCgpXG4gICAgICAgIG9iakxpc3QuYWRkKGlzc3VlKVxuICAgICAgICBvYmpMaXN0LmFkZCh3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcilcbiAgICAgICAgd2FybmluZ3NSYXRlTGlua2VkSXNzdWVzLmFkZChvYmpMaXN0KVxuICAgIH1cbiAgICBcbiAgICAvL2lmKGVycm9ycy4uLilcbiAgICBcbn1cblxubG9nLmRlYnVnIFwid2FybmluZ3NNYXRMaW5rZWRJc3N1ZXM6IFwiICsgd2FybmluZ3NNYXRMaW5rZWRJc3N1ZXNcbmxvZy5kZWJ1ZyBcIndhcm5pbmdzUmF0ZUxpbmtlZElzc3VlczogXCIgKyB3YXJuaW5nc1JhdGVMaW5rZWRJc3N1ZXNcblxuZGVmIG91dHB1dCA9IG5ldyBBcnJheUxpc3QoKVxuXG5pZiAoIWVycm9ycyAmJiAhd2FybmluZ3Mpe1xuXHRyZXR1cm4gdHJ1ZVxufWVsc2V7XG5cdGlmKCFlcnJvcnMgJiYgd2FybmluZ3Mpe1xuXHRcdC8vU2UgY2kgc29ubyBzb2xvIHdhcm5pbmdzIHZlcmlmaWNvIHNlIGwndXRlbnRlIGhhIGdpXHUwMGUwIGRpY2hpYXJhdG8gZGkgdm9sZXIgcHJvc2VndWlyZSBjb211bnF1ZVxuXHRcdC8vIC0gdHJhbnNpdGlvbiBmaWVsZCBcIk9QQUFfQ0hFQ0tfQU5EX0NPTkZJUk1cIj1cIlllc1wiXG5cdFx0Ly8gLSBpbiBjYXNvIGNvbnRyYXJpbyBpbnZpbyBpIHdhcm5pbmcgYSBGRVxuXG5cdFx0bG9nLmRlYnVnIFwidHJhbnNpdGlvbkNoZWNrOiBcIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKVxuXHRcdC8vbG9nLmRlYnVnIFwicmVzdWx0OiBcIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKS50b1N0cmluZygpLmVxdWFscyhcIlllc1wiKVxuXHRcdGlmKHRyYW5zaXRpb25DaGVja1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKFwiWWVzXCIpKXtcblx0XHRcdGxvZy5kZWJ1ZyBcInJldHVybiB0cnVlIC0gdHJhbnNpdGlvbkNoZWNrID0gWWVzXCJcblx0XHRcdHJldHVybiB0cnVlXG5cdFx0fWVsc2V7XG5cdFx0XHRkZWYgd0xpc3QgPSBuZXcgQXJyYXlMaXN0KClcblxuXHRcdFx0aWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5zaXplKCkgPiAwKXtcblx0XHRcdFx0ZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZSA9IG5ldyBBcnJheUxpc3QoKVxuXHRcdFx0XHR3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKFwiV1wiKVxuXHRcdFx0XHR3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKFwiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9SQVRFU1wiKVxuXHRcdFx0XHR3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpXG5cdFx0XHRcdHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcilcblxuXHRcdFx0XHR3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlSYXRlKVxuXHRcdFx0fVxuXG5cdFx0XHRpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuc2l6ZSgpID4gMCl7XG5cdFx0XHRcdGRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpXG5cdFx0XHRcdHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKFwiV1wiKVxuXHRcdFx0XHR3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChcIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFXCIpXG5cdFx0XHRcdHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG51bGwpXG5cdFx0XHRcdHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lcilcblxuXHRcdFx0XHR3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSlcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYod2FybmluZ3NNYXRMaW5rZWRJc3N1ZXMuc2l6ZSgpID4gMCl7XG4gICAgICAgICAgICAgICAgZm9yKG9iaiBpbiB3YXJuaW5nc01hdExpbmtlZElzc3Vlcyl7XG4gICAgICAgICAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpXG4gICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKFwiV1wiKVxuICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChcIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFXCIpXG4gICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG9ialswXSlcbiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQob2JqWzFdKVxuXG4gICAgICAgICAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYod2FybmluZ3NSYXRlTGlua2VkSXNzdWVzLnNpemUoKSA+IDApe1xuICAgICAgICAgICAgICAgIGZvcihvYmogaW4gd2FybmluZ3NSYXRlTGlua2VkSXNzdWVzKXtcbiAgICAgICAgICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZSA9IG5ldyBBcnJheUxpc3QoKVxuICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKFwiV1wiKVxuICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKFwiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9SQVRFU1wiKVxuICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG9ialswXSlcbiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChvYmpbMV0pXG5cbiAgICAgICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5UmF0ZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cblx0XHRcdG91dHB1dC5hZGQod0xpc3QpXG4gICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7XCJXXCI6XCInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnXCJ9Jylcblx0XHRcdC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbihcIldcIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAgXG5cdFx0fVxuXG5cdH1cblx0aWYoZXJyb3JzICYmICF3YXJuaW5ncyl7XG5cdFx0ZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpXG5cblx0XHRvdXRwdXQuYWRkKGVMaXN0KVxuICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7XCJFXCI6XCInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnXCJ9Jylcblx0XHQvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oXCJFXCIsIG91dHB1dC50b1N0cmluZygpKSAgIFxuXHR9XG5cdGlmKGVycm9ycyAmJiB3YXJuaW5ncyl7XG5cdFx0ZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpXG5cdFx0ZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpXG5cblx0XHRpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLnNpemUoKSA+IDApe1xuXHRcdFx0ZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZSA9IG5ldyBBcnJheUxpc3QoKVxuXHRcdFx0d0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChcIldcIilcblx0XHRcdHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoXCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX1JBVEVTXCIpXG5cdFx0XHR3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpXG5cdFx0XHR3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIpXG5cblx0XHRcdHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eVJhdGUpXG5cdFx0fVxuXG5cdFx0aWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLnNpemUoKSA+IDApe1xuXHRcdFx0ZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUgPSBuZXcgQXJyYXlMaXN0KClcblx0XHRcdHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKFwiV1wiKVxuXHRcdFx0d0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoXCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URVwiKVxuXHRcdFx0d0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQobnVsbClcblx0XHRcdHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lcilcblxuXHRcdFx0d0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpXG5cdFx0fVxuXHRcdFxuXHRcdGlmKHdhcm5pbmdzTWF0TGlua2VkSXNzdWVzLnNpemUoKSA+IDApe1xuXHRcdFx0Zm9yKG9iaiBpbiB3YXJuaW5nc01hdExpbmtlZElzc3Vlcyl7XG5cdFx0XHRcdGRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpXG5cdFx0XHRcdHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKFwiV1wiKVxuXHRcdFx0XHR3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChcIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFXCIpXG5cdFx0XHRcdHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG9ialswXSlcblx0XHRcdFx0d0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQob2JqWzFdKVxuXG5cdFx0XHRcdHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRpZih3YXJuaW5nc1JhdGVMaW5rZWRJc3N1ZXMuc2l6ZSgpID4gMCl7XG5cdFx0XHRmb3Iob2JqIGluIHdhcm5pbmdzUmF0ZUxpbmtlZElzc3Vlcyl7XG5cdFx0XHRcdGRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KClcblx0XHRcdFx0d0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChcIldcIilcblx0XHRcdFx0d0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChcIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfUkFURVNcIilcblx0XHRcdFx0d0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChvYmpbMF0pXG5cdFx0XHRcdHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQob2JqWzFdKVxuXG5cdFx0XHRcdHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eVJhdGUpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0b3V0cHV0LmFkZChlTGlzdClcblx0XHRvdXRwdXQuYWRkKHdMaXN0KVxuICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7XCJXRVwiOlwiJyArIG91dHB1dC50b1N0cmluZygpICsgJ1wifScpXG5cdFx0Ly90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKFwiV0VcIiwgb3V0cHV0LnRvU3RyaW5nKCkpICBcblx0fVxufSIsInNjcmlwdFBhdGgiOm51bGwsInBhcmFtZXRlcnMiOnt9fQ==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluawoKaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuSW52YWxpZElucHV0RXhjZXB0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKIApJc3N1ZSBpc3N1ZSA9IGlzc3VlCi8vUGVyIHRlc3QgZGEgY29uc29sZQovL0lzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKLy9pc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiT1BVVC0xNDA2NSIpCgpkZWYgZXJyb3JzID0gZmFsc2UKZGVmIHdhcm5pbmdzID0gZmFsc2UKZGVmIHJlbGF0ZXNJbklzc3VlTGluaz1mYWxzZQpkZWYgcmVsYXRlc091dElzc3VlTGluaz1mYWxzZQpkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZUxpbmtlZCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgd0xpc3RDb25maXJtRW1wdHlSYXRlUXVvdGVMaW5rZWQgPSBuZXcgQXJyYXlMaXN0KCkKCmRlZiBsdW1wU3VtUHJpY2UgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmx1bXBTdW1QcmljZSddLnRvU3RyaW5nKCkpWzBdCgovKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgbm9uIGEgY29ycG8qLwpkZWYgcmVwTWF0ZXJpYWxzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5yZXBsYWNlZE1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdCmRlZiB1bmFUYW50dW1SYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YudW5hdGFudHVtUmF0ZXMnXS50b1N0cmluZygpKVswXQpkZWYgbGFib3VyUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmxhYm91clJhdGVzJ10udG9TdHJpbmcoKSlbMF0KZGVmIHRyYXZlbFJhdGVzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi50cmF2ZWxSYXRlcyddLnRvU3RyaW5nKCkpWzBdCgovKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgYSBjb3JwbyovCmRlZiBsdW1wU3VtUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmx1bXBTdW1SYXRlcyddLnRvU3RyaW5nKCkpWzBdCgovKkNvbmZlcm1hIHV0ZW50ZSBzdSB3YXJuaW5ncyovCmRlZiB0cmFuc2l0aW9uQ2hlY2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmNoZWNrQW5kQ29uZmlybSddLnRvU3RyaW5nKCkpWzBdCmRlZiB0cmFuc2l0aW9uQ2hlY2tWYWx1ZSA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKQoKLypJbnNpZ2h0IFNjaGVtYSBJRHMqLwpkZWYgREJPYmplY3RzID0gcHJvcGVydGllc1snaXNjaGVtYS5kYm8nXS50b1N0cmluZygpICsgIi0iCmRlZiBPUEFBID0gcHJvcGVydGllc1snaXNjaGVtYS5hYSddLnRvU3RyaW5nKCkgKyAiLSIKCi8qQXJyYXkgd2FybmluZ3MgZWQgZXJyb3JzIHBlciBsYSBpc3N1ZSBwcmluY2lwYWxlLCB1bm8gcGVyIG9nbmkgdGlwb2xvZ2lhIGRpIGVycm9yZSBvIHdhcm5pbmcqLwpkZWYgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCmRlZiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCi8vZGVmIGlzc3VlRXJyb3IuLi4KCi8qVmVyaWZpY2EgY2FtcGkgc3UgdGlja2V0IG9nZ2V0dG8gZGVsbGEgdHJhbnNhemlvbmUqLwppZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1QcmljZSkhPW51bGwgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUHJpY2UpLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CgkvKkNvbnRhYmlsaXp6YXppb25lIGEgY29ycG8qLwoJbG9nLmRlYnVnICJDb250YWJpbGl6emF6aW9uZSBhIGNvcnBvIgoJLy9PUEFBX0xVTVBfU1VNX1JBVEVTCglpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVJhdGVzKS50b1N0cmluZygpLmVxdWFscygiIikpewoJCS8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwoJCS8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwoJCUNsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKCQlDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CgkJZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKCQlkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCgkJZGVmIGxzUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpCgoJCWZvcihscyBpbiBsc1JhdGVzTGlzdCl7CgkJCS8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAoJCQlkZWYgbHNSYXRlPWxzLnRvU3RyaW5nKCkKCQkJZGVmIGxzUmF0ZUtleSA9IGxzUmF0ZS5zdWJzdHJpbmcobHNSYXRlLmluZGV4T2YoJygnKSsxLGxzUmF0ZS5pbmRleE9mKCcpJykpCgkJCWRlZiBsc1JhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obHNSYXRlS2V5KQoJCQkvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgcmF0ZQoJCQlkZWYgbHNBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoJCQlkZWYgbHNBcHBsaWVkVG9WYWx1ZQoJCQlpZiAobHNBcHBsaWVkVG8pewoJCQkJbHNBcHBsaWVkVG9WYWx1ZSA9IGxzQXBwbGllZFRvLnN1YnN0cmluZyhsc0FwcGxpZWRUby5pbmRleE9mKCcoJykrMSxsc0FwcGxpZWRUby5pbmRleE9mKCcpJykpCgkJCX0KICAgICAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgZGVmIGRlbGV0ZWQKICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZQogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgZGVsZXRlZCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJkZWxldGVkOiAiICsgZGVsZXRlZAogICAgICAgICAgICAgICAgaWYgKGRlbGV0ZWQpewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCQkJCgkJCWRlZiBsc1JhdGVSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKCQkJCgkJCWRlZiBsc1JhdGVSZWZLZXkKCQkJZGVmIGxzUmF0ZVJlZlZhbHVlCgkJCWlmKGxzUmF0ZVJlZi5zaXplKCkgPiAwKXsKCQkJCWxzUmF0ZVJlZiA9IGxzUmF0ZVJlZi50b1N0cmluZygpCgkJCQlsc1JhdGVSZWZLZXkgPSBsc1JhdGVSZWYuc3Vic3RyaW5nKGxzUmF0ZVJlZi5pbmRleE9mKCcoJykrMSxsc1JhdGVSZWYuaW5kZXhPZignKScpKQoJCQkJZGVmIGxzUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgbHNSYXRlUmVmS2V5KQoJCQkJbHNSYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5OYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKCQkJCWxzUmF0ZVJlZlZhbHVlID0gbHNSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKCQkJfQoKCQkJaWYoKGxzQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCBsc0FwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewoJCQkJLy9nZXQgIlRPVEFMX0FNT1VOVF9DVVNUT01FUiIgZm9yIHRoYXQgY29tcG9uZW50CgkJCQlkZWYgdG90Q3VzdG9tZXIgCgkJCQlpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpKXsKCQkJCQl0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCgkJCQl9CgkJCQlpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewoJCQkJCXdhcm5pbmdzPXRydWUKCQkJCQlpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZChsc1JhdGVSZWZWYWx1ZS50b1N0cmluZygpKQoJCQkJCWxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogIiArIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIKCQkJCX0KCQkJfQoJCSB9ICAgIAoJfQoKfWVsc2V7CgkvKkNvbnRhYmlsaXp6YXppb25lIG5vbiBhIGNvcnBvKi8KCWxvZy5kZWJ1ZyAiQ29udGFiaWxpenphemlvbmUgTk9OIGEgY29ycG8iCgoJLy9PUEFBX1JFUExBQ0VEX01BVEVSSUFMUwoJaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKCQkvL2xvZy5kZWJ1ZyAiTWF0ZXJpYWxpOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpCgkJLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCgkJLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCgkJQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAoJCUNsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKCQlkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwoJCWRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKCQlkZWYgcmVwTWF0TGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKQoKCQlmb3IobWF0IGluIHJlcE1hdExpc3QpewoJCQkvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKCQkJZGVmIGNvbXBvbmVudD1tYXQudG9TdHJpbmcoKQoJCQkvL2RlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKQogICAgICAgICAgICBkZWYgY29tcG9uZW50S2V5ID0gY29tcG9uZW50LnN1YnN0cmluZyhjb21wb25lbnQuaW5kZXhPZignKCcrT1BBQSkrMSxjb21wb25lbnQubGVuZ3RoKCktMSkKCQkJZGVmIGNvbXBvbmVudE9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihjb21wb25lbnRLZXkpCgkJCS8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCBjb21wb25lbnQKCQkJZGVmIGFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAoJCQlkZWYgYXBwbGllZFRvVmFsdWUKCQkJaWYoYXBwbGllZFRvLnNpemUoKSA+IDApewoJCQkJYXBwbGllZFRvID0gYXBwbGllZFRvLnRvU3RyaW5nKCkKCQkJCWFwcGxpZWRUb1ZhbHVlID0gYXBwbGllZFRvLnN1YnN0cmluZyhhcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsYXBwbGllZFRvLmluZGV4T2YoJyknKSkKCQkJCS8vbG9nLmRlYnVnICJhcHBsaWVkVG9WYWx1ZTogIiArIGFwcGxpZWRUb1ZhbHVlCgkJCX0KICAgICAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgZGVmIGRlbGV0ZWQKICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZQogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVsZXRlZDogIiArIGRlbGV0ZWQKICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXsKICAgICAgICAgICAgICAgICAgICBkZWxldGVkVmFsdWUgPSBkZWxldGVkLnN1YnN0cmluZyhkZWxldGVkLmluZGV4T2YoJygnKSsxLGRlbGV0ZWQuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgkJCQoJCQlkZWYgbWF0TnVtYmVyCgkJCWRlZiBtYXROdW1iZXJLZXkKCQkJZGVmIG1hdE51bWJlclZhbHVlCgkJCWlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKSl7CgkJCQltYXROdW1iZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAoJCQkJaWYobWF0TnVtYmVyLnNpemUoKSA+IDApewoJCQkJCW1hdE51bWJlciA9IG1hdE51bWJlci50b1N0cmluZygpCgkJCQkJbWF0TnVtYmVyS2V5ID0gbWF0TnVtYmVyLnN1YnN0cmluZyhtYXROdW1iZXIuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyLmluZGV4T2YoJyknKSkKCQkJCQlkZWYgbWF0TnVtYmVyT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKERCT2JqZWN0cyArIG1hdE51bWJlcktleSkKCQkJCQltYXROdW1iZXJWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXROdW1iZXJPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKCQkJCQltYXROdW1iZXJWYWx1ZSA9IG1hdE51bWJlclZhbHVlLnN1YnN0cmluZyhtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcoJykrMSxtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcpJykpCgkJCQl9CgkJCX0KCQkJCgkJCWRlZiBzZXJpYWxOdW1iZXIKCQkJZGVmIHNlcmlhbE51bWJlclZhbHVlCgkJCWlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkpewoJCQkJc2VyaWFsTnVtYmVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zZXJpYWxOdW1iZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CgkJCQlpZihzZXJpYWxOdW1iZXIuc2l6ZSgpID4gMCl7CgkJCQkJc2VyaWFsTnVtYmVyID0gc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkKCQkJCQlzZXJpYWxOdW1iZXJWYWx1ZSA9IHNlcmlhbE51bWJlci5zdWJzdHJpbmcoc2VyaWFsTnVtYmVyLmluZGV4T2YoJygnKSsxLHNlcmlhbE51bWJlci5pbmRleE9mKCcpJykpCgkJCQl9ICAKCQkJfQkJCQkKCgkJCWlmKChhcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewoJCQkJLy9nZXQgIlRPVEFMX0FNT1VOVF9DVVNUT01FUiIgZm9yIHRoYXQgY29tcG9uZW50CgkJCQlkZWYgdG90Q3VzdG9tZXIgCgkJCQlpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKSl7CgkJCQkJdG90Q3VzdG9tZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCQkJCX0KCQkJCWlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CgkJCQkJd2FybmluZ3M9dHJ1ZQoJCQkJCWlzc3VlV2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lci5hZGQobWF0TnVtYmVyVmFsdWUudG9TdHJpbmcoKSArICghc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkuZXF1YWxzKCJbXSIpID8gIiAoIiArIHNlcmlhbE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAiKSIgOiAiICgpIikpICAgCgkJCQkJbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXI6ICIgKyBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIKCQkJCX0KCQkJfQoJCSB9ICAgIAoJfSAgCgoJLy9PUEFBX1VOQVRBTlRVTV9SQVRFUwoJaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKCQlsb2cuZGVidWcgIlVuYSB0YW50dW0gcmF0ZXM6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKQoJCS8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwoJCS8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwoJCUNsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKCQlDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CgkJZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKCQlkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCgkJZGVmIHVtUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykKCgkJZm9yKHVtIGluIHVtUmF0ZXNMaXN0KXsKCQkJLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CgkJCWRlZiB1bVJhdGU9dW0udG9TdHJpbmcoKQoJCQlkZWYgdW1SYXRlS2V5ID0gdW1SYXRlLnN1YnN0cmluZyh1bVJhdGUuaW5kZXhPZignKCcpKzEsdW1SYXRlLmluZGV4T2YoJyknKSkKCQkJZGVmIHVtUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbih1bVJhdGVLZXkpCgkJCS8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCgkJCWRlZiB1bUFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCgkJCWRlZiB1bUFwcGxpZWRUb1ZhbHVlID0gdW1BcHBsaWVkVG8uc3Vic3RyaW5nKHVtQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLHVtQXBwbGllZFRvLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCByYXRlCgkJCWRlZiBkZWxldGVkCiAgICAgICAgICAgIGRlZiBkZWxldGVkVmFsdWUKICAgICAgICAgICAgaWYgKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBsb2cuZGVidWcgImRlbGV0ZWQ6ICIgKyBkZWxldGVkCiAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZCl7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZFZhbHVlID0gZGVsZXRlZC5zdWJzdHJpbmcoZGVsZXRlZC5pbmRleE9mKCcoJykrMSxkZWxldGVkLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCQkJZGVmIHVtUmF0ZVJlZgoJCQlpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkpewoJCQkJdW1SYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoJCQl9CgkJCQoJCQlkZWYgdW1SYXRlUmVmS2V5CgkJCWRlZiB1bVJhdGVSZWZWYWx1ZQoJCQlpZih1bVJhdGVSZWYpewoJCQkJdW1SYXRlUmVmID0gdW1SYXRlUmVmLnRvU3RyaW5nKCkKCQkJCXVtUmF0ZVJlZktleSA9IHVtUmF0ZVJlZi5zdWJzdHJpbmcodW1SYXRlUmVmLmluZGV4T2YoJygnKSsxLHVtUmF0ZVJlZi5pbmRleE9mKCcpJykpCgkJCQlkZWYgdW1SYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB1bVJhdGVSZWZLZXkpCgkJCQl1bVJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoJCQkJdW1SYXRlUmVmVmFsdWUgPSB1bVJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcodW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKQoJCQl9CgkJCQoJCQlpZigodW1BcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IHVtQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkNVU1RPTUVSIikpICYmICFkZWxldGVkVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoInRydWUiKSl7CgkJCQkvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKCQkJCWRlZiB0b3RDdXN0b21lcgoJCQkJaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7CgkJCQkJdG90Q3VzdG9tZXI9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCQkJCX0KCQkJCWlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CgkJCQkJd2FybmluZ3M9dHJ1ZQoJCQkJCWlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKHVtUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCgkJCQkJbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyOiAiICsgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcgoJCQkJfQoJCQl9CgkJIH0gICAgCgl9CgoJLy9PUEFBX0xBQk9VUl9SQVRFUwoJaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKCQlsb2cuZGVidWcgIkxhYm91ciByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgkJLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCgkJLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCgkJQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAoJCUNsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKCQlkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwoJCWRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKCQlkZWYgbGFib3VyUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykKCgkJZm9yKGxiIGluIGxhYm91clJhdGVzTGlzdCl7CgkJCS8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAoJCQlkZWYgbGJSYXRlPWxiLnRvU3RyaW5nKCkKCQkJZGVmIGxiUmF0ZUtleSA9IGxiUmF0ZS5zdWJzdHJpbmcobGJSYXRlLmluZGV4T2YoJygnKSsxLGxiUmF0ZS5pbmRleE9mKCcpJykpCgkJCWRlZiBsYlJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obGJSYXRlS2V5KQoJCQkvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgcmF0ZQoJCQlkZWYgbGJBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCgkJCWRlZiBsYkFwcGxpZWRUb1ZhbHVlID0gbGJBcHBsaWVkVG8uc3Vic3RyaW5nKGxiQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLGxiQXBwbGllZFRvLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IHJhdGUKCQkJZGVmIGRlbGV0ZWQKICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZQogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVsZXRlZDogIiArIGRlbGV0ZWQKICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXsKICAgICAgICAgICAgICAgICAgICBkZWxldGVkVmFsdWUgPSBkZWxldGVkLnN1YnN0cmluZyhkZWxldGVkLmluZGV4T2YoJygnKSsxLGRlbGV0ZWQuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgoJCQlkZWYgbGJSYXRlUmVmCgkJCWlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKSl7CgkJCQlsYlJhdGVSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCgkJCX0KCQkJCgkJCWRlZiB0ZWNoUmVmCiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRlY2huaWNpYW5SZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICB0ZWNoUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRlY2huaWNpYW5SZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICB9CgkJCQogICAgICAgICAgICBkZWYgbGJSYXRlUmVmS2V5CiAgICAgICAgICAgIGRlZiBsYlJhdGVSZWZWYWx1ZQogICAgICAgICAgICBpZihsYlJhdGVSZWYgJiYgbGJSYXRlUmVmLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgbGJSYXRlUmVmID0gbGJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGxiUmF0ZVJlZktleSA9IGxiUmF0ZVJlZi5zdWJzdHJpbmcobGJSYXRlUmVmLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyBsYlJhdGVSZWZLZXkpCiAgICAgICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbGJSYXRlUmVmVmFsdWUgPSBsYlJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcobGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICB9CgkJCQoJCQlkZWYgdGVjaFJlZktleQogICAgICAgICAgICBkZWYgdGVjaFJlZlZhbHVlCiAgICAgICAgICAgIGlmKHRlY2hSZWYpewogICAgICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJ0ZWNoUmVmOiAiICsgdGVjaFJlZgogICAgICAgICAgICAgICAgdGVjaFJlZktleSA9IHRlY2hSZWYuc3Vic3RyaW5nKHRlY2hSZWYuaW5kZXhPZignKCcpKzEsdGVjaFJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgdGVjaFJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdGVjaFJlZktleSkKICAgICAgICAgICAgICAgIHRlY2hSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0ZWNoUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoudGVjaG5pY2lhbi5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGlmKHRlY2hSZWZWYWx1ZSl7CiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gdGVjaFJlZlZhbHVlLnN1YnN0cmluZyh0ZWNoUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdGVjaFJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoJCQkKCQkJaWYoKGxiQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCBsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewoJCQkJLy9nZXQgIlRPVEFMX0FNT1VOVF9DVVNUT01FUiIgZm9yIHRoYXQgY29tcG9uZW50CgkJCQlkZWYgdG90Q3VzdG9tZXIKCQkJCWlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkpewoJCQkJCXRvdEN1c3RvbWVyPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCgkJCQl9CgkJCQlpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewoJCQkJCXdhcm5pbmdzPXRydWUKCQkJCQlpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZChsYlJhdGVSZWZWYWx1ZS50b1N0cmluZygpKQoJCQkJCWxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogIiArIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIKCQkJCX0KCQkJfQoJCSB9ICAgIAoJfQoKCS8vT1BBQV9UUkFWRUxfUkFURVMKCWlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CgkJbG9nLmRlYnVnICJUcmF2ZWwgcmF0ZXM6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKQoJCS8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwoJCS8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwoJCUNsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKCQlDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CgkJZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKCQlkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCgkJZGVmIHRyYXZlbFJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpCgoJCWZvcih0ciBpbiB0cmF2ZWxSYXRlc0xpc3QpewoJCQkvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKCQkJZGVmIHRyUmF0ZT10ci50b1N0cmluZygpCgkJCWRlZiB0clJhdGVLZXkgPSB0clJhdGUuc3Vic3RyaW5nKHRyUmF0ZS5pbmRleE9mKCcoJykrMSx0clJhdGUuaW5kZXhPZignKScpKQoJCQlkZWYgdHJSYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHRyUmF0ZUtleSkKCQkJLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgZGVmIHRyQXBwbGllZFRvCiAgICAgICAgICAgIGRlZiB0ckFwcGxpZWRUb1ZhbHVlCiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5jb21wb25lbnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgdHJBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2ouY29tcG9uZW50LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICB0ckFwcGxpZWRUb1ZhbHVlID0gdHJBcHBsaWVkVG8uc3Vic3RyaW5nKHRyQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLHRyQXBwbGllZFRvLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2dldCAiREVMRVRFRCIgZm9yIHRoYXQgcmF0ZQoJCQlkZWYgZGVsZXRlZAogICAgICAgICAgICBkZWYgZGVsZXRlZFZhbHVlCiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBsb2cuZGVidWcgImRlbGV0ZWQ6ICIgKyBkZWxldGVkCiAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZCl7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZFZhbHVlID0gZGVsZXRlZC5zdWJzdHJpbmcoZGVsZXRlZC5pbmRleE9mKCcoJykrMSxkZWxldGVkLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCQkJZGVmIHRyUmF0ZVJlZgoJCQlpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkpewoJCQkJdHJSYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoJCQl9CgkJCQoJCQlkZWYgdHJSYXRlUmVmS2V5CgkJCWRlZiB0clJhdGVSZWZWYWx1ZQoJCQlpZih0clJhdGVSZWYgIT0gbnVsbCAmJiB0clJhdGVSZWYuc2l6ZSgpID4gMCl7CgkJCQl0clJhdGVSZWYgPSB0clJhdGVSZWYudG9TdHJpbmcoKQoJCQkJdHJSYXRlUmVmS2V5ID0gdHJSYXRlUmVmLnN1YnN0cmluZyh0clJhdGVSZWYuaW5kZXhPZignKCcpKzEsdHJSYXRlUmVmLmluZGV4T2YoJyknKSkKCQkJCWRlZiB0clJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIHRyUmF0ZVJlZktleSkKCQkJCXRyUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLnJhdGUubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCgkJCQl0clJhdGVSZWZWYWx1ZSA9IHRyUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyh0clJhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx0clJhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpCgkJCX0KCgkJCWlmKHRyQXBwbGllZFRvVmFsdWUgIT0gbnVsbCAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikgJiYgKHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCB0ckFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSl7CgkJCQkvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKCQkJCWRlZiB0b3RDdXN0b21lcgoJCQkJaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7CgkJCQkJdG90Q3VzdG9tZXI9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCQkJCX0KCQkJCWlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CgkJCQkJd2FybmluZ3M9dHJ1ZQoJCQkJCWlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKHRyUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCgkJCQkJbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyOiAiICsgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcgoJCQkJfQoJCQl9CgkJIH0gICAgCgl9Cgp9CgpkZWYgbGlua2VkVGlja2V0cz1uZXcgQXJyYXlMaXN0KCkKCi8qT1AtMTAzODogdmVyaWZpY2EgdGlja2V0IGNvbGxlZ2F0aSAtICBlIHN1IGNpYXNjdW5vIHZlcmlmaWNhIGNhbXBpIG9iYmxpZ2F0b3JpKi8KTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgIHJlbGF0ZXNJbklzc3VlTGluaz10cnVlCiAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpKQogICAgICAgIGxvZy5kZWJ1ZyAiSXNzdWUgY29uIHJlbGF0ZXNJbklzc3VlTGluayIKICAgIH0KfQpMaXN0PElzc3VlTGluaz4gYWxsT3V0SXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldE91dHdhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQpmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxPdXRJc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgcmVsYXRlc091dElzc3VlTGluaz10cnVlCiAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkpCiAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc091dElzc3VlTGluayIKICAgIH0KfQoKLypBcnJheSB3YXJuaW5ncyBlZCBlcnJvcnMgcGVyIGxlIGlzc3VlIGxpbmthdGUsIHVubyBwZXIgb2duaSB0aXBvbG9naWEgZGkgZXJyb3JlIG8gd2FybmluZyovCmRlZiB3YXJuaW5nc01hdExpbmtlZElzc3VlcyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgd2FybmluZ3NSYXRlTGlua2VkSXNzdWVzID0gbmV3IEFycmF5TGlzdCgpCi8vZGVmIGVycm9yc0xpbmtlZElzc3VlcyA9IG5ldyBBcnJheUxpc3QoKQoKZm9yKGkgaW4gbGlua2VkVGlja2V0cyl7CiAgICBpc3N1ZT1pIGFzIElzc3VlCgogICAgLypBcnJheSB3YXJuaW5ncyBlZCBlcnJvcnMgcGVyIGxhIHNpbmdvbGEgaXNzdWUgbGlua2F0YSwgdW5vIHBlciBvZ25pIHRpcG9sb2dpYSBkaSBlcnJvcmUgbyB3YXJuaW5nKi8KICAgIGRlZiB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lciA9IG5ldyBBcnJheUxpc3QoKQogICAgZGVmIHdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIgPSBuZXcgQXJyYXlMaXN0KCkgCiAgICAvL2RlZiBlcnJvci4uLgogICAgCiAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1QcmljZSkhPW51bGwgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUHJpY2UpLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CiAgICAgICAgLypDb250YWJpbGl6emF6aW9uZSBhIGNvcnBvKi8KICAgICAgICBsb2cuZGVidWcgIkNvbnRhYmlsaXp6YXppb25lIGEgY29ycG8iCiAgICAgICAgLy9PUEFBX0xVTVBfU1VNX1JBVEVTCiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICAgICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgICAgICAgICBkZWYgbHNSYXRlc0xpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykKCiAgICAgICAgICAgIGZvcihscyBpbiBsc1JhdGVzTGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGU9bHMudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIGxzUmF0ZUtleSA9IGxzUmF0ZS5zdWJzdHJpbmcobHNSYXRlLmluZGV4T2YoJygnKSsxLGxzUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgbHNSYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGxzUmF0ZUtleSkKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgbHNBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIGxzQXBwbGllZFRvVmFsdWUKICAgICAgICAgICAgICAgIGlmIChsc0FwcGxpZWRUbyl7CiAgICAgICAgICAgICAgICAgICAgbHNBcHBsaWVkVG9WYWx1ZSA9IGxzQXBwbGllZFRvLnN1YnN0cmluZyhsc0FwcGxpZWRUby5pbmRleE9mKCcoJykrMSxsc0FwcGxpZWRUby5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgZGVsZXRlZAogICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZQogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnICJkZWxldGVkOiAiICsgZGVsZXRlZAogICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZFZhbHVlID0gZGVsZXRlZC5zdWJzdHJpbmcoZGVsZXRlZC5pbmRleE9mKCcoJykrMSxkZWxldGVkLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGVmIGxzUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVSZWZLZXkKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVSZWZWYWx1ZQogICAgICAgICAgICAgICAgaWYobHNSYXRlUmVmLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIGxzUmF0ZVJlZiA9IGxzUmF0ZVJlZi50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgbHNSYXRlUmVmS2V5ID0gbHNSYXRlUmVmLnN1YnN0cmluZyhsc1JhdGVSZWYuaW5kZXhPZignKCcpKzEsbHNSYXRlUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICBkZWYgbHNSYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyBsc1JhdGVSZWZLZXkpCiAgICAgICAgICAgICAgICAgICAgbHNSYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWZWYWx1ZSA9IGxzUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyhsc1JhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSxsc1JhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoKGxzQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCBsc0FwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAgICAgICAgIC8vZ2V0ICJUT1RBTF9BTU9VTlRfQ1VTVE9NRVIiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIGRlZiB0b3RDdXN0b21lcgogICAgICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIAl0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZChsc1JhdGVSZWZWYWx1ZS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyOiAiICsgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgfQoKICAgIH1lbHNlewogICAgICAgIC8qQ29udGFiaWxpenphemlvbmUgbm9uIGEgY29ycG8qLwogICAgICAgIGxvZy5kZWJ1ZyAiQ29udGFiaWxpenphemlvbmUgTk9OIGEgY29ycG8iCgogICAgICAgIC8vT1BBQV9SRVBMQUNFRF9NQVRFUklBTFMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICBsb2cuZGVidWcgIk1hdGVyaWFsaTogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKQogICAgICAgICAgICAvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi8KICAgICAgICAgICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICAgICAgICAgIENsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwogICAgICAgICAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCiAgICAgICAgICAgIGRlZiByZXBNYXRMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpCgogICAgICAgICAgICBmb3IobWF0IGluIHJlcE1hdExpc3QpewogICAgICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgICAgICAgICBkZWYgY29tcG9uZW50PW1hdC50b1N0cmluZygpCiAgICAgICAgICAgICAgICAvL2RlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgZGVmIGNvbXBvbmVudEtleSA9IGNvbXBvbmVudC5zdWJzdHJpbmcoY29tcG9uZW50LmluZGV4T2YoJygnK09QQUEpKzEsY29tcG9uZW50Lmxlbmd0aCgpLTEpCiAgICAgICAgICAgICAgICBkZWYgY29tcG9uZW50T2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGNvbXBvbmVudEtleSkKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgIGRlZiBhcHBsaWVkVG8KICAgICAgICAgICAgICAgIGRlZiBhcHBsaWVkVG9WYWx1ZQogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgYXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgICAgICAgICAgICAgaWYoYXBwbGllZFRvLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWVkVG8gPSBhcHBsaWVkVG8udG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWVkVG9WYWx1ZSA9IGFwcGxpZWRUby5zdWJzdHJpbmcoYXBwbGllZFRvLmluZGV4T2YoJygnKSsxLGFwcGxpZWRUby5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiYXBwbGllZFRvVmFsdWU6ICIgKyBhcHBsaWVkVG9WYWx1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgZGVsZXRlZAogICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZQogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZWQgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVsZXRlZDogIiArIGRlbGV0ZWQKICAgICAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyCiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyS2V5CiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyVmFsdWUKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5tYXRlcmlhbFJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSBhcyBBcnJheUxpc3QKICAgICAgICAgICAgICAgICAgICBpZihtYXROdW1iZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdE51bWJlciA9IG1hdE51bWJlci50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdE51bWJlcktleSA9IG1hdE51bWJlci5zdWJzdHJpbmcobWF0TnVtYmVyLmluZGV4T2YoJygnKSsxLG1hdE51bWJlci5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oREJPYmplY3RzICsgbWF0TnVtYmVyS2V5KQogICAgICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXROdW1iZXJPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyVmFsdWUgPSBtYXROdW1iZXJWYWx1ZS5zdWJzdHJpbmcobWF0TnVtYmVyVmFsdWUuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWYgc2VyaWFsTnVtYmVyCiAgICAgICAgICAgICAgICBkZWYgc2VyaWFsTnVtYmVyVmFsdWUKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgICAgICAgICAgICAgIGlmKHNlcmlhbE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyID0gc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyVmFsdWUgPSBzZXJpYWxOdW1iZXIuc3Vic3RyaW5nKHNlcmlhbE51bWJlci5pbmRleE9mKCcoJykrMSxzZXJpYWxOdW1iZXIuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZihhcHBsaWVkVG9WYWx1ZSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikgJiYgKGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgYXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkNVU1RPTUVSIikpKXsKICAgICAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgIkFwcGxpZWRUbyB2ZXJpZmljYXRvID0+ICIgKyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIGRlZiB0b3RDdXN0b21lciAKICAgICAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgCXRvdEN1c3RvbWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RDdXN0J10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lci5hZGQobWF0TnVtYmVyVmFsdWUudG9TdHJpbmcoKSArICghc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkuZXF1YWxzKCJbXSIpID8gIiAoIiArIHNlcmlhbE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAiKSIgOiAiICgpIikpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgd2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lcjogIisgd2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAKICAgICAgICB9ICAKCiAgICAgICAgLy9PUEFBX1VOQVRBTlRVTV9SQVRFUwogICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiVW5hIHRhbnR1bSByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIHVtUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykKCiAgICAgICAgICAgIGZvcih1bSBpbiB1bVJhdGVzTGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGU9dW0udG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIHVtUmF0ZUtleSA9IHVtUmF0ZS5zdWJzdHJpbmcodW1SYXRlLmluZGV4T2YoJygnKSsxLHVtUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHVtUmF0ZUtleSkKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgdW1BcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIHVtQXBwbGllZFRvVmFsdWUgPSB1bUFwcGxpZWRUby5zdWJzdHJpbmcodW1BcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsdW1BcHBsaWVkVG8uaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvL2dldCAiREVMRVRFRCIgZm9yIHRoYXQgcmF0ZQogICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWQKICAgICAgICAgICAgICAgIGRlZiBkZWxldGVkVmFsdWUKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVsZXRlZDogIiArIGRlbGV0ZWQKICAgICAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWYKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZLZXkKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZWYWx1ZQogICAgICAgICAgICAgICAgaWYodW1SYXRlUmVmKXsKICAgICAgICAgICAgICAgICAgICB1bVJhdGVSZWYgPSB1bVJhdGVSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIHVtUmF0ZVJlZktleSA9IHVtUmF0ZVJlZi5zdWJzdHJpbmcodW1SYXRlUmVmLmluZGV4T2YoJygnKSsxLHVtUmF0ZVJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgZGVmIHVtUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdW1SYXRlUmVmS2V5KQogICAgICAgICAgICAgICAgICAgIHVtUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCAiTmFtZSIpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmVmFsdWUgPSB1bVJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcodW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKCh1bUFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgdW1BcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQ1VTVE9NRVIiKSkgJiYgIWRlbGV0ZWRWYWx1ZS50b1N0cmluZygpLmVxdWFscygidHJ1ZSIpKXsKICAgICAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBkZWYgdG90Q3VzdG9tZXIgCiAgICAgICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdEN1c3RvbWVyPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKHVtUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXI6ICIgKyB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAKICAgICAgICB9CgogICAgICAgIC8vT1BBQV9MQUJPVVJfUkFURVMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICBsb2cuZGVidWcgIkxhYm91ciByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgogICAgICAgICAgICBmb3IobGIgaW4gbGFib3VyUmF0ZXNMaXN0KXsKICAgICAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlS2V5ID0gbGJSYXRlLnN1YnN0cmluZyhsYlJhdGUuaW5kZXhPZignKCcpKzEsbGJSYXRlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBsYlJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obGJSYXRlS2V5KQogICAgICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgICAgIGRlZiBsYkFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbGJBcHBsaWVkVG9WYWx1ZSA9IGxiQXBwbGllZFRvLnN1YnN0cmluZyhsYkFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxsYkFwcGxpZWRUby5pbmRleE9mKCcpJykpCgogICAgICAgICAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgICAgIGRlZiBkZWxldGVkCiAgICAgICAgICAgICAgICBkZWYgZGVsZXRlZFZhbHVlCiAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZWQgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgImRlbGV0ZWQ6ICIgKyBkZWxldGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKGRlbGV0ZWQpewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkVmFsdWUgPSBkZWxldGVkLnN1YnN0cmluZyhkZWxldGVkLmluZGV4T2YoJygnKSsxLGRlbGV0ZWQuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoKICAgICAgICAgICAgICAgIGRlZiB0ZWNoUmVmCiAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIHRlY2hSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudGVjaG5pY2lhblJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZktleQogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZlZhbHVlCiAgICAgICAgICAgICAgICBpZihsYlJhdGVSZWYuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgbGJSYXRlUmVmID0gbGJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBsYlJhdGVSZWZLZXkgPSBsYlJhdGVSZWYuc3Vic3RyaW5nKGxiUmF0ZVJlZi5pbmRleE9mKCcoJykrMSxsYlJhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiBsYlJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIGxiUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZlZhbHVlID0gbGJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKGxiUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWYgdGVjaFJlZktleQogICAgICAgICAgICAgICAgZGVmIHRlY2hSZWZWYWx1ZQogICAgICAgICAgICAgICAgaWYodGVjaFJlZil7CiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAidGVjaFJlZjogIiArIHRlY2hSZWYKICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmS2V5ID0gdGVjaFJlZi5zdWJzdHJpbmcodGVjaFJlZi5pbmRleE9mKCcoJykrMSx0ZWNoUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICBkZWYgdGVjaFJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdGVjaFJlZktleSkKICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odGVjaFJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnRlY2huaWNpYW4ubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gbGJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKHRlY2hSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx0ZWNoUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKChsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgbGJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQ1VTVE9NRVIiKSkgJiYgIWRlbGV0ZWRWYWx1ZS50b1N0cmluZygpLmVxdWFscygidHJ1ZSIpKXsKICAgICAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBkZWYgdG90Q3VzdG9tZXIgCiAgICAgICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdEN1c3RvbWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoIXRvdEN1c3RvbWVyIHx8IHRvdEN1c3RvbWVyWzBdLmdldFZhbHVlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjAuMCIpKXsKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5hZGQobGJSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSArICIgKCIgKyB0ZWNoUmVmVmFsdWUudG9TdHJpbmcoKSArICIpIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogIiArIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ICAgIAogICAgICAgIH0KCiAgICAgICAgLy9PUEFBX1RSQVZFTF9SQVRFUwogICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiVHJhdmVsIHJhdGVzOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykKICAgICAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICAgICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgICAgICAgICBkZWYgdHJhdmVsUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykKCiAgICAgICAgICAgIGZvcih0ciBpbiB0cmF2ZWxSYXRlc0xpc3QpewogICAgICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgICAgICAgICBkZWYgdHJSYXRlPXRyLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGRlZiB0clJhdGVLZXkgPSB0clJhdGUuc3Vic3RyaW5nKHRyUmF0ZS5pbmRleE9mKCcoJykrMSx0clJhdGUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbih0clJhdGVLZXkpCiAgICAgICAgICAgICAgICAvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgcmF0ZQogICAgICAgICAgICAgICAgZGVmIHRyQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGRlZiB0ckFwcGxpZWRUb1ZhbHVlID0gdHJBcHBsaWVkVG8uc3Vic3RyaW5nKHRyQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLHRyQXBwbGllZFRvLmluZGV4T2YoJyknKSkKCiAgICAgICAgICAgICAgICAvL2dldCAiREVMRVRFRCIgZm9yIHRoYXQgcmF0ZQogICAgICAgICAgICAgICAgZGVmIGRlbGV0ZWQKICAgICAgICAgICAgICAgIGRlZiBkZWxldGVkVmFsdWUKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVsZXRlZDogIiArIGRlbGV0ZWQKICAgICAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRWYWx1ZSA9IGRlbGV0ZWQuc3Vic3RyaW5nKGRlbGV0ZWQuaW5kZXhPZignKCcpKzEsZGVsZXRlZC5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkZWYgdHJSYXRlUmVmID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCgogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZktleQogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZlZhbHVlCiAgICAgICAgICAgICAgICBpZih0clJhdGVSZWYuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgdHJSYXRlUmVmID0gdHJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWZLZXkgPSB0clJhdGVSZWYuc3Vic3RyaW5nKHRyUmF0ZVJlZi5pbmRleE9mKCcoJykrMSx0clJhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiB0clJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIHRyUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIHRyUmF0ZVJlZlZhbHVlID0gdHJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKHRyUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLHRyUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigodHJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkNVU1RPTUVSIikpICYmICFkZWxldGVkVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoInRydWUiKSl7CiAgICAgICAgICAgICAgICAgICAgLy9nZXQgIlRPVEFMX0FNT1VOVF9DVVNUT01FUiIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyCiAgICAgICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdEN1c3RvbWVyPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKHRyUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXI6ICIgKyB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAKICAgICAgICB9CgogICAgfQogICAgCiAgICAvKlZlcmlmaWNvIGxhIHByZXNlbnphIGRpIGVycm9yaSBlIHdhcm5pbmcgc3VsbGEgaXNzdWUgY29ycmVudGUgZSwgc2UgcHJlc2VudGksIGxpIGFnZ2l1bmdvIGFnbGkgYXJyYXkgZGVnbGkgZXJyb3JpIGUgd2FybmluZyBkZWxsZSBpc3N1ZSBsaW5rYXRlKi8KICAgIGlmKHdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuc2l6ZSgpPjApewogICAgICAgIGRlZiBvYmpMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgb2JqTGlzdC5hZGQoaXNzdWUpCiAgICAgICAgb2JqTGlzdC5hZGQod2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lcikKICAgICAgICB3YXJuaW5nc01hdExpbmtlZElzc3Vlcy5hZGQob2JqTGlzdCkKICAgIH0KICAgIAogICAgaWYod2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuc2l6ZSgpPjApewogICAgICAgIGRlZiBvYmpMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgb2JqTGlzdC5hZGQoaXNzdWUpCiAgICAgICAgb2JqTGlzdC5hZGQod2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIpCiAgICAgICAgd2FybmluZ3NSYXRlTGlua2VkSXNzdWVzLmFkZChvYmpMaXN0KQogICAgfQogICAgCiAgICAvL2lmKGVycm9ycy4uLikKICAgIAp9Cgpsb2cuZGVidWcgIndhcm5pbmdzTWF0TGlua2VkSXNzdWVzOiAiICsgd2FybmluZ3NNYXRMaW5rZWRJc3N1ZXMKbG9nLmRlYnVnICJ3YXJuaW5nc1JhdGVMaW5rZWRJc3N1ZXM6ICIgKyB3YXJuaW5nc1JhdGVMaW5rZWRJc3N1ZXMKCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghZXJyb3JzICYmICF3YXJuaW5ncyl7CglyZXR1cm4gdHJ1ZQp9ZWxzZXsKCWlmKCFlcnJvcnMgJiYgd2FybmluZ3MpewoJCS8vU2UgY2kgc29ubyBzb2xvIHdhcm5pbmdzIHZlcmlmaWNvIHNlIGwndXRlbnRlIGhhIGdpw6AgZGljaGlhcmF0byBkaSB2b2xlciBwcm9zZWd1aXJlIGNvbXVucXVlCgkJLy8gLSB0cmFuc2l0aW9uIGZpZWxkICJPUEFBX0NIRUNLX0FORF9DT05GSVJNIj0iWWVzIgoJCS8vIC0gaW4gY2FzbyBjb250cmFyaW8gaW52aW8gaSB3YXJuaW5nIGEgRkUKCgkJbG9nLmRlYnVnICJ0cmFuc2l0aW9uQ2hlY2s6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykKCQkvL2xvZy5kZWJ1ZyAicmVzdWx0OiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKQoJCWlmKHRyYW5zaXRpb25DaGVja1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CgkJCWxvZy5kZWJ1ZyAicmV0dXJuIHRydWUgLSB0cmFuc2l0aW9uQ2hlY2sgPSBZZXMiCgkJCXJldHVybiB0cnVlCgkJfWVsc2V7CgkJCWRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKCQkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5zaXplKCkgPiAwKXsKCQkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQoJCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIpCgoJCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5UmF0ZSkKCQkJfQoKCQkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLnNpemUoKSA+IDApewoJCQkJZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URSIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChudWxsKQoJCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyKQoKCQkJCXdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKQoJCQl9CgkJCQoJCQlpZih3YXJuaW5nc01hdExpbmtlZElzc3Vlcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcihvYmogaW4gd2FybmluZ3NNYXRMaW5rZWRJc3N1ZXMpewogICAgICAgICAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URSIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQob2JqWzBdKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG9ialsxXSkKCiAgICAgICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKHdhcm5pbmdzUmF0ZUxpbmtlZElzc3Vlcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcihvYmogaW4gd2FybmluZ3NSYXRlTGlua2VkSXNzdWVzKXsKICAgICAgICAgICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHlSYXRlID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiVyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChvYmpbMF0pCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChvYmpbMV0pCgogICAgICAgICAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eVJhdGUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCgkJCW91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siVyI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCgkJCS8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiVyIsIG91dHB1dC50b1N0cmluZygpKSAgIAoJCX0KCgl9CglpZihlcnJvcnMgJiYgIXdhcm5pbmdzKXsKCQlkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKCgkJb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQoJCS8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKSAgIAoJfQoJaWYoZXJyb3JzICYmIHdhcm5pbmdzKXsKCQlkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKCQlkZWYgd0xpc3QgPSBuZXcgQXJyYXlMaXN0KCkKCgkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5zaXplKCkgPiAwKXsKCQkJZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZSA9IG5ldyBBcnJheUxpc3QoKQoJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKCJXIikKCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCgkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQobnVsbCkKCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyKQoKCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5UmF0ZSkKCQl9CgoJCWlmKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lci5zaXplKCkgPiAwKXsKCQkJZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlciKQoJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZCgiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9NQVRfUVVPVEUiKQoJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChudWxsKQoJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIpCgoJCQl3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSkKCQl9CgkJCgkJaWYod2FybmluZ3NNYXRMaW5rZWRJc3N1ZXMuc2l6ZSgpID4gMCl7CgkJCWZvcihvYmogaW4gd2FybmluZ3NNYXRMaW5rZWRJc3N1ZXMpewoJCQkJZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URSIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChvYmpbMF0pCgkJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChvYmpbMV0pCgoJCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpCgkJCX0KCQl9CgkJCgkJaWYod2FybmluZ3NSYXRlTGlua2VkSXNzdWVzLnNpemUoKSA+IDApewoJCQlmb3Iob2JqIGluIHdhcm5pbmdzUmF0ZUxpbmtlZElzc3Vlcyl7CgkJCQlkZWYgd0xpc3RDb25maXJtRW1wdHlSYXRlID0gbmV3IEFycmF5TGlzdCgpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKCJXIikKCQkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfUkFURVMiKQoJCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChvYmpbMF0pCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG9ialsxXSkKCgkJCQl3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlSYXRlKQoJCQl9CgkJfQoKCQlvdXRwdXQuYWRkKGVMaXN0KQoJCW91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCgkJLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXRSIsIG91dHB1dC50b1N0cmluZygpKSAgCgl9Cn0=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">f794e26f6a504d3cc776bd5c16d3ff518ff13b6f</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IFJFU1QgQVBJOiBPUCBnZW5lcmF6aW9uZSBPRFYgc3UgU0FQ</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuV29ya2Zsb3dFeGNlcHRpb247CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgZ3Jvb3Z5Lmpzb24uSnNvblNsdXJwZXI7CmltcG9ydCBncm9vdnkuanNvbi5TdHJlYW1pbmdKc29uQnVpbGRlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5DdXN0b21GaWVsZE1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlTWFuYWdlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3I7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWU7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29kZWMuYmluYXJ5LkJhc2U2NDsKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eXgubmV0Lmh0dHAuSFRUUEJ1aWxkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluawppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCklzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKQ3VzdG9tRmllbGRNYW5hZ2VyIGN1c3RvbUZpZWxkTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpOwoKCmRlZiByZXF1ZXN0TWV0aG9kID0gIlBPU1QiCgpkZWYgcmVsYXRlc0luSXNzdWVMaW5rPWZhbHNlCmRlZiByZWxhdGVzT3V0SXNzdWVMaW5rPWZhbHNlCmRlZiBsaW5rZWRUaWNrZXRzPW5ldyBBcnJheUxpc3QoKQoKTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCiAgICBmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxJbklzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICAgICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICAgICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICByZWxhdGVzSW5Jc3N1ZUxpbms9dHJ1ZQogICAgICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkudG9TdHJpbmcoKSkKICAgICAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc0luSXNzdWVMaW5rIgogICAgICAgIH0KICAgIH0KICAgIExpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpCiAgICBmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxPdXRJc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgcmVsYXRlc091dElzc3VlTGluaz10cnVlCiAgICAgICAgICAgIGxpbmtlZFRpY2tldHMuYWRkKGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpLnRvU3RyaW5nKCkpCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiSXNzdWUgY29uIHJlbGF0ZXNPdXRJc3N1ZUxpbmsiCiAgICAgICAgfQogICAgfQoKLyogUkVTVCBBUEkgcGVyIEludmlvIE5vdGlmaWNhIEVtYWlsIE9OU0lURV9SRVBPUlQgKi8KZGVmIGJvZHlfcmVxCgppZihyZWxhdGVzSW5Jc3N1ZUxpbmsgfHwgcmVsYXRlc091dElzc3VlTGluayl7CiAgICBib2R5X3JlcSA9IFsKICAgICAgICAiaXNzdWVLZXkiOiBpc3N1ZS5rZXksCiAgICAgICAgImxpbmtlZFRpY2tldHMiOiBsaW5rZWRUaWNrZXRzCiAgICBdCn1lbHNlewogICAgYm9keV9yZXEgPSBbCiAgICAgICAgImlzc3VlS2V5IjogaXNzdWUua2V5CiAgICBdCn0KCmRlZiBiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1snYXBpLmVudiddLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvamlyYS9BQS9zYWxlcy9vcmRlci9jcmVhdGUiCmxvZy5kZWJ1ZyBiYXNlVVJMClVSTCB1cmwgPSBuZXcgVVJMKGJhc2VVUkwpCkh0dHBVUkxDb25uZWN0aW9uIGNvbm5lY3Rpb24gPSAoSHR0cFVSTENvbm5lY3Rpb24pdXJsLm9wZW5Db25uZWN0aW9uKCk7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdE1ldGhvZChyZXF1ZXN0TWV0aG9kKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgiKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkFjY2VwdCIsICIqLyoiKTsKY29ubmVjdGlvbi5zZXREb091dHB1dCh0cnVlKTsKY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwpjb25uZWN0aW9uLm91dHB1dFN0cmVhbQpjb25uZWN0aW9uLm91dHB1dFN0cmVhbS53aXRoV3JpdGVyKCJVVEYtOCIpIHsgbmV3IFN0cmVhbWluZ0pzb25CdWlsZGVyKGl0LCBib2R5X3JlcSkgfQpsb2cuZGVidWcgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KY29ubmVjdGlvbi5jb25uZWN0KCk7CgpkZWYgb3V0cHV0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZUxpc3RFcnJvcnMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVycm9yTXNncyA9IG5ldyBBcnJheUxpc3QoKQoKaWYgKCFjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIyMDAiKSl7CiAgICBsb2cuZGVidWcgInVybDogIiArIHVybAogICAgbG9nLmRlYnVnICJSZXNwb25zZUNvZGU6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VNZXNzYWdlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpCiAgICBsb2cuZGVidWcgIkVycm9yU3RyZWFtOiAiICsgY29ubmVjdGlvbi5nZXRFcnJvclN0cmVhbSgpLnRvU3RyaW5nKCkKICAgIGxvZy5kZWJ1ZyAiZ2V0SGVhZGVyRmllbGRzKCk6ICIgKyBjb25uZWN0aW9uLmdldEhlYWRlckZpZWxkcygpCiAgICBkZWYgb3V0cHV0TXNnID0gKChIdHRwVVJMQ29ubmVjdGlvbiljb25uZWN0aW9uKS5lcnJvclN0cmVhbS50ZXh0CiAgICBsb2cuZGVidWcgIigoSHR0cFVSTENvbm5lY3Rpb24pY29ubmVjdGlvbikuZXJyb3JTdHJlYW0udGV4dDogIiArIG91dHB1dE1zZwogICAgCiAgICBkZWYganNvblNsdXJwZXIgPSBuZXcgSnNvblNsdXJwZXIoKQogICAgZGVmIGpzb25fb2JqZWN0ID0ganNvblNsdXJwZXIucGFyc2VUZXh0KG91dHB1dE1zZykKICAgIGFzc2VydCBqc29uX29iamVjdCBpbnN0YW5jZW9mIE1hcCAgCiAgICBsb2cuZGVidWcgIm1lc3NhZ2U6ICIgKyAganNvbl9vYmplY3QubWVzc2FnZQogICAgCiAgICBlTGlzdEVycm9ycy5hZGQoIkUiKQogICAgZUxpc3RFcnJvcnMuYWRkKCJPUC1TQVAtT0RWIikKICAgIGVycm9yTXNncy5hZGQoY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKSArICIgIiArIGpzb25fb2JqZWN0Lm1lc3NhZ2UpCiAgICBlTGlzdEVycm9ycy5hZGQoZXJyb3JNc2dzKQogICAgZUxpc3QuYWRkKGVMaXN0RXJyb3JzKQoKICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpCn0=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="6">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_ACTION">181 Tkt Chiuso</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IENsb3NlIHRrdCBpZiBPRFYgYW5kIE9EQSBoYXZlIGJlZW4gY3JlYXRlZA==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">YCFgY2ZWYWx1ZXNbJ09QX1BVUkNIQVNFX09SREVSJ10gIT0gbnVsbCAmJiBjZlZhbHVlc1snT1BfUFVSQ0hBU0VfT1JERVJfREFURSddICE9IG51bGwgJiYgY2ZWYWx1ZXNbJ09QX1BVUkNIQVNFX09SREVSX1RPVEFMJ10gIT0gbnVsbHx8fA==</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS"></arg>
                  <arg name="FIELD_ADDITIONAL_SCRIPT">YCFg</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="171" name="ODA" view="fieldscreen">
          <meta name="opsbar-sequence">50</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19908</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIE9QX1BVUkNIQVNFX09SREVSX0RBVEUgLSBJZiBub3QgbnVsbCAtIHRyYW5zaXRpb24gaGFzIGFscmVhZHkgYmVlbiBleGVjdXRlZA==</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KY2ZWYWx1ZXNbcHJvcGVydGllc1snY2YucHVyY2hhc2VPcmRlckRhdGUnXV0gPT0gbnVsbCAmJiBjZlZhbHVlc1twcm9wZXJ0aWVzWydjZi53ZlB1cmNoYXNlT3JkZXJUb1MnXV0gPT0gbnVsbHx8fA==</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIE9QQUFfQVVUT01BVElDQUxMWV9DTE9TRUQgLSBpZiBZZXMgZG9uJ3QgYWxsb3cgdHJhbnNpdGlvbg==</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KY2ZWYWx1ZXNbcHJvcGVydGllc1snY2YuYXV0b21hdGljYWxseUNsb3NlZCddXSA9PSBudWxsIHx8IGNmVmFsdWVzW3Byb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlDbG9zZWQnXV0/LnZhbHVlID09ICdObyd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">3c57210d24c112bcff020e8630134c0aaf31c353</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcyAtIHNvbG8gZXJyb3JzLCBubyB3YXJuaW5ncw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluawoKaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuSW52YWxpZElucHV0RXhjZXB0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCklzc3VlIGlzc3VlID0gaXNzdWUKLy9QZXIgdGVzdCBkYSBjb25zb2xlCi8vSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwovL0lzc3VlIGlzc3VlID0gaXNzdWVNYW5hZ2VyLmdldElzc3VlQnlLZXlJZ25vcmVDYXNlKCJBQVMtMjIwMiIpCgpkZWYgZXJyb3JzID0gZmFsc2UKZGVmIHdhcm5pbmdzID0gZmFsc2UKZGVmIHJlbGF0ZXNJbklzc3VlTGluaz1mYWxzZQpkZWYgcmVsYXRlc091dElzc3VlTGluaz1mYWxzZQpkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZUxpbmtlZCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgd0xpc3RDb25maXJtRW1wdHlSYXRlUXVvdGVMaW5rZWQgPSBuZXcgQXJyYXlMaXN0KCkKCmRlZiBsdW1wU3VtUHJpY2UgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmx1bXBTdW1QcmljZSddLnRvU3RyaW5nKCkpWzBdCgovKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgbm9uIGEgY29ycG8qLwpkZWYgcmVwTWF0ZXJpYWxzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5yZXBsYWNlZE1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdCmRlZiB1bmFUYW50dW1SYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YudW5hdGFudHVtUmF0ZXMnXS50b1N0cmluZygpKVswXQpkZWYgbGFib3VyUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmxhYm91clJhdGVzJ10udG9TdHJpbmcoKSlbMF0KZGVmIHRyYXZlbFJhdGVzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi50cmF2ZWxSYXRlcyddLnRvU3RyaW5nKCkpWzBdCgovKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgYSBjb3JwbyovCmRlZiBsdW1wU3VtUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmx1bXBTdW1SYXRlcyddLnRvU3RyaW5nKCkpWzBdCgovKkNvbmZlcm1hIHV0ZW50ZSBzdSB3YXJuaW5ncyovCmRlZiB0cmFuc2l0aW9uQ2hlY2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmNoZWNrQW5kQ29uZmlybSddLnRvU3RyaW5nKCkpWzBdCgovKkluc2lnaHQgU2NoZW1hIElEcyovCmRlZiBEQk9iamVjdHMgPSBwcm9wZXJ0aWVzWydpc2NoZW1hLmRibyddLnRvU3RyaW5nKCkgKyAiLSIKZGVmIE9QQUEgPSBwcm9wZXJ0aWVzWydpc2NoZW1hLmFhJ10udG9TdHJpbmcoKSArICItIgoKLypBcnJheSB3YXJuaW5ncyBlZCBlcnJvcnMgcGVyIGxhIGlzc3VlIHByaW5jaXBhbGUsIHVubyBwZXIgb2duaSB0aXBvbG9naWEgZGkgZXJyb3JlIG8gd2FybmluZyovCmRlZiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0U3VwcGxpZXIgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIgPSBuZXcgQXJyYXlMaXN0KCkKLy9kZWYgaXNzdWVFcnJvci4uLgoKLypWZXJpZmljYSBjYW1waSBzdSB0aWNrZXQgb2dnZXR0byBkZWxsYSB0cmFuc2F6aW9uZSovCmlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVByaWNlKSE9bnVsbCAmJiBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1QcmljZSkudG9TdHJpbmcoKS5lcXVhbHMoIlllcyIpKXsKICAgIC8qQ29udGFiaWxpenphemlvbmUgYSBjb3JwbyovCiAgICBsb2cuZGVidWcgIkNvbnRhYmlsaXp6YXppb25lIGEgY29ycG8iCiAgICAvL09QQUFfTFVNUF9TVU1fUkFURVMKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVJhdGVzKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICBkZWYgbHNSYXRlc0xpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykKCiAgICAgICAgZm9yKGxzIGluIGxzUmF0ZXNMaXN0KXsKICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgICAgIGRlZiBsc1JhdGU9bHMudG9TdHJpbmcoKQogICAgICAgICAgICBsb2cuZGVidWcgbHNSYXRlCiAgICAgICAgICAgIGRlZiBsc1JhdGVLZXkgPSBsc1JhdGUuc3Vic3RyaW5nKGxzUmF0ZS5pbmRleE9mKCcoJykrMSxsc1JhdGUuaW5kZXhPZignKScpKQogICAgICAgICAgICBkZWYgbHNSYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGxzUmF0ZUtleSkKICAgICAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IHRoYXQgcmF0ZQoJCQlkZWYgbHNEZWwgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiAiIgoJICAgICAgICBkZWYgbHNEZWxWYWx1ZSA9IGxzRGVsICE9ICIiID8gbHNEZWwuc3Vic3RyaW5nKGxzRGVsLmluZGV4T2YoJygnKSsxLGxzRGVsLmluZGV4T2YoJyknKSkgOiAiIgoKICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgZGVmIGxzQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgZGVmIGxzQXBwbGllZFRvVmFsdWUKICAgICAgICAgICAgaWYgKGxzQXBwbGllZFRvKXsKICAgICAgICAgICAgICAgIGxzQXBwbGllZFRvVmFsdWUgPSBsc0FwcGxpZWRUby5zdWJzdHJpbmcobHNBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsbHNBcHBsaWVkVG8uaW5kZXhPZignKScpKQogICAgICAgICAgICB9CgogICAgICAgICAgICBkZWYgbHNSYXRlUmVmID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCgogICAgICAgICAgICBkZWYgbHNSYXRlUmVmS2V5CiAgICAgICAgICAgIGRlZiBsc1JhdGVSZWZWYWx1ZQogICAgICAgICAgICBpZihsc1JhdGVSZWYuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBsc1JhdGVSZWYgPSBsc1JhdGVSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbHNSYXRlUmVmS2V5ID0gbHNSYXRlUmVmLnN1YnN0cmluZyhsc1JhdGVSZWYuaW5kZXhPZignKCcpKzEsbHNSYXRlUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIGxzUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgIGxzUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnJhdGUuTmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBsc1JhdGVSZWZWYWx1ZSA9IGxzUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyhsc1JhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSxsc1JhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKChsc0FwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgbHNBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiU1VQUExJRVIiKSkgJiYgIWxzRGVsVmFsdWUuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAgICAgLy9nZXQgIlRPVEFMX0FNT1VOVF9TVVBQTElFUiIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICBkZWYgdG90U3VwcGxpZXIKCQkJCWlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdFN1cHBsaWVyJ10udG9TdHJpbmcoKSkpewoJCQkJCXRvdFN1cHBsaWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCQkJCX0KICAgICAgICAgICAgICAgIGlmKCF0b3RTdXBwbGllciB8fCB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgICAgICAgICAgICAgIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIuYWRkKGxzUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyOiAiICsgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSAgICAKICAgIH0KCn1lbHNlewogICAgLypDb250YWJpbGl6emF6aW9uZSBub24gYSBjb3JwbyovCiAgICBsb2cuZGVidWcgIkNvbnRhYmlsaXp6YXppb25lIE5PTiBhIGNvcnBvIgoKICAgIC8vT1BBQV9SRVBMQUNFRF9NQVRFUklBTFMKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgLy9sb2cuZGVidWcgIk1hdGVyaWFsaTogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKQogICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgIENsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCiAgICAgICAgZGVmIHJlcE1hdExpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKCiAgICAgICAgZm9yKG1hdCBpbiByZXBNYXRMaXN0KXsKICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgICAgIGRlZiBjb21wb25lbnQ9bWF0LnRvU3RyaW5nKCkKICAgICAgICAgICAgZGVmIGNvbXBvbmVudEtleSA9IGNvbXBvbmVudC5zdWJzdHJpbmcoY29tcG9uZW50LmluZGV4T2YoJygnK09QQUEpKzEsY29tcG9uZW50Lmxlbmd0aCgpLTEpCiAgICAgICAgICAgIGRlZiBjb21wb25lbnRPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oY29tcG9uZW50S2V5KQogICAgICAgIAkvL2dldCAiREVMRVRFRCIgZm9yIHRoYXQgY29tcG9uZW50CgkJCWRlZiBtYXREZWwgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiAiIgoJICAgICAgICBkZWYgbWF0RGVsVmFsdWUgPSBtYXREZWwgIT0gIiIgPyBtYXREZWwuc3Vic3RyaW5nKG1hdERlbC5pbmRleE9mKCcoJykrMSxtYXREZWwuaW5kZXhPZignKScpKSA6ICIiCgogICAgICAgICAgICAKICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICBkZWYgYXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgICAgICBkZWYgYXBwbGllZFRvVmFsdWUKICAgICAgICAgICAgaWYoYXBwbGllZFRvLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgYXBwbGllZFRvID0gYXBwbGllZFRvLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGFwcGxpZWRUb1ZhbHVlID0gYXBwbGllZFRvLnN1YnN0cmluZyhhcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsYXBwbGllZFRvLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIC8vbG9nLmRlYnVnICJhcHBsaWVkVG9WYWx1ZTogIiArIGFwcGxpZWRUb1ZhbHVlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRlZiBtYXROdW1iZXIKICAgICAgICAgICAgZGVmIG1hdE51bWJlcktleQogICAgICAgICAgICBkZWYgbWF0TnVtYmVyVmFsdWUKICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5tYXRlcmlhbFJlZiddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgICAgIG1hdE51bWJlciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgICAgICAgICBpZihtYXROdW1iZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyID0gbWF0TnVtYmVyLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXJLZXkgPSBtYXROdW1iZXIuc3Vic3RyaW5nKG1hdE51bWJlci5pbmRleE9mKCcoJykrMSxtYXROdW1iZXIuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oREJPYmplY3RzICsgbWF0TnVtYmVyS2V5KQogICAgICAgICAgICAgICAgICAgIG1hdE51bWJlclZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKG1hdE51bWJlck9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm1hdGVyaWFsLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIG1hdE51bWJlclZhbHVlID0gbWF0TnVtYmVyVmFsdWUuc3Vic3RyaW5nKG1hdE51bWJlclZhbHVlLmluZGV4T2YoJygnKSsxLG1hdE51bWJlclZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgZGVmIHNlcmlhbE51bWJlcgogICAgICAgICAgICBkZWYgc2VyaWFsTnVtYmVyVmFsdWUKICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zZXJpYWxOdW1iZXInXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnNlcmlhbE51bWJlciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSBhcyBBcnJheUxpc3QKICAgICAgICAgICAgICAgIGlmKHNlcmlhbE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXIgPSBzZXJpYWxOdW1iZXIudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlclZhbHVlID0gc2VyaWFsTnVtYmVyLnN1YnN0cmluZyhzZXJpYWxOdW1iZXIuaW5kZXhPZignKCcpKzEsc2VyaWFsTnVtYmVyLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYoKGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgYXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIlNVUFBMSUVSIikpICYmICFtYXREZWxWYWx1ZS5lcXVhbHMoInRydWUiKSl7CiAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX1NVUFBMSUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgIGRlZiB0b3RTdXBwbGllcgogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RTdXBwJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIHRvdFN1cHBsaWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RTdXBwJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZighdG90U3VwcGxpZXIgfHwgdG90U3VwcGxpZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0U3VwcGxpZXIuYWRkKG1hdE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAoIXNlcmlhbE51bWJlci50b1N0cmluZygpLmVxdWFscygiW10iKSA/ICIgKCIgKyBzZXJpYWxOdW1iZXJWYWx1ZS50b1N0cmluZygpICsgIikiIDogIiAoKSIpKQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdFN1cHBsaWVyOiAiICsgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdFN1cHBsaWVyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9ICAgIAogICAgfSAgCgogICAgLy9PUEFBX1VOQVRBTlRVTV9SQVRFUwogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICBsb2cuZGVidWcgIlVuYSB0YW50dW0gcmF0ZXM6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKQogICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgIENsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCiAgICAgICAgZGVmIHVtUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykKCiAgICAgICAgZm9yKHVtIGluIHVtUmF0ZXNMaXN0KXsKICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgICAgIGRlZiB1bVJhdGU9dW0udG9TdHJpbmcoKQogICAgICAgICAgICBkZWYgdW1SYXRlS2V5ID0gdW1SYXRlLnN1YnN0cmluZyh1bVJhdGUuaW5kZXhPZignKCcpKzEsdW1SYXRlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgZGVmIHVtUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbih1bVJhdGVLZXkpCiAgICAgICAgICAgIAogICAgICAgICAgICBkZWYgdW1EZWwgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiAiIgogICAgICAgICAgICBkZWYgdW1EZWxWYWx1ZSA9IHVtRGVsICE9ICIiID8gdW1EZWwuc3Vic3RyaW5nKHVtRGVsLmluZGV4T2YoJygnKSsxLHVtRGVsLmluZGV4T2YoJyknKSkgOiAiIgogICAgICAgICAgICAKICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgZGVmIHVtQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgZGVmIHVtQXBwbGllZFRvVmFsdWUgPSB1bUFwcGxpZWRUby5zdWJzdHJpbmcodW1BcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsdW1BcHBsaWVkVG8uaW5kZXhPZignKScpKQoKICAgICAgICAgICAgZGVmIHVtUmF0ZVJlZgogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgdW1SYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICBkZWYgdW1SYXRlUmVmS2V5CiAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZWYWx1ZQogICAgICAgICAgICBpZih1bVJhdGVSZWYpewogICAgICAgICAgICAgICAgdW1SYXRlUmVmID0gdW1SYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIHVtUmF0ZVJlZktleSA9IHVtUmF0ZVJlZi5zdWJzdHJpbmcodW1SYXRlUmVmLmluZGV4T2YoJygnKSsxLHVtUmF0ZVJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB1bVJhdGVSZWZLZXkpCiAgICAgICAgICAgICAgICB1bVJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgdW1SYXRlUmVmVmFsdWUgPSB1bVJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcodW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdW1SYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigodW1BcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IHVtQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIlNVUFBMSUVSIikpICYmICF1bURlbFZhbHVlLmVxdWFscygidHJ1ZSIpKXsKICAgICAgICAgICAgICAgIC8vZ2V0ICJUT1RBTF9BTU9VTlRfU1VQUExJRVIiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgZGVmIHRvdFN1cHBsaWVyCiAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgICAgICAgICB0b3RTdXBwbGllciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdFN1cHBsaWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZighdG90U3VwcGxpZXIgfHwgdG90U3VwcGxpZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyLmFkZCh1bVJhdGVSZWZWYWx1ZS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllcjogIiArIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gICAgCiAgICB9CgogICAgLy9PUEFBX0xBQk9VUl9SQVRFUwogICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICBsb2cuZGVidWcgIkxhYm91ciByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCiAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICBkZWYgbGFib3VyUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykKCiAgICAgICAgZm9yKGxiIGluIGxhYm91clJhdGVzTGlzdCl7CiAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICBkZWYgbGJSYXRlPWxiLnRvU3RyaW5nKCkKICAgICAgICAgICAgZGVmIGxiUmF0ZUtleSA9IGxiUmF0ZS5zdWJzdHJpbmcobGJSYXRlLmluZGV4T2YoJygnKSsxLGxiUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIGRlZiBsYlJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obGJSYXRlS2V5KQogICAgICAgICAgICAvL2dldCAiREVMRVRFRCIgZm9yIHRoYXQgcmF0ZQogICAgICAgICAgICBkZWYgbGJEZWwgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiAiIgogICAgICAgICAgICBkZWYgbGJEZWxWYWx1ZSA9IGxiRGVsICE9ICIiID8gbGJEZWwuc3Vic3RyaW5nKGxiRGVsLmluZGV4T2YoJygnKSsxLGxiRGVsLmluZGV4T2YoJyknKSkgOiAiIgogICAgICAgICAgICAKICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgZGVmIGxiQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgZGVmIGxiQXBwbGllZFRvVmFsdWUgPSBsYkFwcGxpZWRUby5zdWJzdHJpbmcobGJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsbGJBcHBsaWVkVG8uaW5kZXhPZignKScpKQoKICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZgoJCQlpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkpewoJCQkJbGJSYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoJCQl9CgoJCQlkZWYgdGVjaFJlZgogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgdGVjaFJlZj1vYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoJCQkKICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZktleQogICAgICAgICAgICBkZWYgbGJSYXRlUmVmVmFsdWUKICAgICAgICAgICAgaWYobGJSYXRlUmVmLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgbGJSYXRlUmVmID0gbGJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGxiUmF0ZVJlZktleSA9IGxiUmF0ZVJlZi5zdWJzdHJpbmcobGJSYXRlUmVmLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyBsYlJhdGVSZWZLZXkpCiAgICAgICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbGJSYXRlUmVmVmFsdWUgPSBsYlJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcobGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICB9CgkJCQoJCQlkZWYgdGVjaFJlZktleQogICAgICAgICAgICBkZWYgdGVjaFJlZlZhbHVlCiAgICAgICAgICAgIGlmKHRlY2hSZWYpewogICAgICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJ0ZWNoUmVmOiAiICsgdGVjaFJlZgogICAgICAgICAgICAgICAgdGVjaFJlZktleSA9IHRlY2hSZWYuc3Vic3RyaW5nKHRlY2hSZWYuaW5kZXhPZignKCcpKzEsdGVjaFJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgdGVjaFJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdGVjaFJlZktleSkKICAgICAgICAgICAgICAgIHRlY2hSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0ZWNoUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoudGVjaG5pY2lhbi5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIHRlY2hSZWZWYWx1ZSA9IGxiUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyh0ZWNoUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdGVjaFJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoKGxiQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCBsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJTVVBQTElFUiIpKSAmJiAhbGJEZWxWYWx1ZS5lcXVhbHMoInRydWUiKSl7CiAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX1NVUFBMSUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgIGRlZiB0b3RTdXBwbGllcgogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXInXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgdG90U3VwcGxpZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoIXRvdFN1cHBsaWVyIHx8IHRvdFN1cHBsaWVyWzBdLmdldFZhbHVlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjAuMCIpKXsKICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICAgICAgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllci5hZGQobGJSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSArICIgKCIgKyB0ZWNoUmVmVmFsdWUudG9TdHJpbmcoKSArICIpIikKICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXI6ICIgKyBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9ICAgIAogICAgfQoKICAgIC8vT1BBQV9UUkFWRUxfUkFURVMKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgbG9nLmRlYnVnICJUcmF2ZWwgcmF0ZXM6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKQogICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgIENsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCiAgICAgICAgZGVmIHRyYXZlbFJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpCgogICAgICAgIGZvcih0ciBpbiB0cmF2ZWxSYXRlc0xpc3QpewogICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgZGVmIHRyUmF0ZT10ci50b1N0cmluZygpCiAgICAgICAgICAgIGRlZiB0clJhdGVLZXkgPSB0clJhdGUuc3Vic3RyaW5nKHRyUmF0ZS5pbmRleE9mKCcoJykrMSx0clJhdGUuaW5kZXhPZignKScpKQogICAgICAgICAgICBkZWYgdHJSYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHRyUmF0ZUtleSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGRlZiB0ckRlbCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKSA6ICIiCiAgICAgICAgICAgIGRlZiB0ckRlbFZhbHVlID0gdHJEZWwgIT0gIiIgPyB0ckRlbC5zdWJzdHJpbmcodHJEZWwuaW5kZXhPZignKCcpKzEsdHJEZWwuaW5kZXhPZignKScpKSA6ICIiCiAgICAgICAgICAgIAogICAgICAgICAgICAvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgcmF0ZQogICAgICAgICAgICBkZWYgdHJBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICBkZWYgdHJBcHBsaWVkVG9WYWx1ZSA9IHRyQXBwbGllZFRvLnN1YnN0cmluZyh0ckFwcGxpZWRUby5pbmRleE9mKCcoJykrMSx0ckFwcGxpZWRUby5pbmRleE9mKCcpJykpCgogICAgICAgICAgICBkZWYgdHJSYXRlUmVmCgkJCWlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKSl7CgkJCQl0clJhdGVSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCgkJCX0KCiAgICAgICAgICAgIGRlZiB0clJhdGVSZWZLZXkKICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZlZhbHVlCiAgICAgICAgICAgIGlmKHRyUmF0ZVJlZi5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIHRyUmF0ZVJlZiA9IHRyUmF0ZVJlZi50b1N0cmluZygpCiAgICAgICAgICAgICAgICB0clJhdGVSZWZLZXkgPSB0clJhdGVSZWYuc3Vic3RyaW5nKHRyUmF0ZVJlZi5pbmRleE9mKCcoJykrMSx0clJhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdHJSYXRlUmVmS2V5KQogICAgICAgICAgICAgICAgdHJSYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5OYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIHRyUmF0ZVJlZlZhbHVlID0gdHJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKHRyUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLHRyUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoKHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCB0ckFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJTVVBQTElFUiIpKSAmJiAhdHJEZWxWYWx1ZS5lcXVhbHMoInRydWUiKSl7CiAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX1NVUFBMSUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgIGRlZiB0b3RTdXBwbGllcgogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXInXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgdG90U3VwcGxpZXI9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCF0b3RTdXBwbGllciB8fCB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgICAgICAgICAgICAgIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIuYWRkKHRyUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyOiAiICsgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSAgICAKICAgIH0KCn0KCmRlZiBsaW5rZWRUaWNrZXRzPW5ldyBBcnJheUxpc3QoKQoKLypPUC0xMDM4OiB2ZXJpZmljYSB0aWNrZXQgY29sbGVnYXRpIC0gIGUgc3UgY2lhc2N1bm8gdmVyaWZpY2EgY2FtcGkgb2JibGlnYXRvcmkqLwpMaXN0PElzc3VlTGluaz4gYWxsSW5Jc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0SW53YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsSW5Jc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgcmVsYXRlc0luSXNzdWVMaW5rPXRydWUKICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkpCiAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc0luSXNzdWVMaW5rIgogICAgfQp9Ckxpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICByZWxhdGVzT3V0SXNzdWVMaW5rPXRydWUKICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKSkKICAgICAgICBsb2cuZGVidWcgIklzc3VlIGNvbiByZWxhdGVzT3V0SXNzdWVMaW5rIgogICAgfQp9CgovKkFycmF5IHdhcm5pbmdzIGVkIGVycm9ycyBwZXIgbGUgaXNzdWUgbGlua2F0ZSwgdW5vIHBlciBvZ25pIHRpcG9sb2dpYSBkaSBlcnJvcmUgbyB3YXJuaW5nKi8KZGVmIHdhcm5pbmdzTWF0TGlua2VkSXNzdWVzID0gbmV3IEFycmF5TGlzdCgpCmRlZiB3YXJuaW5nc1JhdGVMaW5rZWRJc3N1ZXMgPSBuZXcgQXJyYXlMaXN0KCkKLy9kZWYgZXJyb3JzTGlua2VkSXNzdWVzID0gbmV3IEFycmF5TGlzdCgpCgpmb3IoaSBpbiBsaW5rZWRUaWNrZXRzKXsKICAgIGlzc3VlPWkgYXMgSXNzdWUKCiAgICAvKkFycmF5IHdhcm5pbmdzIGVkIGVycm9ycyBwZXIgbGEgc2luZ29sYSBpc3N1ZSBsaW5rYXRhLCB1bm8gcGVyIG9nbmkgdGlwb2xvZ2lhIGRpIGVycm9yZSBvIHdhcm5pbmcqLwogICAgZGVmIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyID0gbmV3IEFycmF5TGlzdCgpCiAgICBkZWYgd2FybmluZ0VtcHR5UXVvdGVNYXRTdXBwbGllciA9IG5ldyBBcnJheUxpc3QoKSAKICAgIC8vZGVmIGVycm9yLi4uCiAgICAKICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVByaWNlKSE9bnVsbCAmJiBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1QcmljZSkudG9TdHJpbmcoKS5lcXVhbHMoIlllcyIpKXsKICAgICAgICAvKkNvbnRhYmlsaXp6YXppb25lIGEgY29ycG8qLwogICAgICAgIGxvZy5kZWJ1ZyAiQ29udGFiaWxpenphemlvbmUgYSBjb3JwbyIKICAgICAgICAvL09QQUFfTFVNUF9TVU1fUkFURVMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVJhdGVzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICAvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi8KICAgICAgICAgICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICAgICAgICAgIENsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwogICAgICAgICAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCiAgICAgICAgICAgIGRlZiBsc1JhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobHVtcFN1bVJhdGVzKQoKICAgICAgICAgICAgZm9yKGxzIGluIGxzUmF0ZXNMaXN0KXsKICAgICAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgZGVmIGxzUmF0ZT1scy50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbHNSYXRlS2V5ID0gbHNSYXRlLnN1YnN0cmluZyhsc1JhdGUuaW5kZXhPZignKCcpKzEsbHNSYXRlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obHNSYXRlS2V5KQogICAgICAgICAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgZGVmIGxzRGVsID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZS5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpID8gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZS5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpIDogIiIKICAgICAgICAgICAgICAgIGRlZiBsc0RlbFZhbHVlID0gbHNEZWwgIT0gIiIgPyBsc0RlbC5zdWJzdHJpbmcobHNEZWwuaW5kZXhPZignKCcpKzEsbHNEZWwuaW5kZXhPZignKScpKSA6ICIiCgogICAgICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgICAgIGRlZiBsc0FwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbHNBcHBsaWVkVG9WYWx1ZQogICAgICAgICAgICAgICAgaWYgKGxzQXBwbGllZFRvKXsKICAgICAgICAgICAgICAgICAgICBsc0FwcGxpZWRUb1ZhbHVlID0gbHNBcHBsaWVkVG8uc3Vic3RyaW5nKGxzQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLGxzQXBwbGllZFRvLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWYgbHNSYXRlUmVmID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCgogICAgICAgICAgICAgICAgZGVmIGxzUmF0ZVJlZktleQogICAgICAgICAgICAgICAgZGVmIGxzUmF0ZVJlZlZhbHVlCiAgICAgICAgICAgICAgICBpZihsc1JhdGVSZWYuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgbHNSYXRlUmVmID0gbHNSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWZLZXkgPSBsc1JhdGVSZWYuc3Vic3RyaW5nKGxzUmF0ZVJlZi5pbmRleE9mKCcoJykrMSxsc1JhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIGxzUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxzUmF0ZVJlZlZhbHVlID0gbHNSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigobHNBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IGxzQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIlNVUFBMSUVSIikpICYmICFsc0RlbFZhbHVlLmVxdWFscygidHJ1ZSIpKXsKICAgICAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX1NVUFBMSUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBkZWYgdG90U3VwcGxpZXIKICAgICAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgICAgICAgICAJdG90U3VwcGxpZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighdG90U3VwcGxpZXIgfHwgdG90U3VwcGxpZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlICAgIAogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllci5hZGQobHNSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiB3YXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllcjogIiArIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ICAgIAogICAgICAgIH0KCiAgICB9ZWxzZXsKICAgICAgICAvKkNvbnRhYmlsaXp6YXppb25lIG5vbiBhIGNvcnBvKi8KICAgICAgICBsb2cuZGVidWcgIkNvbnRhYmlsaXp6YXppb25lIE5PTiBhIGNvcnBvIgoKICAgICAgICAvL09QQUFfUkVQTEFDRURfTUFURVJJQUxTCiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICAgICAgbG9nLmRlYnVnICJNYXRlcmlhbGk6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKICAgICAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICAgICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgICAgICAgICBkZWYgcmVwTWF0TGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKQoKICAgICAgICAgICAgZm9yKG1hdCBpbiByZXBNYXRMaXN0KXsKICAgICAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgZGVmIGNvbXBvbmVudD1tYXQudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIGNvbXBvbmVudEtleSA9IGNvbXBvbmVudC5zdWJzdHJpbmcoY29tcG9uZW50LmluZGV4T2YoJygnK09QQUEpKzEsY29tcG9uZW50Lmxlbmd0aCgpLTEpCiAgICAgICAgICAgICAgICBkZWYgY29tcG9uZW50T2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGNvbXBvbmVudEtleSkKICAgICAgICAgICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgIGRlZiBtYXREZWwgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiAiIgogICAgICAgICAgICAgICAgZGVmIG1hdERlbFZhbHVlID0gbWF0RGVsICE9ICIiID8gbWF0RGVsLnN1YnN0cmluZyhtYXREZWwuaW5kZXhPZignKCcpKzEsbWF0RGVsLmluZGV4T2YoJyknKSkgOiAiIgoKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgIGRlZiBhcHBsaWVkVG8KICAgICAgICAgICAgICAgIGRlZiBhcHBsaWVkVG9WYWx1ZQogICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIGFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSBhcyBBcnJheUxpc3QKICAgICAgICAgICAgICAgICAgICBpZihhcHBsaWVkVG8uc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpZWRUbyA9IGFwcGxpZWRUby50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpZWRUb1ZhbHVlID0gYXBwbGllZFRvLnN1YnN0cmluZyhhcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsYXBwbGllZFRvLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnICJhcHBsaWVkVG9WYWx1ZTogIiArIGFwcGxpZWRUb1ZhbHVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyCiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyS2V5CiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyVmFsdWUKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5tYXRlcmlhbFJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSBhcyBBcnJheUxpc3QKICAgICAgICAgICAgICAgICAgICBpZihtYXROdW1iZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdE51bWJlciA9IG1hdE51bWJlci50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdE51bWJlcktleSA9IG1hdE51bWJlci5zdWJzdHJpbmcobWF0TnVtYmVyLmluZGV4T2YoJygnKSsxLG1hdE51bWJlci5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oREJPYmplY3RzICsgbWF0TnVtYmVyS2V5KQogICAgICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXROdW1iZXJPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyVmFsdWUgPSBtYXROdW1iZXJWYWx1ZS5zdWJzdHJpbmcobWF0TnVtYmVyVmFsdWUuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWYgc2VyaWFsTnVtYmVyCiAgICAgICAgICAgICAgICBkZWYgc2VyaWFsTnVtYmVyVmFsdWUKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgICAgICAgICAgICAgIGlmKHNlcmlhbE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyID0gc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyVmFsdWUgPSBzZXJpYWxOdW1iZXIuc3Vic3RyaW5nKHNlcmlhbE51bWJlci5pbmRleE9mKCcoJykrMSxzZXJpYWxOdW1iZXIuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZihhcHBsaWVkVG9WYWx1ZSAmJiAhbWF0RGVsVmFsdWUuZXF1YWxzKCJ0cnVlIikgJiYgKGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgYXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIlNVUFBMSUVSIikpKXsKICAgICAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX1NVUFBMSUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgIkFwcGxpZWRUbyB2ZXJpZmljYXRvID0+ICIgKyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdFN1cHAnXS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIGRlZiB0b3RTdXBwbGllciAKICAgICAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdFN1cHAnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgCXRvdFN1cHBsaWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RTdXBwJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICAgICAgfQoJCQkJCWlmKCF0b3RTdXBwbGllciB8fCB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVNYXRTdXBwbGllci5hZGQobWF0TnVtYmVyVmFsdWUudG9TdHJpbmcoKSArICghc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkuZXF1YWxzKCJbXSIpID8gIiAoIiArIHNlcmlhbE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAiKSIgOiAiICgpIikpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgd2FybmluZ0VtcHR5UXVvdGVNYXRTdXBwbGllcjogIisgd2FybmluZ0VtcHR5UXVvdGVNYXRTdXBwbGllcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAKICAgICAgICB9ICAKCiAgICAgICAgLy9PUEFBX1VOQVRBTlRVTV9SQVRFUwogICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiVW5hIHRhbnR1bSByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIHVtUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykKCiAgICAgICAgICAgIGZvcih1bSBpbiB1bVJhdGVzTGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGU9dW0udG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIHVtUmF0ZUtleSA9IHVtUmF0ZS5zdWJzdHJpbmcodW1SYXRlLmluZGV4T2YoJygnKSsxLHVtUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHVtUmF0ZUtleSkKICAgICAgICAgICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgIGRlZiB1bURlbCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGUuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGUuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKSA6ICIiCiAgICAgICAgICAgICAgICBkZWYgdW1EZWxWYWx1ZSA9IHVtRGVsICE9ICIiID8gdW1EZWwuc3Vic3RyaW5nKHVtRGVsLmluZGV4T2YoJygnKSsxLHVtRGVsLmluZGV4T2YoJyknKSkgOiAiIgoKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgdW1BcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIHVtQXBwbGllZFRvVmFsdWUgPSB1bUFwcGxpZWRUby5zdWJzdHJpbmcodW1BcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsdW1BcHBsaWVkVG8uaW5kZXhPZignKScpKQoKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWYKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGVmIHRlY2hSZWYKICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRlY2huaWNpYW5SZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZj1vYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmS2V5CiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmVmFsdWUKICAgICAgICAgICAgICAgIGlmKHVtUmF0ZVJlZil7CiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmID0gdW1SYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICB1bVJhdGVSZWZLZXkgPSB1bVJhdGVSZWYuc3Vic3RyaW5nKHVtUmF0ZVJlZi5pbmRleE9mKCcoJykrMSx1bVJhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIHVtUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgICAgICB1bVJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIHVtUmF0ZVJlZlZhbHVlID0gdW1SYXRlUmVmVmFsdWUuc3Vic3RyaW5nKHVtUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLHVtUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWYgdGVjaFJlZktleQogICAgICAgICAgICAgICAgZGVmIHRlY2hSZWZWYWx1ZQogICAgICAgICAgICAgICAgaWYodGVjaFJlZil7CiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAidGVjaFJlZjogIiArIHRlY2hSZWYKICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmS2V5ID0gdGVjaFJlZi5zdWJzdHJpbmcodGVjaFJlZi5pbmRleE9mKCcoJykrMSx0ZWNoUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB1bVJhdGVSZWZLZXkpCiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRlY2hSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai50ZWNobmljaWFuLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIHRlY2hSZWZWYWx1ZSA9IHVtUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyh0ZWNoUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdGVjaFJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigodW1BcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IHVtQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIlNVUFBMSUVSIikpICYmICF1bURlbFZhbHVlLmVxdWFscygidHJ1ZSIpKXsKICAgICAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX1NVUFBMSUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBkZWYgdG90U3VwcGxpZXIgCiAgICAgICAgICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXInXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdFN1cHBsaWVyPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdFN1cHBsaWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RTdXBwbGllciB8fCB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIuYWRkKHVtUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkgKyAiICgiICsgdGVjaFJlZlZhbHVlLnRvU3RyaW5nKCkgKyAiKSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgd2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXI6ICIgKyB3YXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAKICAgICAgICB9CgogICAgICAgIC8vT1BBQV9MQUJPVVJfUkFURVMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICBsb2cuZGVidWcgIkxhYm91ciByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgogICAgICAgICAgICBmb3IobGIgaW4gbGFib3VyUmF0ZXNMaXN0KXsKICAgICAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlS2V5ID0gbGJSYXRlLnN1YnN0cmluZyhsYlJhdGUuaW5kZXhPZignKCcpKzEsbGJSYXRlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBsYlJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obGJSYXRlS2V5KQogICAgICAgICAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgZGVmIGxiRGVsID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZS5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpID8gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZS5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpIDogIiIKICAgICAgICAgICAgICAgIGRlZiBsYkRlbFZhbHVlID0gbGJEZWwgIT0gIiIgPyBsYkRlbC5zdWJzdHJpbmcobGJEZWwuaW5kZXhPZignKCcpKzEsbGJEZWwuaW5kZXhPZignKScpKSA6ICIiCgogICAgICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgICAgIGRlZiBsYkFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbGJBcHBsaWVkVG9WYWx1ZSA9IGxiQXBwbGllZFRvLnN1YnN0cmluZyhsYkFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxsYkFwcGxpZWRUby5pbmRleE9mKCcpJykpCgogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoKICAgICAgICAgICAgICAgIGRlZiB0ZWNoUmVmCiAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50ZWNobmljaWFuUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgIHRlY2hSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudGVjaG5pY2lhblJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZktleQogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZlZhbHVlCiAgICAgICAgICAgICAgICBpZihsYlJhdGVSZWYuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgbGJSYXRlUmVmID0gbGJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBsYlJhdGVSZWZLZXkgPSBsYlJhdGVSZWYuc3Vic3RyaW5nKGxiUmF0ZVJlZi5pbmRleE9mKCcoJykrMSxsYlJhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiBsYlJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIGxiUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZlZhbHVlID0gbGJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKGxiUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWYgdGVjaFJlZktleQogICAgICAgICAgICAgICAgZGVmIHRlY2hSZWZWYWx1ZQogICAgICAgICAgICAgICAgaWYodGVjaFJlZil7CiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAidGVjaFJlZjogIiArIHRlY2hSZWYKICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmS2V5ID0gdGVjaFJlZi5zdWJzdHJpbmcodGVjaFJlZi5pbmRleE9mKCcoJykrMSx0ZWNoUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICBkZWYgdGVjaFJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdGVjaFJlZktleSkKICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odGVjaFJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnRlY2huaWNpYW4ubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gbGJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKHRlY2hSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx0ZWNoUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKChsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgbGJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiU1VQUExJRVIiKSkgJiYgIWxiRGVsVmFsdWUuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAgICAgICAgIC8vZ2V0ICJUT1RBTF9BTU9VTlRfU1VQUExJRVIiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIGRlZiB0b3RTdXBwbGllciAKICAgICAgICAgICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgICAgICAgICAgICAgdG90U3VwcGxpZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighdG90U3VwcGxpZXIgfHwgdG90U3VwcGxpZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyLmFkZChsYlJhdGVSZWZWYWx1ZS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyOiAiICsgd2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgfQoKICAgICAgICAvL09QQUFfVFJBVkVMX1JBVEVTCiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICAgICAgbG9nLmRlYnVnICJUcmF2ZWwgcmF0ZXM6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKQogICAgICAgICAgICAvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi8KICAgICAgICAgICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICAgICAgICAgIENsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwogICAgICAgICAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgICAgICAgICBkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCiAgICAgICAgICAgIGRlZiB0cmF2ZWxSYXRlc0xpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKQoKICAgICAgICAgICAgZm9yKHRyIGluIHRyYXZlbFJhdGVzTGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiB0clJhdGU9dHIudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZUtleSA9IHRyUmF0ZS5zdWJzdHJpbmcodHJSYXRlLmluZGV4T2YoJygnKSsxLHRyUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgdHJSYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHRyUmF0ZUtleSkKICAgICAgICAgICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgIGRlZiB0ckRlbCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGUuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGUuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKSA6ICIiCiAgICAgICAgICAgICAgICBkZWYgdHJEZWxWYWx1ZSA9IHRyRGVsICE9ICIiID8gdHJEZWwuc3Vic3RyaW5nKHRyRGVsLmluZGV4T2YoJygnKSsxLHRyRGVsLmluZGV4T2YoJyknKSkgOiAiIgoKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgdHJBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIHRyQXBwbGllZFRvVmFsdWUgPSB0ckFwcGxpZWRUby5zdWJzdHJpbmcodHJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsdHJBcHBsaWVkVG8uaW5kZXhPZignKScpKQoKICAgICAgICAgICAgICAgIGRlZiB0clJhdGVSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKCiAgICAgICAgICAgICAgICBkZWYgdHJSYXRlUmVmS2V5CiAgICAgICAgICAgICAgICBkZWYgdHJSYXRlUmVmVmFsdWUKICAgICAgICAgICAgICAgIGlmKHRyUmF0ZVJlZi5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWYgPSB0clJhdGVSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIHRyUmF0ZVJlZktleSA9IHRyUmF0ZVJlZi5zdWJzdHJpbmcodHJSYXRlUmVmLmluZGV4T2YoJygnKSsxLHRyUmF0ZVJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdHJSYXRlUmVmS2V5KQogICAgICAgICAgICAgICAgICAgIHRyUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnJhdGUuTmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgdHJSYXRlUmVmVmFsdWUgPSB0clJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcodHJSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdHJSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKCh0ckFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgdHJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiU1VQUExJRVIiKSkgJiYgIXRyRGVsVmFsdWUuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAgICAgICAgIC8vZ2V0ICJUT1RBTF9BTU9VTlRfU1VQUExJRVIiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIGRlZiB0b3RTdXBwbGllcgogICAgICAgICAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdFN1cHBsaWVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgICAgICAgICB0b3RTdXBwbGllcj1vYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighdG90U3VwcGxpZXIgfHwgdG90U3VwcGxpZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyLmFkZCh0clJhdGVSZWZWYWx1ZS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2cuZGVidWcgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyOiAiICsgd2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgfQoKICAgIH0KICAgIAogICAgLypWZXJpZmljbyBsYSBwcmVzZW56YSBkaSBlcnJvcmkgZSB3YXJuaW5nIHN1bGxhIGlzc3VlIGNvcnJlbnRlIGUsIHNlIHByZXNlbnRpLCBsaSBhZ2dpdW5nbyBhZ2xpIGFycmF5IGRlZ2xpIGVycm9yaSBlIHdhcm5pbmcgZGVsbGUgaXNzdWUgbGlua2F0ZSovCiAgICBpZih3YXJuaW5nRW1wdHlRdW90ZU1hdFN1cHBsaWVyLnNpemUoKT4wKXsKICAgICAgICBkZWYgb2JqTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgIG9iakxpc3QuYWRkKGlzc3VlKQogICAgICAgIG9iakxpc3QuYWRkKHdhcm5pbmdFbXB0eVF1b3RlTWF0U3VwcGxpZXIpCiAgICAgICAgd2FybmluZ3NNYXRMaW5rZWRJc3N1ZXMuYWRkKG9iakxpc3QpCiAgICB9CiAgICAKICAgIGlmKHdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyLnNpemUoKT4wKXsKICAgICAgICBkZWYgb2JqTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgIG9iakxpc3QuYWRkKGlzc3VlKQogICAgICAgIG9iakxpc3QuYWRkKHdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyKQogICAgICAgIHdhcm5pbmdzUmF0ZUxpbmtlZElzc3Vlcy5hZGQob2JqTGlzdCkKICAgIH0KICAgIAogICAgLy9pZihlcnJvcnMuLi4pCiAgICAKfQoKbG9nLmRlYnVnICJ3YXJuaW5nc01hdExpbmtlZElzc3VlczogIiArIHdhcm5pbmdzTWF0TGlua2VkSXNzdWVzCmxvZy5kZWJ1ZyAid2FybmluZ3NSYXRlTGlua2VkSXNzdWVzOiAiICsgd2FybmluZ3NSYXRlTGlua2VkSXNzdWVzCgpkZWYgb3V0cHV0ID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWVycm9ycyAmJiAhd2FybmluZ3MpewogICAgcmV0dXJuIHRydWUKfWVsc2V7CiAgICBpZighZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICAvL1NlIGNpIHNvbm8gc29sbyB3YXJuaW5ncyB2ZXJpZmljbyBzZSBsJ3V0ZW50ZSBoYSBnacOgIGRpY2hpYXJhdG8gZGkgdm9sZXIgcHJvc2VndWlyZSBjb211bnF1ZQogICAgICAgIC8vIC0gdHJhbnNpdGlvbiBmaWVsZCAiT1BBQV9DSEVDS19BTkRfQ09ORklSTSI9IlllcyIKICAgICAgICAvLyAtIGluIGNhc28gY29udHJhcmlvIGludmlvIGkgd2FybmluZyBhIEZFCgogICAgICAgIC8vbG9nLmRlYnVnICJ0cmFuc2l0aW9uQ2hlY2s6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykKICAgICAgICAvL2xvZy5kZWJ1ZyAicmVzdWx0OiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKQogICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpewogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAicmV0dXJuIHRydWUgLSB0cmFuc2l0aW9uQ2hlY2sgPSBZZXMiCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICAgICAgaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiU1VQUExJRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlSYXRlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0U3VwcGxpZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgIAlkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlNVUFBMSUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFIikKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG51bGwpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0U3VwcGxpZXIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYod2FybmluZ3NNYXRMaW5rZWRJc3N1ZXMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBmb3Iob2JqIGluIHdhcm5pbmdzTWF0TGlua2VkSXNzdWVzKXsKICAgICAgICAgICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZCgiU1VQUExJRVJfQ09ORklSTV9FTVBUWV9NQVRfUVVPVEUiKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG9ialswXSkKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChvYmpbMV0pCgogICAgICAgICAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZih3YXJuaW5nc1JhdGVMaW5rZWRJc3N1ZXMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBmb3Iob2JqIGluIHdhcm5pbmdzUmF0ZUxpbmtlZElzc3Vlcyl7CiAgICAgICAgICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlNVUFBMSUVSX0NPTkZJUk1fRU1QVFlfUkFURVMiKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQob2JqWzBdKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQob2JqWzFdKQoKICAgICAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlSYXRlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IlciOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIlciLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKICAgICAgICB9CgogICAgfQogICAgaWYoZXJyb3JzICYmICF3YXJuaW5ncyl7CiAgICAgICAgZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgogICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKICAgIH0KICAgIGlmKGVycm9ycyAmJiB3YXJuaW5ncyl7CiAgICAgICAgZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgogICAgICAgIGlmKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiVyIpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlNVUFBMSUVSX0NPTkZJUk1fRU1QVFlfUkFURVMiKQoJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllcikKCiAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eVJhdGUpCiAgICAgICAgfQoKICAgICAgICBpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0U3VwcGxpZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlNVUFBMSUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFIikKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQobnVsbCkKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdFN1cHBsaWVyKQoKICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpCiAgICAgICAgfQoKICAgICAgICBpZih3YXJuaW5nc01hdExpbmtlZElzc3Vlcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgZm9yKG9iaiBpbiB3YXJuaW5nc01hdExpbmtlZElzc3Vlcyl7CiAgICAgICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlNVUFBMSUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFIikKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG9ialswXSkKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG9ialsxXSkKCiAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYod2FybmluZ3NSYXRlTGlua2VkSXNzdWVzLnNpemUoKSA+IDApewogICAgICAgICAgICBmb3Iob2JqIGluIHdhcm5pbmdzUmF0ZUxpbmtlZElzc3Vlcyl7CiAgICAgICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHlSYXRlID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKCJXIikKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlNVUFBMSUVSX0NPTkZJUk1fRU1QVFlfUkFURVMiKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChvYmpbMF0pCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG9ialsxXSkKCiAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlSYXRlKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgICAgIG91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXRSIsIG91dHB1dC50b1N0cmluZygpKSAgCiAgICB9Cn0=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">3657615f14a01fb91bdcb3a532f38f81b3555fa9</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IGdlbmVyYXppb25lIE9EQSBmb3JuaXRvcmU=</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgZ3Jvb3Z5Lmpzb24uSnNvblNsdXJwZXIKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKCklzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKQ3VzdG9tRmllbGRNYW5hZ2VyIGN1c3RvbUZpZWxkTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpOwpkZWYgcmVxdWVzdE1ldGhvZApkZWYgYmFzZVVSTAoKVVJMIHVybApIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uCgovKiBSRVNUIEFQSSBwZXIgR2VuZXJhemlvbmUgT0RBICovCnJlcXVlc3RNZXRob2QgPSAiUE9TVCI7CmRlZiByZWxhdGVzSW5Jc3N1ZUxpbms9ZmFsc2UKZGVmIHJlbGF0ZXNPdXRJc3N1ZUxpbms9ZmFsc2UKZGVmIGxpbmtlZFRpY2tldHM9bmV3IEFycmF5TGlzdCgpCkxpc3Q8SXNzdWVMaW5rPiBhbGxJbklzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRJbndhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQpmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxJbklzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICByZWxhdGVzSW5Jc3N1ZUxpbms9dHJ1ZQogICAgICAgIGxpbmtlZFRpY2tldHMuYWRkKGlzc3VlTGluay5nZXRTb3VyY2VPYmplY3QoKS50b1N0cmluZygpKQogICAgICAgIGxvZy5kZWJ1ZyAiSXNzdWUgY29uIHJlbGF0ZXNJbklzc3VlTGluayIKICAgIH0KfQpMaXN0PElzc3VlTGluaz4gYWxsT3V0SXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldE91dHdhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQpmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxPdXRJc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgcmVsYXRlc091dElzc3VlTGluaz10cnVlCiAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkudG9TdHJpbmcoKSkKICAgICAgICBsb2cuZGVidWcgIklzc3VlIGNvbiByZWxhdGVzT3V0SXNzdWVMaW5rIgogICAgfQp9CgpkZWYgYm9keV9yZXEKCmlmKHJlbGF0ZXNJbklzc3VlTGluayB8fCByZWxhdGVzT3V0SXNzdWVMaW5rKXsKICAgIGJvZHlfcmVxID0gWwogICAgICAgICJpc3N1ZUtleSI6IGlzc3VlLmtleSwKICAgICAgICAibGlua2VkVGlja2V0cyI6IGxpbmtlZFRpY2tldHMKICAgIF0KfWVsc2V7CiAgICBib2R5X3JlcSA9IFsKICAgICAgICAiaXNzdWVLZXkiOiBpc3N1ZS5rZXkKICAgIF0KfQoKCmJhc2VVUkwgPSAiaHR0cDovLyIgKyBwcm9wZXJ0aWVzWydhcGkuZW52J10udG9TdHJpbmcoKSArICIvb3AvcmVzdC9qaXJhL0FBL3B1cmNoYXNlL29yZGVyL2NyZWF0ZSIKdXJsID0gbmV3IFVSTChiYXNlVVJMKQpjb25uZWN0aW9uID0gKEh0dHBVUkxDb25uZWN0aW9uKXVybC5vcGVuQ29ubmVjdGlvbigpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RNZXRob2QocmVxdWVzdE1ldGhvZCk7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PVVURi04Iik7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJBY2NlcHQiLCAiKi8qIik7CmNvbm5lY3Rpb24uc2V0RG9PdXRwdXQodHJ1ZSk7CmNvbm5lY3Rpb24uc2V0RG9JbnB1dCh0cnVlKTsKY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0ud2l0aFdyaXRlcigiVVRGLTgiKSB7IG5ldyBTdHJlYW1pbmdKc29uQnVpbGRlcihpdCwgYm9keV9yZXEpIH0KbG9nLmRlYnVnIGNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtCmNvbm5lY3Rpb24uY29ubmVjdCgpOwoKZGVmIG91dHB1dCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0RXJyb3JzID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlcnJvck1zZ3MgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKS50b1N0cmluZygpLmVxdWFscygiMjAwIikpewogICAgbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VDb2RlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlTWVzc2FnZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKQogICAgbG9nLmRlYnVnICJSZXNwb25zZTogIiArIGNvbm5lY3Rpb24KICAgIGRlZiBvdXRwdXRNc2cgPSAoKEh0dHBVUkxDb25uZWN0aW9uKWNvbm5lY3Rpb24pLmVycm9yU3RyZWFtLnRleHQKICAgIGxvZy5kZWJ1ZyAiKChIdHRwVVJMQ29ubmVjdGlvbiljb25uZWN0aW9uKS5lcnJvclN0cmVhbS50ZXh0OiAiICsgb3V0cHV0TXNnCiAgICAKICAgIGRlZiBqc29uU2x1cnBlciA9IG5ldyBKc29uU2x1cnBlcigpCiAgICBkZWYganNvbl9vYmplY3QgPSBqc29uU2x1cnBlci5wYXJzZVRleHQob3V0cHV0TXNnKQogICAgYXNzZXJ0IGpzb25fb2JqZWN0IGluc3RhbmNlb2YgTWFwICAKICAgIGxvZy5kZWJ1ZyAibWVzc2FnZTogIiArICBqc29uX29iamVjdC5tZXNzYWdlCiAgICAKICAgIGVMaXN0RXJyb3JzLmFkZCgiRSIpCiAgICBlTGlzdEVycm9ycy5hZGQoIk9QLVNBUC1PREEiKQogICAgZXJyb3JNc2dzLmFkZChjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpICsgIiAiICsganNvbl9vYmplY3QubWVzc2FnZSkKICAgIGVMaXN0RXJyb3JzLmFkZChlcnJvck1zZ3MpCiAgICBlTGlzdC5hZGQoZUxpc3RFcnJvcnMpCiAgICAKICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpCn0=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="6">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1AgRW1haWwgTm90aWZpY2F0aW9uOiBQVVJDSEFTRV9PUkRFUl9UT19TVVBQTElFUg==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLkN1c3RvbUZpZWxkTWFuYWdlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5maWVsZHMuQ3VzdG9tRmllbGQ7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmNvbXBvbmVudC5Db21wb25lbnRBY2Nlc3NvcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZTsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb2RlYy5iaW5hcnkuQmFzZTY0OwppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCklzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKQ3VzdG9tRmllbGRNYW5hZ2VyIGN1c3RvbUZpZWxkTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpOwpkZWYgcmVxdWVzdE1ldGhvZApkZWYgYmFzZVVSTAoKVVJMIHVybApIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uCgpyZXF1ZXN0TWV0aG9kID0gIlBPU1QiOwpkZWYgYm9keV9yZXEgPSBbCiAgICAidGVtcGxhdGVOYW1lIjogIlBVUkNIQVNFX09SREVSX1RPX1NVUFBMSUVSIiwKICAgICJwZWMiOiBmYWxzZSwKICAgICJpc3N1ZUtleSI6IGlzc3VlLmtleQpdCgpiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1snYXBpLmVudiddLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvamlyYS9BQS90cmFuc2FjdGlvbi9tYWlsL3NlbmQiCnVybCA9IG5ldyBVUkwoYmFzZVVSTCkKY29ubmVjdGlvbiA9IChIdHRwVVJMQ29ubmVjdGlvbil1cmwub3BlbkNvbm5lY3Rpb24oKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCIpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQWNjZXB0IiwgIiovKiIpOwpjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwpjb25uZWN0aW9uLnNldERvSW5wdXQodHJ1ZSk7CmNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtCmNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtLndpdGhXcml0ZXIoIlVURi04IikgeyBuZXcgU3RyZWFtaW5nSnNvbkJ1aWxkZXIoaXQsIGJvZHlfcmVxKSB9CmxvZy5kZWJ1ZyBjb25uZWN0aW9uLm91dHB1dFN0cmVhbQpjb25uZWN0aW9uLmNvbm5lY3QoKTsKCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdEVycm9ycyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgIGxvZy5kZWJ1ZyAidXJsOiAiICsgdXJsCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQogICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKICAgIGVMaXN0RXJyb3JzLmFkZCgiRSIpCiAgICBlTGlzdEVycm9ycy5hZGQoIlNFTkRNQUlMIikKICAgIGVycm9yTXNncy5hZGQoY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKSArICIgIiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkpCiAgICBlTGlzdEVycm9ycy5hZGQoZXJyb3JNc2dzKQogICAgZUxpc3QuYWRkKGVMaXN0RXJyb3JzKQoKICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpCn1lbHNlewogICAgCiAgICAvL1VwZGF0ZSBjdXN0b20gZmllbGQgT1BBQV9QVVJDSEFTRV9PUkRFUl9EQVRFCiAgICAKfQ==</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_ACTION">181 Tkt Chiuso</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IENsb3NlIHRrdCBpZiBPRFYgYW5kIE9EQSBoYXZlIGJlZW4gY3JlYXRlZA==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">YCFgY2ZWYWx1ZXNbJ09QX1NBTEVTX09SREVSJ10gIT0gbnVsbCAmJiBjZlZhbHVlc1snT1BfU0FMRVNfT1JERVJfREFURSddICE9IG51bGwgJiYgY2ZWYWx1ZXNbJ09QX1NBTEVTX09SREVSX1RPVEFMJ10gIT0gbnVsbHx8fA==</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS"></arg>
                  <arg name="FIELD_ADDITIONAL_SCRIPT">YCFg</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="181" name="Tkt Chiuso" view="fieldscreen">
          <meta name="opsbar-sequence">70</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19925</meta>
          <results>
            <unconditional-result old-status="null" status="null" step="7">
              <post-functions>
                <function type="class">
                  <arg name="field.name">resolution</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">6</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">cb1f83508d578368bc33689cfe415057fb57da44</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IERvYyBUZW1wbGF0ZSBnZW5lcmF0aW9uIC0gc2UgTmV3IEluc3RhbGxhdGlvbiAtIEdlbmVyYSBDRV9ET0NVTUVOVEFUSU9O</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuV29ya2Zsb3dFeGNlcHRpb247CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgZ3Jvb3Z5Lmpzb24uSnNvblNsdXJwZXI7CmltcG9ydCBncm9vdnkuanNvbi5TdHJlYW1pbmdKc29uQnVpbGRlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5DdXN0b21GaWVsZE1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlTWFuYWdlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3I7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWU7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29kZWMuYmluYXJ5LkJhc2U2NDsKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eXgubmV0Lmh0dHAuSFRUUEJ1aWxkZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCkNsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0RmFjYWRlIik7ICAKQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwpkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwpkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCgpkZWYgZmlyc3RUaWNrZXQgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmZpcnN0VGt0J10udG9TdHJpbmcoKSlbMF0KU3RyaW5nIGFzc2V0Q0YgPSBwcm9wZXJ0aWVzWydjZi5hc3NldCddID8gcHJvcGVydGllc1snY2YuYXNzZXQnXS50b1N0cmluZygpIDogIk9QX0FTU0VUIgpkZWYgYXNzZXQgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUoYXNzZXRDRilbMF0KZGVmIGFzc2V0VmFsdWUgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGFzc2V0KQoKbG9nLmRlYnVnICJhc3NldDogIiArIGFzc2V0ICsgIiwgYXNzZXRWYWx1ZTogIiArIGFzc2V0VmFsdWVbMF0gKyAiIC0gZnJvbSAiICsgYXNzZXRWYWx1ZVswXS50b1N0cmluZygpLmluZGV4T2YoJygnKSsxCgpkZWYgYXNzZXRLZXkgPSBhc3NldFZhbHVlWzBdLnRvU3RyaW5nKCkuc3Vic3RyaW5nKGFzc2V0VmFsdWVbMF0udG9TdHJpbmcoKS5pbmRleE9mKCcoJykrMSxhc3NldFZhbHVlWzBdLnRvU3RyaW5nKCkuaW5kZXhPZignKScpKQoKZGVmIGFzc2V0T2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGFzc2V0S2V5KQoKbG9nLmRlYnVnIGlzc3VlLmdldElzc3VlVHlwZSgpLm5hbWUKbG9nLmRlYnVnIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoZmlyc3RUaWNrZXQpCgoKLyogUkVTVCBBUEkgcGVyIEludmlvIE5vdGlmaWNhIEVtYWlsIE9OU0lURV9SRVBPUlQgKi8KcmVxdWVzdE1ldGhvZCA9ICJHRVQiOwoKaWYoaXNzdWUuZ2V0SXNzdWVUeXBlKCkubmFtZS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpdC5uZXdJbnN0YWxsYXRpb24nXSkpewogICAgYmFzZVVSTCA9ICJodHRwOi8vIiArIHByb3BlcnRpZXNbJ2FwaS5lbnYnXS50b1N0cmluZygpICsgIi9vcC9yZXN0L2F1dG9tYXRpb24vZG9jdW1lbnQvZ2VuZXJhdGlvbi9jaGVjaz9JU1NVRV9LRVk9IisgYXNzZXRPYmplY3QuZ2V0SWQoKS50b1N0cmluZygpICsiJkRPQ19DQVRFR09SWT1DRV9ET0NVTUVOVEFUSU9OIgogICAgbG9nLmRlYnVnIGJhc2VVUkwKICAgIFVSTCB1cmwgPSBuZXcgVVJMKGJhc2VVUkwpCiAgICBIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gKEh0dHBVUkxDb25uZWN0aW9uKXVybC5vcGVuQ29ubmVjdGlvbigpOwogICAgY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwogICAgY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQWNjZXB0IiwgIiovKiIpOwogICAgY29ubmVjdGlvbi5zZXREb091dHB1dCh0cnVlKTsKICAgIGNvbm5lY3Rpb24uc2V0RG9JbnB1dCh0cnVlKTsKICAgIGNvbm5lY3Rpb24uY29ubmVjdCgpOwoKICAgIGRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgZGVmIGVMaXN0RXJyb3JzID0gbmV3IEFycmF5TGlzdCgpCiAgICBkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgogICAgaWYgKCFjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIyMDAiKSl7CiAgICAgICAgbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKICAgICAgICBsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQogICAgICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VNZXNzYWdlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpCiAgICAgICAgbG9nLmRlYnVnICJFcnJvclN0cmVhbTogIiArIGNvbm5lY3Rpb24uZ2V0RXJyb3JTdHJlYW0oKS50b1N0cmluZygpCiAgICAgICAgbG9nLmRlYnVnICJnZXRIZWFkZXJGaWVsZHMoKTogIiArIGNvbm5lY3Rpb24uZ2V0SGVhZGVyRmllbGRzKCkKICAgICAgICBkZWYgb3V0cHV0TXNnID0gKChIdHRwVVJMQ29ubmVjdGlvbiljb25uZWN0aW9uKS5lcnJvclN0cmVhbS50ZXh0CiAgICAgICAgbG9nLmRlYnVnICIoKEh0dHBVUkxDb25uZWN0aW9uKWNvbm5lY3Rpb24pLmVycm9yU3RyZWFtLnRleHQ6ICIgKyBvdXRwdXRNc2cKCiAgICAgICAgZGVmIGpzb25TbHVycGVyID0gbmV3IEpzb25TbHVycGVyKCkKICAgICAgICBkZWYganNvbl9vYmplY3QgPSBqc29uU2x1cnBlci5wYXJzZVRleHQob3V0cHV0TXNnKQogICAgICAgIGFzc2VydCBqc29uX29iamVjdCBpbnN0YW5jZW9mIE1hcCAgCiAgICAgICAgbG9nLmRlYnVnICJtZXNzYWdlOiAiICsgIGpzb25fb2JqZWN0Lm1lc3NhZ2UKCiAgICAgICAgZUxpc3RFcnJvcnMuYWRkKCJFIikKICAgICAgICBlTGlzdEVycm9ycy5hZGQoIk9QLURPQ1MiKQogICAgICAgIGVycm9yTXNncy5hZGQoY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKSArICIgIiArIGpzb25fb2JqZWN0Lm1lc3NhZ2UpCiAgICAgICAgZUxpc3RFcnJvcnMuYWRkKGVycm9yTXNncykKICAgICAgICBlTGlzdC5hZGQoZUxpc3RFcnJvcnMpCgogICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKQogICAgfQp9Cg==</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1A6IE5ldyBJbnN0YWxsYXRpb24gLSBDaGVjayBsaW5rZWRUaWNrZXRzICYgRmFzdC1UcmFuc2FjdCB0aGVt</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5pbmRleC5Jc3N1ZUluZGV4aW5nU2VydmljZQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5XQVJOKQoKbG9nLndhcm4gIiR7aXNzdWUua2V5fSBUcmFuc2F6aW9uZSBUS1QgQ0hJVVNPIC0gUG9zdCBGdW5jdGlvbiBjaGVjayBsaW5rZWRJc3N1ZXMiCgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKZGVmIGF1dG9tYXRpY2FsbHlDb25maXJtZWQgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlEb25lJ10gPyBwcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5RG9uZSddLnRvU3RyaW5nKCkgOiAiT1BfQVVUT01BVElDQUxMWV9ET05FIilbMF0KSXNzdWVJbmRleGluZ1NlcnZpY2UgCWlzc3VlSW5kZXhpbmdTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29tcG9uZW50KElzc3VlSW5kZXhpbmdTZXJ2aWNlKQoKSXNzdWUgaXNzdWUgPSBpc3N1ZQovL1BlciB0ZXN0IGRhIGNvbnNvbGUKLy9pc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiT1BVVC0yNzYiKQoKLypERVYqLwpDTE9TRV9US1QgPSBwcm9wZXJ0aWVzWyd3Zi50ci5jbG9zZSddID8gcHJvcGVydGllc1snd2YudHIuY2xvc2UnXSA6IDE4MQoKLypQUk9EKi8KLy9DT05GSVJNX1RPX0NVU1RPTUVSCgpkZWYgdXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKQpkZWYgaXNzdWVTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVTZXJ2aWNlKCkKCi8qU2UgZXNlZ3VvIGxhIGNvbmZpcm0gdG8gY3VzdG9tZXIgc3UgdW4gdGlja2V0IGNvbiAxIG8gKyB0aWNrZXQgY29sbGVnYXRpLCB2ZXJpZmljbyBlIHNwb3N0byBpbiBhdXRvbWF0aWNvIGdsaSBldmVudHVhbGkgdGlja2V0IGNvbGxlZ2F0aSovCmxvZy53YXJuICJ2ZXJpZmljbyBlIHNwb3N0byBpbiBhdXRvbWF0aWNvIGdsaSBldmVudHVhbGkgdGlja2V0IGNvbGxlZ2F0aSIKCmlmKGlzc3VlLmdldElzc3VlVHlwZSgpLmdldE5hbWUoKSA9PSBwcm9wZXJ0aWVzWydpdC5uZXdJbnN0YWxsYXRpb24nXS50b1N0cmluZygpICYmIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNvbmZpcm1lZCk9PW51bGwgfHwgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKS50b1N0cmluZygpLmVxdWFscygiTm8iKSl7CiAgICBMaXN0PElzc3VlTGluaz4gYWxsSW5Jc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0SW53YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKICAgIGZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgICAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgICAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIGxvZy53YXJuICJJc3N1ZSBjb24gcmVsYXRlc0luSXNzdWVMaW5rIgogICAgICAgICAgICAvKkVzZWd1aXJlIHRyYW5zYXppb25lIGRpIHN0YXRvIGRlbGxhIHNvdXJjZUlzc3VlKi8KICAgICAgICAgICAgZGVmIGxpbmtlZElzc3VlID0gaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZVN0YXR1cyA9IGxpbmtlZElzc3VlLmdldFN0YXR1cygpCiAgICAgICAgICAgIGRlZiB0cmFuc2l0aW9uSWQKICAgICAgICAgICAgaWYobGlua2VkSXNzdWVTdGF0dXMubmFtZSA9PSAocHJvcGVydGllc1snd2YuY29tcGxldGVkVG9CZUNsb3NlZCddID8gcHJvcGVydGllc1snd2YuY29tcGxldGVkVG9CZUNsb3NlZCddLnRvU3RyaW5nKCkgOiAiQ29tcGxldGVkIHRvIGJlIENsb3NlZCIpICl7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9Q0xPU0VfVEtUCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYodHJhbnNpdGlvbklkPT1DTE9TRV9US1QpewogICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBvdXIgaW5wdXQgZm9yIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICBkZWYgaXNzdWVJbnB1dFBhcmFtZXRlcnMgPSBpc3N1ZVNlcnZpY2UubmV3SXNzdWVJbnB1dFBhcmFtZXRlcnMoKQogICAgICAgICAgICAgICAgaXNzdWVJbnB1dFBhcmFtZXRlcnMud2l0aCB7CiAgICAgICAgICAgICAgICAgICAgc2V0U2tpcFNjcmVlbkNoZWNrKHRydWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2RlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDbG9zZWQuZ2V0UmVsZXZhbnRDb25maWcoaXNzdWUpCiAgICAgICAgICAgICAgICAvL0NvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICAvL2lzc3VlSW5wdXRQYXJhbWV0ZXJzLmFkZEN1c3RvbUZpZWxkVmFsdWUoZmllbGRDb25maWcuZ2V0SWQoKSwgIlllcyIpIAogICAgICAgICAgICAgICAgLy9sb2cud2FybiAiaXNzdWVJbnB1dFBhcmFtZXRlcnM6ICIgKyBpc3N1ZUlucHV0UGFyYW1ldGVycwogICAgICAgICAgICAgICAgZGVmIGN1cnJlbnRVc2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpCiAgICAgICAgICAgICAgICBkZWYgbWkgPSAoTXV0YWJsZUlzc3VlKSBsaW5rZWRJc3N1ZQoKICAgICAgICAgICAgICAgIGRlZiBmaWVsZENvbmZpZyA9IGF1dG9tYXRpY2FsbHlDb25maXJtZWQuZ2V0UmVsZXZhbnRDb25maWcobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiZmllbGRDb25maWc6ICIgKyBmaWVsZENvbmZpZwogICAgICAgICAgICAgICAgZGVmIGNmTmV3VmFsdWUgPSBDb21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgYXV0b21hdGljYWxseUNvbmZpcm1lZC51cGRhdGVWYWx1ZShudWxsLCBsaW5rZWRJc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUobGlua2VkSXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q29uZmlybWVkKSwgY2ZOZXdWYWx1ZSksIG5ldyBEZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIoKSkKCiAgICAgICAgICAgICAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpc3N1ZUluZGV4aW5nU2VydmljZS5yZUluZGV4KGxpbmtlZElzc3VlKQogICAgICAgICAgICAgICAgbG9nLndhcm4gIlVwZGF0ZWQgY3VzdG9tZmllbGQgLSBpc3N1ZSBsaW5rYXRhIgoKICAgICAgICAgICAgICAgIC8vZGVmIHZhbGlkYXRpb25SZXN1bHQgPSBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKQogICAgICAgICAgICAgICAgaWYgKGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICBkZWYgaXNzdWVSZXN1bHQgPSBpc3N1ZVNlcnZpY2UudHJhbnNpdGlvbih1c2VyLCBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKSkKICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkZhaWxlZCB0byB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSA3OSAke2xpbmtlZElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259LCAke2xpbmtlZElzc3VlLnN0YXR1c30iKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkNvdWxkIG5vdCB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVTZXJ2aWNlLnZhbGlkYXRlVHJhbnNpdGlvbih1c2VyLCBsaW5rZWRJc3N1ZS5pZCwgdHJhbnNpdGlvbklkLCBpc3N1ZUlucHV0UGFyYW1ldGVycykuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgTGlzdDxJc3N1ZUxpbms+IGFsbE91dElzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRPdXR3YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKICAgIGZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICAgICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICAgICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBsb2cud2FybiAiSXNzdWUgY29uIHJlbGF0ZXNPdXRJc3N1ZUxpbmsiCiAgICAgICAgICAgIC8qRXNlZ3VpcmUgdHJhbnNhemlvbmUgZGkgc3RhdG8gZGVsbGEgZGVzdGluYXRpb25Jc3N1ZSovCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZSA9IGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpCiAgICAgICAgICAgIGRlZiBsaW5rZWRJc3N1ZVN0YXR1cyA9IGxpbmtlZElzc3VlLmdldFN0YXR1cygpCiAgICAgICAgICAgIGRlZiB0cmFuc2l0aW9uSWQKICAgICAgICAgICAgbG9nLndhcm4gImxpbmtlZElzc3VlOiAiICsgbGlua2VkSXNzdWUKICAgICAgICAgICAgbG9nLndhcm4gImxpbmtlZElzc3VlU3RhdHVzLm5hbWU6ICIgKyBsaW5rZWRJc3N1ZVN0YXR1cy5uYW1lCiAgICAgICAgICAgIGlmKGxpbmtlZElzc3VlU3RhdHVzLm5hbWUgPT0gKHByb3BlcnRpZXNbJ3dmLmNvbXBsZXRlZFRvQmVDbG9zZWQnXSA/IHByb3BlcnRpZXNbJ3dmLmNvbXBsZXRlZFRvQmVDbG9zZWQnXS50b1N0cmluZygpIDogIkNvbXBsZXRlZCB0byBiZSBDbG9zZWQiKSl7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uSWQ9Q0xPU0VfVEtUCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKHRyYW5zaXRpb25JZD09Q0xPU0VfVEtUKXsKICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgb3VyIGlucHV0IGZvciB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgZGVmIGlzc3VlSW5wdXRQYXJhbWV0ZXJzID0gaXNzdWVTZXJ2aWNlLm5ld0lzc3VlSW5wdXRQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICAgICAgICAgIHNldFNraXBTY3JlZW5DaGVjayh0cnVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9kZWYgZmllbGRDb25maWcgPSBhdXRvbWF0aWNhbGx5Q2xvc2VkLmdldFJlbGV2YW50Q29uZmlnKGlzc3VlKQogICAgICAgICAgICAgICAgLy9Db21wb25lbnRBY2Nlc3Nvci5vcHRpb25zTWFuYWdlci5nZXRPcHRpb25zKGZpZWxkQ29uZmlnKT8uZmluZCB7IGl0LnRvU3RyaW5nKCkgPT0gIlllcyIgfQogICAgICAgICAgICAgICAgLy9pc3N1ZUlucHV0UGFyYW1ldGVycy5hZGRDdXN0b21GaWVsZFZhbHVlKGZpZWxkQ29uZmlnLmdldElkKCksICJZZXMiKSAKCiAgICAgICAgICAgICAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgICAgICAgICAgICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgICAgICAgICAgICAgZGVmIGZpZWxkQ29uZmlnID0gYXV0b21hdGljYWxseUNvbmZpcm1lZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgICAgICAgICAgICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICAgICAgICAgICAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5Q29uZmlybWVkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDb25maXJtZWQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoKICAgICAgICAgICAgICAgIENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlzc3VlSW5kZXhpbmdTZXJ2aWNlLnJlSW5kZXgobGlua2VkSXNzdWUpCiAgICAgICAgICAgICAgICBsb2cud2FybiAiVXBkYXRlZCBjdXN0b21maWVsZCAtIGlzc3VlIGxpbmthdGEiCgogICAgICAgICAgICAgICAgaWYgKGlzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgICAgICBkZWYgaXNzdWVSZXN1bHQgPSBpc3N1ZVNlcnZpY2UudHJhbnNpdGlvbih1c2VyLCBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCB0cmFuc2l0aW9uSWQsIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKSkKICAgICAgICAgICAgICAgICAgICBpZiAoISBpc3N1ZVJlc3VsdC5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oIkZhaWxlZCB0byB0cmFuc2l0aW9uIHRhc2sgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSIpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJUcmFuc2F6aW9uZSBmYXR0YSAxMjIgJHtsaW5rZWRJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7aXNzdWVSZXN1bHQuZXJyb3JDb2xsZWN0aW9ufSwgJHtsaW5rZWRJc3N1ZS5zdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKCJDb3VsZCBub3QgdHJhbnNpdGlvbiB0YXNrICR7bGlua2VkSXNzdWUua2V5fSwgZXJyb3JzOiAke2lzc3VlU2VydmljZS52YWxpZGF0ZVRyYW5zaXRpb24odXNlciwgbGlua2VkSXNzdWUuaWQsIHRyYW5zaXRpb25JZCwgaXNzdWVJbnB1dFBhcmFtZXRlcnMpLmVycm9yQ29sbGVjdGlvbn0iKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgIH0KfQ==</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="191" name="Invia Consuntivo al Cliente" view="fieldscreen">
          <meta name="opsbar-sequence">30</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19911</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="FIELD_NOTES">YCFg</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">fada32c2-b768-4770-816d-beeac0f8e084</arg>
                <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIEZJTkFOQ0lBTF9TVEFURU1FTlRfVE9fQ1VTVE9NRVIgLSBJZiBpdCdzIG51bGwgdGhlIGVtYWlsIGhhcyBub3QgYmVlbiBzZW50IHlldA==</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgeyJzY3JpcHQiOiJpbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lclxuaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsXG5cblByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKClcbkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpXG5wcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0ge1xuXHRwcm9wZXJ0aWVzLmxvYWQoaXQpXG59XG5jZlZhbHVlc1twcm9wZXJ0aWVzWydjZi53ZkZpbmFuY2lhbFN0YXRtVG9DJ11dID09IG51bGwiLCJzY3JpcHRQYXRoIjpudWxsfQ==</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">e70180eb-0cf2-468c-b6c4-1eeded83980b</arg>
                <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIE9QX0FVVE9NQVRJQ0FMTFlfQ0xPU0VEIC0gaWYgWWVzIGRvbid0IGFsbG93IHRyYW5zaXRpb24=</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgeyJzY3JpcHQiOiJpbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lclxuaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsXG5cblByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKClcbkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpXG5wcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0ge1xuXHRwcm9wZXJ0aWVzLmxvYWQoaXQpXG59XG5jZlZhbHVlc1twcm9wZXJ0aWVzWydjZi5hdXRvbWF0aWNhbGx5Q2xvc2VkJ11dID09IG51bGwgfHwgY2ZWYWx1ZXNbcHJvcGVydGllc1snY2YuYXV0b21hdGljYWxseUNsb3NlZCddXT8udmFsdWUgPT0gJ05vJyIsInNjcmlwdFBhdGgiOm51bGx9</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">6c786cdf0a6d0ad4b6b1d34c1ad1598920327ad2</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcyAtIHNvbG8gZXJyb3JzLCBubyB3YXJuaW5ncw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQogCklzc3VlIGlzc3VlID0gaXNzdWUKLy9Jc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7Ci8vSXNzdWUgaXNzdWUgPSBpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVCeUtleUlnbm9yZUNhc2UoIk9QVVQtMzk2IikKCmRlZiBlcnJvcnMgPSBmYWxzZQpkZWYgd2FybmluZ3MgPSBmYWxzZQoKZGVmIGx1bXBTdW1QcmljZSA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YubHVtcFN1bVByaWNlJ10udG9TdHJpbmcoKSlbMF0KCi8qQ2FtcGkgY29uIGRhdGkgb2JibGlnYXRvcmkgcGVyIHRpY2tldCBub24gYSBjb3JwbyovCmRlZiByZXBNYXRlcmlhbHMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnJlcGxhY2VkTWF0ZXJpYWxzJ10udG9TdHJpbmcoKSlbMF0KZGVmIHVuYVRhbnR1bVJhdGVzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi51bmF0YW50dW1SYXRlcyddLnRvU3RyaW5nKCkpWzBdCmRlZiBsYWJvdXJSYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YubGFib3VyUmF0ZXMnXS50b1N0cmluZygpKVswXQpkZWYgdHJhdmVsUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnRyYXZlbFJhdGVzJ10udG9TdHJpbmcoKSlbMF0KCi8qQ2FtcGkgY29uIGRhdGkgb2JibGlnYXRvcmkgcGVyIHRpY2tldCBhIGNvcnBvKi8KZGVmIGx1bXBTdW1SYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YubHVtcFN1bVJhdGVzJ10udG9TdHJpbmcoKSlbMF0KCi8qQ29uZmVybWEgdXRlbnRlIHN1IHdhcm5pbmdzKi8KZGVmIHRyYW5zaXRpb25DaGVjayA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuY2hlY2tBbmRDb25maXJtJ10udG9TdHJpbmcoKSlbMF0KCi8qSW5zaWdodCBTY2hlbWEgSURzKi8KZGVmIERCT2JqZWN0cyA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuZGJvJ10udG9TdHJpbmcoKSArICItIgpkZWYgT1BBQSA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuYWEnXS50b1N0cmluZygpICsgIi0iCgpkZWYgZXJyb3JNYW5kYXRvcnlGaWVsZHMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVycm9ySm9iU3RhcnRlZENvbXBsZXRlZEZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgd2FybmluZ0VtcHR5RmllbGRzID0gbmV3IEFycmF5TGlzdCgpCmRlZiB3YXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCmRlZiB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lciA9IG5ldyBBcnJheUxpc3QoKQoKLy90cnl7CiAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1QcmljZSkhPW51bGwgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUHJpY2UpLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CiAgICAgICAgLypDb250YWJpbGl6emF6aW9uZSBhIGNvcnBvKi8KICAgICAgICBsb2cuZGVidWcgIkNvbnRhYmlsaXp6YXppb25lIGEgY29ycG8iCiAgICAgICAgLy9PUEFBX0xVTVBfU1VNX1JBVEVTCiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICAgICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgICAgICAgICBkZWYgbHNSYXRlc0xpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykKCQkJbG9nLmRlYnVnIGxzUmF0ZXNMaXN0CiAgICAgICAgICAgIGZvcihscyBpbiBsc1JhdGVzTGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGU9bHMudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJsc1JhdGU6ICIgKyBsc1JhdGUKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVLZXkgPSBsc1JhdGUuc3Vic3RyaW5nKGxzUmF0ZS5pbmRleE9mKCcoJykrMSxsc1JhdGUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJsc1JhdGVLZXk6ICIgKyBsc1JhdGVLZXkKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obHNSYXRlS2V5KQogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJsc1JhdGVPYmplY3Q6ICIgKyBsc1JhdGVPYmplY3QKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgbHNBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJsc0FwcGxpZWRUbzogIiArIGxzQXBwbGllZFRvCiAgICAgICAgICAgICAgICBkZWYgbHNBcHBsaWVkVG9WYWx1ZQogICAgICAgICAgICAgICAgaWYgKGxzQXBwbGllZFRvKXsKICAgICAgICAgICAgICAgICAgICBsc0FwcGxpZWRUb1ZhbHVlID0gbHNBcHBsaWVkVG8uc3Vic3RyaW5nKGxzQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLGxzQXBwbGllZFRvLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAib2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBSQVRFX1JFRik6ICIgKyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyAibHNSYXRlUmVmOiAiICsgbHNSYXRlUmVmCiAgICAgICAgICAgICAgICBkZWYgbHNSYXRlUmVmS2V5CiAgICAgICAgICAgICAgICBkZWYgbHNSYXRlUmVmVmFsdWUKICAgICAgICAgICAgICAgIGlmKGxzUmF0ZVJlZi5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWYgPSBsc1JhdGVSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxzUmF0ZVJlZktleSA9IGxzUmF0ZVJlZi5zdWJzdHJpbmcobHNSYXRlUmVmLmluZGV4T2YoJygnKSsxLGxzUmF0ZVJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgZGVmIGxzUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgbHNSYXRlUmVmS2V5KQogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBsc1JhdGVSZWZPYmplY3QKICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxzUmF0ZVJlZlZhbHVlID0gbHNSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZihsc0FwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgbHNBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQ1VTVE9NRVIiKSl7CiAgICAgICAgICAgICAgICAgICAgLy9nZXQgIlRPVEFMX0FNT1VOVF9DVVNUT01FUiIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZChsc1JhdGVSZWZWYWx1ZS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0gICAgCiAgICAgICAgfQoKICAgIH1lbHNlewogICAgICAgIC8qQ29udGFiaWxpenphemlvbmUgbm9uIGEgY29ycG8qLwogICAgICAgIGxvZy5kZWJ1ZyAiQ29udGFiaWxpenphemlvbmUgTk9OIGEgY29ycG8iCgogICAgICAgIC8vT1BBQV9SRVBMQUNFRF9NQVRFUklBTFMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAiTWF0ZXJpYWxpOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIHJlcE1hdExpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKCiAgICAgICAgICAgIGZvcihtYXQgaW4gcmVwTWF0TGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiBjb21wb25lbnQ9bWF0LnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGRlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJytPUEFBKSsxLGNvbXBvbmVudC5sZW5ndGgoKS0xKQogICAgICAgICAgICAgICAgZGVmIGNvbXBvbmVudE9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihjb21wb25lbnRLZXkpCiAgICAgICAgICAgICAgICAvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICBkZWYgYXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgICAgICAgICAgZGVmIGFwcGxpZWRUb1ZhbHVlCiAgICAgICAgICAgICAgICBpZihhcHBsaWVkVG8uc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgYXBwbGllZFRvID0gYXBwbGllZFRvLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBhcHBsaWVkVG9WYWx1ZSA9IGFwcGxpZWRUby5zdWJzdHJpbmcoYXBwbGllZFRvLmluZGV4T2YoJygnKSsxLGFwcGxpZWRUby5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgLy9sb2cuZGVidWcgImFwcGxpZWRUb1ZhbHVlOiAiICsgYXBwbGllZFRvVmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGVmIG1hdE51bWJlciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyS2V5CiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyVmFsdWUKICAgICAgICAgICAgICAgIGlmKG1hdE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXIgPSBtYXROdW1iZXIudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIG1hdE51bWJlcktleSA9IG1hdE51bWJlci5zdWJzdHJpbmcobWF0TnVtYmVyLmluZGV4T2YoJygnKSsxLG1hdE51bWJlci5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgZGVmIG1hdE51bWJlck9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihEQk9iamVjdHMgKyBtYXROdW1iZXJLZXkpCiAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obWF0TnVtYmVyT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoubWF0ZXJpYWwubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyVmFsdWUgPSBtYXROdW1iZXJWYWx1ZS5zdWJzdHJpbmcobWF0TnVtYmVyVmFsdWUuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkZWYgc2VyaWFsTnVtYmVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zZXJpYWxOdW1iZXInXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdCA6IG51bGwKICAgICAgICAgICAgICAgIGRlZiBzZXJpYWxOdW1iZXJWYWx1ZQogICAgICAgICAgICAgICAgaWYoc2VyaWFsTnVtYmVyICYmIHNlcmlhbE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXIgPSBzZXJpYWxOdW1iZXIudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlclZhbHVlID0gc2VyaWFsTnVtYmVyLnN1YnN0cmluZyhzZXJpYWxOdW1iZXIuaW5kZXhPZignKCcpKzEsc2VyaWFsTnVtYmVyLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICBpZihhcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKXsKICAgICAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBkZWYgdG90Q3VzdG9tZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSA6IG51bGwKICAgICAgICAgICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuYWRkKG1hdE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAoKHNlcmlhbE51bWJlciAmJiBzZXJpYWxOdW1iZXIuc2l6ZSgpID4gMCkgPyAiICgiICsgc2VyaWFsTnVtYmVyVmFsdWUudG9TdHJpbmcoKSArICIpIiA6ICIgKCkiKSkgICAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9ICAgIAogICAgICAgIH0gIAoKICAgICAgICAvL09QQUFfVU5BVEFOVFVNX1JBVEVTCiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICAgICAgbG9nLmRlYnVnICJVbmEgdGFudHVtIHJhdGVzOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykKICAgICAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICAgICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgICAgICAgICBkZWYgdW1SYXRlc0xpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKQoKICAgICAgICAgICAgZm9yKHVtIGluIHVtUmF0ZXNMaXN0KXsKICAgICAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgZGVmIHVtUmF0ZT11bS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlS2V5ID0gdW1SYXRlLnN1YnN0cmluZyh1bVJhdGUuaW5kZXhPZignKCcpKzEsdW1SYXRlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4odW1SYXRlS2V5KQogICAgICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgICAgIGRlZiB1bUFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgdW1BcHBsaWVkVG9WYWx1ZSA9IHVtQXBwbGllZFRvLnN1YnN0cmluZyh1bUFwcGxpZWRUby5pbmRleE9mKCcoJykrMSx1bUFwcGxpZWRUby5pbmRleE9mKCcpJykpCgogICAgICAgICAgICAgICAgZGVmIHVtUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQoKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZLZXkKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZWYWx1ZQogICAgICAgICAgICAgICAgaWYodW1SYXRlUmVmLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIHVtUmF0ZVJlZiA9IHVtUmF0ZVJlZi50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmS2V5ID0gdW1SYXRlUmVmLnN1YnN0cmluZyh1bVJhdGVSZWYuaW5kZXhPZignKCcpKzEsdW1SYXRlUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB1bVJhdGVSZWZLZXkpCiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5OYW1lJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5OYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiBudWxsCiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmVmFsdWUgPSB1bVJhdGVSZWZWYWx1ZSA/IHVtUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyh1bVJhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx1bVJhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpIDogbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZih1bUFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgdW1BcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQ1VTVE9NRVIiKSl7CiAgICAgICAgICAgICAgICAgICAgLy9nZXQgIlRPVEFMX0FNT1VOVF9DVVNUT01FUiIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHVtUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih1bVJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIDogbnVsbAogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKHVtUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSAgICAKICAgICAgICB9CgogICAgICAgIC8vT1BBQV9MQUJPVVJfUkFURVMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICBsb2cuZGVidWcgIkxhYm91ciByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgogICAgICAgICAgICBmb3IobGIgaW4gbGFib3VyUmF0ZXNMaXN0KXsKICAgICAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlS2V5ID0gbGJSYXRlLnN1YnN0cmluZyhsYlJhdGUuaW5kZXhPZignKCcpKzEsbGJSYXRlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBsYlJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obGJSYXRlS2V5KQogICAgICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgICAgIGRlZiBsYkFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbGJBcHBsaWVkVG9WYWx1ZSA9IGxiQXBwbGllZFRvLnN1YnN0cmluZyhsYkFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxsYkFwcGxpZWRUby5pbmRleE9mKCcpJykpCgogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlUmVmS2V5CiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlUmVmVmFsdWUKICAgICAgICAgICAgICAgIGlmKGxiUmF0ZVJlZi5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBsYlJhdGVSZWYgPSBsYlJhdGVSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZktleSA9IGxiUmF0ZVJlZi5zdWJzdHJpbmcobGJSYXRlUmVmLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgbGJSYXRlUmVmS2V5KQogICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnJhdGUuTmFtZSddLnRvU3RyaW5nKCkpID8gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnJhdGUuTmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpIDogbnVsbAogICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZlZhbHVlID0gbGJSYXRlUmVmVmFsdWUgPyBsYlJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcobGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKSA6IG51bGwKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZihsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgbGJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQ1VTVE9NRVIiKSl7CiAgICAgICAgICAgICAgICAgICAgLy9nZXQgIlRPVEFMX0FNT1VOVF9DVVNUT01FUiIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIDogbnVsbAogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKGxiUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSAgICAKICAgICAgICB9CgogICAgICAgIC8vT1BBQV9UUkFWRUxfUkFURVMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYXZlbFJhdGVzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICBsb2cuZGVidWcgIlRyYXZlbCByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIHRyYXZlbFJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpCgogICAgICAgICAgICBmb3IodHIgaW4gdHJhdmVsUmF0ZXNMaXN0KXsKICAgICAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZT10ci50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgdHJSYXRlS2V5ID0gdHJSYXRlLnN1YnN0cmluZyh0clJhdGUuaW5kZXhPZignKCcpKzEsdHJSYXRlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiB0clJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4odHJSYXRlS2V5KQogICAgICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgICAgIGRlZiB0ckFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpID8gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiBudWxsCiAgICAgICAgICAgICAgICBkZWYgdHJBcHBsaWVkVG9WYWx1ZSA9IHRyQXBwbGllZFRvID8gdHJBcHBsaWVkVG8uc3Vic3RyaW5nKHRyQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLHRyQXBwbGllZFRvLmluZGV4T2YoJyknKSkgOiBudWxsCgogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKSA6IG51bGwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZktleQogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZVJlZlZhbHVlCiAgICAgICAgICAgICAgICBpZih0clJhdGVSZWYuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgdHJSYXRlUmVmID0gdHJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWZLZXkgPSB0clJhdGVSZWYuc3Vic3RyaW5nKHRyUmF0ZVJlZi5pbmRleE9mKCcoJykrMSx0clJhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiB0clJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIHRyUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKSA/IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKSA6IG51bGwKICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWZWYWx1ZSA9IHRyUmF0ZVJlZlZhbHVlID8gdHJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKHRyUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLHRyUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkgOiBudWxsCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYodHJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkNVU1RPTUVSIikpewogICAgICAgICAgICAgICAgICAgIC8vZ2V0ICJUT1RBTF9BTU9VTlRfQ1VTVE9NRVIiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIGRlZiB0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSA6IG51bGwKICAgICAgICAgICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZCh0clJhdGVSZWZWYWx1ZS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0gICAgCiAgICAgICAgfQoKICAgIH0KCgogICAgZGVmIG91dHB1dCA9IG5ldyBBcnJheUxpc3QoKQoKICAgIGlmICghZXJyb3JzICYmICF3YXJuaW5ncyl7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH1lbHNlewogICAgICAgIGlmKCFlcnJvcnMgJiYgd2FybmluZ3MpewogICAgICAgICAgICAvL1NlIGNpIHNvbm8gc29sbyB3YXJuaW5ncyB2ZXJpZmljbyBzZSBsJ3V0ZW50ZSBoYSBnacOgIGRpY2hpYXJhdG8gZGkgdm9sZXIgcHJvc2VndWlyZSBjb211bnF1ZQogICAgICAgICAgICAvLyAtIHRyYW5zaXRpb24gZmllbGQgIk9QQUFfQ0hFQ0tfQU5EX0NPTkZJUk0iPSJZZXMiCiAgICAgICAgICAgIC8vIC0gaW4gY2FzbyBjb250cmFyaW8gaW52aW8gaSB3YXJuaW5nIGEgRkUKCiAgICAgICAgICAgIC8vbG9nLmRlYnVnICJ0cmFuc2l0aW9uQ2hlY2s6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykKICAgICAgICAgICAgLy9sb2cuZGVidWcgInJlc3VsdDogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKS50b1N0cmluZygpLmVxdWFscygiWWVzIikKICAgICAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CiAgICAgICAgICAgICAgICAvL2xvZy5kZWJ1ZyAicmV0dXJuIHRydWUgLSB0cmFuc2l0aW9uQ2hlY2sgPSBZZXMiCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIGRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICAgICAgICAgIGlmKHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKCJXIikKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX1JBVEVTIikKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCh3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcikKCiAgICAgICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5UmF0ZSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZih3YXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URSIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQobnVsbCkKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZCh3YXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyKQoKICAgICAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgICAgICAgICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiVyIsIG91dHB1dC50b1N0cmluZygpKSAgIAogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICBpZihlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgICAgICAgICAgZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgogICAgICAgICAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKICAgICAgICB9CiAgICAgICAgaWYoZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICAgICAgZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIGRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICAgICAgaWYod2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfUkFURVMiKQogICAgICAgICAgICAgICAgCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQobnVsbCkKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyKQoKICAgICAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlSYXRlKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKHdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZCgiVyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFIikKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChudWxsKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKHdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIpCgogICAgICAgICAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICAgICAgb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiV0UiLCBvdXRwdXQudG9TdHJpbmcoKSkgIAogICAgICAgIH0KICAgIH0KLy99Y2F0Y2goRXhjZXB0aW9uIGUpewovLyAgICBsb2cuZGVidWcgIkV4Y2VwdGlvbjogIiArIGUKLy8gICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRXhjZXB0aW9uIiwgZS50b1N0cmluZygpKSAgCi8vfQo=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">8a3daba2cbc0fa976eb28f598d455a84abf02ad8</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IFJFU1QgQVBJOiBPUCBnZW5lcmF6aW9uZSBDb25zdW50aXZv</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCgovKiBSRVNUIEFQSSBwZXIgR2VuZXJhemlvbmUgQWxsZWdhdG8gQ29uc3VudGl2byAqLwpyZXF1ZXN0TWV0aG9kID0gIlBVVCI7CgpkZWYgcmVsYXRlc0luSXNzdWVMaW5rPWZhbHNlCmRlZiByZWxhdGVzT3V0SXNzdWVMaW5rPWZhbHNlCmRlZiBsaW5rZWRUaWNrZXRzPW5ldyBBcnJheUxpc3QoKQpMaXN0PElzc3VlTGluaz4gYWxsSW5Jc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0SW53YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsSW5Jc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgcmVsYXRlc0luSXNzdWVMaW5rPXRydWUKICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkudG9TdHJpbmcoKSkKICAgICAgICBsb2cuZGVidWcgIklzc3VlIGNvbiByZWxhdGVzSW5Jc3N1ZUxpbmsiCiAgICB9Cn0KTGlzdDxJc3N1ZUxpbms+IGFsbE91dElzc3VlTGluayA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTGlua01hbmFnZXIoKS5nZXRPdXR3YXJkTGlua3MoaXNzdWUuZ2V0SWQoKSkKZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsT3V0SXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgIHJlbGF0ZXNPdXRJc3N1ZUxpbms9dHJ1ZQogICAgICAgIGxpbmtlZFRpY2tldHMuYWRkKGlzc3VlTGluay5nZXREZXN0aW5hdGlvbk9iamVjdCgpLnRvU3RyaW5nKCkpCiAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc091dElzc3VlTGluayIKICAgIH0KfQoKYmFzZVVSTCA9ICJodHRwOi8vIiArIHByb3BlcnRpZXNbJ2FwaS5lbnYnXS50b1N0cmluZygpICsgIi9vcC9yZXN0L2F1dG9tYXRpb24vQUEvdGlja2V0LyIgKyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIvYXR0YWNobWVudC9iYWxhbmNlIgoKaWYocmVsYXRlc0luSXNzdWVMaW5rIHx8IHJlbGF0ZXNPdXRJc3N1ZUxpbmspewogICAgYmFzZVVSTCA9IGJhc2VVUkwgKyAiP2xpbmtlZFRpY2tldHM9IiArIGxpbmtlZFRpY2tldHMudG9TdHJpbmcoKS5yZXBsYWNlQWxsKCJcXFsiLCIiKS5yZXBsYWNlQWxsKCJcXF0iLCIiKS5yZXBsYWNlQWxsKCIgIiwiIikKfQoKbG9nLmRlYnVnICJiYXNlVXJsOiAiICsgYmFzZVVSTAoKVVJMIHVybAp1cmwgPSBuZXcgVVJMKGJhc2VVUkwpCkh0dHBVUkxDb25uZWN0aW9uIGNvbm5lY3Rpb24gPSAoSHR0cFVSTENvbm5lY3Rpb24pdXJsLm9wZW5Db25uZWN0aW9uKCk7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdE1ldGhvZChyZXF1ZXN0TWV0aG9kKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uIik7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJBY2NlcHQiLCAiKi8qIik7CmNvbm5lY3Rpb24uc2V0RG9PdXRwdXQodHJ1ZSk7CmNvbm5lY3Rpb24uc2V0RG9JbnB1dCh0cnVlKTsKY29ubmVjdGlvbi5jb25uZWN0KCk7CgpkZWYgb3V0cHV0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZUxpc3RFcnJvcnMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVycm9yTXNncyA9IG5ldyBBcnJheUxpc3QoKQoKaWYgKCFjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIyMDAiKSl7CiAgICBsb2cuZGVidWcgInVybDogIiArIHVybAogICAgbG9nLmRlYnVnICJSZXNwb25zZUNvZGU6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VNZXNzYWdlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpCiAgICBlTGlzdEVycm9ycy5hZGQoIkUiKQogICAgZUxpc3RFcnJvcnMuYWRkKCJHRU5FUkFURS1BQ0NPVU5USU5HUkVQT1JUIikKICAgIGVycm9yTXNncy5hZGQoY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKSArICIgIiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkpCiAgICBlTGlzdEVycm9ycy5hZGQoZXJyb3JNc2dzKQogICAgZUxpc3QuYWRkKGVMaXN0RXJyb3JzKQoKICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpCn0K</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">7f809f6e87447e19ed7c9921bc7d6a28aed7bf3f</arg>
              <arg name="FIELD_NOTES">YCFgT1AgRW1haWwgTm90aWZpY2F0aW9uOiBGSU5BTkNJQUxfU1RBVEVNRU5UX1RPX0NVU1RPTUVS</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCgpkZWYgREJPPXByb3BlcnRpZXNbJ2lzY2hlbWEuZGJvLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQovKiBSRVNUIEFQSSBwZXIgSW52aW8gTm90aWZpY2EgRW1haWwgT05TSVRFX1JFUE9SVCAqLwpyZXF1ZXN0TWV0aG9kID0gIlBPU1QiOwoKZGVmIHJlbGF0ZXNJbklzc3VlTGluaz1mYWxzZQpkZWYgcmVsYXRlc091dElzc3VlTGluaz1mYWxzZQpkZWYgbGlua2VkVGlja2V0cz1uZXcgQXJyYXlMaXN0KCkKTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgIHJlbGF0ZXNJbklzc3VlTGluaz10cnVlCiAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpLnRvU3RyaW5nKCkpCiAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc0luSXNzdWVMaW5rIgogICAgfQp9Ckxpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICByZWxhdGVzT3V0SXNzdWVMaW5rPXRydWUKICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKS50b1N0cmluZygpKQogICAgICAgIGxvZy5kZWJ1ZyAiSXNzdWUgY29uIHJlbGF0ZXNPdXRJc3N1ZUxpbmsiCiAgICB9Cn0KCmRlZiBib2R5X3JlcQppZihyZWxhdGVzSW5Jc3N1ZUxpbmsgfHwgcmVsYXRlc091dElzc3VlTGluayl7CiAgICBib2R5X3JlcSA9IFsKICAgICAgICAidGVtcGxhdGVOYW1lIjogcHJvcGVydGllc1sndHQuZmluYW5jaWFsU3RhdGVtZW50VG9DJ10udG9TdHJpbmcoKSwKICAgICAgICAicGVjIjogZmFsc2UsCiAgICAgICAgImlzc3VlS2V5IjogaXNzdWUua2V5LAogICAgICAgICJsaW5rZWRUaWNrZXRzIjogbGlua2VkVGlja2V0cwogICAgXQp9ZWxzZXsKICAgIGJvZHlfcmVxID0gWwogICAgICAgICJ0ZW1wbGF0ZU5hbWUiOiBwcm9wZXJ0aWVzWyd0dC5maW5hbmNpYWxTdGF0ZW1lbnRUb0MnXS50b1N0cmluZygpLAogICAgICAgICJwZWMiOiBmYWxzZSwKICAgICAgICAiaXNzdWVLZXkiOiBpc3N1ZS5rZXkKICAgIF0KfQoKYmFzZVVSTCA9ICJodHRwOi8vIiArIHByb3BlcnRpZXNbJ2FwaS5lbnYnXS50b1N0cmluZygpICsgIi9vcC9yZXN0L2ppcmEvQUEvdHJhbnNhY3Rpb24vbWFpbC9zZW5kIgpVUkwgdXJsCnVybCA9IG5ldyBVUkwoYmFzZVVSTCkKSHR0cFVSTENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IChIdHRwVVJMQ29ubmVjdGlvbil1cmwub3BlbkNvbm5lY3Rpb24oKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCIpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQWNjZXB0IiwgIiovKiIpOwpjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwpjb25uZWN0aW9uLnNldERvSW5wdXQodHJ1ZSk7CmNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtCmNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtLndpdGhXcml0ZXIoIlVURi04IikgeyBuZXcgU3RyZWFtaW5nSnNvbkJ1aWxkZXIoaXQsIGJvZHlfcmVxKSB9CmxvZy5kZWJ1ZyBjb25uZWN0aW9uLm91dHB1dFN0cmVhbQpjb25uZWN0aW9uLmNvbm5lY3QoKTsKCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdEVycm9ycyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgIGxvZy5kZWJ1ZyAidXJsOiAiICsgdXJsCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQogICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2U6ICIgKyBjb25uZWN0aW9uCiAgICAKICAgIC8qUk9MTEJBQ0sqLwogICAgLypSaW1vemlvbmUgYWxsZWdhdG8gY29uc3VudGl2byBhcHBlbmEgY3JlYXRvKi8KICAgIC8qIEdldCBJbnNpZ2h0IElRTCBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KICAgIENsYXNzIGlxbEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlIik7IAogICAgZGVmIGlxbEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShpcWxGYWNhZGVDbGFzcyk7CgogICAgLyogR2V0IEluc2lnaHQgT2JqZWN0IEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwogICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsKICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgIC8qIEdldCBJbnNpZ2h0IE9iamVjdCBUeXBlIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwogICAgQ2xhc3Mgb2JqZWN0VHlwZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZSIpOwogICAgZGVmIG9iamVjdFR5cGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUZhY2FkZUNsYXNzKTsKCiAgICAvKiBHZXQgSW5zaWdodCBPYmplY3QgQXR0cmlidXRlIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwogICAgQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwogICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKCiAgICBDbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5zZXJ2aWNlcy5tb2RlbC5mYWN0b3J5Lk9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Iik7CiAgICBkZWYgb2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnkgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnlDbGFzcyk7CgogICAgLyogU3BlY2lmeSB0aGUgc2NoZW1hIGlkIGFzIHdlbGwgYXMgdGhlIElRTCB0aGF0IHdpbGwgZmV0Y2ggb2JqZWN0cy4gSW4gdGhpcyBjYXNlIGFsbCBvYmplY3RzIHdpdGggTmFtZSBtYXRjaGluZyB0aGUgdmFsdWVDRiwgYmUgc3VyZSB0byBpbmNsdWRlICIgYXJvdW5kIHZhbHVlICovCiAgICBkZWYgb2JqZWN0cyA9IGlxbEZhY2FkZS5maW5kT2JqZWN0c0J5SVFMQW5kU2NoZW1hKERCTywgIlwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmNhdGVnb3J5UmVmJ10udG9TdHJpbmcoKSArICJcIi5cIiIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5uYW1lJ10udG9TdHJpbmcoKSArICJcIiA9IFwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm9ianMuY29uc3VudGl2byddLnRvU3RyaW5nKCkgKyAiXCIgQU5EICIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5kZWxldGVkJ10udG9TdHJpbmcoKSArICIhPXRydWUgQU5EIG9iamVjdCBIQVZJTkcgY29ubmVjdGVkVGlja2V0cyhrZXkgPSAiICsgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiKSIpOyAvLyBTZWUgdGhlIGNvbXBsZXRlIGxpc3Qgb2YgcG9zc2libGUgSVFMIG9uIHRoZSBJbnNpZ2h0IFF1ZXJ5IExhbmd1YWdlIGRvY3VtZW50YXRpb24gcGFnZQogICAgLyogSWYgdGhpcyBpcyBhIG1hbmRhdG9yeSBmaWVsZCB5b3Ugc2hvdWxkIGJlIGFibGUgdG8gZG8gdGhpczogKi8KICAgIGxvZy5pbmZvKCJJbnNpZ2h0IG9iamVjdDogIiArIG9iamVjdHNbMF0pOwogICAgCiAgICBpZihvYmplY3RzWzBdKXsKICAgICAgICAvKiBVUERBVEUgT0pCRUNUIERFTEVURUQgVkFMVUUgKi8KICAgICAgICBkZWYgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4ob2JqZWN0c1swXS5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5kZWxldGVkJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpICAKICAgICAgICBkZWYgdmFsdWUgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCiAgICAgICAgZGVmIHZhbHVlQmVhbiA9IG9iVHJpYWdlLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpCiAgICAgICAgdmFsdWVCZWFuLnNldFZhbHVlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKG9iVHJpYWdlLmdldE9iamVjdFR5cGVBdHRyaWJ1dGVJZCgpKSwgdHJ1ZSkKICAgICAgICAvKkNsZWFuIGFjdHVhbCB2YWx1ZSovCiAgICAgICAgdmFsdWUuY2xlYXIoKQogICAgICAgIHZhbHVlLmFkZCh2YWx1ZUJlYW4pOwogICAgICAgIG9iVHJpYWdlLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWUpCgogICAgICAgIC8vVXBkYXRlIE9KQkVDVCBhdHRyaWJ1dGUgdmFsdWUKICAgICAgICB0cnkgewogICAgICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5zdG9yZU9iamVjdEF0dHJpYnV0ZUJlYW4ob2JUcmlhZ2UpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiB2aWUpIHsKICAgICAgICAgICAgbG9nLndhcm4oIkNvdWxkIG5vdCB1cGRhdGUgb2JqZWN0IGF0dHJpYnV0ZSBkdWUgdG8gdmFsaWRhdGlvbiBleGNlcHRpb246IiArIHZpZS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZGVmIG91dHB1dE1zZyA9ICgoSHR0cFVSTENvbm5lY3Rpb24pY29ubmVjdGlvbikuZXJyb3JTdHJlYW0udGV4dAogICAgbG9nLmRlYnVnICIoKEh0dHBVUkxDb25uZWN0aW9uKWNvbm5lY3Rpb24pLmVycm9yU3RyZWFtLnRleHQ6ICIgKyBvdXRwdXRNc2cKCiAgICBkZWYganNvblNsdXJwZXIgPSBuZXcgSnNvblNsdXJwZXIoKQogICAgZGVmIGpzb25fb2JqZWN0ID0ganNvblNsdXJwZXIucGFyc2VUZXh0KG91dHB1dE1zZykKICAgIGFzc2VydCBqc29uX29iamVjdCBpbnN0YW5jZW9mIE1hcCAgCiAgICBsb2cuZGVidWcgIm1lc3NhZ2U6ICIgKyAganNvbl9vYmplY3QubWVzc2FnZQoKICAgIGVMaXN0RXJyb3JzLmFkZCgiRSIpCiAgICBlTGlzdEVycm9ycy5hZGQoIlNFTkRNQUlMIikKICAgIGVycm9yTXNncy5hZGQoY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKSArICIgIiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkpCiAgICBlTGlzdEVycm9ycy5hZGQoanNvbl9vYmplY3QubWVzc2FnZSkKICAgIGVMaXN0LmFkZChlTGlzdEVycm9ycykKICAgIAogICAgb3V0cHV0LmFkZChlTGlzdCkKICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkKfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="6">
              <post-functions>
                <function type="class">
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="append.value"></arg>
                  <arg name="field.value">%%CURRENT_DATETIME%%</arg>
                  <arg name="field.name">customfield_22644</arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="201" name="Riapri Rapporto di Intervento">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1BBQV9TQUxFU19PUkRFUl9EQVRFIGFuZCBPUEFBX1BVUkNIQVNFX09SREVSX0RBVEUgc2hvdWxkIGJlIG51bGwgaW4gb3JkZXIgdG8gcmVvcGVuIHRoZSB0aWNrZXQgLSBvdGhlcndpc2UgdGhlIHRpY2tldCBoYXMgYWxyZWFkeSBiZWVuIGFjY291bnRlZCBzbyBpdCBjYW5ub3QgYmUgcmVvcGVuZWQ=</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgY2ZWYWx1ZXNbJ09QX1NBTEVTX09SREVSX0RBVEUnXSA9PSBudWxsICYmIGNmVmFsdWVzWydPUF9QVVJDSEFTRV9PUkRFUl9EQVRFJ10gPT0gbnVsbHx8fA==</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="null" status="null" step="5">
              <post-functions>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22660</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22644</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22641</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22666</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">93ee91428be862f784d2facaa9da5be13f63a66b</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IFJlbW92ZSBPblNpdGUgUmVwb3J0IEF0dGFjaG1lbnRz</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKCklzc3VlSW5kZXhpbmdTZXJ2aWNlIAlpc3N1ZUluZGV4aW5nU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChJc3N1ZUluZGV4aW5nU2VydmljZSkKZGVmIGF1dG9tYXRpY2FsbHlDbG9zZWQgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlDbG9zZWQnXS50b1N0cmluZygpKVswXQoKZGVmIHJlcXVlc3RNZXRob2QKZGVmIGJhc2VVUkwKCi8qU2NyaXB0IFZhcmlhYmxlcyovCi8vUGVyIFBvc3QgRnVuY3Rpb24KSXNzdWUgaXNzdWUgPSBpc3N1ZQovL1BlciB0ZXN0IGRhIGNvbnNvbGUKLy9Jc3N1ZSBpc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiT1BVVC0xNDA2MiIpCgppbnQgT1BBQSA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuYWEuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmludCBEQk8gPSBwcm9wZXJ0aWVzWydpc2NoZW1hLmRiby5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKCi8qUmltb3ppb25lIGFsbGVnYXRvIHJhcHBvcnRvIGRpIGludGVydmVudG8gYXBwZW5hIGNyZWF0byovCi8qIEdldCBJbnNpZ2h0IElRTCBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3MgaXFsRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5JUUxGYWNhZGUiKTsgCmRlZiBpcWxGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUoaXFsRmFjYWRlQ2xhc3MpOwoKLyogR2V0IEluc2lnaHQgT2JqZWN0IEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOwpkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCi8qIEdldCBJbnNpZ2h0IE9iamVjdCBUeXBlIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RUeXBlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlRmFjYWRlIik7CmRlZiBvYmplY3RUeXBlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVGYWNhZGVDbGFzcyk7CgovKiBHZXQgSW5zaWdodCBPYmplY3QgQXR0cmlidXRlIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CmRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CgpDbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5zZXJ2aWNlcy5tb2RlbC5mYWN0b3J5Lk9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Iik7CmRlZiBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzKTsKCi8qIFNwZWNpZnkgdGhlIHNjaGVtYSBpZCBhcyB3ZWxsIGFzIHRoZSBJUUwgdGhhdCB3aWxsIGZldGNoIG9iamVjdHMuIEluIHRoaXMgY2FzZSBhbGwgb2JqZWN0cyB3aXRoIE5hbWUgbWF0Y2hpbmcgdGhlIHZhbHVlQ0YsIGJlIHN1cmUgdG8gaW5jbHVkZSAiIGFyb3VuZCB2YWx1ZSAqLwpkZWYgb2JqZWN0cyA9IGlxbEZhY2FkZS5maW5kT2JqZWN0c0J5SVFMQW5kU2NoZW1hKERCTywgIlwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmNhdGVnb3J5UmVmJ10udG9TdHJpbmcoKSArICJcIi5cIiIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5uYW1lJ10udG9TdHJpbmcoKSArICJcIiBJTiAoXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5yYXBwSW50RkFBQyddLnRvU3RyaW5nKCkgKyAiXCIsXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5jb25zdW50aXZvJ10udG9TdHJpbmcoKSArICJcIikgQU5EICIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5kZWxldGVkJ10udG9TdHJpbmcoKSArICIhPXRydWUgQU5EIG9iamVjdCBIQVZJTkcgY29ubmVjdGVkVGlja2V0cyhrZXkgPSAiICsgaXNzdWUua2V5LnRvU3RyaW5nKCkgKyAiKSIpOyAvLyBTZWUgdGhlIGNvbXBsZXRlIGxpc3Qgb2YgcG9zc2libGUgSVFMIG9uIHRoZSBJbnNpZ2h0IFF1ZXJ5IExhbmd1YWdlIGRvY3VtZW50YXRpb24gcGFnZQovKiBJZiB0aGlzIGlzIGEgbWFuZGF0b3J5IGZpZWxkIHlvdSBzaG91bGQgYmUgYWJsZSB0byBkbyB0aGlzOiAqLwpsb2cuZGVidWcgIklRTDogIiArICJcIiIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5jYXRlZ29yeVJlZiddLnRvU3RyaW5nKCkgKyAiXCIuXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkubmFtZSddLnRvU3RyaW5nKCkgKyAiXCIgSU4gKFwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm9ianMucmFwcEludEZBQUMnXS50b1N0cmluZygpICsgIlwiLFwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm9ianMuY29uc3VudGl2byddLnRvU3RyaW5nKCkgKyAiXCIpIEFORCAiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuZGVsZXRlZCddLnRvU3RyaW5nKCkgKyAiIT10cnVlIEFORCBvYmplY3QgSEFWSU5HIGNvbm5lY3RlZFRpY2tldHMoa2V5ID0gIiArIGlzc3VlLmtleS50b1N0cmluZygpICsgIikiCgpmb3IoaW9iaiBpbiBvYmplY3RzKXsKICAgIC8qIFVQREFURSBPSkJFQ1QgREVMRVRFRCBWQUxVRSAqLwogICAgZGVmIG9iaiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihpb2JqLmdldElkKCkpOwogICAgICAgIAogICAgaW50IGF0dGFjaG1lbnREZWxldGVkID0gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50LmRlbGV0ZWQuaWQnXSA/IHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudC5kZWxldGVkLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKSA6IDMyNjUKICAgIAogICAgYXR0cmliVHlwZSA9IG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKGF0dGFjaG1lbnREZWxldGVkKTsgCgogICAgbmV3QXR0cmliID0gb2JqLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4oYXR0cmliVHlwZSk7CiAgICBkZWYgbmV3QXR0cmliVmFsdWUgPSBuZXdBdHRyaWIuY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7CgogICAgdHJ5IHsKICAgIAluZXdBdHRyaWJWYWx1ZS5zZXRWYWx1ZShhdHRyaWJUeXBlLCB0cnVlKTsKICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiB2aWUpIHsKICAgICAJbG9nLndhcm4oIlNFVElOU0lHSFRWQUxVRTogVW5hYmxlIHRvIHNldCBhdHRyaWJ1dGUgIiArIGF0dHJpYlR5cGUgKyAiIHRvICIgKyB0b3RhbEFtb3VudFN1cHAgKyAiLiBFeGl0aW5nLiIpOwogICAgIAlsb2cud2FybihTRVRJTlNJR0hUVkFMVUU6IHZpZS5nZXRNZXNzYWdlKCkpOwogICAgIAlyZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIGRlZiBhdHRyaWJWYWx1ZXMgPSBuZXdBdHRyaWIuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOwogICAgYXR0cmliVmFsdWVzLmFkZChuZXdBdHRyaWJWYWx1ZSk7CiAgICBuZXdBdHRyaWIuc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyhhdHRyaWJWYWx1ZXMpOwogICAgIAogICAgdHJ5IHsKICAgIAluZXdBdHRyaWIgPSBvYmplY3RGYWNhZGUuc3RvcmVPYmplY3RBdHRyaWJ1dGVCZWFuKG5ld0F0dHJpYik7CiAgICB9IGNhdGNoIChFeGNlcHRpb24gdmllKSB7CiAgICAJbG9nLndhcm4oIlNFVElOU0lHSFRWQUxVRTogVW5hYmxlIHRvIHNhdmUgY2hhbmdlcy4gRXhpdGluZy4iKTsKICAgICAJbG9nLndhcm4oU0VUSU5TSUdIVFZBTFVFOiB2aWUuZ2V0TWVzc2FnZSgpKTsKICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGxvZy5pbmZvKCJTRVRJTlNJR0hUVkFMVUU6IFN1Y2Nlc3NmdWxseSBzYXZlZCB2YWx1ZSIpOwp9</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="211" name="Invia notifica ODA al Fornitore">
          <meta name="opsbar-sequence">60</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgQ2hlY2sgT1BfUFVSQ0hBU0VfT1JERVJfREFURSAmJiBPUF9QVVJDSEFTRV9PUkRFUiAtIElmIHRoZSBmaXJzdCBvbmUgaXMgbm90IG51bGwgJiYgdGhlIHNlY29uZCBvbmUgaXMgbnVsbCAtIE9EQSBoYXMgYmVlbiBjcmVhdGVkIGJ1dCBtYWlsIG5vdCBzZW50</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KY2ZWYWx1ZXNbcHJvcGVydGllc1snY2YucHVyY2hhc2VPcmRlckRhdGUnXV0gIT0gbnVsbCAmJiBjZlZhbHVlc1twcm9wZXJ0aWVzWydjZi5wdXJjaGFzZU9yZGVyJ11dID09IG51bGx8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">4e1d2427405a47dffb8300132632cf585f8677e4</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcyAtIHNvbG8gZXJyb3JzLCBubyB3YXJuaW5ncw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQogCklzc3VlIGlzc3VlID0gaXNzdWUKCmRlZiBlcnJvcnMgPSBmYWxzZQpkZWYgd2FybmluZ3MgPSBmYWxzZQoKZGVmIGx1bXBTdW1QcmljZSA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YubHVtcFN1bVByaWNlJ10udG9TdHJpbmcoKSlbMF0KCi8qQ2FtcGkgY29uIGRhdGkgb2JibGlnYXRvcmkgcGVyIHRpY2tldCBub24gYSBjb3JwbyovCmRlZiByZXBNYXRlcmlhbHMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnJlcGxhY2VkTWF0ZXJpYWxzJ10udG9TdHJpbmcoKSlbMF0KZGVmIHVuYVRhbnR1bVJhdGVzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi51bmF0YW50dW1SYXRlcyddLnRvU3RyaW5nKCkpWzBdCmRlZiBsYWJvdXJSYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YubGFib3VyUmF0ZXMnXS50b1N0cmluZygpKVswXQpkZWYgdHJhdmVsUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnRyYXZlbFJhdGVzJ10udG9TdHJpbmcoKSlbMF0KCi8qQ2FtcGkgY29uIGRhdGkgb2JibGlnYXRvcmkgcGVyIHRpY2tldCBhIGNvcnBvKi8KZGVmIGx1bXBTdW1SYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YubHVtcFN1bVJhdGVzJ10udG9TdHJpbmcoKSlbMF0KCi8qQ29uZmVybWEgdXRlbnRlIHN1IHdhcm5pbmdzKi8KZGVmIHRyYW5zaXRpb25DaGVjayA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuY2hlY2tBbmRDb25maXJtJ10udG9TdHJpbmcoKSlbMF0KCi8qSW5zaWdodCBTY2hlbWEgSURzKi8KZGVmIERCT2JqZWN0cyA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuZGJvJ10udG9TdHJpbmcoKSArICItIgpkZWYgT1BBQSA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuYWEnXS50b1N0cmluZygpICsgIi0iCgpkZWYgZXJyb3JNYW5kYXRvcnlGaWVsZHMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVycm9ySm9iU3RhcnRlZENvbXBsZXRlZEZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgd2FybmluZ0VtcHR5RmllbGRzID0gbmV3IEFycmF5TGlzdCgpCmRlZiB3YXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCmRlZiB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lciA9IG5ldyBBcnJheUxpc3QoKQoKLy90cnl7CiAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1QcmljZSkhPW51bGwgJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUHJpY2UpLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CiAgICAgICAgLypDb250YWJpbGl6emF6aW9uZSBhIGNvcnBvKi8KICAgICAgICBsb2cuZGVidWcgIkNvbnRhYmlsaXp6YXppb25lIGEgY29ycG8iCiAgICAgICAgLy9PUEFBX0xVTVBfU1VNX1JBVEVTCiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsdW1wU3VtUmF0ZXMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgICAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICAgICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgICAgICAgICBkZWYgbHNSYXRlc0xpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGx1bXBTdW1SYXRlcykKCiAgICAgICAgICAgIGZvcihscyBpbiBsc1JhdGVzTGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGU9bHMudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIGxzUmF0ZUtleSA9IGxzUmF0ZS5zdWJzdHJpbmcobHNSYXRlLmluZGV4T2YoJygnKSsxLGxzUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgbHNSYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGxzUmF0ZUtleSkKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgbHNBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIGxzQXBwbGllZFRvVmFsdWUKICAgICAgICAgICAgICAgIGlmIChsc0FwcGxpZWRUbyl7CiAgICAgICAgICAgICAgICAgICAgbHNBcHBsaWVkVG9WYWx1ZSA9IGxzQXBwbGllZFRvLnN1YnN0cmluZyhsc0FwcGxpZWRUby5pbmRleE9mKCcoJykrMSxsc0FwcGxpZWRUby5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obHNSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGVmIGxzUmF0ZVJlZktleQogICAgICAgICAgICAgICAgZGVmIGxzUmF0ZVJlZlZhbHVlCiAgICAgICAgICAgICAgICBpZihsc1JhdGVSZWYuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgbHNSYXRlUmVmID0gbHNSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWZLZXkgPSBsc1JhdGVSZWYuc3Vic3RyaW5nKGxzUmF0ZVJlZi5pbmRleE9mKCcoJykrMSxsc1JhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiBsc1JhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIGxzUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgICAgICBsc1JhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsc1JhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxzUmF0ZVJlZlZhbHVlID0gbHNSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLGxzUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZihsc0FwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgbHNBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiU1VQUExJRVIiKSl7CiAgICAgICAgICAgICAgICAgICAgLy9nZXQgIlRPVEFMX0FNT1VOVF9TVVBQTElFUiIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxzUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZChsc1JhdGVSZWZWYWx1ZS50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0gICAgCiAgICAgICAgfQoKICAgIH1lbHNlewogICAgICAgIC8qQ29udGFiaWxpenphemlvbmUgbm9uIGEgY29ycG8qLwogICAgICAgIGxvZy5kZWJ1ZyAiQ29udGFiaWxpenphemlvbmUgTk9OIGEgY29ycG8iCgogICAgICAgIC8vT1BBQV9SRVBMQUNFRF9NQVRFUklBTFMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAiTWF0ZXJpYWxpOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIHJlcE1hdExpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKCiAgICAgICAgICAgIGZvcihtYXQgaW4gcmVwTWF0TGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiBjb21wb25lbnQ9bWF0LnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGRlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJytPUEFBKSsxLGNvbXBvbmVudC5sZW5ndGgoKS0xKQogICAgICAgICAgICAgICAgZGVmIGNvbXBvbmVudE9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihjb21wb25lbnRLZXkpCiAgICAgICAgICAgICAgICAvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICBkZWYgYXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgICAgICAgICBkZWYgYXBwbGllZFRvVmFsdWUKICAgICAgICAgICAgICAgIGlmKGFwcGxpZWRUby5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBhcHBsaWVkVG8gPSBhcHBsaWVkVG8udG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGFwcGxpZWRUb1ZhbHVlID0gYXBwbGllZFRvLnN1YnN0cmluZyhhcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsYXBwbGllZFRvLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICAvL2xvZy5kZWJ1ZyAiYXBwbGllZFRvVmFsdWU6ICIgKyBhcHBsaWVkVG9WYWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5tYXRlcmlhbFJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSBhcyBBcnJheUxpc3QKICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJLZXkKICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJWYWx1ZQogICAgICAgICAgICAgICAgaWYobWF0TnVtYmVyLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIG1hdE51bWJlciA9IG1hdE51bWJlci50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgbWF0TnVtYmVyS2V5ID0gbWF0TnVtYmVyLnN1YnN0cmluZyhtYXROdW1iZXIuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICBkZWYgbWF0TnVtYmVyT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKERCT2JqZWN0cyArIG1hdE51bWJlcktleSkKICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXROdW1iZXJPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG1hdE51bWJlclZhbHVlLnN1YnN0cmluZyhtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcoJykrMSxtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRlZiBzZXJpYWxOdW1iZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnNlcmlhbE51bWJlciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSBhcyBBcnJheUxpc3QKICAgICAgICAgICAgICAgIGRlZiBzZXJpYWxOdW1iZXJWYWx1ZQogICAgICAgICAgICAgICAgaWYoc2VyaWFsTnVtYmVyLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlciA9IHNlcmlhbE51bWJlci50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyVmFsdWUgPSBzZXJpYWxOdW1iZXIuc3Vic3RyaW5nKHNlcmlhbE51bWJlci5pbmRleE9mKCcoJykrMSxzZXJpYWxOdW1iZXIuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgIGlmKGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgYXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIlNVUFBMSUVSIikpewogICAgICAgICAgICAgICAgICAgIC8vZ2V0ICJUT1RBTF9BTU9VTlRfU1VQUExJRVIiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIGRlZiB0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lci5hZGQobWF0TnVtYmVyVmFsdWUudG9TdHJpbmcoKSArICghc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkuZXF1YWxzKCJbXSIpID8gIiAoIiArIHNlcmlhbE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAiKSIgOiAiICgpIikpICAgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSAgICAKICAgICAgICB9ICAKCiAgICAgICAgLy9PUEFBX1VOQVRBTlRVTV9SQVRFUwogICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiVW5hIHRhbnR1bSByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodW5hVGFudHVtUmF0ZXMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIHVtUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh1bmFUYW50dW1SYXRlcykKCiAgICAgICAgICAgIGZvcih1bSBpbiB1bVJhdGVzTGlzdCl7CiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGU9dW0udG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIHVtUmF0ZUtleSA9IHVtUmF0ZS5zdWJzdHJpbmcodW1SYXRlLmluZGV4T2YoJygnKSsxLHVtUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICBkZWYgdW1SYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKHVtUmF0ZUtleSkKICAgICAgICAgICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCiAgICAgICAgICAgICAgICBkZWYgdW1BcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgZGVmIHVtQXBwbGllZFRvVmFsdWUgPSB1bUFwcGxpZWRUby5zdWJzdHJpbmcodW1BcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsdW1BcHBsaWVkVG8uaW5kZXhPZignKScpKQoKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZLZXkKICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZWYWx1ZQogICAgICAgICAgICAgICAgaWYodW1SYXRlUmVmLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIHVtUmF0ZVJlZiA9IHVtUmF0ZVJlZi50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmS2V5ID0gdW1SYXRlUmVmLnN1YnN0cmluZyh1bVJhdGVSZWYuaW5kZXhPZignKCcpKzEsdW1SYXRlUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICBkZWYgdW1SYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB1bVJhdGVSZWZLZXkpCiAgICAgICAgICAgICAgICAgICAgdW1SYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICB1bVJhdGVSZWZWYWx1ZSA9IHVtUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyh1bVJhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx1bVJhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmKHVtQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCB1bUFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJTVVBQTElFUiIpKXsKICAgICAgICAgICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX1NVUFBMSUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICBkZWYgdG90Q3VzdG9tZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odW1SYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzPXRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuYWRkKHVtUmF0ZVJlZlZhbHVlLnRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSAgICAKICAgICAgICB9CgogICAgICAgIC8vT1BBQV9MQUJPVVJfUkFURVMKICAgICAgICBpZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSE9bnVsbCAmJiAoU3RyaW5nKWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKS50b1N0cmluZygpLmVxdWFscygiIikpewogICAgICAgICAgICBsb2cuZGVidWcgIkxhYm91ciByYXRlczogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCiAgICAgICAgICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgICAgICAgICAvL2luc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMKICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgICAgICAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICAgICAgICAgIGRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CiAgICAgICAgICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgICAgICAgICAgZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgogICAgICAgICAgICBmb3IobGIgaW4gbGFib3VyUmF0ZXNMaXN0KXsKICAgICAgICAgICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlS2V5ID0gbGJSYXRlLnN1YnN0cmluZyhsYlJhdGUuaW5kZXhPZignKCcpKzEsbGJSYXRlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBsYlJhdGVPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4obGJSYXRlS2V5KQogICAgICAgICAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICAgICAgICAgIGRlZiBsYkFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBkZWYgbGJBcHBsaWVkVG9WYWx1ZSA9IGxiQXBwbGllZFRvLnN1YnN0cmluZyhsYkFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxsYkFwcGxpZWRUby5pbmRleE9mKCcpJykpCgogICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZiA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlUmVmS2V5CiAgICAgICAgICAgICAgICBkZWYgbGJSYXRlUmVmVmFsdWUKICAgICAgICAgICAgICAgIGlmKGxiUmF0ZVJlZi5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBsYlJhdGVSZWYgPSBsYlJhdGVSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZktleSA9IGxiUmF0ZVJlZi5zdWJzdHJpbmcobGJSYXRlUmVmLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgbGJSYXRlUmVmS2V5KQogICAgICAgICAgICAgICAgICAgIGxiUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnJhdGUubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgbGJSYXRlUmVmVmFsdWUgPSBsYlJhdGVSZWZWYWx1ZS5zdWJzdHJpbmcobGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgZGVmIHRlY2hSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksICJURUNITklDSUFOX1JFRiIpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICAgICAgZGVmIHRlY2hSZWZLZXkKICAgICAgICAgICAgICAgIGRlZiB0ZWNoUmVmVmFsdWUKICAgICAgICAgICAgICAgIGlmKHRlY2hSZWYuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIHRlY2hSZWZLZXkgPSB0ZWNoUmVmLnN1YnN0cmluZyh0ZWNoUmVmLmluZGV4T2YoJygnKSsxLHRlY2hSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgICAgIGRlZiB1bVJhdGVSZWZPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oT1BBQSArIHVtUmF0ZVJlZktleSkKICAgICAgICAgICAgICAgICAgICB0ZWNoUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odGVjaFJlZk9iamVjdC5nZXRJZCgpLCAiTmFtZSIpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gdW1SYXRlUmVmVmFsdWUuc3Vic3RyaW5nKHRlY2hSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx0ZWNoUmVmVmFsdWUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICBpZihsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgbGJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiU1VQUExJRVIiKSl7CiAgICAgICAgICAgICAgICAgICAgLy9nZXQgIlRPVEFMX0FNT1VOVF9TVVBQTElFUiIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLmFkZChsYlJhdGVSZWZWYWx1ZS50b1N0cmluZygpLyogKyAiICgiICsgdGVjaFJlZlZhbHVlLnRvU3RyaW5nKCkgKyAiKSIqLykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9ICAgIAogICAgICAgIH0KCiAgICAgICAgLy9PUEFBX1RSQVZFTF9SQVRFUwogICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykgIT0gIiIgJiYgIWlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhdmVsUmF0ZXMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiVHJhdmVsIHJhdGVzOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykKICAgICAgICAgICAgLypDaWNsYXJlIHR1dHRpIGdsaSBvZ2dldHRpIGFzc29jaWF0aSBhbCBjYW1wbyovCiAgICAgICAgICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgICAgICAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICAgICAgICAgIENsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKICAgICAgICAgICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgICAgICAgICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgICAgICAgICBkZWYgdHJhdmVsUmF0ZXNMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmF2ZWxSYXRlcykKCiAgICAgICAgICAgIGZvcih0ciBpbiB0cmF2ZWxSYXRlc0xpc3QpewogICAgICAgICAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgICAgICAgICBkZWYgdHJSYXRlPXRyLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGRlZiB0clJhdGVLZXkgPSB0clJhdGUuc3Vic3RyaW5nKHRyUmF0ZS5pbmRleE9mKCcoJykrMSx0clJhdGUuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgZGVmIHRyUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbih0clJhdGVLZXkpCiAgICAgICAgICAgICAgICAvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgcmF0ZQogICAgICAgICAgICAgICAgZGVmIHRyQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIGRlZiB0ckFwcGxpZWRUb1ZhbHVlID0gdHJBcHBsaWVkVG8uc3Vic3RyaW5nKHRyQXBwbGllZFRvLmluZGV4T2YoJygnKSsxLHRyQXBwbGllZFRvLmluZGV4T2YoJyknKSkKCiAgICAgICAgICAgICAgICBkZWYgdHJSYXRlUmVmID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRyUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRlZiB0clJhdGVSZWZLZXkKICAgICAgICAgICAgICAgIGRlZiB0clJhdGVSZWZWYWx1ZQogICAgICAgICAgICAgICAgaWYodHJSYXRlUmVmLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgICAgIHRyUmF0ZVJlZiA9IHRyUmF0ZVJlZi50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgdHJSYXRlUmVmS2V5ID0gdHJSYXRlUmVmLnN1YnN0cmluZyh0clJhdGVSZWYuaW5kZXhPZignKCcpKzEsdHJSYXRlUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgICAgICBkZWYgdHJSYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB0clJhdGVSZWZLZXkpCiAgICAgICAgICAgICAgICAgICAgdHJSYXRlUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odHJSYXRlUmVmT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoucmF0ZS5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICB0clJhdGVSZWZWYWx1ZSA9IHRyUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyh0clJhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSx0clJhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYodHJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IHRyQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIlNVUFBMSUVSIikpewogICAgICAgICAgICAgICAgICAgIC8vZ2V0ICJUT1RBTF9BTU9VTlRfU1VQUExJRVIiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIGRlZiB0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbih0clJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdFN1cHBsaWVyJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgICAgICAgICAgICAgaWYoIXRvdEN1c3RvbWVyIHx8IHRvdEN1c3RvbWVyWzBdLmdldFZhbHVlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjAuMCIpKXsKICAgICAgICAgICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5hZGQodHJSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9ICAgIAogICAgICAgIH0KCiAgICB9CgoKICAgIGRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKCiAgICBpZiAoIWVycm9ycyAmJiAhd2FybmluZ3MpewogICAgICAgIHJldHVybiB0cnVlCiAgICB9ZWxzZXsKICAgICAgICBpZighZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICAgICAgLy9TZSBjaSBzb25vIHNvbG8gd2FybmluZ3MgdmVyaWZpY28gc2UgbCd1dGVudGUgaGEgZ2nDoCBkaWNoaWFyYXRvIGRpIHZvbGVyIHByb3NlZ3VpcmUgY29tdW5xdWUKICAgICAgICAgICAgLy8gLSB0cmFuc2l0aW9uIGZpZWxkICJPUEFBX0NIRUNLX0FORF9DT05GSVJNIj0iWWVzIgogICAgICAgICAgICAvLyAtIGluIGNhc28gY29udHJhcmlvIGludmlvIGkgd2FybmluZyBhIEZFCgogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAidHJhbnNpdGlvbkNoZWNrOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spCiAgICAgICAgICAgIC8vbG9nLmRlYnVnICJyZXN1bHQ6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykudG9TdHJpbmcoKS5lcXVhbHMoIlllcyIpCiAgICAgICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpewogICAgICAgICAgICAgICAgLy9sb2cuZGVidWcgInJldHVybiB0cnVlIC0gdHJhbnNpdGlvbkNoZWNrID0gWWVzIgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBkZWYgd0xpc3QgPSBuZXcgQXJyYXlMaXN0KCkKCiAgICAgICAgICAgICAgICBpZih3YXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHlSYXRlID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiVyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiU1VQUExJRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChudWxsKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQod2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIpCgogICAgICAgICAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eVJhdGUpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYod2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKICAgICAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZCgiU1VQUExJRVJfQ09ORklSTV9FTVBUWV9NQVRfUVVPVEUiKQogICAgICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG51bGwpCiAgICAgICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQod2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lcikKCiAgICAgICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siVyI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIlciLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKICAgICAgICAgICAgfQoKICAgICAgICB9CiAgICAgICAgaWYoZXJyb3JzICYmICF3YXJuaW5ncyl7CiAgICAgICAgICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICAgICAgb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgICAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAgCiAgICAgICAgfQogICAgICAgIGlmKGVycm9ycyAmJiB3YXJuaW5ncyl7CiAgICAgICAgICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICBkZWYgd0xpc3QgPSBuZXcgQXJyYXlMaXN0KCkKCiAgICAgICAgICAgIGlmKHdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiVyIpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKCJTVVBQTElFUl9DT05GSVJNX0VNUFRZX1JBVEVTIikKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQobnVsbCkKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQod2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIpCgogICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5UmF0ZSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYod2FybmluZ0VtcHR5UXVvdGVNYXRDdXN0b21lci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIGRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZCgiVyIpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZCgiU1VQUExJRVJfQ09ORklSTV9FTVBUWV9NQVRfUVVPVEUiKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQobnVsbCkKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKHdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIpCgogICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgICAgIG91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siV0UiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIldFIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAKICAgICAgICB9CiAgICB9Ci8vfWNhdGNoKEV4Y2VwdGlvbiBlKXsKLy8gICAgbG9nLmRlYnVnICJFeGNlcHRpb246ICIgKyBlCi8vICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkV4Y2VwdGlvbiIsIGUudG9TdHJpbmcoKSkgIAovL30K</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">689764320f82b76e3ae6c1de4019336fc58866cd</arg>
              <arg name="FIELD_NOTES">YCFgT1AgRW1haWwgTm90aWZpY2F0aW9uOiBQVVJDSEFTRV9PUkRFUl9UT19TVVBQTElFUg==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLkN1c3RvbUZpZWxkTWFuYWdlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5maWVsZHMuQ3VzdG9tRmllbGQ7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmNvbXBvbmVudC5Db21wb25lbnRBY2Nlc3NvcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZTsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb2RlYy5iaW5hcnkuQmFzZTY0OwppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluawoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCgpVUkwgdXJsCkh0dHBVUkxDb25uZWN0aW9uIGNvbm5lY3Rpb24KCnJlcXVlc3RNZXRob2QgPSAiUE9TVCI7CgpkZWYgcmVsYXRlc0luSXNzdWVMaW5rPWZhbHNlCmRlZiByZWxhdGVzT3V0SXNzdWVMaW5rPWZhbHNlCmRlZiBsaW5rZWRUaWNrZXRzPW5ldyBBcnJheUxpc3QoKQoKTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgIHJlbGF0ZXNJbklzc3VlTGluaz10cnVlCiAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpKQogICAgICAgIGxvZy5kZWJ1ZyAiSXNzdWUgY29uIHJlbGF0ZXNJbklzc3VlTGluayIKICAgIH0KfQpMaXN0PElzc3VlTGluaz4gYWxsT3V0SXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldE91dHdhcmRMaW5rcyhpc3N1ZS5nZXRJZCgpKQpmb3IgKEl0ZXJhdG9yPElzc3VlTGluaz4gb3V0SXRlcmF0b3IgPSBhbGxPdXRJc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKCiAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CiAgICAgICAgcmVsYXRlc091dElzc3VlTGluaz10cnVlCiAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldERlc3RpbmF0aW9uT2JqZWN0KCkpCiAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc091dElzc3VlTGluayIKICAgIH0KfQoKZGVmIGJvZHlfcmVxID0gW10KCmlmKHJlbGF0ZXNJbklzc3VlTGluayB8fCByZWxhdGVzT3V0SXNzdWVMaW5rKXsKICAgIGJvZHlfcmVxID0gWwogICAgICAgICJ0ZW1wbGF0ZU5hbWUiOiBwcm9wZXJ0aWVzWyd0dC5wdXJjaGFzZU9yZGVyVG9TJ10udG9TdHJpbmcoKSwKICAgICAgICAicGVjIjogZmFsc2UsCiAgICAgICAgImlzc3VlS2V5IjogaXNzdWUua2V5LAogICAgICAgICJsaW5rZWRUaWNrZXRzIjogbGlua2VkVGlja2V0cwogICAgXSAgICAKfWVsc2V7CiAgICBib2R5X3JlcSA9IFsKICAgICAgICAidGVtcGxhdGVOYW1lIjogcHJvcGVydGllc1sndHQucHVyY2hhc2VPcmRlclRvUyddLnRvU3RyaW5nKCksCiAgICAgICAgInBlYyI6IGZhbHNlLAogICAgICAgICJpc3N1ZUtleSI6IGlzc3VlLmtleQogICAgXSAKfQoKYmFzZVVSTCA9ICJodHRwOi8vIiArIHByb3BlcnRpZXNbJ2FwaS5lbnYnXS50b1N0cmluZygpICsgIi9vcC9yZXN0L2ppcmEvQUEvdHJhbnNhY3Rpb24vbWFpbC9zZW5kIgp1cmwgPSBuZXcgVVJMKGJhc2VVUkwpCmNvbm5lY3Rpb24gPSAoSHR0cFVSTENvbm5lY3Rpb24pdXJsLm9wZW5Db25uZWN0aW9uKCk7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdE1ldGhvZChyZXF1ZXN0TWV0aG9kKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgiKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkFjY2VwdCIsICIqLyoiKTsKY29ubmVjdGlvbi5zZXREb091dHB1dCh0cnVlKTsKY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwpjb25uZWN0aW9uLm91dHB1dFN0cmVhbQpjb25uZWN0aW9uLm91dHB1dFN0cmVhbS53aXRoV3JpdGVyKCJVVEYtOCIpIHsgbmV3IFN0cmVhbWluZ0pzb25CdWlsZGVyKGl0LCBib2R5X3JlcSkgfQpsb2cuZGVidWcgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KY29ubmVjdGlvbi5jb25uZWN0KCk7CgpkZWYgb3V0cHV0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZUxpc3RFcnJvcnMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVycm9yTXNncyA9IG5ldyBBcnJheUxpc3QoKQoKaWYgKCFjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIyMDAiKSl7CiAgICBsb2cuZGVidWcgInVybDogIiArIHVybAogICAgbG9nLmRlYnVnICJSZXNwb25zZUNvZGU6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VNZXNzYWdlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpCiAgICBlTGlzdEVycm9ycy5hZGQoIkUiKQogICAgZUxpc3RFcnJvcnMuYWRkKCJTRU5ETUFJTCIpCiAgICBlcnJvck1zZ3MuYWRkKGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkgKyAiICIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpKQogICAgZUxpc3RFcnJvcnMuYWRkKGVycm9yTXNncykKICAgIGVMaXN0LmFkZChlTGlzdEVycm9ycykKCiAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKQp9</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="6">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="221" name="Invia Mail Rapporto di Intervento" view="fieldscreen">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19912</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1A6IElmIHN0YXR1cz1DT01QTEVURUQgVE8gQkUgQ0xPU0VEICYmIE9OU0lURV9SRVBPUlQgPSBudWxsIC0gTm90aWZpY2F0aW9uIGhhcyBub3QgYmVlbiBzZW50</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KY2ZWYWx1ZXNbcHJvcGVydGllc1snY2Yud2ZPbnNpdGVSZXBvcnQnXV0gPT0gbnVsbHx8fA==</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaXNzdWUuaXNzdWVUeXBlLm5hbWUgPT0gJ01haW50ZW5hbmNlIFRpY2tldCd8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">dcec49d7a2f27ae7f5e1c9874ad28f99eb5fde33</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IGxpbmtlZFRpY2tldHMhPW51bGwgPT4gQ2hlY2sgd2l0aCB1c2VyIHRoZSByZXF1aXJlZCBFbWFpbCBSZWNpcGllbnRz</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUubGluay5Jc3N1ZUxpbmsKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KZGVmIENhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKSXNzdWUgaXNzdWUgPSBpc3N1ZQoKZGVmIGZpZWxkc1JlcXVpcmVkID0gZmFsc2UKZGVmIGF1dG9tYXRpY2FsbHlDbG9zZWQgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlDbG9zZWQnXS50b1N0cmluZygpKVswXQpkZWYgc2VuZE1haWxUbyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yuc2VuZE1haWxUb0xpbmtlZCddLnRvU3RyaW5nKCkpWzBdCmRlZiByZXF1aXJlZEZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgcmVsYXRlc0luSXNzdWVMaW5rPWZhbHNlCmRlZiByZWxhdGVzT3V0SXNzdWVMaW5rPWZhbHNlCgovKk9QLTEwMzg6IENoaWVkbyBhbGwndXRlbnRlIHNlIGUgYSBjaGkgdnVvbGUgaW52aWFyZSBsYSBub3RpZmljYSBkZWwgcmFwcG9ydG8gZGkgaW50ZXJ2ZW50byBjaGUgdmVycsOgIGdlbmVyYXRvLgpMbyBjaGllZG8gc29sbyBzZSBpbCB0aWNrZXQgc3UgY3VpIHN0byBlc2VndWVuZG8gbGEgdHJhbnNhemlvbmUgbm9uIMOoIHN0YXRvIGNoaXVzbyBpbiBhdXRvbWF0aWNvIGRhbCBzaXN0ZW1hIGUgc29sbyBzZSBub24gZ2xpIGVyYSBnacOgIHN0YXRvIGNoaWVzdG8gcHJpbWEqLwpsb2cuZGVidWcgImlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoYXV0b21hdGljYWxseUNsb3NlZCk6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGF1dG9tYXRpY2FsbHlDbG9zZWQpCmxvZy5kZWJ1ZyAiaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShzZW5kTWFpbFRvKTogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc2VuZE1haWxUbykKbG9nLmRlYnVnICJ0cmFuc2llbnRWYXJzOiAiICsgdHJhbnNpZW50VmFycwpsb2cuZGVidWcgImlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc2VuZE1haWxUbykudG9TdHJpbmcoKTogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc2VuZE1haWxUbykudG9TdHJpbmcoKQoKTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CiAgICAKICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKCQlyZWxhdGVzSW5Jc3N1ZUxpbms9dHJ1ZQogICAgICAgIGxvZy5kZWJ1ZyAiSXNzdWUgY29uIHJlbGF0ZXNJbklzc3VlTGluayIKICAgICAgICBicmVhawogICAgfQp9Ckxpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwogICAgCiAgICBpZihpc3N1ZUxpbmsuaXNzdWVMaW5rVHlwZS5nZXROYW1lKCkudG9TdHJpbmcoKS5lcXVhbHMocHJvcGVydGllc1snaWwubGlua2VkVGt0c1JlbGF0ZXMnXS50b1N0cmluZygpKSl7CgkJcmVsYXRlc091dElzc3VlTGluaz10cnVlCiAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc091dElzc3VlTGluayIKICAgICAgICBicmVhawogICAgfQp9Cgpsb2cuZGVidWcgaXNzdWUua2V5ICsgIiAocmVsYXRlc0luSXNzdWVMaW5rIHx8IHJlbGF0ZXNPdXRJc3N1ZUxpbmspOiAiICsgKHJlbGF0ZXNJbklzc3VlTGluayB8fCByZWxhdGVzT3V0SXNzdWVMaW5rKQpsb2cuZGVidWcgaXNzdWUua2V5ICsgIiAoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKSAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKQpsb2cuZGVidWcgaXNzdWUua2V5ICsgIiBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pPT1udWxsICIgKyAoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShzZW5kTWFpbFRvKT09bnVsbCkKCmlmKChyZWxhdGVzSW5Jc3N1ZUxpbmsgfHwgcmVsYXRlc091dElzc3VlTGluaykgLyomJiAoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKT09bnVsbCB8fCAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShhdXRvbWF0aWNhbGx5Q2xvc2VkKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpKi8gJiYgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShzZW5kTWFpbFRvKT09bnVsbCl7CglmaWVsZHNSZXF1aXJlZCA9IHRydWUKCXJlcXVpcmVkRmllbGRzLmFkZChwcm9wZXJ0aWVzWydjZi5zZW5kTWFpbFRvTGlua2VkJ10udG9TdHJpbmcoKSkKfQoKbG9nLmRlYnVnICJGaWVsZHNSZXF1aXJlZDogIiArIGZpZWxkc1JlcXVpcmVkCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKCmlmKGZpZWxkc1JlcXVpcmVkKXsKCWRlZiBmTGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICBpZihyZXF1aXJlZEZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAJZGVmIGZMaXN0RGV0YWlsID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICBmTGlzdERldGFpbC5hZGQoIkYiKQogICAgICAgICAgICAgICAgZkxpc3REZXRhaWwuYWRkKCJVU0VSX0lOUFVUIikKICAgICAgICAgICAgCWZMaXN0RGV0YWlsLmFkZChudWxsKQogICAgICAgICAgICAgICAgZkxpc3REZXRhaWwuYWRkKHJlcXVpcmVkRmllbGRzKQogICAgICAgICAgICAgICAgZkxpc3QuYWRkKGZMaXN0RGV0YWlsKQogICAgICAgIH0KCiAgICAgICAgb3V0cHV0LmFkZChmTGlzdCkKICAgIAl0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkYiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRiIsIG91dHB1dC50b1N0cmluZygpKSAgIAp9ZWxzZXsKICAgIHJldHVybiB0cnVlCn0=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">732b852fe810d140fc2df432e5e30b7a3bed81cc</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IFJFU1QgQVBJOiBPUCBFbWFpbCBOb3RpZmljYXRpb246IE9OU0lURV9SRVBPUlQ=</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk1vZGlmaWVkVmFsdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS51dGlsLkRlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCmRlZiBzZW5kTWFpbFRvID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5zZW5kTWFpbFRvTGlua2VkJ10udG9TdHJpbmcoKSlbMF0KZGVmIG9uc2l0ZVJlcG9ydERhdGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yud2ZPbnNpdGVSZXBvcnQnXS50b1N0cmluZygpKVswXQpkZWYgc2VuZE1haWxUb1JlYyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yuc2VuZE1haWxUb1JlY2lwaWVudHMnXS50b1N0cmluZygpKVswXQoKZGVmIHJlbGF0ZXNJbklzc3VlTGluaz1mYWxzZQpkZWYgcmVsYXRlc091dElzc3VlTGluaz1mYWxzZQpkZWYgbGlua2VkVGlja2V0cz1uZXcgQXJyYXlMaXN0KCkKbG9nLmRlYnVnIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc2VuZE1haWxUbykudG9TdHJpbmcoKQoKTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbEluSXNzdWVMaW5rLml0ZXJhdG9yKCk7IG91dEl0ZXJhdG9yLmhhc05leHQoKTspIHsKICAgIElzc3VlTGluayBpc3N1ZUxpbmsgPSAoSXNzdWVMaW5rKSBvdXRJdGVyYXRvci5uZXh0KCk7CgogICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNSZWxhdGVzJ10udG9TdHJpbmcoKSkpewogICAgICAgIHJlbGF0ZXNJbklzc3VlTGluaz10cnVlCiAgICAgICAgbGlua2VkVGlja2V0cy5hZGQoaXNzdWVMaW5rLmdldFNvdXJjZU9iamVjdCgpLnRvU3RyaW5nKCkpCiAgICAgICAgbG9nLmRlYnVnICJJc3N1ZSBjb24gcmVsYXRlc0luSXNzdWVMaW5rIgogICAgfQp9Ckxpc3Q8SXNzdWVMaW5rPiBhbGxPdXRJc3N1ZUxpbmsgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZUxpbmtNYW5hZ2VyKCkuZ2V0T3V0d2FyZExpbmtzKGlzc3VlLmdldElkKCkpCmZvciAoSXRlcmF0b3I8SXNzdWVMaW5rPiBvdXRJdGVyYXRvciA9IGFsbE91dElzc3VlTGluay5pdGVyYXRvcigpOyBvdXRJdGVyYXRvci5oYXNOZXh0KCk7KSB7CiAgICBJc3N1ZUxpbmsgaXNzdWVMaW5rID0gKElzc3VlTGluaykgb3V0SXRlcmF0b3IubmV4dCgpOwoKICAgIGlmKGlzc3VlTGluay5pc3N1ZUxpbmtUeXBlLmdldE5hbWUoKS50b1N0cmluZygpLmVxdWFscyhwcm9wZXJ0aWVzWydpbC5saW5rZWRUa3RzUmVsYXRlcyddLnRvU3RyaW5nKCkpKXsKICAgICAgICByZWxhdGVzT3V0SXNzdWVMaW5rPXRydWUKICAgICAgICBsaW5rZWRUaWNrZXRzLmFkZChpc3N1ZUxpbmsuZ2V0RGVzdGluYXRpb25PYmplY3QoKS50b1N0cmluZygpKQogICAgICAgIGxvZy5kZWJ1ZyAiSXNzdWUgY29uIHJlbGF0ZXNPdXRJc3N1ZUxpbmsiCiAgICB9Cn0KCmRlZiBib2R5X3JlcSA9IFtdCgppZigocmVsYXRlc0luSXNzdWVMaW5rIHx8IHJlbGF0ZXNPdXRJc3N1ZUxpbmspICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2NmLm9wdGlvbi5zZW5kTWFpbFRvLm5vRW1haWwnXS50b1N0cmluZygpKSAmJiBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2NmLm9wdGlvbi5zZW5kTWFpbFRvLmN1cnJlbnRSZXBvcnQnXS50b1N0cmluZygpKSl7CiAgICAvL09QLTEwMzg6IGludmlhcmUgc29sbyBsYSBtYWlsIGNvbiBpbCByYXBwb3J0byBkaSBpbnRlcnZlbnRvIGRlbCB0aWNrZXQgY29ycmVudGUKICAgIGJvZHlfcmVxID0gWwogICAgICAgICJ0ZW1wbGF0ZU5hbWUiOiBwcm9wZXJ0aWVzWyd0dC5vblNpdGVSZXBvcnQnXS50b1N0cmluZygpLAogICAgICAgICJwZWMiOiBmYWxzZSwKICAgICAgICAiaXNzdWVLZXkiOiBpc3N1ZS5rZXksCiAgICAgICAgImFkZGl0aW9uYWxSZWNpcGllbnRzIjogaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShzZW5kTWFpbFRvUmVjKS50b1N0cmluZygpCiAgICBdCiAgICBsb2cuZGVidWcgImluMTogYm9keV9yZXE6ICIgKyBib2R5X3JlcQp9ZWxzZSBpZigocmVsYXRlc0luSXNzdWVMaW5rIHx8IHJlbGF0ZXNPdXRJc3N1ZUxpbmspICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2NmLm9wdGlvbi5zZW5kTWFpbFRvLm5vRW1haWwnXS50b1N0cmluZygpKSAmJiBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHNlbmRNYWlsVG8pLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2NmLm9wdGlvbi5zZW5kTWFpbFRvLmFsbExpbmtlZCddLnRvU3RyaW5nKCkpKXsKICAgIC8vT1AtMTAzODogaW52aWFyZSBsYSBtYWlsIGNvbiB0dXR0aSBpIHJhcHBvcnRpIGRpIGludGVydmVudG8gZGVpIHRpY2tldCBjb2xsZWdhdGkKICAgIGJvZHlfcmVxID0gWwogICAgICAgICJ0ZW1wbGF0ZU5hbWUiOiBwcm9wZXJ0aWVzWyd0dC5vblNpdGVSZXBvcnQnXS50b1N0cmluZygpLAogICAgICAgICJwZWMiOiBmYWxzZSwKICAgICAgICAiaXNzdWVLZXkiOiBpc3N1ZS5rZXksCiAgICAgICAgImxpbmtlZFRpY2tldHMiOiBsaW5rZWRUaWNrZXRzLAogICAgICAgICJhZGRpdGlvbmFsUmVjaXBpZW50cyI6IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc2VuZE1haWxUb1JlYykudG9TdHJpbmcoKQogICAgXQogICAgbG9nLmRlYnVnICJpbjI6IGJvZHlfcmVxOiAiICsgYm9keV9yZXEKfWVsc2UgaWYoIXJlbGF0ZXNJbklzc3VlTGluayAmJiAhcmVsYXRlc091dElzc3VlTGluayl7CiAgICBib2R5X3JlcSA9IFsKICAgICAgICAidGVtcGxhdGVOYW1lIjogcHJvcGVydGllc1sndHQub25TaXRlUmVwb3J0J10udG9TdHJpbmcoKSwKICAgICAgICAicGVjIjogZmFsc2UsCiAgICAgICAgImlzc3VlS2V5IjogaXNzdWUua2V5LAogICAgICAgICJhZGRpdGlvbmFsUmVjaXBpZW50cyI6IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoc2VuZE1haWxUb1JlYykudG9TdHJpbmcoKQogICAgXQogICAgbG9nLmRlYnVnICJpbjM6IGJvZHlfcmVxOiAiICsgYm9keV9yZXEKfQoKLyogUkVTVCBBUEkgcGVyIEludmlvIE5vdGlmaWNhIEVtYWlsIE9OU0lURV9SRVBPUlQgKi8KcmVxdWVzdE1ldGhvZCA9ICJQT1NUIjsKbG9nLmRlYnVnICJwcmVwYXJvIGxhIGNoaWFtYXRhIgpiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1siYXBpLmVudiJdLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvamlyYS9BQS90cmFuc2FjdGlvbi9tYWlsL3NlbmQiClVSTCB1cmwgPSBuZXcgVVJMKGJhc2VVUkwpCkh0dHBVUkxDb25uZWN0aW9uIGNvbm5lY3Rpb24gPSAoSHR0cFVSTENvbm5lY3Rpb24pdXJsLm9wZW5Db25uZWN0aW9uKCk7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdE1ldGhvZChyZXF1ZXN0TWV0aG9kKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgiKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkFjY2VwdCIsICIqLyoiKTsKY29ubmVjdGlvbi5zZXREb091dHB1dCh0cnVlKTsKY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwpjb25uZWN0aW9uLm91dHB1dFN0cmVhbQpjb25uZWN0aW9uLm91dHB1dFN0cmVhbS53aXRoV3JpdGVyKCJVVEYtOCIpIHsgbmV3IFN0cmVhbWluZ0pzb25CdWlsZGVyKGl0LCBib2R5X3JlcSkgfQpsb2cuZGVidWcgImNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtOiAiICsgY29ubmVjdGlvbi5vdXRwdXRTdHJlYW0KY29ubmVjdGlvbi5jb25uZWN0KCk7Ci8vbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKbG9nLmRlYnVnICJSZXNwb25zZUNvZGU6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkKbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdEVycm9ycyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgIGxvZy5kZWJ1ZyAidXJsOiAiICsgdXJsCiAgICBsb2cuZGVidWcgImJvZHlfcmVxOiAiICsgYm9keV9yZXEKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VDb2RlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlTWVzc2FnZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKQoKICAgIGRlZiBvdXRwdXRNc2cgPSAoKEh0dHBVUkxDb25uZWN0aW9uKWNvbm5lY3Rpb24pLmVycm9yU3RyZWFtLnRleHQKICAgIGxvZy5kZWJ1ZyAiKChIdHRwVVJMQ29ubmVjdGlvbiljb25uZWN0aW9uKS5lcnJvclN0cmVhbS50ZXh0OiAiICsgb3V0cHV0TXNnCgogICAgZGVmIGpzb25TbHVycGVyID0gbmV3IEpzb25TbHVycGVyKCkKICAgIGRlZiBqc29uX29iamVjdCA9IGpzb25TbHVycGVyLnBhcnNlVGV4dChvdXRwdXRNc2cpCiAgICBhc3NlcnQganNvbl9vYmplY3QgaW5zdGFuY2VvZiBNYXAgIAogICAgbG9nLmRlYnVnICJtZXNzYWdlOiAiICsgIGpzb25fb2JqZWN0Lm1lc3NhZ2UKCiAgICBlTGlzdEVycm9ycy5hZGQoIkUiKQogICAgZUxpc3RFcnJvcnMuYWRkKCJTRU5ETUFJTCIpCiAgICBlcnJvck1zZ3MuYWRkKGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkgKyAiICIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpKQogICAgZUxpc3RFcnJvcnMuYWRkKGpzb25fb2JqZWN0Lm1lc3NhZ2UpCiAgICBlTGlzdC5hZGQoZUxpc3RFcnJvcnMpCgogICAgb3V0cHV0LmFkZChlTGlzdCkKICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkKICAgIAp9ZWxzZXsKICAgIC8qTCdlbWFpbCDDqCBzdGF0YSBpbnZpYXRhIGNvcnJldHRhbWVudGUsIGFnZ2lvcm5vIGlsIGNhbXBvIE9OU0lURV9SRVBPUlQgY29uIGxhIGRhdGEgY29ycmVudGUqLwoKICAgIC8vIGxvZy53YXJuICJpc3N1ZSAiK2lzc3VlLmdldEtleSgpCiAgICBkZWYgY2Z2ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShvbnNpdGVSZXBvcnREYXRlKQogICAgaWYgKCFjZnYpIHsKICAgICAgICBkZWYgdDAgID0gbmV3IGphdmEuc3FsLlRpbWVzdGFtcChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSkKICAgICAgICBsb2cud2FybiAiU3RhcnRUaW1lID0+ICciK3QwLnRvU3RyaW5nKCkrIiciCiAgICAgICAgZGVmIG12ID0gbmV3IE1vZGlmaWVkVmFsdWUob25zaXRlUmVwb3J0RGF0ZSwgdDApCiAgICAgICAgZGVmIGNoID0gbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpCiAgICAgICAgb25zaXRlUmVwb3J0RGF0ZS51cGRhdGVWYWx1ZShudWxsLCBpc3N1ZSwgbXYsIGNoKSAKICAgIH0gZWxzZSB7CiAgICAgICAgbG9nLndhcm4gIlN0YXJ0VGltZSA9PSAnIitjZnYudG9TdHJpbmcoKSsiJyIKICAgIH0KfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="6">
              <post-functions>
                <function type="class">
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="append.value"></arg>
                  <arg name="field.value">%%CURRENT_DATETIME%%</arg>
                  <arg name="field.name">customfield_22641</arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="7" name="Closed">
      <meta name="jira.status.id">6</meta>
      <actions>
        <action id="231" name="Genera Offerta per Materiali da Preventivare">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1A6IEdlbmVyYXppb25lIHRpY2tldCBkaSBwcmV2ZW50aXZhemlvbmUgLSBzb2xvIHNlIGNpIHNvbm8gT1BfUkVRVUlSRURfTUFURVJJQUxTIGUgc2UgT1BBQV9RVU9URV9USUNLRVQgPSBudWxs</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KY2ZWYWx1ZXNbcHJvcGVydGllc1snY2YucmVxdWlyZWRNYXRlcmlhbHMnXV0gIT0gbnVsbCAmJiBjZlZhbHVlc1twcm9wZXJ0aWVzWydjZi5vZmZlckxpbmtlZElzc3VlJ11dID09IG51bGx8fHw=</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="null" status="null" step="7">
              <post-functions>
                <function type="class">
                  <arg name="field.copyFieldSource3">customfield_22601</arg>
                  <arg name="field.copyFieldSource2">customfield_22600</arg>
                  <arg name="field.copyFieldSource1">customfield_22609</arg>
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="field.copyFieldSource9"></arg>
                  <arg name="field.copyFieldSource8">customfield_22607</arg>
                  <arg name="field.copyFieldSource7">customfield_22700</arg>
                  <arg name="field.copyFieldSource6">customfield_22651</arg>
                  <arg name="field.copyFieldSource5">customfield_22662</arg>
                  <arg name="field.copyFieldSource4">customfield_22602</arg>
                  <arg name="field.issuePriorityId">0</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="targetIssueType">SELECTED_ISSUE_TYPE</arg>
                  <arg name="field.copyTransitionComment">false</arg>
                  <arg name="field.issueAssignTo">ASSIGN_TO_ASSIGNEE</arg>
                  <arg name="targetProjectSelectedCustomField"></arg>
                  <arg name="destination-scopeTarget">LINK_END</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiescreatelinkedissue-function</arg>
                  <arg name="scopeDestination-linkEnd">10500:INWARD</arg>
                  <arg name="field.enablingCustomFieldId">customfield_22609</arg>
                  <arg name="class.name">ch.beecom.jira.jsu.workflow.function.createlinkedissue.CreateLinkedIssueFunction</arg>
                  <arg name="projectId">11228</arg>
                  <arg name="field.createTargetValue8"></arg>
                  <arg name="field.existingAttachmentEnablingCustomFieldId"></arg>
                  <arg name="targetIssueTypeDefinedByCfSelection"></arg>
                  <arg name="field.createTargetValue1"></arg>
                  <arg name="field.copyFieldMode2">OVERWRITE</arg>
                  <arg name="field.originIssue_copyFieldSource1"></arg>
                  <arg name="field.copyFieldMode3">OVERWRITE</arg>
                  <arg name="field.createTargetValue3"></arg>
                  <arg name="field.copyFieldMode1">OVERWRITE</arg>
                  <arg name="field.createTargetValue2"></arg>
                  <arg name="field.copyFieldSeparator8"></arg>
                  <arg name="field.createTargetValue5"></arg>
                  <arg name="field.copyFieldSeparator7"></arg>
                  <arg name="field.createTargetValue4"></arg>
                  <arg name="field.copyFieldSeparator6"></arg>
                  <arg name="field.copyFieldSeparator5"></arg>
                  <arg name="field.createTargetValue7"></arg>
                  <arg name="field.copyFieldSeparator4"></arg>
                  <arg name="field.createTargetValue6"></arg>
                  <arg name="field.copyFieldDestination1">customfield_22658</arg>
                  <arg name="field.copyFieldDestination2">customfield_22600</arg>
                  <arg name="issueTypeId">13001</arg>
                  <arg name="field.copyFieldDestination3">customfield_22601</arg>
                  <arg name="field.copyFieldDestination4">customfield_22602</arg>
                  <arg name="scopeType">ISSUE_LINKING</arg>
                  <arg name="field.attachmentEnablingCustomFieldId"></arg>
                  <arg name="field.copyFieldDestination5">customfield_22662</arg>
                  <arg name="field.copyFieldDestination6">customfield_22651</arg>
                  <arg name="scopeSource-jql"></arg>
                  <arg name="field.copyFieldDestination7">customfield_22700</arg>
                  <arg name="field.copyFieldDestination8">customfield_22607</arg>
                  <arg name="createIssueAsUser-user">atlassian_faac_service_desk</arg>
                  <arg name="targetProjectType">SAME</arg>
                  <arg name="transitionAttachmentsOperation">copy</arg>
                  <arg name="field.copyFieldSeparator3"></arg>
                  <arg name="field.copyFieldSeparator2"></arg>
                  <arg name="field.copyFieldSeparator1"></arg>
                  <arg name="field.copyFieldMode8">OVERWRITE</arg>
                  <arg name="field.copyFieldMode6">OVERWRITE</arg>
                  <arg name="field.copyFieldMode7">OVERWRITE</arg>
                  <arg name="field.copyFieldMode4">OVERWRITE</arg>
                  <arg name="field.copyFieldMode5">OVERWRITE</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="scopeDestination-jql"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">4fd7d272cffa1401b740b9188cdaeaaf5185c323</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IFNldCBPUF9PRkZFUl9US1Q9WWVzIG9uIGp1c3QgY3JlYXRlZCBsaW5rZWRJc3N1ZQ==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXIKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uU2x1cnBlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb25maWcudXRpbC5KaXJhSG9tZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQKaW1wb3J0IGphdmEudGV4dC5QYXJzZUV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmNvbmZpZy5wcm9wZXJ0aWVzLkFQS2V5cwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuTGlua0NvbGxlY3Rpb25JbXBsOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk1vZGlmaWVkVmFsdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS51dGlsLkRlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKSXNzdWVJbmRleGluZ1NlcnZpY2UgCWlzc3VlSW5kZXhpbmdTZXJ2aWNlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q29tcG9uZW50KElzc3VlSW5kZXhpbmdTZXJ2aWNlKQoKLypTY3JpcHQgVmFyaWFibGVzKi8KLy9QZXIgUG9zdCBGdW5jdGlvbgppc3N1ZSA9IGlzc3VlCi8vUGVyIHRlc3QgZGEgY29uc29sZQovL0lzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKQovL2lzc3VlID0gaXNzdWVNYW5hZ2VyLmdldElzc3VlQnlLZXlJZ25vcmVDYXNlKCJPUFVULTI1NyIpCmxvZy5kZWJ1ZyAiSXNzdWU6ICIgKyBpc3N1ZQpkZWYgZm91bmQ9ZmFsc2UKZGVmIGxpbmtlZElzc3VlCmRlZiBpc3N1ZVNlcnZpY2UgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZVNlcnZpY2UoKQoKTGlzdDxJc3N1ZUxpbms+IGFsbEluSXNzdWVMaW5rID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVMaW5rTWFuYWdlcigpLmdldElud2FyZExpbmtzKGlzc3VlLmdldElkKCkpOwpsb2cuZGVidWcgImFsbEluSXNzdWVMaW5rOiAiICsgYWxsSW5Jc3N1ZUxpbmsKZm9yIChJdGVyYXRvcjxJc3N1ZUxpbms+IG91dEl0ZXJhdG9yID0gYWxsSW5Jc3N1ZUxpbmsuaXRlcmF0b3IoKTsgb3V0SXRlcmF0b3IuaGFzTmV4dCgpOykgewogICAgSXNzdWVMaW5rIGlzc3VlTGluayA9IChJc3N1ZUxpbmspIG91dEl0ZXJhdG9yLm5leHQoKTsKICAgIGRlZiBsaW5rZWRJc3N1ZVRlbXAgPSBpc3N1ZUxpbmsuZ2V0U291cmNlT2JqZWN0KCkKICAgIFN0cmluZyB0eXBlID0gbGlua2VkSXNzdWVUZW1wLmdldElzc3VlVHlwZSgpLmdldE5hbWUoKTsKCiAgICBsb2cuZGVidWcoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpKSAKICAgIAogICAgaWYoaXNzdWVMaW5rLmlzc3VlTGlua1R5cGUuZ2V0TmFtZSgpLnRvU3RyaW5nKCkuZXF1YWxzKHByb3BlcnRpZXNbJ2lsLmxpbmtlZFRrdHNUcmlnZ2VyJ10udG9TdHJpbmcoKSkpewogICAgICAgIGZvdW5kPXRydWUKICAgICAgICBsaW5rZWRJc3N1ZT1saW5rZWRJc3N1ZVRlbXAKICAgIH0KfQpsb2cuZGVidWcgImZvdW5kOiAiICsgZm91bmQKCmlmKGZvdW5kKXsKCWRlZiBkZXN0U3RhdHVzT2JqZWN0ID0gbGlua2VkSXNzdWUuZ2V0U3RhdHVzT2JqZWN0KCkKICAgIGxvZy5kZWJ1ZyAiZGVzdFN0YXR1c09iamVjdDogIiArIGRlc3RTdGF0dXNPYmplY3QKICAgIGxvZy5kZWJ1ZyAibGlua2VkSXNzdWU6ICIgKyBsaW5rZWRJc3N1ZQogICAgZGVmIHVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKCS8vIElzIHRoZSBzdGF0dXMgb2YgdGhlIGxpbmtlZCBpc3N1ZSAiSW5zdGFsbGluZyIgPwogICAgCiAgICBkZWYgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuY3VzdG9tRmllbGRNYW5hZ2VyCiAgICBkZWYgb2ZmZXJJc3N1ZUZpZWxkID0gY3VzdG9tRmllbGRNYW5hZ2VyLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5vZmZlckxpbmtlZElzc3VlJ10udG9TdHJpbmcoKSkuZmlyc3QoKQogICAgZGVmIG1haW50ZW5hbmNlSXNzdWVGaWVsZCA9IGN1c3RvbUZpZWxkTWFuYWdlci5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YubWFpbnRlbmFuY2VMaW5rZWRJc3N1ZSddID8gcHJvcGVydGllc1snY2YubWFpbnRlbmFuY2VMaW5rZWRJc3N1ZSddLnRvU3RyaW5nKCkgOiAiT1BfTUFJTlRFTkFOQ0VfTElOS0VEX0lTU1VFIikuZmlyc3QoKQogICAgZGVmIG9mZmVySXNzdWVCb29sRmllbGQgPSBjdXN0b21GaWVsZE1hbmFnZXIuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLm9mZmVyVGt0J10udG9TdHJpbmcoKSkuZmlyc3QoKQogICAgCiAgICAvL1NldCBPUEFBX09GRkVSX1RLVD1ZZXMgb24ganVzdCBjcmVhdGVkIGxpbmtlZElzc3VlCiAgICBkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKICAgIGRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGxpbmtlZElzc3VlCgogICAgZGVmIGZpZWxkQ29uZmlnID0gb2ZmZXJJc3N1ZUJvb2xGaWVsZC5nZXRSZWxldmFudENvbmZpZyhsaW5rZWRJc3N1ZSkKICAgIGxvZy53YXJuICJmaWVsZENvbmZpZzogIiArIGZpZWxkQ29uZmlnCiAgICBkZWYgY2ZOZXdWYWx1ZSA9IENvbXBvbmVudEFjY2Vzc29yLm9wdGlvbnNNYW5hZ2VyLmdldE9wdGlvbnMoZmllbGRDb25maWcpPy5maW5kIHsgaXQudG9TdHJpbmcoKSA9PSAiWWVzIiB9CiAgICBvZmZlcklzc3VlQm9vbEZpZWxkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKG9mZmVySXNzdWVCb29sRmllbGQpLCBjZk5ld1ZhbHVlKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQoJbWFpbnRlbmFuY2VJc3N1ZUZpZWxkLnVwZGF0ZVZhbHVlKG51bGwsIGxpbmtlZElzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShsaW5rZWRJc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKG1haW50ZW5hbmNlSXNzdWVGaWVsZCksIGlzc3VlLmtleS50b1N0cmluZygpKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQogICAgCiAgICBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7CiAgICBpc3N1ZUluZGV4aW5nU2VydmljZS5yZUluZGV4KGxpbmtlZElzc3VlKSAgICAKICAgIAogICAgbG9nLmRlYnVnICJvZmZlcklzc3VlRmllbGQ6ICIgKyBvZmZlcklzc3VlRmllbGQKICAgIGxvZy5kZWJ1ZyAibGlua2VkSXNzdWU6ICIgKyBsaW5rZWRJc3N1ZQogICAgb2ZmZXJJc3N1ZUZpZWxkLnVwZGF0ZVZhbHVlKG51bGwsIGlzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKG9mZmVySXNzdWVGaWVsZCksIGxpbmtlZElzc3VlLmtleS50b1N0cmluZygpKSwgbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpKQogICAgbG9nLmRlYnVnICJ1cGRhdGVkOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShvZmZlcklzc3VlRmllbGQpCiAgICAKICAgIGlmIChkZXN0U3RhdHVzT2JqZWN0Lm5hbWUgPT0gcHJvcGVydGllc1snd2Yub3BlbiddLnRvU3RyaW5nKCkpIHsKICAgICAgICAvLyBQcmVwYXJlIG91ciBpbnB1dCBmb3IgdGhlIHRyYW5zaXRpb24KICAgICAgICBkZWYgaXNzdWVJbnB1dFBhcmFtZXRlcnMgPSBpc3N1ZVNlcnZpY2UubmV3SXNzdWVJbnB1dFBhcmFtZXRlcnMoKQogICAgICAgIGlzc3VlSW5wdXRQYXJhbWV0ZXJzLndpdGggewogICAgICAgICAgICBzZXRTa2lwU2NyZWVuQ2hlY2sodHJ1ZSkKICAgICAgICB9CiAgICAgICAgLy8gVmFsaWRhdGUgdHJhbnNpdGlvbmluZyB0aGUgbGlua2VkIGlzc3VlIHRvICJTaWducyBOZWVkZWQiCiAgICAgICAgZGVmIHZhbGlkYXRpb25SZXN1bHQgPSBpc3N1ZVNlcnZpY2UudmFsaWRhdGVUcmFuc2l0aW9uKHVzZXIsIGxpbmtlZElzc3VlLmlkLCAocHJvcGVydGllc1snd2YudHIuYXNrUXVvdGUnXSA/IHByb3BlcnRpZXNbJ3dmLnRyLmFza1F1b3RlJ10udG9JbnRlZ2VyKCkgOiAxMSksIGlzc3VlSW5wdXRQYXJhbWV0ZXJzKQogICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQoKSkgewogICAgICAgICAgICAvLyBQZXJmb3JtIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgIGRlZiBpc3N1ZVJlc3VsdCA9IGlzc3VlU2VydmljZS50cmFuc2l0aW9uKHVzZXIsIHZhbGlkYXRpb25SZXN1bHQpCiAgICAgICAgICAgIGlmICghIGlzc3VlUmVzdWx0LmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgbG9nLmRlYnVnKCJGYWlsZWQgdG8gdHJhbnNpdGlvbiB0YXNrICR7ZGVzdElzc3VlLmtleX0sIGVycm9yczogJHtpc3N1ZVJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBsb2cuZGVidWcoIlRyYW5zYXppb25lIGZhdHRhIikKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxvZy5kZWJ1ZygiQ291bGQgbm90IHRyYW5zaXRpb24gdGFzayAke2Rlc3RJc3N1ZS5rZXl9LCBlcnJvcnM6ICR7dmFsaWRhdGlvblJlc3VsdC5lcnJvckNvbGxlY3Rpb259IikKICAgICAgICB9CiAgICB9CiAgICAKfQ==</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="241" name="Riapri Tkt">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_NOTES">YCFgT1A6IE9QQUFfU0FMRVNfT1JERVJfREFURSBhbmQgT1BBQV9QVVJDSEFTRV9PUkRFUl9EQVRFIHNob3VsZCBiZSBudWxsIGluIG9yZGVyIHRvIHJlb3BlbiB0aGUgdGlja2V0IC0gb3RoZXJ3aXNlIHRoZSB0aWNrZXQgaGFzIGFscmVhZHkgYmVlbiBhY2NvdW50ZWQgc28gaXQgY2Fubm90IGJlIHJlb3BlbmVk</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">YCFgY2ZWYWx1ZXNbJ09QX1NBTEVTX09SREVSX0RBVEUnXSA9PSBudWxsICYmIGNmVmFsdWVzWydPUF9QVVJDSEFTRV9PUkRFUl9EQVRFJ10gPT0gbnVsbHx8fA==</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE"></arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="null" status="null" step="6">
              <post-functions>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">resolution</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="8" name="To be Quoted">
      <meta name="jira.status.id">14331</meta>
      <actions>
        <action id="251" name="Richiedi Preventivo a Fornitore" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19913</meta>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">38c5effd94ec08c894a28a7995b3e38d8a3edc57</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlTWFuYWdlcgoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCklzc3VlIGlzc3VlID0gaXNzdWUKLy9Jc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7Ci8vSXNzdWUgaXNzdWUgPSBpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVCeUtleUlnbm9yZUNhc2UoIkFBUy0yNzYxIikKCmRlZiBlcnJvcnMgPSBmYWxzZQpkZWYgd2FybmluZ3MgPSBmYWxzZQoKZGVmIHRyYW5zaXRpb25DaGVjayA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuY2hlY2tBbmRDb25maXJtJ10udG9TdHJpbmcoKSlbMF0KZGVmIHJlcE1hdGVyaWFscyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YucXVvdGVNYXRlcmlhbHMnXS50b1N0cmluZygpKVswXQoKZGVmIGVycm9yTWFuZGF0b3J5RmllbGRzID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlcnJvckpvYlN0YXJ0ZWRDb21wbGV0ZWRGaWVsZHMgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIHdhcm5pbmdFbXB0eUZpZWxkcyA9IG5ldyBBcnJheUxpc3QoKQoKLy9PUEFBX1JFUExBQ0VEX01BVEVSSUFMUwppZihpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscyk9PW51bGwgfHwgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykgPT0gIiIgfHwgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpLnRvU3RyaW5nKCkuZXF1YWxzKCIiKSl7CiAgICBsb2cuZGVidWcgIndhcm5pbmdzIHRydWUiCiAgICB3YXJuaW5ncyA9IHRydWUKICAgIHdhcm5pbmdFbXB0eUZpZWxkcy5hZGQocHJvcGVydGllc1snY2YucXVvdGVNYXRlcmlhbHMnXS50b1N0cmluZygpKQp9ZWxzZXsKICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwogICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgIC8vVmVyaWZpY28gY2hlIGNpIHNpYSBhbG1lbm8gdW4gZWxlbWVudG8sIGRpIHF1ZWxsaSBsZWdhdGkgbmVsIGN1c3RvbWZpZWxkLCBjb24gREVMRVRFRCE9dHJ1ZQogICAgZGVmIGFsbERlbGV0ZWQ9dHJ1ZQogICAgZm9yKG9iaiBpbiBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykpewogICAgICAgIAogICAgICAgIG9iaj1vYmoudG9TdHJpbmcoKQogICAgICAgIGRlZiBvYmpLZXkgPSBvYmouc3Vic3RyaW5nKG9iai5pbmRleE9mKCcoJykrMSxvYmouaW5kZXhPZignKScpKQogICAgICAgIGRlZiBvYmpPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4ob2JqS2V5KQogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihvYmpPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4ob2JqT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmRlbGV0ZWQnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKICAgICAgICAgICAgZGVsZXRlZCA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkKICAgICAgICAgICAgaWYoIWRlbGV0ZWQpewogICAgICAgICAgICAgICAgYWxsRGVsZXRlZD1mYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGFsbERlbGV0ZWQ9ZmFsc2UKICAgICAgICB9ICAgICAgCiAgICAgICAgLy9sb2cuZGVidWcgIm9iajogIiArIG9iagogICAgICAgIC8vbG9nLmRlYnVnICJhbGxEZWxldGVkOiAiICsgYWxsRGVsZXRlZAogICAgfQogICAgaWYoYWxsRGVsZXRlZCl7CiAgICAgICAgd2FybmluZ3MgPSB0cnVlCiAgICAgICAgd2FybmluZ0VtcHR5RmllbGRzLmFkZChwcm9wZXJ0aWVzWydjZi5xdW90ZU1hdGVyaWFscyddLnRvU3RyaW5nKCkpCiAgICB9Cn0KCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghZXJyb3JzICYmICF3YXJuaW5ncyl7CiAgICByZXR1cm4gdHJ1ZQp9ZWxzZXsKICAgIGlmKCFlcnJvcnMgJiYgd2FybmluZ3MpewogICAgICAgIC8vU2UgY2kgc29ubyBzb2xvIHdhcm5pbmdzIHZlcmlmaWNvIHNlIGwndXRlbnRlIGhhIGdpw6AgZGljaGlhcmF0byBkaSB2b2xlciBwcm9zZWd1aXJlIGNvbXVucXVlCiAgICAgICAgLy8gLSB0cmFuc2l0aW9uIGZpZWxkICJPUEFBX0NIRUNLX0FORF9DT05GSVJNIj0iWWVzIgogICAgICAgIC8vIC0gaW4gY2FzbyBjb250cmFyaW8gaW52aW8gaSB3YXJuaW5nIGEgRkUKCiAgICAgICAgLy9sb2cuZGVidWcgInRyYW5zaXRpb25DaGVjazogIiArIGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKQogICAgICAgIC8vbG9nLmRlYnVnICJyZXN1bHQ6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykudG9TdHJpbmcoKS5lcXVhbHMoIlllcyIpCiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICAgICAgaWYod2FybmluZ0VtcHR5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQoIlciKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJDT05GSVJNX0VNUFRZX0ZJRUxEUyIpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQobnVsbCkKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZCh3YXJuaW5nRW1wdHlGaWVsZHMpCgogICAgICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5KQogICAgICAgICAgICB9CgogICAgICAgICAgICBvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgICAgICBsb2cuZGVidWcgInRocm93IGV4Y2VwdGlvbjogIiArIG91dHB1dC50b1N0cmluZygpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siVyI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiVyIsIG91dHB1dC50b1N0cmluZygpKSAgIAogICAgICAgIH0KCiAgICB9CiAgICBpZihlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgICAgICBkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKCiAgICAgICAgaWYoZXJyb3JNYW5kYXRvcnlGaWVsZHMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgIGRlZiBlTGlzdE1hbmRhdG9yeSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoIkUiKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoIk1BTkRBVE9SWV9GSUVMRFMiKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQobnVsbCkKICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKGVycm9yTWFuZGF0b3J5RmllbGRzKQogICAgICAgICAgICBlTGlzdC5hZGQoZUxpc3RNYW5kYXRvcnkpCiAgICAgICAgfQoKICAgICAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgICAgIGxvZy5kZWJ1ZyAidGhyb3cgZXhjZXB0aW9uOiAiICsgb3V0cHV0LnRvU3RyaW5nKCkKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IkUiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKSAgIAogICAgfQogICAgaWYoZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICBkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICBkZWYgd0xpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICBpZihlcnJvck1hbmRhdG9yeUZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgZGVmIGVMaXN0TWFuZGF0b3J5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiRSIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZCgiTUFOREFUT1JZX0ZJRUxEUyIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChudWxsKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoZXJyb3JNYW5kYXRvcnlGaWVsZHMpCiAgICAgICAgICAgIGVMaXN0LmFkZChlTGlzdE1hbmRhdG9yeSkKICAgICAgICB9CgogICAgICAgIGlmKHdhcm5pbmdFbXB0eUZpZWxkcy5zaXplKCkgPiAwKXsKICAgICAgICAgICAgZGVmIHdMaXN0Q29uZmlybUVtcHR5ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZCgiVyIpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZCgiQ09ORklSTV9FTVBUWV9GSUVMRFMiKQogICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQobnVsbCkKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKHdhcm5pbmdFbXB0eUZpZWxkcykKCiAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eSkKICAgICAgICB9CgogICAgICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICBsb2cuZGVidWcgInRocm93IGV4Y2VwdGlvbjogIiArIG91dHB1dC50b1N0cmluZygpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXRSIsIG91dHB1dC50b1N0cmluZygpKSAgCiAgICB9Cn0K</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="9">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1A6IFZhbG9yaXp6YXppb25lIGxpc3RpbmkgZm9ybml0b3Jl</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKCklzc3VlSW5kZXhpbmdTZXJ2aWNlIAlpc3N1ZUluZGV4aW5nU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChJc3N1ZUluZGV4aW5nU2VydmljZSkKCmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCgpsb2cuZGVidWcgIlZhbG9yaXp6YXppb25lIGxpc3RpbmkiCgovKiBSRVNUIEFQSSBwZXIgQ29udGFiaWxpenphemlvbmUgSW50ZXJ2ZW50byAqLwpyZXF1ZXN0TWV0aG9kID0gIkdFVCI7CgpiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1snYXBpLmVudiddLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvQUEvdGlja2V0L2lzc3VlS2V5LyIgKyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIvY2xvc2U/cG9wdWxhdGVSYXRlcz1mYWxzZSZtYXRlcmlhbEF0dHJpYnV0ZT0iICsgcHJvcGVydGllc1snY2YucXVvdGVNYXRlcmlhbHMnXS50b1N0cmluZygpCmxvZy5kZWJ1ZyAiYmFzZVVybDogIiArIGJhc2VVUkwKCi8qRGVmaW5pcmUgcGFyYW1ldHJvIGRpIGlucHV0IHVuYXRhbnR1bT10cnVlfGZhbHNlIGluIGJhc2UgYWwgdmFsb3JlIGRlbGxhIHZhcmlhYmlsZSBib29sZWFuYSB1bmF0YW50dW0qLwpVUkwgdXJsID0gbmV3IFVSTChiYXNlVVJMKQpIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gKEh0dHBVUkxDb25uZWN0aW9uKXVybC5vcGVuQ29ubmVjdGlvbigpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RNZXRob2QocmVxdWVzdE1ldGhvZCk7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbiIpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQWNjZXB0IiwgIiovKiIpOwpjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwpjb25uZWN0aW9uLnNldERvSW5wdXQodHJ1ZSk7CmNvbm5lY3Rpb24uY29ubmVjdCgpOwpsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQpsb2cuZGVidWcgIlJlc3BvbnNlTWVzc2FnZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKQoKLy9Jc3N1ZUluZGV4aW5nU2VydmljZSBpc3N1ZUluZGV4aW5nU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChJc3N1ZUluZGV4aW5nU2VydmljZSkKLy9pc3N1ZUluZGV4aW5nU2VydmljZS5yZUluZGV4KGlzc3VlTWFuYWdlci5nZXRJc3N1ZU9iamVjdChpc3N1ZS5rZXkudG9TdHJpbmcoKSkpCgovL2RlZiB1bmFUYW50dW1SYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUoIk9QQUFfVU5BVEFOVFVNX1JBVEVTIilbMF0KLy9sb2cud2FybiAidW5hVGFudHVtUmF0ZXM6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHVuYVRhbnR1bVJhdGVzKQoKZGVmIG91dHB1dCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0RXJyb3JzID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlcnJvck1zZ3MgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKS50b1N0cmluZygpLmVxdWFscygiMjAwIikpewogICAgbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VDb2RlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlTWVzc2FnZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKQogICAgbG9nLmRlYnVnICJSZXNwb25zZTogIiArIGNvbm5lY3Rpb24KCiAgICBlTGlzdEVycm9ycy5hZGQoIkUiKQogICAgZUxpc3RFcnJvcnMuYWRkKCJPUC1US1QtQUNDT1VOVElORyIpCiAgICBlcnJvck1zZ3MuYWRkKGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkgKyAiICIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpKQogICAgZUxpc3RFcnJvcnMuYWRkKGVycm9yTXNncykKICAgIGVMaXN0LmFkZChlTGlzdEVycm9ycykKCiAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKQp9</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="9" name="Waiting for Supplier Quote">
      <meta name="jira.status.id">14332</meta>
      <actions>
        <action id="261" name="Preventivo Fornitore Inserito" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19914</meta>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">23e761954d70d711d1ee5515aaf85f7738768dd8</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIG1hbmRhdG9yeSBhdHRhY2htZW50czogUHJldmVudGl2byBGb3JuaXRvcmU=</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmluZGV4Lklzc3VlSW5kZXhpbmdTZXJ2aWNlCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuZXZlbnQudHlwZS5FdmVudERpc3BhdGNoT3B0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXIKaW1wb3J0IGNvbS5vbnJlc29sdmUuc2NyaXB0cnVubmVyLnJ1bm5lci5TY3JpcHRSdW5uZXJJbXBsCgpQcm9wZXJ0aWVzIHByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcygpCkZpbGUgcHJvcGVydGllc0ZpbGUgPSBuZXcgRmlsZShTY3JpcHRSdW5uZXJJbXBsLmdldFBsdWdpbkNvbXBvbmVudChTY3JpcHRSdW5uZXIpLmdldFJvb3RzRm9yRGlzcGxheSgpICsgJy9vcHByb2plY3QucHJvcGVydGllcycpCnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7Cglwcm9wZXJ0aWVzLmxvYWQoaXQpCn0KQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKCklzc3VlSW5kZXhpbmdTZXJ2aWNlIAlpc3N1ZUluZGV4aW5nU2VydmljZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldENvbXBvbmVudChJc3N1ZUluZGV4aW5nU2VydmljZSkKZGVmIGF1dG9tYXRpY2FsbHlDbG9zZWQgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmF1dG9tYXRpY2FsbHlDbG9zZWQnXS50b1N0cmluZygpKVswXQoKZGVmIHJlcXVlc3RNZXRob2QKZGVmIGJhc2VVUkwKCmludCBPUEFBID0gcHJvcGVydGllc1snaXNjaGVtYS5hYS5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKaW50IERCTyA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuZGJvLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQogCklzc3VlIGlzc3VlID0gaXNzdWUKCmRlZiBlcnJvcnMgPSBmYWxzZQpkZWYgd2FybmluZ3MgPSBmYWxzZQoKZGVmIGVycm9yTWFuZGF0b3J5RmllbGRzID0gbmV3IEFycmF5TGlzdCgpCgovKlJpbW96aW9uZSBhbGxlZ2F0byByYXBwb3J0byBkaSBpbnRlcnZlbnRvIGFwcGVuYSBjcmVhdG8qLwovKiBHZXQgSW5zaWdodCBJUUwgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCkNsYXNzIGlxbEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlIik7IApkZWYgaXFsRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKGlxbEZhY2FkZUNsYXNzKTsKCi8qIEdldCBJbnNpZ2h0IE9iamVjdCBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsKZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgovKiBHZXQgSW5zaWdodCBPYmplY3QgVHlwZSBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3Mgb2JqZWN0VHlwZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZSIpOwpkZWYgb2JqZWN0VHlwZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlRmFjYWRlQ2xhc3MpOwoKLyogR2V0IEluc2lnaHQgT2JqZWN0IEF0dHJpYnV0ZSBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwpkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwoKQ2xhc3Mgb2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnlDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuc2VydmljZXMubW9kZWwuZmFjdG9yeS5PYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeSIpOwpkZWYgb2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnkgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0QXR0cmlidXRlQmVhbkZhY3RvcnlDbGFzcyk7CgovKiBTcGVjaWZ5IHRoZSBzY2hlbWEgaWQgYXMgd2VsbCBhcyB0aGUgSVFMIHRoYXQgd2lsbCBmZXRjaCBvYmplY3RzLiBJbiB0aGlzIGNhc2UgYWxsIG9iamVjdHMgd2l0aCBOYW1lIG1hdGNoaW5nIHRoZSB2YWx1ZUNGLCBiZSBzdXJlIHRvIGluY2x1ZGUgIiBhcm91bmQgdmFsdWUgKi8KZGVmIG9iamVjdHMgPSBpcWxGYWNhZGUuZmluZE9iamVjdHNCeUlRTEFuZFNjaGVtYShEQk8sICJcIiIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5jYXRlZ29yeVJlZiddLnRvU3RyaW5nKCkgKyAiXCIuXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkubmFtZSddLnRvU3RyaW5nKCkgKyAiXCIgPSBcIiIgKyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5vYmpzLnByZXZGb3JuaXRvcmUnXS50b1N0cmluZygpICsgIlwiIEFORCAiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuZGVsZXRlZCddLnRvU3RyaW5nKCkgKyAiIT10cnVlIEFORCBvYmplY3QgSEFWSU5HIGNvbm5lY3RlZFRpY2tldHMoa2V5ID0gIiArIGlzc3VlLmtleS50b1N0cmluZygpICsgIikiKTsgLy8gU2VlIHRoZSBjb21wbGV0ZSBsaXN0IG9mIHBvc3NpYmxlIElRTCBvbiB0aGUgSW5zaWdodCBRdWVyeSBMYW5ndWFnZSBkb2N1bWVudGF0aW9uIHBhZ2UKLyogSWYgdGhpcyBpcyBhIG1hbmRhdG9yeSBmaWVsZCB5b3Ugc2hvdWxkIGJlIGFibGUgdG8gZG8gdGhpczogKi8KbG9nLmluZm8oIkluc2lnaHQgb2JqZWN0OiAiICsgb2JqZWN0c1swXSk7CmxvZy5kZWJ1ZyAiXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuY2F0ZWdvcnlSZWYnXS50b1N0cmluZygpICsgIlwiLlwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm5hbWUnXS50b1N0cmluZygpICsgIlwiID0gXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5wcmV2Rm9ybml0b3JlJ10udG9TdHJpbmcoKSArICJcIiBBTkQgIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmRlbGV0ZWQnXS50b1N0cmluZygpICsgIiE9dHJ1ZSBBTkQgb2JqZWN0IEhBVklORyBjb25uZWN0ZWRUaWNrZXRzKGtleSA9ICIgKyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIpIgoKaWYoIW9iamVjdHNbMF0pewogICAgLypOZXNzdW4gcHJldmVudGl2byBhbGxlZ2F0byovCiAgICBlcnJvcnMgPSB0cnVlCiAgICBlcnJvck1hbmRhdG9yeUZpZWxkcy5hZGQocHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5wcmV2Rm9ybml0b3JlJ10gPyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5vYmpzLnByZXZGb3JuaXRvcmUnXS50b1N0cmluZygpIDogIlByZXZlbnRpdm8gRm9ybml0b3JlIikKfQoKZGVmIG91dHB1dCA9IG5ldyBBcnJheUxpc3QoKQoKaWYgKCFlcnJvcnMgJiYgIXdhcm5pbmdzKXsKICAgIHJldHVybiB0cnVlCn1lbHNlewogICAgaWYoIWVycm9ycyAmJiB3YXJuaW5ncyl7CiAgICAgICAgaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CiAgICAgICAgICAgIC8vbG9nLmRlYnVnICJyZXR1cm4gdHJ1ZSIKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgogICAgICAgICAgICBpZih3YXJuaW5nRW1wdHlGaWVsZHMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHkgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZCgiVyIpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQoIkNPTkZJUk1fRU1QVFlfRklFTERTIikKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZChudWxsKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKHdhcm5pbmdFbXB0eUZpZWxkcykKCiAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHkpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siVyI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiVyIsIG91dHB1dC50b1N0cmluZygpKSAgIAogICAgICAgIH0KICAgIH0KICAgIGlmKGVycm9ycyAmJiAhd2FybmluZ3MpewogICAgICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgIAogICAgICAgIGlmKGVycm9yTWFuZGF0b3J5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICBkZWYgZUxpc3RNYW5kYXRvcnkgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKCJFIikKICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKCJNQU5EQVRPUllfQVRUQUNITUVOVFMiKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQobnVsbCkKICAgICAgICAgICAgZUxpc3RNYW5kYXRvcnkuYWRkKGVycm9yTWFuZGF0b3J5RmllbGRzKQogICAgICAgICAgICBlTGlzdC5hZGQoZUxpc3RNYW5kYXRvcnkpCiAgICAgICAgfQogICAgICAgIAoJCW91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgICAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKICAgIH0KICAgIGlmKGVycm9ycyAmJiB3YXJuaW5ncyl7CiAgICAgICAgZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgCiAgICAgICAgaWYoZXJyb3JNYW5kYXRvcnlGaWVsZHMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgIGRlZiBlTGlzdE1hbmRhdG9yeSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoIkUiKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoIk1BTkRBVE9SWV9BVFRBQ0hNRU5UUyIpCiAgICAgICAgICAgIGVMaXN0TWFuZGF0b3J5LmFkZChudWxsKQogICAgICAgICAgICBlTGlzdE1hbmRhdG9yeS5hZGQoZXJyb3JNYW5kYXRvcnlGaWVsZHMpCiAgICAgICAgICAgIGVMaXN0LmFkZChlTGlzdE1hbmRhdG9yeSkKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYod2FybmluZ0VtcHR5RmllbGRzLnNpemUoKSA+IDApewogICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHkgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJXIikKICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHkuYWRkKCJDT05GSVJNX0VNUFRZX0ZJRUxEUyIpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5LmFkZChudWxsKQogICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eS5hZGQod2FybmluZ0VtcHR5RmllbGRzKQoKICAgICAgICAgICAgd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5KQogICAgICAgIH0KICAgICAgICAKICAgICAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgICAgIG91dHB1dC5hZGQod0xpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXRSIsIG91dHB1dC50b1N0cmluZygpKSAgCiAgICB9Cn0=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">53480a627af4b00abaf5fd025ed6c011dab7e21e</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcyA=</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluawoKaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuSW52YWxpZElucHV0RXhjZXB0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKCklzc3VlIGlzc3VlID0gaXNzdWUKLy9QZXIgdGVzdCBkYSBjb25zb2xlCi8vSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwovL0lzc3VlIGlzc3VlID0gaXNzdWVNYW5hZ2VyLmdldElzc3VlQnlLZXlJZ25vcmVDYXNlKCJBQVMtMjc2MSIpCgpkZWYgZXJyb3JzID0gZmFsc2UKZGVmIHdhcm5pbmdzID0gZmFsc2UKZGVmIHJlbGF0ZXNJbklzc3VlTGluaz1mYWxzZQpkZWYgcmVsYXRlc091dElzc3VlTGluaz1mYWxzZQpkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZUxpbmtlZCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgd0xpc3RDb25maXJtRW1wdHlSYXRlUXVvdGVMaW5rZWQgPSBuZXcgQXJyYXlMaXN0KCkKCmRlZiByZXBNYXRlcmlhbHMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnF1b3RlTWF0ZXJpYWxzJ10udG9TdHJpbmcoKSlbMF0KZGVmIGxhYm91clJhdGVzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5xdW90ZUxhYm91clJhdGVzJ10udG9TdHJpbmcoKSlbMF0KCi8qQ29uZmVybWEgdXRlbnRlIHN1IHdhcm5pbmdzKi8KZGVmIHRyYW5zaXRpb25DaGVjayA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuY2hlY2tBbmRDb25maXJtJ10udG9TdHJpbmcoKSlbMF0KCi8qSW5zaWdodCBTY2hlbWEgSURzKi8KZGVmIERCT2JqZWN0cyA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuZGJvJ10udG9TdHJpbmcoKSArICItIgpkZWYgT1BBQSA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuYWEnXS50b1N0cmluZygpICsgIi0iCgovKkFycmF5IHdhcm5pbmdzIGVkIGVycm9ycyBwZXIgbGEgaXNzdWUgcHJpbmNpcGFsZSwgdW5vIHBlciBvZ25pIHRpcG9sb2dpYSBkaSBlcnJvcmUgbyB3YXJuaW5nKi8KZGVmIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVNYXRTdXBwbGllciA9IG5ldyBBcnJheUxpc3QoKQpkZWYgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllciA9IG5ldyBBcnJheUxpc3QoKQovL2RlZiBpc3N1ZUVycm9yLi4uCgovKlZlcmlmaWNhIGNhbXBpIHN1IHRpY2tldCBvZ2dldHRvIGRlbGxhIHRyYW5zYXppb25lKi8KLy9PUF9RVU9URV9NQVRFUklBTFMKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgIGxvZy5kZWJ1ZyAiTWF0ZXJpYWxpOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpCiAgICAvKkNpY2xhcmUgdHV0dGkgZ2xpIG9nZ2V0dGkgYXNzb2NpYXRpIGFsIGNhbXBvKi8KICAgIC8vaW5zaWdodCBjbGFzc2VzICYgY29tcG9uZW50cwogICAgQ2xhc3Mgb2JqZWN0RmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RGYWNhZGUiKTsgIAogICAgQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSIpOwogICAgZGVmIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzKTsKICAgIGRlZiBvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwoKICAgIGRlZiByZXBNYXRMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpCgogICAgZm9yKG1hdCBpbiByZXBNYXRMaXN0KXsKICAgICAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5nIGdldCBvYmplY3QKICAgICAgICBkZWYgY29tcG9uZW50PW1hdC50b1N0cmluZygpCiAgICAgICAgZGVmIGNvbXBvbmVudEtleSA9IGNvbXBvbmVudC5zdWJzdHJpbmcoY29tcG9uZW50LmluZGV4T2YoJygnK09QQUEpKzEsY29tcG9uZW50Lmxlbmd0aCgpLTEpCiAgICAgICAgZGVmIGNvbXBvbmVudE9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihjb21wb25lbnRLZXkpCiAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IGNvbXBvbmVudAoJCWRlZiBtYXREZWwgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiAiIgogICAgICAgIGRlZiBtYXREZWxWYWx1ZSA9IG1hdERlbCAhPSAiIiA/IG1hdERlbC5zdWJzdHJpbmcobWF0RGVsLmluZGV4T2YoJygnKSsxLG1hdERlbC5pbmRleE9mKCcpJykpIDogIiIKCQlsb2cuZGVidWcgIm1hdE9iajogIiArIGNvbXBvbmVudE9iamVjdAogICAgICAgIGxvZy5kZWJ1ZyAiZGVsOiAiICsgbWF0RGVsCiAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgIGRlZiBhcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgZGVmIGFwcGxpZWRUb1ZhbHVlCiAgICAgICAgaWYoYXBwbGllZFRvLnNpemUoKSA+IDApewogICAgICAgICAgICBhcHBsaWVkVG8gPSBhcHBsaWVkVG8udG9TdHJpbmcoKQogICAgICAgICAgICBhcHBsaWVkVG9WYWx1ZSA9IGFwcGxpZWRUby5zdWJzdHJpbmcoYXBwbGllZFRvLmluZGV4T2YoJygnKSsxLGFwcGxpZWRUby5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIC8vbG9nLmRlYnVnICJhcHBsaWVkVG9WYWx1ZTogIiArIGFwcGxpZWRUb1ZhbHVlCiAgICAgICAgfQoKICAgICAgICBkZWYgbWF0TnVtYmVyCiAgICAgICAgZGVmIG1hdE51bWJlcktleQogICAgICAgIGRlZiBtYXROdW1iZXJWYWx1ZQogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIG1hdE51bWJlciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgICAgIGlmKG1hdE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIG1hdE51bWJlciA9IG1hdE51bWJlci50b1N0cmluZygpCiAgICAgICAgICAgICAgICBtYXROdW1iZXJLZXkgPSBtYXROdW1iZXIuc3Vic3RyaW5nKG1hdE51bWJlci5pbmRleE9mKCcoJykrMSxtYXROdW1iZXIuaW5kZXhPZignKScpKQogICAgICAgICAgICAgICAgZGVmIG1hdE51bWJlck9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihEQk9iamVjdHMgKyBtYXROdW1iZXJLZXkpCiAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXROdW1iZXJPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5uYW1lJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIG1hdE51bWJlclZhbHVlID0gbWF0TnVtYmVyVmFsdWUuc3Vic3RyaW5nKG1hdE51bWJlclZhbHVlLmluZGV4T2YoJygnKSsxLG1hdE51bWJlclZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGVmIHNlcmlhbE51bWJlcgogICAgICAgIGRlZiBzZXJpYWxOdW1iZXJWYWx1ZQogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2VyaWFsTnVtYmVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBzZXJpYWxOdW1iZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnNlcmlhbE51bWJlciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKSBhcyBBcnJheUxpc3QKICAgICAgICAgICAgaWYoc2VyaWFsTnVtYmVyLnNpemUoKSA+IDApewogICAgICAgICAgICAgICAgc2VyaWFsTnVtYmVyID0gc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlclZhbHVlID0gc2VyaWFsTnVtYmVyLnN1YnN0cmluZyhzZXJpYWxOdW1iZXIuaW5kZXhPZignKCcpKzEsc2VyaWFsTnVtYmVyLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfSAgICAgICAgICAgICAgIAogICAgICAgIH0KCiAgICAgICAgaWYoKGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgYXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIlNVUFBMSUVSIikpICYmICFtYXREZWxWYWx1ZS5lcXVhbHMoInRydWUiKSl7CiAgICAgICAgICAgIC8vZ2V0ICJUT1RBTF9BTU9VTlRfU1VQUExJRVIiIGZvciB0aGF0IGNvbXBvbmVudAogICAgICAgICAgICBkZWYgdG90U3VwcGxpZXIKICAgICAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RTdXBwJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgdG90U3VwcGxpZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdFN1cHAnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZighdG90U3VwcGxpZXIgfHwgdG90U3VwcGxpZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgICAgICAgICAgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdFN1cHBsaWVyLmFkZChtYXROdW1iZXJWYWx1ZS50b1N0cmluZygpICsgKCghc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkuZXF1YWxzKCJudWxsIikgJiYgIXNlcmlhbE51bWJlci50b1N0cmluZygpLmVxdWFscygiW10iKSkgPyAiICgiICsgc2VyaWFsTnVtYmVyVmFsdWUudG9TdHJpbmcoKSArICIpIiA6ICIiKSkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdFN1cHBsaWVyOiAiICsgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdFN1cHBsaWVyCiAgICAgICAgICAgIH0KICAgICAgICB9ICAgCiAgICB9ICAgIAp9ICAKCi8vT1BBQV9MQUJPVVJfUkFURVMKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgIGxvZy5kZWJ1ZyAiTGFib3VyIHJhdGVzOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykKICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgogICAgZm9yKGxiIGluIGxhYm91clJhdGVzTGlzdCl7CiAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpCiAgICAgICAgZGVmIGxiUmF0ZUtleSA9IGxiUmF0ZS5zdWJzdHJpbmcobGJSYXRlLmluZGV4T2YoJygnKSsxLGxiUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgZGVmIGxiUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihsYlJhdGVLZXkpCiAgICAgICAgLy9nZXQgIkRFTEVURUQiIGZvciB0aGF0IHJhdGUKICAgICAgICBkZWYgbGJEZWwgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkgPyBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkgOiAiIgogICAgICAgIGRlZiBsYkRlbFZhbHVlID0gbGJEZWwgIT0gIiIgPyBsYkRlbC5zdWJzdHJpbmcobGJEZWwuaW5kZXhPZignKCcpKzEsbGJEZWwuaW5kZXhPZignKScpKSA6ICIiCgogICAgICAgIC8vZ2V0ICJBUFBMSUVEX1RPIiBmb3IgdGhhdCByYXRlCiAgICAgICAgZGVmIGxiQXBwbGllZFRvID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICBkZWYgbGJBcHBsaWVkVG9WYWx1ZSA9IGxiQXBwbGllZFRvLnN1YnN0cmluZyhsYkFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxsYkFwcGxpZWRUby5pbmRleE9mKCcpJykpCgogICAgICAgIGRlZiBsYlJhdGVSZWYKICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBsYlJhdGVSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgfQoKICAgICAgICBkZWYgdGVjaFJlZgogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRlY2huaWNpYW5SZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIHRlY2hSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudGVjaG5pY2lhblJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgfQoKICAgICAgICBkZWYgbGJSYXRlUmVmS2V5CiAgICAgICAgZGVmIGxiUmF0ZVJlZlZhbHVlCiAgICAgICAgaWYobGJSYXRlUmVmLnNpemUoKSA+IDApewogICAgICAgICAgICBsYlJhdGVSZWYgPSBsYlJhdGVSZWYudG9TdHJpbmcoKQogICAgICAgICAgICBsYlJhdGVSZWZLZXkgPSBsYlJhdGVSZWYuc3Vic3RyaW5nKGxiUmF0ZVJlZi5pbmRleE9mKCcoJykrMSxsYlJhdGVSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICBkZWYgbGJSYXRlUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyBsYlJhdGVSZWZLZXkpCiAgICAgICAgICAgIGxiUmF0ZVJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZVJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnJhdGUuTmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgIGxiUmF0ZVJlZlZhbHVlID0gbGJSYXRlUmVmVmFsdWUuc3Vic3RyaW5nKGxiUmF0ZVJlZlZhbHVlLmluZGV4T2YoJygnKSsxLGxiUmF0ZVJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICB9CgogICAgICAgIGRlZiB0ZWNoUmVmS2V5CiAgICAgICAgZGVmIHRlY2hSZWZWYWx1ZQogICAgICAgIGlmKHRlY2hSZWYpewogICAgICAgICAgICB0ZWNoUmVmID0gdGVjaFJlZi50b1N0cmluZygpCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAidGVjaFJlZjogIiArIHRlY2hSZWYKICAgICAgICAgICAgdGVjaFJlZktleSA9IHRlY2hSZWYuc3Vic3RyaW5nKHRlY2hSZWYuaW5kZXhPZignKCcpKzEsdGVjaFJlZi5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIGRlZiB0ZWNoUmVmT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKE9QQUEgKyB0ZWNoUmVmS2V5KQogICAgICAgICAgICB0ZWNoUmVmVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4odGVjaFJlZk9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLnRlY2huaWNpYW4ubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgIHRlY2hSZWZWYWx1ZSA9IGxiUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyh0ZWNoUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdGVjaFJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICB9CgogICAgICAgIGlmKChsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJCT1RIIikgfHwgbGJBcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiU1VQUExJRVIiKSkgJiYgIWxiRGVsVmFsdWUuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX1NVUFBMSUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgZGVmIHRvdFN1cHBsaWVyCiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdFN1cHBsaWVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgdG90U3VwcGxpZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCF0b3RTdXBwbGllciB8fCB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyLmFkZChsYlJhdGVSZWZWYWx1ZS50b1N0cmluZygpICsgIiAoIiArIHRlY2hSZWZWYWx1ZS50b1N0cmluZygpICsgIikiKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyOiAiICsgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllcgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSAgICAKfQpkZWYgb3V0cHV0ID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWVycm9ycyAmJiAhd2FybmluZ3MpewogICAgcmV0dXJuIHRydWUKfWVsc2V7CiAgICBpZighZXJyb3JzICYmIHdhcm5pbmdzKXsKICAgICAgICAvL1NlIGNpIHNvbm8gc29sbyB3YXJuaW5ncyB2ZXJpZmljbyBzZSBsJ3V0ZW50ZSBoYSBnacOgIGRpY2hpYXJhdG8gZGkgdm9sZXIgcHJvc2VndWlyZSBjb211bnF1ZQogICAgICAgIC8vIC0gdHJhbnNpdGlvbiBmaWVsZCAiT1BBQV9DSEVDS19BTkRfQ09ORklSTSI9IlllcyIKICAgICAgICAvLyAtIGluIGNhc28gY29udHJhcmlvIGludmlvIGkgd2FybmluZyBhIEZFCgogICAgICAgIC8vbG9nLmRlYnVnICJ0cmFuc2l0aW9uQ2hlY2s6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykKICAgICAgICAvL2xvZy5kZWJ1ZyAicmVzdWx0OiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKQogICAgICAgIGlmKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKS50b1N0cmluZygpLmVxdWFscygiWWVzIikpewogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAicmV0dXJuIHRydWUgLSB0cmFuc2l0aW9uQ2hlY2sgPSBZZXMiCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICAgICAgaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVTdXBwbGllci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiU1VQUExJRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlSYXRlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0U3VwcGxpZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgIAlkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlciKQogICAgICAgICAgICAgICAgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIlNVUFBMSUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFIikKICAgICAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG51bGwpCiAgICAgICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0U3VwcGxpZXIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJXIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgICAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJXIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAgCiAgICAgICAgfQoKICAgIH0KICAgIGlmKGVycm9ycyAmJiAhd2FybmluZ3MpewogICAgICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAgICAgLy90aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAgCiAgICB9CiAgICBpZihlcnJvcnMgJiYgd2FybmluZ3MpewogICAgICAgIGRlZiBlTGlzdCA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgIGRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKICAgICAgICBpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZVN1cHBsaWVyLnNpemUoKSA+IDApewogICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHlSYXRlID0gbmV3IEFycmF5TGlzdCgpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQogICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKCJTVVBQTElFUl9DT05GSVJNX0VNUFRZX1JBVEVTIikKCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZChudWxsKQogICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlU3VwcGxpZXIpCgogICAgICAgICAgICB3TGlzdC5hZGQod0xpc3RDb25maXJtRW1wdHlSYXRlKQogICAgICAgIH0KCiAgICAgICAgaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdFN1cHBsaWVyLnNpemUoKSA+IDApewogICAgICAgICAgICBkZWYgd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZSA9IG5ldyBBcnJheUxpc3QoKQogICAgICAgICAgICB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZCgiVyIpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJTVVBQTElFUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URSIpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKG51bGwpCiAgICAgICAgICAgIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVNYXRTdXBwbGllcikKCiAgICAgICAgICAgIHdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKQogICAgICAgIH0KCiAgICAgICAgb3V0cHV0LmFkZChlTGlzdCkKICAgICAgICBvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siV0UiOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQogICAgICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiV0UiLCBvdXRwdXQudG9TdHJpbmcoKSkgIAogICAgfQp9</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="10">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="271" name="Quote Reminder">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="9">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">YCFgT1AgRW1haWwgTm90aWZpY2F0aW9uOiBSRU1JTkRFUl9GT1JfU1VQUExJRVJfUVVPVEUgKyBVcGRhdGUgZmllbGQgUkVNSU5ERVJfRk9SX1NVUFBMSUVSX1FVT1RFIHdpdGggbmV3IGR1ZSBkYXRl</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLkN1c3RvbUZpZWxkTWFuYWdlcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5maWVsZHMuQ3VzdG9tRmllbGQ7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmNvbXBvbmVudC5Db21wb25lbnRBY2Nlc3NvcjsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZTsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb2RlYy5iaW5hcnkuQmFzZTY0OwppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQpDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluayAKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5EZWZhdWx0SXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGphdmEuc3FsLlRpbWVzdGFtcAppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQKaW1wb3J0IGphdmEudGV4dC5EYXRlRm9ybWF0CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTW9kaWZpZWRWYWx1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuSXNzdWVDaGFuZ2VIb2xkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS51dGlsLkRlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpJc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCk7CkN1c3RvbUZpZWxkTWFuYWdlciBjdXN0b21GaWVsZE1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKTsKZGVmIHJlcXVlc3RNZXRob2QKZGVmIGJhc2VVUkwKClVSTCB1cmwKSHR0cFVSTENvbm5lY3Rpb24gY29ubmVjdGlvbgpkZWYgbWkgPSAoTXV0YWJsZUlzc3VlKSBpc3N1ZQpkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKCmRlZiByZW1pbmRlckRhdGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yud2ZSZW1pbmRlckZvclNRdW90ZSddLnRvU3RyaW5nKCkpWzBdCgpyZXF1ZXN0TWV0aG9kID0gIlBPU1QiOwpkZWYgYm9keV9yZXEgPSBbXQoKYm9keV9yZXEgPSBbCiAgICAgICAgInRlbXBsYXRlTmFtZSI6IHByb3BlcnRpZXNbJ3R0LnJlbWluZGVyVG9TJ10udG9TdHJpbmcoKSwKICAgICAgICAicGVjIjogZmFsc2UsCiAgICAgICAgImlzc3VlS2V5IjogaXNzdWUua2V5Cl0gCgpiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1snYXBpLmVudiddLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvamlyYS9BQS90cmFuc2FjdGlvbi9tYWlsL3NlbmQiCnVybCA9IG5ldyBVUkwoYmFzZVVSTCkKY29ubmVjdGlvbiA9IChIdHRwVVJMQ29ubmVjdGlvbil1cmwub3BlbkNvbm5lY3Rpb24oKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCIpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQWNjZXB0IiwgIiovKiIpOwpjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwpjb25uZWN0aW9uLnNldERvSW5wdXQodHJ1ZSk7CmNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtCmNvbm5lY3Rpb24ub3V0cHV0U3RyZWFtLndpdGhXcml0ZXIoIlVURi04IikgeyBuZXcgU3RyZWFtaW5nSnNvbkJ1aWxkZXIoaXQsIGJvZHlfcmVxKSB9CmxvZy5kZWJ1ZyBjb25uZWN0aW9uLm91dHB1dFN0cmVhbQpjb25uZWN0aW9uLmNvbm5lY3QoKTsKCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdEVycm9ycyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgIGxvZy5kZWJ1ZyAidXJsOiAiICsgdXJsCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQogICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKICAgIGVMaXN0RXJyb3JzLmFkZCgiRSIpCiAgICBlTGlzdEVycm9ycy5hZGQoIlNFTkRNQUlMIikKICAgIGVycm9yTXNncy5hZGQoY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKSArICIgIiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkpCiAgICBlTGlzdEVycm9ycy5hZGQoZXJyb3JNc2dzKQogICAgZUxpc3QuYWRkKGVMaXN0RXJyb3JzKQoKICAgIG91dHB1dC5hZGQoZUxpc3QpCiAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCJFIiwgb3V0cHV0LnRvU3RyaW5nKCkpCn1lbHNlewoKICAgIGRlZiBkYXRlID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZW1pbmRlckRhdGUpCiAgICBEYXRlIG5ld1REViA9IG5ldyBEYXRlKCkKICAgIAogICAgZGVmIG5ld0RhdGVmb3JtYXQgPSBuZXdURFYuZm9ybWF0KCdNTS9kZC95eXl5JykKICAgIFNpbXBsZURhdGVGb3JtYXQgc2RmID0gbmV3IFNpbXBsZURhdGVGb3JtYXQoIk1NL2RkL3l5eXkiKTsKCWRlZiBjYWwgPSBDYWxlbmRhci5nZXRJbnN0YW5jZSgpCiAgICBjYWwuc2V0VGltZShzZGYucGFyc2UobmV3RGF0ZWZvcm1hdCkpOwogICAgY2FsLmFkZChDYWxlbmRhci5EQVRFLCArMik7IAoKICAgIFRpbWVzdGFtcCBEZWZUREQgPSBuZXcgVGltZXN0YW1wKGNhbC5nZXRUaW1lSW5NaWxsaXMoKSkKIAogICAgbWkuc2V0Q3VzdG9tRmllbGRWYWx1ZShyZW1pbmRlckRhdGUsIERlZlRERCk7CglDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKS51cGRhdGVJc3N1ZShjdXJyZW50VXNlciwgbWksIEV2ZW50RGlzcGF0Y2hPcHRpb24uRE9fTk9UX0RJU1BBVENILCBmYWxzZSk7IAp9</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="10" name="Supplier Quote Received">
      <meta name="jira.status.id">14333</meta>
      <actions>
        <action id="281" name="Invia Offerta al Cliente" view="fieldscreen">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19926</meta>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">87c923e5bb5b4e6303d9b8ce896495c53f9b7957</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluawoKaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuSW52YWxpZElucHV0RXhjZXB0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKIApJc3N1ZSBpc3N1ZSA9IGlzc3VlCi8vUGVyIHRlc3QgZGEgY29uc29sZQovL0lzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKLy9pc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiQUFTLTI3NjEiKQoKZGVmIGVycm9ycyA9IGZhbHNlCmRlZiB3YXJuaW5ncyA9IGZhbHNlCmRlZiByZWxhdGVzSW5Jc3N1ZUxpbms9ZmFsc2UKZGVmIHJlbGF0ZXNPdXRJc3N1ZUxpbms9ZmFsc2UKZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGVMaW5rZWQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZVF1b3RlTGlua2VkID0gbmV3IEFycmF5TGlzdCgpCgovKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgbm9uIGEgY29ycG8qLwpkZWYgcmVwTWF0ZXJpYWxzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5xdW90ZU1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdCmRlZiBsYWJvdXJSYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YucXVvdGVMYWJvdXJSYXRlcyddLnRvU3RyaW5nKCkpWzBdCgovKkNvbmZlcm1hIHV0ZW50ZSBzdSB3YXJuaW5ncyovCmRlZiB0cmFuc2l0aW9uQ2hlY2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmNoZWNrQW5kQ29uZmlybSddLnRvU3RyaW5nKCkpWzBdCmRlZiB0cmFuc2l0aW9uQ2hlY2tWYWx1ZSA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKQoKLypJbnNpZ2h0IFNjaGVtYSBJRHMqLwpkZWYgREJPYmplY3RzID0gcHJvcGVydGllc1snaXNjaGVtYS5kYm8nXS50b1N0cmluZygpICsgIi0iCmRlZiBPUEFBID0gcHJvcGVydGllc1snaXNjaGVtYS5hYSddLnRvU3RyaW5nKCkgKyAiLSIKCi8qQXJyYXkgd2FybmluZ3MgZWQgZXJyb3JzIHBlciBsYSBpc3N1ZSBwcmluY2lwYWxlLCB1bm8gcGVyIG9nbmkgdGlwb2xvZ2lhIGRpIGVycm9yZSBvIHdhcm5pbmcqLwpkZWYgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCmRlZiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCgovKlZlcmlmaWNhIGNhbXBpIHN1IHRpY2tldCBvZ2dldHRvIGRlbGxhIHRyYW5zYXppb25lKi8KLy9PUF9RVU9URV9NQVRFUklBTFMKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgIC8vbG9nLmRlYnVnICJNYXRlcmlhbGk6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgZGVmIHJlcE1hdExpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKCiAgICBmb3IobWF0IGluIHJlcE1hdExpc3QpewogICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgIGRlZiBjb21wb25lbnQ9bWF0LnRvU3RyaW5nKCkKICAgICAgICAvL2RlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKQogICAgICAgIGRlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJytPUEFBKSsxLGNvbXBvbmVudC5sZW5ndGgoKS0xKQogICAgICAgIGRlZiBjb21wb25lbnRPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oY29tcG9uZW50S2V5KQoKICAgICAgICAvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgZGVmIGFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgIGRlZiBhcHBsaWVkVG9WYWx1ZQogICAgICAgIGlmKGFwcGxpZWRUby5zaXplKCkgPiAwKXsKICAgICAgICAgICAgYXBwbGllZFRvID0gYXBwbGllZFRvLnRvU3RyaW5nKCkKICAgICAgICAgICAgYXBwbGllZFRvVmFsdWUgPSBhcHBsaWVkVG8uc3Vic3RyaW5nKGFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxhcHBsaWVkVG8uaW5kZXhPZignKScpKQogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAiYXBwbGllZFRvVmFsdWU6ICIgKyBhcHBsaWVkVG9WYWx1ZQogICAgICAgIH0KICAgICAgICAvL2dldCAiREVMRVRFRCIgZm9yIHRoYXQgcmF0ZQogICAgICAgIGRlZiBkZWxldGVkCiAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZQogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgZGVsZXRlZCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVsZXRlZDogIiArIGRlbGV0ZWQKICAgICAgICAgICAgaWYgKGRlbGV0ZWQpewogICAgICAgICAgICAgICAgZGVsZXRlZFZhbHVlID0gZGVsZXRlZC5zdWJzdHJpbmcoZGVsZXRlZC5pbmRleE9mKCcoJykrMSxkZWxldGVkLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGVmIG1hdE51bWJlcgogICAgICAgIGRlZiBtYXROdW1iZXJLZXkKICAgICAgICBkZWYgbWF0TnVtYmVyVmFsdWUKICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBtYXROdW1iZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgICAgICBpZihtYXROdW1iZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBtYXROdW1iZXIgPSBtYXROdW1iZXIudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbWF0TnVtYmVyS2V5ID0gbWF0TnVtYmVyLnN1YnN0cmluZyhtYXROdW1iZXIuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oREJPYmplY3RzICsgbWF0TnVtYmVyS2V5KQogICAgICAgICAgICAgICAgbWF0TnVtYmVyVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obWF0TnVtYmVyT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoubWF0ZXJpYWwubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG1hdE51bWJlclZhbHVlLnN1YnN0cmluZyhtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcoJykrMSxtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGRlZiBzZXJpYWxOdW1iZXIKICAgICAgICBkZWYgc2VyaWFsTnVtYmVyVmFsdWUKICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnNlcmlhbE51bWJlciddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgc2VyaWFsTnVtYmVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zZXJpYWxOdW1iZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgICAgIGlmKHNlcmlhbE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlciA9IHNlcmlhbE51bWJlci50b1N0cmluZygpCiAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXJWYWx1ZSA9IHNlcmlhbE51bWJlci5zdWJzdHJpbmcoc2VyaWFsTnVtYmVyLmluZGV4T2YoJygnKSsxLHNlcmlhbE51bWJlci5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIH0gIAogICAgICAgIH0JCQkJCgogICAgICAgIGlmKChhcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyIAogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICB0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuYWRkKG1hdE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAoKCFzZXJpYWxOdW1iZXIudG9TdHJpbmcoKS5lcXVhbHMoIm51bGwiKSAmJiAhc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkuZXF1YWxzKCJbXSIpKSA/ICIgKCIgKyBzZXJpYWxOdW1iZXJWYWx1ZS50b1N0cmluZygpICsgIikiIDogIiIpKSAgIAogICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXI6ICIgKyBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gICAgCn0gIAoKLy9PUF9RVU9URV9MQUJPVVJfUkFURVMKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgIGxvZy5kZWJ1ZyAiTGFib3VyIHJhdGVzOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykKICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgogICAgZm9yKGxiIGluIGxhYm91clJhdGVzTGlzdCl7CiAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpCiAgICAgICAgZGVmIGxiUmF0ZUtleSA9IGxiUmF0ZS5zdWJzdHJpbmcobGJSYXRlLmluZGV4T2YoJygnKSsxLGxiUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgZGVmIGxiUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihsYlJhdGVLZXkpCiAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICBkZWYgbGJBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgZGVmIGxiQXBwbGllZFRvVmFsdWUgPSBsYkFwcGxpZWRUby5zdWJzdHJpbmcobGJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsbGJBcHBsaWVkVG8uaW5kZXhPZignKScpKQogICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCByYXRlCiAgICAgICAgZGVmIGRlbGV0ZWQKICAgICAgICBkZWYgZGVsZXRlZFZhbHVlCiAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgbG9nLmRlYnVnICJkZWxldGVkOiAiICsgZGVsZXRlZAogICAgICAgICAgICBpZiAoZGVsZXRlZCl7CiAgICAgICAgICAgICAgICBkZWxldGVkVmFsdWUgPSBkZWxldGVkLnN1YnN0cmluZyhkZWxldGVkLmluZGV4T2YoJygnKSsxLGRlbGV0ZWQuaW5kZXhPZignKScpKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBkZWYgbGJSYXRlUmVmCiAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgbGJSYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgIH0KICAgICAgICBsb2cuZGVidWcgImxiUmF0ZVJlZjogIiArIGxiUmF0ZVJlZgoKICAgICAgICBkZWYgdGVjaFJlZgogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRlY2huaWNpYW5SZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIHRlY2hSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudGVjaG5pY2lhblJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgfQoKICAgICAgICBkZWYgbGJSYXRlUmVmS2V5CiAgICAgICAgZGVmIGxiUmF0ZVJlZlZhbHVlCiAgICAgICAgaWYobGJSYXRlUmVmICYmIGxiUmF0ZVJlZi5zaXplKCkgPiAwKXsKICAgICAgICAgICAgbGJSYXRlUmVmID0gbGJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgbGJSYXRlUmVmS2V5ID0gbGJSYXRlUmVmLnN1YnN0cmluZyhsYlJhdGVSZWYuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgbGJSYXRlUmVmS2V5KQogICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IGxiUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyhsYlJhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSxsYlJhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgfQoKICAgICAgICBkZWYgdGVjaFJlZktleQogICAgICAgIGRlZiB0ZWNoUmVmVmFsdWUKICAgICAgICBpZih0ZWNoUmVmKXsKICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICBsb2cuZGVidWcgInRlY2hSZWY6ICIgKyB0ZWNoUmVmCiAgICAgICAgICAgIHRlY2hSZWZLZXkgPSB0ZWNoUmVmLnN1YnN0cmluZyh0ZWNoUmVmLmluZGV4T2YoJygnKSsxLHRlY2hSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICBkZWYgdGVjaFJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdGVjaFJlZktleSkKICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRlY2hSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai50ZWNobmljaWFuLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICBpZih0ZWNoUmVmVmFsdWUpewogICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gdGVjaFJlZlZhbHVlLnN1YnN0cmluZyh0ZWNoUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdGVjaFJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoKGxiQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCBsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyCiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgdG90Q3VzdG9tZXI9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgICAgICAgICAgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5hZGQobGJSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogIiArIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gICAgCn0KCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghZXJyb3JzICYmICF3YXJuaW5ncyl7CglyZXR1cm4gdHJ1ZQp9ZWxzZXsKCWlmKCFlcnJvcnMgJiYgd2FybmluZ3MpewoJCS8vU2UgY2kgc29ubyBzb2xvIHdhcm5pbmdzIHZlcmlmaWNvIHNlIGwndXRlbnRlIGhhIGdpw6AgZGljaGlhcmF0byBkaSB2b2xlciBwcm9zZWd1aXJlIGNvbXVucXVlCgkJLy8gLSB0cmFuc2l0aW9uIGZpZWxkICJPUEFBX0NIRUNLX0FORF9DT05GSVJNIj0iWWVzIgoJCS8vIC0gaW4gY2FzbyBjb250cmFyaW8gaW52aW8gaSB3YXJuaW5nIGEgRkUKCgkJbG9nLmRlYnVnICJ0cmFuc2l0aW9uQ2hlY2s6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykKCQkvL2xvZy5kZWJ1ZyAicmVzdWx0OiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKQoJCWlmKHRyYW5zaXRpb25DaGVja1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CgkJCWxvZy5kZWJ1ZyAicmV0dXJuIHRydWUgLSB0cmFuc2l0aW9uQ2hlY2sgPSBZZXMiCgkJCXJldHVybiB0cnVlCgkJfWVsc2V7CgkJCWRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKCQkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5zaXplKCkgPiAwKXsKCQkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQoJCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIpCgoJCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5UmF0ZSkKCQkJfQoKCQkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLnNpemUoKSA+IDApewoJCQkJZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URSIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChudWxsKQoJCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyKQoKCQkJCXdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKQoJCQl9CgoJCQlvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IlciOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQoJCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIlciLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKCQl9CgoJfQoJaWYoZXJyb3JzICYmICF3YXJuaW5ncyl7CgkJZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgoJCW91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKCX0KCWlmKGVycm9ycyAmJiB3YXJuaW5ncyl7CgkJZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgkJZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgoJCWlmKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuc2l6ZSgpID4gMCl7CgkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiVyIpCgkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfUkFURVMiKQoJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCgkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcikKCgkJCXdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eVJhdGUpCgkJfQoKCQlpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuc2l6ZSgpID4gMCl7CgkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpCgkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFIikKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQobnVsbCkKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyKQoKCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpCgkJfQoJCQoJCW91dHB1dC5hZGQoZUxpc3QpCgkJb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IldFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIldFIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAKCX0KfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="11">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="291" name="Genera Offerta - PDF" view="fieldscreen">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19926</meta>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">87c923e5bb5b4e6303d9b8ce896495c53f9b7957</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluawoKaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuSW52YWxpZElucHV0RXhjZXB0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKIApJc3N1ZSBpc3N1ZSA9IGlzc3VlCi8vUGVyIHRlc3QgZGEgY29uc29sZQovL0lzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKLy9pc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiQUFTLTI3NjEiKQoKZGVmIGVycm9ycyA9IGZhbHNlCmRlZiB3YXJuaW5ncyA9IGZhbHNlCmRlZiByZWxhdGVzSW5Jc3N1ZUxpbms9ZmFsc2UKZGVmIHJlbGF0ZXNPdXRJc3N1ZUxpbms9ZmFsc2UKZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGVMaW5rZWQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZVF1b3RlTGlua2VkID0gbmV3IEFycmF5TGlzdCgpCgovKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgbm9uIGEgY29ycG8qLwpkZWYgcmVwTWF0ZXJpYWxzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5xdW90ZU1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdCmRlZiBsYWJvdXJSYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YucXVvdGVMYWJvdXJSYXRlcyddLnRvU3RyaW5nKCkpWzBdCgovKkNvbmZlcm1hIHV0ZW50ZSBzdSB3YXJuaW5ncyovCmRlZiB0cmFuc2l0aW9uQ2hlY2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmNoZWNrQW5kQ29uZmlybSddLnRvU3RyaW5nKCkpWzBdCmRlZiB0cmFuc2l0aW9uQ2hlY2tWYWx1ZSA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKQoKLypJbnNpZ2h0IFNjaGVtYSBJRHMqLwpkZWYgREJPYmplY3RzID0gcHJvcGVydGllc1snaXNjaGVtYS5kYm8nXS50b1N0cmluZygpICsgIi0iCmRlZiBPUEFBID0gcHJvcGVydGllc1snaXNjaGVtYS5hYSddLnRvU3RyaW5nKCkgKyAiLSIKCi8qQXJyYXkgd2FybmluZ3MgZWQgZXJyb3JzIHBlciBsYSBpc3N1ZSBwcmluY2lwYWxlLCB1bm8gcGVyIG9nbmkgdGlwb2xvZ2lhIGRpIGVycm9yZSBvIHdhcm5pbmcqLwpkZWYgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCmRlZiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCgovKlZlcmlmaWNhIGNhbXBpIHN1IHRpY2tldCBvZ2dldHRvIGRlbGxhIHRyYW5zYXppb25lKi8KLy9PUF9RVU9URV9NQVRFUklBTFMKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgIC8vbG9nLmRlYnVnICJNYXRlcmlhbGk6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgZGVmIHJlcE1hdExpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKCiAgICBmb3IobWF0IGluIHJlcE1hdExpc3QpewogICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgIGRlZiBjb21wb25lbnQ9bWF0LnRvU3RyaW5nKCkKICAgICAgICAvL2RlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKQogICAgICAgIGRlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJytPUEFBKSsxLGNvbXBvbmVudC5sZW5ndGgoKS0xKQogICAgICAgIGRlZiBjb21wb25lbnRPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oY29tcG9uZW50S2V5KQoKICAgICAgICAvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgZGVmIGFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgIGRlZiBhcHBsaWVkVG9WYWx1ZQogICAgICAgIGlmKGFwcGxpZWRUby5zaXplKCkgPiAwKXsKICAgICAgICAgICAgYXBwbGllZFRvID0gYXBwbGllZFRvLnRvU3RyaW5nKCkKICAgICAgICAgICAgYXBwbGllZFRvVmFsdWUgPSBhcHBsaWVkVG8uc3Vic3RyaW5nKGFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxhcHBsaWVkVG8uaW5kZXhPZignKScpKQogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAiYXBwbGllZFRvVmFsdWU6ICIgKyBhcHBsaWVkVG9WYWx1ZQogICAgICAgIH0KICAgICAgICAvL2dldCAiREVMRVRFRCIgZm9yIHRoYXQgcmF0ZQogICAgICAgIGRlZiBkZWxldGVkCiAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZQogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgZGVsZXRlZCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVsZXRlZDogIiArIGRlbGV0ZWQKICAgICAgICAgICAgaWYgKGRlbGV0ZWQpewogICAgICAgICAgICAgICAgZGVsZXRlZFZhbHVlID0gZGVsZXRlZC5zdWJzdHJpbmcoZGVsZXRlZC5pbmRleE9mKCcoJykrMSxkZWxldGVkLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGVmIG1hdE51bWJlcgogICAgICAgIGRlZiBtYXROdW1iZXJLZXkKICAgICAgICBkZWYgbWF0TnVtYmVyVmFsdWUKICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBtYXROdW1iZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgICAgICBpZihtYXROdW1iZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBtYXROdW1iZXIgPSBtYXROdW1iZXIudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbWF0TnVtYmVyS2V5ID0gbWF0TnVtYmVyLnN1YnN0cmluZyhtYXROdW1iZXIuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oREJPYmplY3RzICsgbWF0TnVtYmVyS2V5KQogICAgICAgICAgICAgICAgbWF0TnVtYmVyVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obWF0TnVtYmVyT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoubWF0ZXJpYWwubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG1hdE51bWJlclZhbHVlLnN1YnN0cmluZyhtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcoJykrMSxtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGRlZiBzZXJpYWxOdW1iZXIKICAgICAgICBkZWYgc2VyaWFsTnVtYmVyVmFsdWUKICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnNlcmlhbE51bWJlciddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgc2VyaWFsTnVtYmVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zZXJpYWxOdW1iZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgICAgIGlmKHNlcmlhbE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlciA9IHNlcmlhbE51bWJlci50b1N0cmluZygpCiAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXJWYWx1ZSA9IHNlcmlhbE51bWJlci5zdWJzdHJpbmcoc2VyaWFsTnVtYmVyLmluZGV4T2YoJygnKSsxLHNlcmlhbE51bWJlci5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIH0gIAogICAgICAgIH0JCQkJCgogICAgICAgIGlmKChhcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyIAogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICB0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuYWRkKG1hdE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAoKCFzZXJpYWxOdW1iZXIudG9TdHJpbmcoKS5lcXVhbHMoIm51bGwiKSAmJiAhc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkuZXF1YWxzKCJbXSIpKSA/ICIgKCIgKyBzZXJpYWxOdW1iZXJWYWx1ZS50b1N0cmluZygpICsgIikiIDogIiIpKSAgIAogICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXI6ICIgKyBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gICAgCn0gIAoKLy9PUF9RVU9URV9MQUJPVVJfUkFURVMKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgIGxvZy5kZWJ1ZyAiTGFib3VyIHJhdGVzOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykKICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgogICAgZm9yKGxiIGluIGxhYm91clJhdGVzTGlzdCl7CiAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpCiAgICAgICAgZGVmIGxiUmF0ZUtleSA9IGxiUmF0ZS5zdWJzdHJpbmcobGJSYXRlLmluZGV4T2YoJygnKSsxLGxiUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgZGVmIGxiUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihsYlJhdGVLZXkpCiAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICBkZWYgbGJBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgZGVmIGxiQXBwbGllZFRvVmFsdWUgPSBsYkFwcGxpZWRUby5zdWJzdHJpbmcobGJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsbGJBcHBsaWVkVG8uaW5kZXhPZignKScpKQogICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCByYXRlCiAgICAgICAgZGVmIGRlbGV0ZWQKICAgICAgICBkZWYgZGVsZXRlZFZhbHVlCiAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgbG9nLmRlYnVnICJkZWxldGVkOiAiICsgZGVsZXRlZAogICAgICAgICAgICBpZiAoZGVsZXRlZCl7CiAgICAgICAgICAgICAgICBkZWxldGVkVmFsdWUgPSBkZWxldGVkLnN1YnN0cmluZyhkZWxldGVkLmluZGV4T2YoJygnKSsxLGRlbGV0ZWQuaW5kZXhPZignKScpKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBkZWYgbGJSYXRlUmVmCiAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgbGJSYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgIH0KICAgICAgICBsb2cuZGVidWcgImxiUmF0ZVJlZjogIiArIGxiUmF0ZVJlZgoKICAgICAgICBkZWYgdGVjaFJlZgogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRlY2huaWNpYW5SZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIHRlY2hSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudGVjaG5pY2lhblJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgfQoKICAgICAgICBkZWYgbGJSYXRlUmVmS2V5CiAgICAgICAgZGVmIGxiUmF0ZVJlZlZhbHVlCiAgICAgICAgaWYobGJSYXRlUmVmICYmIGxiUmF0ZVJlZi5zaXplKCkgPiAwKXsKICAgICAgICAgICAgbGJSYXRlUmVmID0gbGJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgbGJSYXRlUmVmS2V5ID0gbGJSYXRlUmVmLnN1YnN0cmluZyhsYlJhdGVSZWYuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgbGJSYXRlUmVmS2V5KQogICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IGxiUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyhsYlJhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSxsYlJhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgfQoKICAgICAgICBkZWYgdGVjaFJlZktleQogICAgICAgIGRlZiB0ZWNoUmVmVmFsdWUKICAgICAgICBpZih0ZWNoUmVmKXsKICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICBsb2cuZGVidWcgInRlY2hSZWY6ICIgKyB0ZWNoUmVmCiAgICAgICAgICAgIHRlY2hSZWZLZXkgPSB0ZWNoUmVmLnN1YnN0cmluZyh0ZWNoUmVmLmluZGV4T2YoJygnKSsxLHRlY2hSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICBkZWYgdGVjaFJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdGVjaFJlZktleSkKICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRlY2hSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai50ZWNobmljaWFuLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICBpZih0ZWNoUmVmVmFsdWUpewogICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gdGVjaFJlZlZhbHVlLnN1YnN0cmluZyh0ZWNoUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdGVjaFJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoKGxiQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCBsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyCiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgdG90Q3VzdG9tZXI9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgICAgICAgICAgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5hZGQobGJSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogIiArIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gICAgCn0KCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghZXJyb3JzICYmICF3YXJuaW5ncyl7CglyZXR1cm4gdHJ1ZQp9ZWxzZXsKCWlmKCFlcnJvcnMgJiYgd2FybmluZ3MpewoJCS8vU2UgY2kgc29ubyBzb2xvIHdhcm5pbmdzIHZlcmlmaWNvIHNlIGwndXRlbnRlIGhhIGdpw6AgZGljaGlhcmF0byBkaSB2b2xlciBwcm9zZWd1aXJlIGNvbXVucXVlCgkJLy8gLSB0cmFuc2l0aW9uIGZpZWxkICJPUEFBX0NIRUNLX0FORF9DT05GSVJNIj0iWWVzIgoJCS8vIC0gaW4gY2FzbyBjb250cmFyaW8gaW52aW8gaSB3YXJuaW5nIGEgRkUKCgkJbG9nLmRlYnVnICJ0cmFuc2l0aW9uQ2hlY2s6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykKCQkvL2xvZy5kZWJ1ZyAicmVzdWx0OiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKQoJCWlmKHRyYW5zaXRpb25DaGVja1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CgkJCWxvZy5kZWJ1ZyAicmV0dXJuIHRydWUgLSB0cmFuc2l0aW9uQ2hlY2sgPSBZZXMiCgkJCXJldHVybiB0cnVlCgkJfWVsc2V7CgkJCWRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKCQkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5zaXplKCkgPiAwKXsKCQkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQoJCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIpCgoJCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5UmF0ZSkKCQkJfQoKCQkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLnNpemUoKSA+IDApewoJCQkJZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URSIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChudWxsKQoJCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyKQoKCQkJCXdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKQoJCQl9CgoJCQlvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IlciOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQoJCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIlciLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKCQl9CgoJfQoJaWYoZXJyb3JzICYmICF3YXJuaW5ncyl7CgkJZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgoJCW91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKCX0KCWlmKGVycm9ycyAmJiB3YXJuaW5ncyl7CgkJZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgkJZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgoJCWlmKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuc2l6ZSgpID4gMCl7CgkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiVyIpCgkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfUkFURVMiKQoJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCgkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcikKCgkJCXdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eVJhdGUpCgkJfQoKCQlpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuc2l6ZSgpID4gMCl7CgkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpCgkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFIikKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQobnVsbCkKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyKQoKCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpCgkJfQoJCQoJCW91dHB1dC5hZGQoZUxpc3QpCgkJb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IldFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIldFIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAKCX0KfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">f0e886b6a38b4c375023c581670d7765927ee07a</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IFJFU1QgQVBJOiBnZW5lcmF0ZSBPZmZlciBhdHRhY2htZW50</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCgpkZWYgY3VzdG9tZXIgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmN1c3RvbWVyJ10udG9TdHJpbmcoKSlbMF0KZGVmIHRlbXBsYXRlSWQKaW50IERCTyA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuZGJvLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQoKLyogSW5kaXZpZHVhemlvbmUgVGVtcGxhdGUgb2ZmZXJ0YSBkYSBhcHBsaWNhcmUgKi8KLyogQ2FzbyAxKSBlc2lzdGUgdW5vIHNwZWNpZmljbyB0ZW1wbGF0ZSBwZXIgaWwgY2xpZW50ZSBzZWxlemlvbmF0byAtLT4gdXNvIHF1ZXN0byAqLwovKiBlbHNlIC0tPiB1c28gaWwgdGVtcGxhdGUgZGkgZGVmYXVsdDogQXR0YWNobWVudENhdGVnb3J5ID0gIk9mZmVydGEgQ2xpZW50ZSIgQU5EIENVU1RPTUVSX1JFRiBJUyBFTVBUWSBBTkQgREVGQVVMVD10cnVlCi8qUmltb3ppb25lIGFsbGVnYXRvIHJhcHBvcnRvIGRpIGludGVydmVudG8gYXBwZW5hIGNyZWF0byovCi8qIEdldCBJbnNpZ2h0IElRTCBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3MgaXFsRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5JUUxGYWNhZGUiKTsgCmRlZiBpcWxGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUoaXFsRmFjYWRlQ2xhc3MpOwoKLyogR2V0IEluc2lnaHQgT2JqZWN0IEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOwpkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCi8qIEdldCBJbnNpZ2h0IE9iamVjdCBUeXBlIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RUeXBlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlRmFjYWRlIik7CmRlZiBvYmplY3RUeXBlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVGYWNhZGVDbGFzcyk7CgovKiBHZXQgSW5zaWdodCBPYmplY3QgQXR0cmlidXRlIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CmRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CgpDbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5zZXJ2aWNlcy5tb2RlbC5mYWN0b3J5Lk9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Iik7CmRlZiBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzKTsKCmRlZiBjdXN0b21lclZhbHVlID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShjdXN0b21lcilbMF0udG9TdHJpbmcoKQpkZWYgY3VzdG9tZXJLZXkgPSBjdXN0b21lclZhbHVlLnN1YnN0cmluZyhjdXN0b21lclZhbHVlLmluZGV4T2YoJygnKSsxLGN1c3RvbWVyVmFsdWUuaW5kZXhPZignKScpKQoKZGVmIERPY3VzdG9tZXJPYmplY3RSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShjdXN0b21lcilbMF0uZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jdXN0b21lci5jdXN0b21lclJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsKbG9nLmRlYnVnICJET2N1c3RvbWVyT2JqZWN0UmVmOiAiICsgRE9jdXN0b21lck9iamVjdFJlZgoKZGVmIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKERPY3VzdG9tZXJPYmplY3RSZWZbMF0uZ2V0VmFsdWUoKSwgcHJvcGVydGllc1snaW9iai5jb250YWN0LmRiby5uYW1lJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpICAKZGVmIGN1c3RvbWVyTmFtZSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoKLyogU3BlY2lmeSB0aGUgc2NoZW1hIGlkIGFzIHdlbGwgYXMgdGhlIElRTCB0aGF0IHdpbGwgZmV0Y2ggb2JqZWN0cy4gSW4gdGhpcyBjYXNlIGFsbCBvYmplY3RzIHdpdGggTmFtZSBtYXRjaGluZyB0aGUgdmFsdWVDRiwgYmUgc3VyZSB0byBpbmNsdWRlICIgYXJvdW5kIHZhbHVlICovCmRlZiBvYmplY3RzID0gaXFsRmFjYWRlLmZpbmRPYmplY3RzQnlJUUxBbmRTY2hlbWEoREJPLCAiXCIiICsgKHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmF0dGFjaG1lbnRDYXRlZ29yeSddID8gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuYXR0YWNobWVudENhdGVnb3J5J10udG9TdHJpbmcoKSA6ICJBVFRBQ0hNRU5UX0NBVEVHT1JZIikgKyAiXCIuXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkubmFtZSddLnRvU3RyaW5nKCkgKyAiXCIgPSBcIiIgKyAocHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5vZmZDbGllbnRlJ10gPyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5vYmpzLm9mZkNsaWVudGUnXS50b1N0cmluZygpIDogIk9mZmVydGEgQ2xpZW50ZSIpICsgIlwiIEFORCAiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuZGVsZXRlZCddLnRvU3RyaW5nKCkgKyAiIT10cnVlIEFORCBDVVNUT01FUl9SRUYgSVMgTk9UIEVNUFRZIEFORCBDVVNUT01FUl9SRUYuTmFtZSA9IFwiIiArIGN1c3RvbWVyTmFtZVswXS5nZXRWYWx1ZSgpICsgIlwiIik7IC8vIFNlZSB0aGUgY29tcGxldGUgbGlzdCBvZiBwb3NzaWJsZSBJUUwgb24gdGhlIEluc2lnaHQgUXVlcnkgTGFuZ3VhZ2UgZG9jdW1lbnRhdGlvbiBwYWdlCi8qIElmIHRoaXMgaXMgYSBtYW5kYXRvcnkgZmllbGQgeW91IHNob3VsZCBiZSBhYmxlIHRvIGRvIHRoaXM6ICovCmxvZy5pbmZvKCJJbnNpZ2h0IG9iamVjdDogIiArIG9iamVjdHNbMF0pOwpsb2cuZGVidWcgIlwiIiArIChwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5hdHRhY2htZW50Q2F0ZWdvcnknXSA/IHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmF0dGFjaG1lbnRDYXRlZ29yeSddLnRvU3RyaW5nKCkgOiAiQVRUQUNITUVOVF9DQVRFR09SWSIpICsgIlwiLlwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm5hbWUnXS50b1N0cmluZygpICsgIlwiID0gXCIiICsgKHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm9ianMub2ZmQ2xpZW50ZSddID8gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5vZmZDbGllbnRlJ10udG9TdHJpbmcoKSA6ICJPZmZlcnRhIENsaWVudGUiKSArICJcIiBBTkQgIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmRlbGV0ZWQnXS50b1N0cmluZygpICsgIiE9dHJ1ZSBBTkQgQ1VTVE9NRVJfUkVGIElTIE5PVCBFTVBUWSBBTkQgQ1VTVE9NRVJfUkVGLk5hbWUgPSBcIiIgKyBjdXN0b21lck5hbWVbMF0uZ2V0VmFsdWUoKSArICJcIiIKCmlmKCFvYmplY3RzWzBdKXsKICAgIC8qTmVzc3VuIGZpbGUgaW5kaXZpZHVhdG8gcGVyIGlsIGNsaWVudGUgLSBjZXJjbyB0ZW1wbGF0ZSBnZW5lcmljbyAqLwogICAgb2JqZWN0cyA9IGlxbEZhY2FkZS5maW5kT2JqZWN0c0J5SVFMQW5kU2NoZW1hKERCTywgIlwiIiArIChwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5hdHRhY2htZW50Q2F0ZWdvcnknXSA/IHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmF0dGFjaG1lbnRDYXRlZ29yeSddLnRvU3RyaW5nKCkgOiAiQVRUQUNITUVOVF9DQVRFR09SWSIpICsgIlwiLlwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm5hbWUnXS50b1N0cmluZygpICsgIlwiID0gXCIiICsgKHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm9ianMub2ZmQ2xpZW50ZSddID8gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5vZmZDbGllbnRlJ10udG9TdHJpbmcoKSA6ICJPZmZlcnRhIENsaWVudGUiKSArICJcIiBBTkQgIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmRlbGV0ZWQnXS50b1N0cmluZygpICsgIiE9dHJ1ZSBBTkQgQ1VTVE9NRVJfUkVGIElTIEVNUFRZIEFORCBERUZBVUxUPXRydWUiKTsgLy8gU2VlIHRoZSBjb21wbGV0ZSBsaXN0IG9mIHBvc3NpYmxlIElRTCBvbiB0aGUgSW5zaWdodCBRdWVyeSBMYW5ndWFnZSBkb2N1bWVudGF0aW9uIHBhZ2UKICAgIC8qIElmIHRoaXMgaXMgYSBtYW5kYXRvcnkgZmllbGQgeW91IHNob3VsZCBiZSBhYmxlIHRvIGRvIHRoaXM6ICovCiAgICBsb2cuaW5mbygiSW5zaWdodCBvYmplY3Q6ICIgKyBvYmplY3RzWzBdKTsKICAgIGxvZy5kZWJ1ZyAiXCIiICsgKHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmF0dGFjaG1lbnRDYXRlZ29yeSddID8gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuYXR0YWNobWVudENhdGVnb3J5J10udG9TdHJpbmcoKSA6ICJBVFRBQ0hNRU5UX0NBVEVHT1JZIikgKyAiXCIuXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkubmFtZSddLnRvU3RyaW5nKCkgKyAiXCIgPSBcIiIgKyAocHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5vZmZDbGllbnRlJ10gPyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5vYmpzLm9mZkNsaWVudGUnXS50b1N0cmluZygpIDogIk9mZmVydGEgQ2xpZW50ZSIpICsgIlwiIEFORCAiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuZGVsZXRlZCddLnRvU3RyaW5nKCkgKyAiIT10cnVlIEFORCBDVVNUT01FUl9SRUYgSVMgRU1QVFkgQU5EIERFRkFVTFQ9dHJ1ZSIKfQoKaWYob2JqZWN0c1swXSl7CiAgICBsb2cuZGVidWcgInRlbXBsYXRlIGRhIHVzYXJlOiAiICsgb2JqZWN0c1swXS5nZXRJZCgpCiAgICB0ZW1wbGF0ZUlkPW9iamVjdHNbMF0uZ2V0SWQoKQp9CgovKiBSRVNUIEFQSSBwZXIgR2VuZXJhemlvbmUgQWxsZWdhdG8gQ29uc3VudGl2byAqLwpyZXF1ZXN0TWV0aG9kID0gIlBVVCI7CgpiYXNlVVJMID0gImh0dHA6Ly8iICsgcHJvcGVydGllc1snYXBpLmVudiddLnRvU3RyaW5nKCkgKyAiL29wL3Jlc3QvYXV0b21hdGlvbi90aWNrZXQvIiArIGlzc3VlLmtleS50b1N0cmluZygpICsgIi9hdHRhY2htZW50L2dlbmVyaWM/dGVtcGxhdGVJZD0iICsgdGVtcGxhdGVJZCArICImdHlwZT1QREYmYXR0YWNobWVudEN1c3RvbUZpZWxkPSIgKyBwcm9wZXJ0aWVzWydjZi5vZmZlckF0dGFjaG1lbnRSZWYnXS50b1N0cmluZygpCgpsb2cuZGVidWcgImJhc2VVcmw6ICIgKyBiYXNlVVJMCgpVUkwgdXJsCnVybCA9IG5ldyBVUkwoYmFzZVVSTCkKSHR0cFVSTENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IChIdHRwVVJMQ29ubmVjdGlvbil1cmwub3BlbkNvbm5lY3Rpb24oKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0TWV0aG9kKHJlcXVlc3RNZXRob2QpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb24iKTsKY29ubmVjdGlvbi5zZXRSZXF1ZXN0UHJvcGVydHkoIkFjY2VwdCIsICIqLyoiKTsKY29ubmVjdGlvbi5zZXREb091dHB1dCh0cnVlKTsKY29ubmVjdGlvbi5zZXREb0lucHV0KHRydWUpOwpjb25uZWN0aW9uLmNvbm5lY3QoKTsKCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlTGlzdEVycm9ycyA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZXJyb3JNc2dzID0gbmV3IEFycmF5TGlzdCgpCgppZiAoIWNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkudG9TdHJpbmcoKS5lcXVhbHMoIjIwMCIpKXsKICAgIGxvZy5kZWJ1ZyAidXJsOiAiICsgdXJsCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlQ29kZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKQogICAgbG9nLmRlYnVnICJSZXNwb25zZU1lc3NhZ2U6IiArIGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VNZXNzYWdlKCkKICAgIGVMaXN0RXJyb3JzLmFkZCgiRSIpCiAgICBlTGlzdEVycm9ycy5hZGQoIkdFTkVSQVRFLUFDQ09VTlRJTkdSRVBPUlQiKQogICAgZXJyb3JNc2dzLmFkZChjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpICsgIiAiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKSkKICAgIGVMaXN0RXJyb3JzLmFkZChlcnJvck1zZ3MpCiAgICBlTGlzdC5hZGQoZUxpc3RFcnJvcnMpCgogICAgb3V0cHV0LmFkZChlTGlzdCkKICAgIHRocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oJ3siRSI6IicgKyBvdXRwdXQudG9TdHJpbmcoKSArICcifScpCiAgICAvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkKfQo=</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="10">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="301" name="Genera Offerta - Word" view="fieldscreen">
          <meta name="opsbar-sequence">30</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id">19926</meta>
          <validators>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">87c923e5bb5b4e6303d9b8ce896495c53f9b7957</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IENoZWNrIFJlcXVpcmVkIEZpZWxkcw==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuZmllbGRzLkN1c3RvbUZpZWxkCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWVNYW5hZ2VyCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5NdXRhYmxlSXNzdWUKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5saW5rLklzc3VlTGluawoKaW1wb3J0IGNvbS5vcGVuc3ltcGhvbnkud29ya2Zsb3cuSW52YWxpZElucHV0RXhjZXB0aW9uCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuaW5kZXguSXNzdWVJbmRleGluZ1NlcnZpY2UKCmltcG9ydCBvcmcuYXBhY2hlLmxvZzRqLkNhdGVnb3J5CmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZSgiY29tLm9ucmVzb2x2ZS5qaXJhLmdyb292eS5Qb3N0RnVuY3Rpb24iKQpsb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRykKIApJc3N1ZSBpc3N1ZSA9IGlzc3VlCi8vUGVyIHRlc3QgZGEgY29uc29sZQovL0lzc3VlTWFuYWdlciBpc3N1ZU1hbmFnZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRJc3N1ZU1hbmFnZXIoKTsKLy9pc3N1ZSA9IGlzc3VlTWFuYWdlci5nZXRJc3N1ZUJ5S2V5SWdub3JlQ2FzZSgiQUFTLTI3NjEiKQoKZGVmIGVycm9ycyA9IGZhbHNlCmRlZiB3YXJuaW5ncyA9IGZhbHNlCmRlZiByZWxhdGVzSW5Jc3N1ZUxpbms9ZmFsc2UKZGVmIHJlbGF0ZXNPdXRJc3N1ZUxpbms9ZmFsc2UKZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGVMaW5rZWQgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIHdMaXN0Q29uZmlybUVtcHR5UmF0ZVF1b3RlTGlua2VkID0gbmV3IEFycmF5TGlzdCgpCgovKkNhbXBpIGNvbiBkYXRpIG9iYmxpZ2F0b3JpIHBlciB0aWNrZXQgbm9uIGEgY29ycG8qLwpkZWYgcmVwTWF0ZXJpYWxzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5xdW90ZU1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdCmRlZiBsYWJvdXJSYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YucXVvdGVMYWJvdXJSYXRlcyddLnRvU3RyaW5nKCkpWzBdCgovKkNvbmZlcm1hIHV0ZW50ZSBzdSB3YXJuaW5ncyovCmRlZiB0cmFuc2l0aW9uQ2hlY2sgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmNoZWNrQW5kQ29uZmlybSddLnRvU3RyaW5nKCkpWzBdCmRlZiB0cmFuc2l0aW9uQ2hlY2tWYWx1ZSA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUodHJhbnNpdGlvbkNoZWNrKQoKLypJbnNpZ2h0IFNjaGVtYSBJRHMqLwpkZWYgREJPYmplY3RzID0gcHJvcGVydGllc1snaXNjaGVtYS5kYm8nXS50b1N0cmluZygpICsgIi0iCmRlZiBPUEFBID0gcHJvcGVydGllc1snaXNjaGVtYS5hYSddLnRvU3RyaW5nKCkgKyAiLSIKCi8qQXJyYXkgd2FybmluZ3MgZWQgZXJyb3JzIHBlciBsYSBpc3N1ZSBwcmluY2lwYWxlLCB1bm8gcGVyIG9nbmkgdGlwb2xvZ2lhIGRpIGVycm9yZSBvIHdhcm5pbmcqLwpkZWYgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCmRlZiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlUmF0ZUN1c3RvbWVyID0gbmV3IEFycmF5TGlzdCgpCgovKlZlcmlmaWNhIGNhbXBpIHN1IHRpY2tldCBvZ2dldHRvIGRlbGxhIHRyYW5zYXppb25lKi8KLy9PUF9RVU9URV9NQVRFUklBTFMKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpIT1udWxsICYmIChTdHJpbmcpaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpICE9ICIiICYmICFpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgIC8vbG9nLmRlYnVnICJNYXRlcmlhbGk6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgZGVmIHJlcE1hdExpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscykKCiAgICBmb3IobWF0IGluIHJlcE1hdExpc3QpewogICAgICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmcgZ2V0IG9iamVjdAogICAgICAgIGRlZiBjb21wb25lbnQ9bWF0LnRvU3RyaW5nKCkKICAgICAgICAvL2RlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKQogICAgICAgIGRlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJytPUEFBKSsxLGNvbXBvbmVudC5sZW5ndGgoKS0xKQogICAgICAgIGRlZiBjb21wb25lbnRPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oY29tcG9uZW50S2V5KQoKICAgICAgICAvL2dldCAiQVBQTElFRF9UTyIgZm9yIHRoYXQgY29tcG9uZW50CiAgICAgICAgZGVmIGFwcGxpZWRUbyA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYXBwbGllZFRvJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgIGRlZiBhcHBsaWVkVG9WYWx1ZQogICAgICAgIGlmKGFwcGxpZWRUby5zaXplKCkgPiAwKXsKICAgICAgICAgICAgYXBwbGllZFRvID0gYXBwbGllZFRvLnRvU3RyaW5nKCkKICAgICAgICAgICAgYXBwbGllZFRvVmFsdWUgPSBhcHBsaWVkVG8uc3Vic3RyaW5nKGFwcGxpZWRUby5pbmRleE9mKCcoJykrMSxhcHBsaWVkVG8uaW5kZXhPZignKScpKQogICAgICAgICAgICAvL2xvZy5kZWJ1ZyAiYXBwbGllZFRvVmFsdWU6ICIgKyBhcHBsaWVkVG9WYWx1ZQogICAgICAgIH0KICAgICAgICAvL2dldCAiREVMRVRFRCIgZm9yIHRoYXQgcmF0ZQogICAgICAgIGRlZiBkZWxldGVkCiAgICAgICAgZGVmIGRlbGV0ZWRWYWx1ZQogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgZGVsZXRlZCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgIGxvZy5kZWJ1ZyAiZGVsZXRlZDogIiArIGRlbGV0ZWQKICAgICAgICAgICAgaWYgKGRlbGV0ZWQpewogICAgICAgICAgICAgICAgZGVsZXRlZFZhbHVlID0gZGVsZXRlZC5zdWJzdHJpbmcoZGVsZXRlZC5pbmRleE9mKCcoJykrMSxkZWxldGVkLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGVmIG1hdE51bWJlcgogICAgICAgIGRlZiBtYXROdW1iZXJLZXkKICAgICAgICBkZWYgbWF0TnVtYmVyVmFsdWUKICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBtYXROdW1iZXIgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm1hdGVyaWFsUmVmJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpIGFzIEFycmF5TGlzdAogICAgICAgICAgICBpZihtYXROdW1iZXIuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBtYXROdW1iZXIgPSBtYXROdW1iZXIudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgbWF0TnVtYmVyS2V5ID0gbWF0TnVtYmVyLnN1YnN0cmluZyhtYXROdW1iZXIuaW5kZXhPZignKCcpKzEsbWF0TnVtYmVyLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgICAgIGRlZiBtYXROdW1iZXJPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oREJPYmplY3RzICsgbWF0TnVtYmVyS2V5KQogICAgICAgICAgICAgICAgbWF0TnVtYmVyVmFsdWUgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obWF0TnVtYmVyT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoubWF0ZXJpYWwubmFtZSddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgICAgICAgICBtYXROdW1iZXJWYWx1ZSA9IG1hdE51bWJlclZhbHVlLnN1YnN0cmluZyhtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcoJykrMSxtYXROdW1iZXJWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGRlZiBzZXJpYWxOdW1iZXIKICAgICAgICBkZWYgc2VyaWFsTnVtYmVyVmFsdWUKICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnNlcmlhbE51bWJlciddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgc2VyaWFsTnVtYmVyID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zZXJpYWxOdW1iZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkgYXMgQXJyYXlMaXN0CiAgICAgICAgICAgIGlmKHNlcmlhbE51bWJlci5zaXplKCkgPiAwKXsKICAgICAgICAgICAgICAgIHNlcmlhbE51bWJlciA9IHNlcmlhbE51bWJlci50b1N0cmluZygpCiAgICAgICAgICAgICAgICBzZXJpYWxOdW1iZXJWYWx1ZSA9IHNlcmlhbE51bWJlci5zdWJzdHJpbmcoc2VyaWFsTnVtYmVyLmluZGV4T2YoJygnKSsxLHNlcmlhbE51bWJlci5pbmRleE9mKCcpJykpCiAgICAgICAgICAgIH0gIAogICAgICAgIH0JCQkJCgogICAgICAgIGlmKChhcHBsaWVkVG9WYWx1ZS50b1N0cmluZygpLmVxdWFscygiQk9USCIpIHx8IGFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyIAogICAgICAgICAgICBpZihvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgICAgICB0b3RDdXN0b21lciA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCF0b3RDdXN0b21lciB8fCB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkuZXF1YWxzKCIwLjAiKSl7CiAgICAgICAgICAgICAgICB3YXJuaW5ncz10cnVlCiAgICAgICAgICAgICAgICBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuYWRkKG1hdE51bWJlclZhbHVlLnRvU3RyaW5nKCkgKyAoKCFzZXJpYWxOdW1iZXIudG9TdHJpbmcoKS5lcXVhbHMoIm51bGwiKSAmJiAhc2VyaWFsTnVtYmVyLnRvU3RyaW5nKCkuZXF1YWxzKCJbXSIpKSA/ICIgKCIgKyBzZXJpYWxOdW1iZXJWYWx1ZS50b1N0cmluZygpICsgIikiIDogIiIpKSAgIAogICAgICAgICAgICAgICAgbG9nLmRlYnVnIGlzc3VlLmtleS50b1N0cmluZygpICsgIiBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXI6ICIgKyBpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gICAgCn0gIAoKLy9PUF9RVU9URV9MQUJPVVJfUkFURVMKaWYoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykhPW51bGwgJiYgKFN0cmluZylpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKSAhPSAiIiAmJiAhaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykudG9TdHJpbmcoKS5lcXVhbHMoIiIpKXsKICAgIGxvZy5kZWJ1ZyAiTGFib3VyIHJhdGVzOiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShsYWJvdXJSYXRlcykKICAgIC8qQ2ljbGFyZSB0dXR0aSBnbGkgb2dnZXR0aSBhc3NvY2lhdGkgYWwgY2FtcG8qLwogICAgLy9pbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzCiAgICBDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCiAgICBDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CiAgICBkZWYgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwogICAgZGVmIG9iamVjdEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RGYWNhZGVDbGFzcyk7CgogICAgZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpCgogICAgZm9yKGxiIGluIGxhYm91clJhdGVzTGlzdCl7CiAgICAgICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZyBnZXQgb2JqZWN0CiAgICAgICAgZGVmIGxiUmF0ZT1sYi50b1N0cmluZygpCiAgICAgICAgZGVmIGxiUmF0ZUtleSA9IGxiUmF0ZS5zdWJzdHJpbmcobGJSYXRlLmluZGV4T2YoJygnKSsxLGxiUmF0ZS5pbmRleE9mKCcpJykpCiAgICAgICAgZGVmIGxiUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihsYlJhdGVLZXkpCiAgICAgICAgLy9nZXQgIkFQUExJRURfVE8iIGZvciB0aGF0IHJhdGUKICAgICAgICBkZWYgbGJBcHBsaWVkVG8gPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgZGVmIGxiQXBwbGllZFRvVmFsdWUgPSBsYkFwcGxpZWRUby5zdWJzdHJpbmcobGJBcHBsaWVkVG8uaW5kZXhPZignKCcpKzEsbGJBcHBsaWVkVG8uaW5kZXhPZignKScpKQogICAgICAgIC8vZ2V0ICJERUxFVEVEIiBmb3IgdGhhdCByYXRlCiAgICAgICAgZGVmIGRlbGV0ZWQKICAgICAgICBkZWYgZGVsZXRlZFZhbHVlCiAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICBkZWxldGVkID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpLnRvU3RyaW5nKCkKICAgICAgICAgICAgbG9nLmRlYnVnICJkZWxldGVkOiAiICsgZGVsZXRlZAogICAgICAgICAgICBpZiAoZGVsZXRlZCl7CiAgICAgICAgICAgICAgICBkZWxldGVkVmFsdWUgPSBkZWxldGVkLnN1YnN0cmluZyhkZWxldGVkLmluZGV4T2YoJygnKSsxLGRlbGV0ZWQuaW5kZXhPZignKScpKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBkZWYgbGJSYXRlUmVmCiAgICAgICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQucmF0ZVJlZiddLnRvU3RyaW5nKCkpKXsKICAgICAgICAgICAgbGJSYXRlUmVmPW9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgIH0KICAgICAgICBsb2cuZGVidWcgImxiUmF0ZVJlZjogIiArIGxiUmF0ZVJlZgoKICAgICAgICBkZWYgdGVjaFJlZgogICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRlY2huaWNpYW5SZWYnXS50b1N0cmluZygpKSl7CiAgICAgICAgICAgIHRlY2hSZWY9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudGVjaG5pY2lhblJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKS50b1N0cmluZygpCiAgICAgICAgfQoKICAgICAgICBkZWYgbGJSYXRlUmVmS2V5CiAgICAgICAgZGVmIGxiUmF0ZVJlZlZhbHVlCiAgICAgICAgaWYobGJSYXRlUmVmICYmIGxiUmF0ZVJlZi5zaXplKCkgPiAwKXsKICAgICAgICAgICAgbGJSYXRlUmVmID0gbGJSYXRlUmVmLnRvU3RyaW5nKCkKICAgICAgICAgICAgbGJSYXRlUmVmS2V5ID0gbGJSYXRlUmVmLnN1YnN0cmluZyhsYlJhdGVSZWYuaW5kZXhPZignKCcpKzEsbGJSYXRlUmVmLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgZGVmIGxiUmF0ZVJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgbGJSYXRlUmVmS2V5KQogICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5yYXRlLk5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICBsYlJhdGVSZWZWYWx1ZSA9IGxiUmF0ZVJlZlZhbHVlLnN1YnN0cmluZyhsYlJhdGVSZWZWYWx1ZS5pbmRleE9mKCcoJykrMSxsYlJhdGVSZWZWYWx1ZS5pbmRleE9mKCcpJykpCiAgICAgICAgfQoKICAgICAgICBkZWYgdGVjaFJlZktleQogICAgICAgIGRlZiB0ZWNoUmVmVmFsdWUKICAgICAgICBpZih0ZWNoUmVmKXsKICAgICAgICAgICAgdGVjaFJlZiA9IHRlY2hSZWYudG9TdHJpbmcoKQogICAgICAgICAgICBsb2cuZGVidWcgInRlY2hSZWY6ICIgKyB0ZWNoUmVmCiAgICAgICAgICAgIHRlY2hSZWZLZXkgPSB0ZWNoUmVmLnN1YnN0cmluZyh0ZWNoUmVmLmluZGV4T2YoJygnKSsxLHRlY2hSZWYuaW5kZXhPZignKScpKQogICAgICAgICAgICBkZWYgdGVjaFJlZk9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihPUEFBICsgdGVjaFJlZktleSkKICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKHRlY2hSZWZPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai50ZWNobmljaWFuLm5hbWUnXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkudG9TdHJpbmcoKQogICAgICAgICAgICBpZih0ZWNoUmVmVmFsdWUpewogICAgICAgICAgICAgICAgdGVjaFJlZlZhbHVlID0gdGVjaFJlZlZhbHVlLnN1YnN0cmluZyh0ZWNoUmVmVmFsdWUuaW5kZXhPZignKCcpKzEsdGVjaFJlZlZhbHVlLmluZGV4T2YoJyknKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoKGxiQXBwbGllZFRvVmFsdWUudG9TdHJpbmcoKS5lcXVhbHMoIkJPVEgiKSB8fCBsYkFwcGxpZWRUb1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJDVVNUT01FUiIpKSAmJiAhZGVsZXRlZFZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJ0cnVlIikpewogICAgICAgICAgICAvL2dldCAiVE9UQUxfQU1PVU5UX0NVU1RPTUVSIiBmb3IgdGhhdCBjb21wb25lbnQKICAgICAgICAgICAgZGVmIHRvdEN1c3RvbWVyCiAgICAgICAgICAgIGlmKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3RvbWVyJ10udG9TdHJpbmcoKSkpewogICAgICAgICAgICAgICAgdG90Q3VzdG9tZXI9b2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXInXS50b1N0cmluZygpKS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZighdG90Q3VzdG9tZXIgfHwgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b1N0cmluZygpLmVxdWFscygiMC4wIikpewogICAgICAgICAgICAgICAgd2FybmluZ3M9dHJ1ZQogICAgICAgICAgICAgICAgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5hZGQobGJSYXRlUmVmVmFsdWUudG9TdHJpbmcoKSkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIgaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcjogIiArIGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gICAgCn0KCmRlZiBvdXRwdXQgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghZXJyb3JzICYmICF3YXJuaW5ncyl7CglyZXR1cm4gdHJ1ZQp9ZWxzZXsKCWlmKCFlcnJvcnMgJiYgd2FybmluZ3MpewoJCS8vU2UgY2kgc29ubyBzb2xvIHdhcm5pbmdzIHZlcmlmaWNvIHNlIGwndXRlbnRlIGhhIGdpw6AgZGljaGlhcmF0byBkaSB2b2xlciBwcm9zZWd1aXJlIGNvbXVucXVlCgkJLy8gLSB0cmFuc2l0aW9uIGZpZWxkICJPUEFBX0NIRUNLX0FORF9DT05GSVJNIj0iWWVzIgoJCS8vIC0gaW4gY2FzbyBjb250cmFyaW8gaW52aW8gaSB3YXJuaW5nIGEgRkUKCgkJbG9nLmRlYnVnICJ0cmFuc2l0aW9uQ2hlY2s6ICIgKyBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKHRyYW5zaXRpb25DaGVjaykKCQkvL2xvZy5kZWJ1ZyAicmVzdWx0OiAiICsgaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZSh0cmFuc2l0aW9uQ2hlY2spLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKQoJCWlmKHRyYW5zaXRpb25DaGVja1ZhbHVlLnRvU3RyaW5nKCkuZXF1YWxzKCJZZXMiKSl7CgkJCWxvZy5kZWJ1ZyAicmV0dXJuIHRydWUgLSB0cmFuc2l0aW9uQ2hlY2sgPSBZZXMiCgkJCXJldHVybiB0cnVlCgkJfWVsc2V7CgkJCWRlZiB3TGlzdCA9IG5ldyBBcnJheUxpc3QoKQoKCQkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lci5zaXplKCkgPiAwKXsKCQkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIlciKQoJCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiQ1VTVE9NRVJfQ09ORklSTV9FTVBUWV9SQVRFUyIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCgkJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIpCgoJCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5UmF0ZSkKCQkJfQoKCQkJaWYoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyLnNpemUoKSA+IDApewoJCQkJZGVmIHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKCQkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJDVVNUT01FUl9DT05GSVJNX0VNUFRZX01BVF9RVU9URSIpCgkJCQl3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlLmFkZChudWxsKQoJCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyKQoKCQkJCXdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlKQoJCQl9CgoJCQlvdXRwdXQuYWRkKHdMaXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IlciOiInICsgb3V0cHV0LnRvU3RyaW5nKCkgKyAnIn0nKQoJCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIlciLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKCQl9CgoJfQoJaWYoZXJyb3JzICYmICF3YXJuaW5ncyl7CgkJZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgoJCW91dHB1dC5hZGQoZUxpc3QpCiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIkUiLCBvdXRwdXQudG9TdHJpbmcoKSkgICAKCX0KCWlmKGVycm9ycyAmJiB3YXJuaW5ncyl7CgkJZGVmIGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgkJZGVmIHdMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgoJCWlmKGlzc3VlV2FybmluZ0VtcHR5UXVvdGVSYXRlQ3VzdG9tZXIuc2l6ZSgpID4gMCl7CgkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eVJhdGUgPSBuZXcgQXJyYXlMaXN0KCkKCQkJd0xpc3RDb25maXJtRW1wdHlSYXRlLmFkZCgiVyIpCgkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfUkFURVMiKQoJCQl3TGlzdENvbmZpcm1FbXB0eVJhdGUuYWRkKG51bGwpCgkJCXdMaXN0Q29uZmlybUVtcHR5UmF0ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZVJhdGVDdXN0b21lcikKCgkJCXdMaXN0LmFkZCh3TGlzdENvbmZpcm1FbXB0eVJhdGUpCgkJfQoKCQlpZihpc3N1ZVdhcm5pbmdFbXB0eVF1b3RlTWF0Q3VzdG9tZXIuc2l6ZSgpID4gMCl7CgkJCWRlZiB3TGlzdENvbmZpcm1FbXB0eU1hdFF1b3RlID0gbmV3IEFycmF5TGlzdCgpCgkJCXdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUuYWRkKCJXIikKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoIkNVU1RPTUVSX0NPTkZJUk1fRU1QVFlfTUFUX1FVT1RFIikKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQobnVsbCkKCQkJd0xpc3RDb25maXJtRW1wdHlNYXRRdW90ZS5hZGQoaXNzdWVXYXJuaW5nRW1wdHlRdW90ZU1hdEN1c3RvbWVyKQoKCQkJd0xpc3QuYWRkKHdMaXN0Q29uZmlybUVtcHR5TWF0UXVvdGUpCgkJfQoJCQoJCW91dHB1dC5hZGQoZUxpc3QpCgkJb3V0cHV0LmFkZCh3TGlzdCkKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZElucHV0RXhjZXB0aW9uKCd7IldFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKCQkvL3Rocm93IG5ldyBJbnZhbGlkSW5wdXRFeGNlcHRpb24oIldFIiwgb3V0cHV0LnRvU3RyaW5nKCkpICAKCX0KfQ==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
            <validator name="" type="class">
              <arg name="FIELD_FUNCTION_ID">0ed547676d78f1b77b55fb654d1a258e09977399</arg>
              <arg name="FIELD_NOTES">YCFgT1A6IFJFU1QgQVBJOiBnZW5lcmF0ZSBPZmZlciBhdHRhY2htZW50IC0gV29yZA==</arg>
              <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyOwppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuQ3VzdG9tRmllbGRNYW5hZ2VyOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmZpZWxkcy5DdXN0b21GaWVsZDsKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXI7CmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlOwppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5CYXNlNjQ7CmltcG9ydCBjb20ub3BlbnN5bXBob255LndvcmtmbG93LkludmFsaWRJbnB1dEV4Y2VwdGlvbgppbXBvcnQgb3JnLmFwYWNoZS5sb2c0ai5DYXRlZ29yeQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLmxpbmsuSXNzdWVMaW5rCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyCmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVySW1wbAoKUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKQpGaWxlIHByb3BlcnRpZXNGaWxlID0gbmV3IEZpbGUoU2NyaXB0UnVubmVySW1wbC5nZXRQbHVnaW5Db21wb25lbnQoU2NyaXB0UnVubmVyKS5nZXRSb290c0ZvckRpc3BsYXkoKSArICcvb3Bwcm9qZWN0LnByb3BlcnRpZXMnKQpwcm9wZXJ0aWVzRmlsZS53aXRoSW5wdXRTdHJlYW0gewoJcHJvcGVydGllcy5sb2FkKGl0KQp9CkNhdGVnb3J5IGxvZyA9IENhdGVnb3J5LmdldEluc3RhbmNlKCJjb20ub25yZXNvbHZlLmppcmEuZ3Jvb3Z5LlBvc3RGdW5jdGlvbiIpCmxvZy5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkRFQlVHKQoKSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpOwovL0lzc3VlIGlzc3VlID0gaXNzdWVNYW5hZ2VyLmdldElzc3VlQnlLZXlJZ25vcmVDYXNlKCJBQVMtMjc2MiIpCgpDdXN0b21GaWVsZE1hbmFnZXIgY3VzdG9tRmllbGRNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCk7CmRlZiByZXF1ZXN0TWV0aG9kCmRlZiBiYXNlVVJMCgpkZWYgY3VzdG9tZXIgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmN1c3RvbWVyJ10udG9TdHJpbmcoKSlbMF0KZGVmIHRlbXBsYXRlSWQKaW50IERCTyA9IHByb3BlcnRpZXNbJ2lzY2hlbWEuZGJvLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQoKLyogSW5kaXZpZHVhemlvbmUgVGVtcGxhdGUgb2ZmZXJ0YSBkYSBhcHBsaWNhcmUgKi8KLyogQ2FzbyAxKSBlc2lzdGUgdW5vIHNwZWNpZmljbyB0ZW1wbGF0ZSBwZXIgaWwgY2xpZW50ZSBzZWxlemlvbmF0byAtLT4gdXNvIHF1ZXN0byAqLwovKiBlbHNlIC0tPiB1c28gaWwgdGVtcGxhdGUgZGkgZGVmYXVsdDogQXR0YWNobWVudENhdGVnb3J5ID0gIk9mZmVydGEgQ2xpZW50ZSIgQU5EIENVU1RPTUVSX1JFRiBJUyBFTVBUWSBBTkQgREVGQVVMVD10cnVlCi8qUmltb3ppb25lIGFsbGVnYXRvIHJhcHBvcnRvIGRpIGludGVydmVudG8gYXBwZW5hIGNyZWF0byovCi8qIEdldCBJbnNpZ2h0IElRTCBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3MgaXFsRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5JUUxGYWNhZGUiKTsgCmRlZiBpcWxGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUoaXFsRmFjYWRlQ2xhc3MpOwoKLyogR2V0IEluc2lnaHQgT2JqZWN0IEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOwpkZWYgb2JqZWN0RmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEZhY2FkZUNsYXNzKTsKCi8qIEdldCBJbnNpZ2h0IE9iamVjdCBUeXBlIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RUeXBlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlRmFjYWRlIik7CmRlZiBvYmplY3RUeXBlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVGYWNhZGVDbGFzcyk7CgovKiBHZXQgSW5zaWdodCBPYmplY3QgQXR0cmlidXRlIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqLwpDbGFzcyBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKCJjb20ucmlhZGFsYWJzLmppcmEucGx1Z2lucy5pbnNpZ2h0LmNoYW5uZWwuZXh0ZXJuYWwuYXBpLmZhY2FkZS5PYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlIik7CmRlZiBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7CgpDbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5zZXJ2aWNlcy5tb2RlbC5mYWN0b3J5Lk9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Iik7CmRlZiBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzKTsKCmRlZiBjdXN0b21lclZhbHVlID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShjdXN0b21lcilbMF0udG9TdHJpbmcoKQpkZWYgY3VzdG9tZXJLZXkgPSBjdXN0b21lclZhbHVlLnN1YnN0cmluZyhjdXN0b21lclZhbHVlLmluZGV4T2YoJygnKSsxLGN1c3RvbWVyVmFsdWUuaW5kZXhPZignKScpKQoKZGVmIERPY3VzdG9tZXJPYmplY3RSZWYgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShjdXN0b21lcilbMF0uZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jdXN0b21lci5jdXN0b21lclJlZiddLnRvU3RyaW5nKCkpLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsKbG9nLmRlYnVnICJET2N1c3RvbWVyT2JqZWN0UmVmOiAiICsgRE9jdXN0b21lck9iamVjdFJlZgoKZGVmIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKERPY3VzdG9tZXJPYmplY3RSZWZbMF0uZ2V0VmFsdWUoKSwgcHJvcGVydGllc1snaW9iai5jb250YWN0LmRiby5uYW1lJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpICAKZGVmIGN1c3RvbWVyTmFtZSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoKLyogU3BlY2lmeSB0aGUgc2NoZW1hIGlkIGFzIHdlbGwgYXMgdGhlIElRTCB0aGF0IHdpbGwgZmV0Y2ggb2JqZWN0cy4gSW4gdGhpcyBjYXNlIGFsbCBvYmplY3RzIHdpdGggTmFtZSBtYXRjaGluZyB0aGUgdmFsdWVDRiwgYmUgc3VyZSB0byBpbmNsdWRlICIgYXJvdW5kIHZhbHVlICovCmRlZiBvYmplY3RzID0gaXFsRmFjYWRlLmZpbmRPYmplY3RzQnlJUUxBbmRTY2hlbWEoREJPLCAiXCIiICsgKHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmF0dGFjaG1lbnRDYXRlZ29yeSddID8gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuYXR0YWNobWVudENhdGVnb3J5J10udG9TdHJpbmcoKSA6ICJBVFRBQ0hNRU5UX0NBVEVHT1JZIikgKyAiXCIuXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkubmFtZSddLnRvU3RyaW5nKCkgKyAiXCIgPSBcIiIgKyAocHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5vZmZDbGllbnRlJ10gPyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5vYmpzLm9mZkNsaWVudGUnXS50b1N0cmluZygpIDogIk9mZmVydGEgQ2xpZW50ZSIpICsgIlwiIEFORCAiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuZGVsZXRlZCddLnRvU3RyaW5nKCkgKyAiIT10cnVlIEFORCBDVVNUT01FUl9SRUYgSVMgTk9UIEVNUFRZIEFORCBDVVNUT01FUl9SRUYuTmFtZSA9IFwiIiArIGN1c3RvbWVyTmFtZVswXS5nZXRWYWx1ZSgpICsgIlwiIik7IC8vIFNlZSB0aGUgY29tcGxldGUgbGlzdCBvZiBwb3NzaWJsZSBJUUwgb24gdGhlIEluc2lnaHQgUXVlcnkgTGFuZ3VhZ2UgZG9jdW1lbnRhdGlvbiBwYWdlCi8qIElmIHRoaXMgaXMgYSBtYW5kYXRvcnkgZmllbGQgeW91IHNob3VsZCBiZSBhYmxlIHRvIGRvIHRoaXM6ICovCmxvZy5pbmZvKCJJbnNpZ2h0IG9iamVjdDogIiArIG9iamVjdHNbMF0pOwpsb2cuZGVidWcgIlwiIiArIChwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5hdHRhY2htZW50Q2F0ZWdvcnknXSA/IHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmF0dGFjaG1lbnRDYXRlZ29yeSddLnRvU3RyaW5nKCkgOiAiQVRUQUNITUVOVF9DQVRFR09SWSIpICsgIlwiLlwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm5hbWUnXS50b1N0cmluZygpICsgIlwiID0gXCIiICsgKHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm9ianMub2ZmQ2xpZW50ZSddID8gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5vZmZDbGllbnRlJ10udG9TdHJpbmcoKSA6ICJPZmZlcnRhIENsaWVudGUiKSArICJcIiBBTkQgIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmRlbGV0ZWQnXS50b1N0cmluZygpICsgIiE9dHJ1ZSBBTkQgQ1VTVE9NRVJfUkVGIElTIE5PVCBFTVBUWSBBTkQgQ1VTVE9NRVJfUkVGLk5hbWUgPSBcIiIgKyBjdXN0b21lck5hbWVbMF0uZ2V0VmFsdWUoKSArICJcIiIKCmlmKCFvYmplY3RzWzBdKXsKICAgIC8qTmVzc3VuIGZpbGUgaW5kaXZpZHVhdG8gcGVyIGlsIGNsaWVudGUgLSBjZXJjbyB0ZW1wbGF0ZSBnZW5lcmljbyAqLwogICAgb2JqZWN0cyA9IGlxbEZhY2FkZS5maW5kT2JqZWN0c0J5SVFMQW5kU2NoZW1hKERCTywgIlwiIiArIChwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5hdHRhY2htZW50Q2F0ZWdvcnknXSA/IHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmF0dGFjaG1lbnRDYXRlZ29yeSddLnRvU3RyaW5nKCkgOiAiQVRUQUNITUVOVF9DQVRFR09SWSIpICsgIlwiLlwiIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm5hbWUnXS50b1N0cmluZygpICsgIlwiID0gXCIiICsgKHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5Lm9ianMub2ZmQ2xpZW50ZSddID8gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5vZmZDbGllbnRlJ10udG9TdHJpbmcoKSA6ICJPZmZlcnRhIENsaWVudGUiKSArICJcIiBBTkQgIiArIHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmRlbGV0ZWQnXS50b1N0cmluZygpICsgIiE9dHJ1ZSBBTkQgQ1VTVE9NRVJfUkVGIElTIEVNUFRZIEFORCBERUZBVUxUPXRydWUiKTsgLy8gU2VlIHRoZSBjb21wbGV0ZSBsaXN0IG9mIHBvc3NpYmxlIElRTCBvbiB0aGUgSW5zaWdodCBRdWVyeSBMYW5ndWFnZSBkb2N1bWVudGF0aW9uIHBhZ2UKICAgIC8qIElmIHRoaXMgaXMgYSBtYW5kYXRvcnkgZmllbGQgeW91IHNob3VsZCBiZSBhYmxlIHRvIGRvIHRoaXM6ICovCiAgICBsb2cuaW5mbygiSW5zaWdodCBvYmplY3Q6ICIgKyBvYmplY3RzWzBdKTsKICAgIGxvZy5kZWJ1ZyAiXCIiICsgKHByb3BlcnRpZXNbJ2lvYmouYXR0YWNobWVudENhdGVnb3J5LmF0dGFjaG1lbnRDYXRlZ29yeSddID8gcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuYXR0YWNobWVudENhdGVnb3J5J10udG9TdHJpbmcoKSA6ICJBVFRBQ0hNRU5UX0NBVEVHT1JZIikgKyAiXCIuXCIiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkubmFtZSddLnRvU3RyaW5nKCkgKyAiXCIgPSBcIiIgKyAocHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkub2Jqcy5vZmZDbGllbnRlJ10gPyBwcm9wZXJ0aWVzWydpb2JqLmF0dGFjaG1lbnRDYXRlZ29yeS5vYmpzLm9mZkNsaWVudGUnXS50b1N0cmluZygpIDogIk9mZmVydGEgQ2xpZW50ZSIpICsgIlwiIEFORCAiICsgcHJvcGVydGllc1snaW9iai5hdHRhY2htZW50Q2F0ZWdvcnkuZGVsZXRlZCddLnRvU3RyaW5nKCkgKyAiIT10cnVlIEFORCBDVVNUT01FUl9SRUYgSVMgRU1QVFkgQU5EIERFRkFVTFQ9dHJ1ZSIKfQoKaWYob2JqZWN0c1swXSl7CiAgICBsb2cuZGVidWcgInRlbXBsYXRlIGRhIHVzYXJlOiAiICsgb2JqZWN0c1swXS5nZXRJZCgpCiAgICB0ZW1wbGF0ZUlkPW9iamVjdHNbMF0uZ2V0SWQoKQp9CgoKLyogUkVTVCBBUEkgcGVyIEdlbmVyYXppb25lIEFsbGVnYXRvIENvbnN1bnRpdm8gKi8KcmVxdWVzdE1ldGhvZCA9ICJQVVQiOwoKYmFzZVVSTCA9ICJodHRwOi8vIiArIHByb3BlcnRpZXNbJ2FwaS5lbnYnXS50b1N0cmluZygpICsgIi9vcC9yZXN0L2F1dG9tYXRpb24vdGlja2V0LyIgKyBpc3N1ZS5rZXkudG9TdHJpbmcoKSArICIvYXR0YWNobWVudC9nZW5lcmljP3RlbXBsYXRlSWQ9IiArIHRlbXBsYXRlSWQgKyAiJnR5cGU9V29yZCZhdHRhY2htZW50Q3VzdG9tRmllbGQ9IiArIHByb3BlcnRpZXNbJ2NmLm9mZmVyQXR0YWNobWVudFJlZiddLnRvU3RyaW5nKCkKCmxvZy5kZWJ1ZyAiYmFzZVVybDogIiArIGJhc2VVUkwKClVSTCB1cmwKdXJsID0gbmV3IFVSTChiYXNlVVJMKQpIdHRwVVJMQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gKEh0dHBVUkxDb25uZWN0aW9uKXVybC5vcGVuQ29ubmVjdGlvbigpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RNZXRob2QocmVxdWVzdE1ldGhvZCk7CmNvbm5lY3Rpb24uc2V0UmVxdWVzdFByb3BlcnR5KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbiIpOwpjb25uZWN0aW9uLnNldFJlcXVlc3RQcm9wZXJ0eSgiQWNjZXB0IiwgIiovKiIpOwpjb25uZWN0aW9uLnNldERvT3V0cHV0KHRydWUpOwpjb25uZWN0aW9uLnNldERvSW5wdXQodHJ1ZSk7CmNvbm5lY3Rpb24uY29ubmVjdCgpOwoKZGVmIG91dHB1dCA9IG5ldyBBcnJheUxpc3QoKQpkZWYgZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCkKZGVmIGVMaXN0RXJyb3JzID0gbmV3IEFycmF5TGlzdCgpCmRlZiBlcnJvck1zZ3MgPSBuZXcgQXJyYXlMaXN0KCkKCmlmICghY29ubmVjdGlvbi5nZXRSZXNwb25zZUNvZGUoKS50b1N0cmluZygpLmVxdWFscygiMjAwIikpewogICAgbG9nLmRlYnVnICJ1cmw6ICIgKyB1cmwKICAgIGxvZy5kZWJ1ZyAiUmVzcG9uc2VDb2RlOiIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlQ29kZSgpCiAgICBsb2cuZGVidWcgIlJlc3BvbnNlTWVzc2FnZToiICsgY29ubmVjdGlvbi5nZXRSZXNwb25zZU1lc3NhZ2UoKQogICAgZUxpc3RFcnJvcnMuYWRkKCJFIikKICAgIGVMaXN0RXJyb3JzLmFkZCgiR0VORVJBVEUtQUNDT1VOVElOR1JFUE9SVCIpCiAgICBlcnJvck1zZ3MuYWRkKGNvbm5lY3Rpb24uZ2V0UmVzcG9uc2VDb2RlKCkgKyAiICIgKyBjb25uZWN0aW9uLmdldFJlc3BvbnNlTWVzc2FnZSgpKQogICAgZUxpc3RFcnJvcnMuYWRkKGVycm9yTXNncykKICAgIGVMaXN0LmFkZChlTGlzdEVycm9ycykKCiAgICBvdXRwdXQuYWRkKGVMaXN0KQogICAgdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigneyJFIjoiJyArIG91dHB1dC50b1N0cmluZygpICsgJyJ9JykKICAgIC8vdGhyb3cgbmV3IEludmFsaWRJbnB1dEV4Y2VwdGlvbigiRSIsIG91dHB1dC50b1N0cmluZygpKQp9Cg==</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.CustomScriptValidator</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
              <arg name="FIELD_SCRIPT_FILE"></arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="null" status="null" step="10">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_22693</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="381" name="ReOpen Quote">
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="8">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="11" name="Waiting for Customer Feedback">
      <meta name="jira.status.id">14334</meta>
      <actions>
        <action id="311" name="Offerta Accettata da Cliente">
          <meta name="opsbar-sequence">10</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="12">
              <post-functions>
                <function type="class">
                  <arg name="conditionList">3</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesvalueField-precondition-function</arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.25.0</arg>
                  <arg name="comparisonType">1</arg>
                  <arg name="precondition">true</arg>
                  <arg name="class.name">ch.beecom.jira.jsu.workflow.function.valuefield.ValueFieldPreconditionFunction</arg>
                  <arg name="preconditionNegateResult-booleanValue"></arg>
                  <arg name="fieldValue">Yes</arg>
                  <arg name="preconditionMode-textValue">DISCARD</arg>
                  <arg name="fieldsList">customfield_22681</arg>
                </function>
                <function type="class">
                  <arg name="field.copyFieldSource2"></arg>
                  <arg name="field.copyFieldSource1">customfield_22683</arg>
                  <arg name="scopeSource-linkEnd"></arg>
                  <arg name="maxAllowed-integerValue"></arg>
                  <arg name="field.createTargetValue1"></arg>
                  <arg name="runAsUser-user">atlassian_faac_service_desk</arg>
                  <arg name="field.copyFieldMode1">OVERWRITE</arg>
                  <arg name="field.copyFieldDestination1">customfield_22635</arg>
                  <arg name="field.copyFieldSeparator1"></arg>
                  <arg name="scopeType">SAME</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiescopyValueFromOtherField-function</arg>
                  <arg name="scopeDestination-linkEnd"></arg>
                  <arg name="jsuWorkflowParamsVersion-textValue">2.25.0</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">TRUE</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql"></arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.CopyValueFromOtherFieldPostFunction</arg>
                  <arg name="scopeSource-jql"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">38100fbf-8abd-4951-82c2-3defd3481f99</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IENhbGN1bGF0ZSBPRkZFUl9DVVNUT01FUl9UT1RBTF9BTU9VTlQsIE9GRkVSX1NVUFBMSUVSX1RPVEFMX0FNT1VOVCArIF9NQVRFUklBTCBlIF9MQUJPVVI=</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">YCFgeyJzY3JpcHQiOiJpbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlXG5pbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb25cbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlTWFuYWdlclxuaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnlcbmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlclxuaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyXG5pbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXJcbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29uZmlnLnV0aWwuSmlyYUhvbWVcbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvblxuaW1wb3J0IGphdmEudGV4dC5TaW1wbGVEYXRlRm9ybWF0XG5pbXBvcnQgamF2YS50ZXh0LlBhcnNlRXhjZXB0aW9uXG5pbXBvcnQgamF2YS50ZXh0LkRlY2ltYWxGb3JtYXRcbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTW9kaWZpZWRWYWx1ZVxuaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS51dGlsLklzc3VlQ2hhbmdlSG9sZGVyXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyXG5cbmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyXG5pbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGxcblxuUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKVxuRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJylcbnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7XG5cdHByb3BlcnRpZXMubG9hZChpdClcbn1cbmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZShcImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uXCIpXG5sb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRylcblxuLypTY3JpcHQgVmFyaWFibGVzKi9cbi8vUGVyIFBvc3QgRnVuY3Rpb25cbmlzc3VlID0gaXNzdWVcbi8vUGVyIHRlc3QgZGEgY29uc29sZVxuLy9Jc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKClcbi8vaXNzdWUgPSBpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVCeUtleUlnbm9yZUNhc2UoXCJPUFVULTMzODJcIilcblxuLypJbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzKi9cbkNsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcyhcImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZVwiKTsgIFxuQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcyhcImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVcIik7XG5vYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7XG5vYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpO1xuLyogR2V0IEluc2lnaHQgSVFMIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqL1xuQ2xhc3MgaXFsRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlXCIpOyBcbmlxbEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShpcWxGYWNhZGVDbGFzcyk7XG5DbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcyhcImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuc2VydmljZXMubW9kZWwuZmFjdG9yeS5PYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeVwiKTtcbm9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5ID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Q2xhc3MpO1xuLyogR2V0IEluc2lnaHQgT2JqZWN0IFR5cGUgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovXG5DbGFzcyBvYmplY3RUeXBlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZVwiKTsgXG5vYmplY3RUeXBlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVGYWNhZGVDbGFzcyk7XG5cbi8qQ09TVEFOVEkqL1xuT1BBQT1wcm9wZXJ0aWVzWydpc2NoZW1hLmFhLmlkJ11cbi8vQXR0cmlidXRlIElEc1xuUkFURV9UT1RBTF9BTU9VTlRfU1VQUExJRVI9cHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdFN1cHAuaWQnXVxuUkFURV9UT1RBTF9BTU9VTlRfQ1VTVE9NRVI9cHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnRvdEN1c3QuaWQnXVxuQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9TVVBQTElFUj1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RTdXBwLmlkJ11cbkNPTVBPTkVOVF9UT1RBTF9BTU9VTlRfQ1VTVE9NRVI9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdC5pZCddXG4vL09ialR5cGUgSURzXG5PTlNJVEVfUkFURV9SRVBPUlQ9cHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0J11cbkNPTVBPTkVOVD1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudCddXG5cbi8qQ3VzdG9tZmllbGRzKi9cbmRlZiBDdXN0T2ZmZXJUb3QgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmN1c3RvbWVyT2ZmZXJUb3RBbW91bnQnXS50b1N0cmluZygpKVswXVxuZGVmIFN1cHBPZmZlclRvdCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yuc3VwcGxpZXJPZmZlclRvdEFtb3VudCddLnRvU3RyaW5nKCkpWzBdXG5cbmRlZiBDdXN0T2ZmZXJNYXRUb3QgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLmN1c3RvbWVyT2ZmZXJNYXRlcmlhbHMnXS50b1N0cmluZygpKVswXVxuZGVmIFN1cHBPZmZlck1hdFRvdCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yuc3VwcGxpZXJPZmZlck1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdXG5kZWYgQ3VzdE9mZmVyTGFiVG90ID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5jdXN0b21lck9mZmVyTGFib3VyJ10udG9TdHJpbmcoKSlbMF1cbmRlZiBTdXBwT2ZmZXJMYWJUb3QgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnN1cHBsaWVyT2ZmZXJMYWJvdXInXS50b1N0cmluZygpKVswXVxuXG5kZWYgcmVwTWF0ZXJpYWxzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5xdW90ZU1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdXG5kZWYgbGFib3VyUmF0ZXMgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnF1b3RlTGFib3VyUmF0ZXMnXS50b1N0cmluZygpKVswXVxuXG5kZWYgbWkgPSAoTXV0YWJsZUlzc3VlKSBpc3N1ZVxuZGVmIGN1cnJlbnRVc2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SmlyYUF1dGhlbnRpY2F0aW9uQ29udGV4dCgpLmdldExvZ2dlZEluVXNlcigpXG5cbi8qVmFyaWFibGVzKi9cbmRlZiBjdXN0b21lck9mZmVyVG90LCBzdXBwbGllck9mZmVyVG90XG5kb3VibGUgdG90QW1vdW50U3VwcGxpZXIgPSAwXG5kb3VibGUgdG90QW1vdW50Q3VzdG9tZXIgPSAwXG5kZWYgcmVwTWF0TGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocmVwTWF0ZXJpYWxzKVxuZGVmIGxhYm91clJhdGVzTGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUobGFib3VyUmF0ZXMpXG5cbmRlZiB0b3RDdXN0TWF0ID0gMFxuZGVmIHRvdEN1c3RMYWIgPSAwXG5kZWYgdG90U3VwcE1hdCA9IDBcbmRlZiB0b3RTdXBwTGFiPSAwXG5cbmZvcihtYXQgaW4gcmVwTWF0TGlzdCl7XG4gICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZCBnZXQgb2JqZWN0XG4gICAgZGVmIGNvbXBvbmVudD1tYXQudG9TdHJpbmcoKVxuICAgIGRlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKVxuICAgIGRlZiBjb21wb25lbnRPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oY29tcG9uZW50S2V5KVxuXG4gICAgLy9NQVRFUklBTF9SRUZcbiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKClcbiAgICBkZWYgbWF0ZXJpYWwgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcbiAgICBcbiAgICAvL0RFTEVURURcbiAgICBkZWYgZGVsZXRlZFxuICAgIGlmIChvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7XG4gICAgICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpXG4gICAgXHRkZWxldGVkID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpXG4gICAgICAgIGRlbGV0ZWQgPSBkZWxldGVkWzBdLmdldFZhbHVlKClcbiAgICB9XG4gICAgXG4gICAgLy9UT1RBTF9BTU9VTlRfU1VQUExJRVJcbiAgICBpZihkZWxldGVkPT1udWxsIHx8IGRlbGV0ZWQhPXRydWUpe1xuICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90U3VwcCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuICAgICAgICBkZWYgdG90U3VwcGxpZXIgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcbiAgICAgICAgdG90QW1vdW50U3VwcGxpZXIgPSB0b3RBbW91bnRTdXBwbGllciArIHRvdFN1cHBsaWVyWzBdLmdldFZhbHVlKCkudG9Eb3VibGUoKVxuICAgICAgICB0b3RTdXBwTWF0ID0gdG90U3VwcE1hdCArIHRvdFN1cHBsaWVyWzBdLmdldFZhbHVlKCkudG9Eb3VibGUoKVxuICAgIH1cbiAgICBcbiAgICAvL1RPVEFMX0FNT1VOVF9DVVNUT01FUlxuICAgIGlmKGRlbGV0ZWQ9PW51bGwgfHwgZGVsZXRlZCE9dHJ1ZSl7XG4gICAgICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RDdXN0J10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpXG4gICAgICAgIGRlZiB0b3RDdXN0b21lciA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuICAgICAgICB0b3RBbW91bnRDdXN0b21lciA9IHRvdEFtb3VudEN1c3RvbWVyICsgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b0RvdWJsZSgpXG4gICAgICAgIHRvdEN1c3RNYXQgPSB0b3RDdXN0TWF0ICsgdG90Q3VzdG9tZXJbMF0uZ2V0VmFsdWUoKS50b0RvdWJsZSgpXG4gICAgfVxuICAgICAgICBcbiAgICBpZiAobWF0ZXJpYWwhPW51bGwgJiYgKGRlbGV0ZWQ9PW51bGwgfHwgZGVsZXRlZCE9dHJ1ZSkpeyBcbiAgICAgICAgLypWZXJpZmljbyBzZSBzaSB0cmF0dGEgZGkgdW4gbWF0ZXJpYWxlIFNBUCBvIE5PIFNBUCovXG4gICAgICAgIG1hdGVyaWFsID0gbWF0ZXJpYWwudG9TdHJpbmcoKVxuICAgICAgICBtYXRlcmlhbEtleSA9IG1hdGVyaWFsLnN1YnN0cmluZyhtYXRlcmlhbC5pbmRleE9mKCcoJykrMSxtYXRlcmlhbC5pbmRleE9mKCcpJykpXG5cbiAgICAgICAgLypNQVRFUklBTCAtIFNBUCovXG4gICAgICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKG1hdGVyaWFsS2V5LnRvSW50ZWdlcigpLCBwcm9wZXJ0aWVzWydpb2JqLm1hdGVyaWFsLnNhcCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuICAgICAgICBzYXAgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcblxuICAgICAgICAvKk1BVEVSSUFMIC0gTUFUTlIqL1xuICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXRlcmlhbEtleS50b0ludGVnZXIoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5tYXRuciddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuICAgICAgICBtYXRuciA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXG4gICAgICAgIGlmKHNhcCE9bnVsbCAmJiBtYXRuciE9bnVsbCl7XG4gICAgICAgICAgICBtYXRucj1tYXRuci50b1N0cmluZygpXG4gICAgICAgICAgICBtYXRuciA9IG1hdG5yLnN1YnN0cmluZyhtYXRuci5pbmRleE9mKCcoJykrMSxtYXRuci5pbmRleE9mKCcpJykpXG4gICAgICAgICAgICBzYXA9c2FwLnRvU3RyaW5nKClcbiAgICAgICAgICAgIHNhcCA9IHNhcC5zdWJzdHJpbmcoc2FwLmluZGV4T2YoJygnKSsxLHNhcC5pbmRleE9mKCcpJykpXG5cbiAgICAgICAgICAgIGlmKHNhcC5lcXVhbHNJZ25vcmVDYXNlKFwidHJ1ZVwiKSl7XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnIFwiTWF0ZXJpYWxlIHNhcDogXCIgKyBzYXBcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyBcIk1hdGVyaWFsZSBOT04gc2FwOiBcIiArIHNhcFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG59XG5cbmZvcihyYXRlIGluIGxhYm91clJhdGVzTGlzdCl7XG4gICAgLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZCBnZXQgb2JqZWN0XG4gICAgZGVmIGxhYlJhdGU9cmF0ZS50b1N0cmluZygpXG4gICAgZGVmIGxhYlJhdGVLZXkgPSBsYWJSYXRlLnN1YnN0cmluZyhsYWJSYXRlLmluZGV4T2YoJygnKSsxLGxhYlJhdGUuaW5kZXhPZignKScpKVxuICAgIGRlZiBsYWJSYXRlT2JqZWN0ID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RCZWFuKGxhYlJhdGVLZXkpXG5cbiAgICAvL01BVEVSSUFMX1JFRlxuICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxhYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LnJhdGVSZWYnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKClcbiAgICBkZWYgcmF0ZURlc2MgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcbiAgICBcbiAgICAvL0RFTEVURURcbiAgICBkZWYgZGVsZXRlZFxuICAgIGlmIChvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGFiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpKXtcbiAgICAgICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGFiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuICAgIFx0ZGVsZXRlZCA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuICAgICAgICBkZWxldGVkID0gZGVsZXRlZFswXS5nZXRWYWx1ZSgpXG4gICAgfVxuICAgIFxuICAgIC8vVE9UQUxfQU1PVU5UX1NVUFBMSUVSXG4gICAgaWYoZGVsZXRlZD09bnVsbCB8fCBkZWxldGVkIT10cnVlKXtcbiAgICAgICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4obGFiUmF0ZU9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXInXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKClcbiAgICAgICAgZGVmIHRvdFN1cHBsaWVyID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpXG4gICAgICAgIHRvdEFtb3VudFN1cHBsaWVyID0gdG90QW1vdW50U3VwcGxpZXIgKyB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvRG91YmxlKClcbiAgICAgICAgdG90U3VwcExhYiA9IHRvdFN1cHBMYWIgKyB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvRG91YmxlKClcbiAgICB9XG4gICAgXG4gICAgLy9UT1RBTF9BTU9VTlRfQ1VTVE9NRVJcbiAgICBpZihkZWxldGVkPT1udWxsIHx8IGRlbGV0ZWQhPXRydWUpe1xuICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYWJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuICAgICAgICBkZWYgdG90Q3VzdG9tZXIgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcbiAgICAgICAgdG90QW1vdW50Q3VzdG9tZXIgPSB0b3RBbW91bnRDdXN0b21lciArIHRvdEN1c3RvbWVyWzBdLmdldFZhbHVlKCkudG9Eb3VibGUoKVxuICAgICAgICB0b3RDdXN0TGFiID0gdG90Q3VzdExhYiArIHRvdEN1c3RvbWVyWzBdLmdldFZhbHVlKCkudG9Eb3VibGUoKVxuICAgIH1cbn1cblxuXG5cbmxvZy5kZWJ1ZyBcIlRPVEFMRSBPRkZFUlRBIEZPUk5JVE9SRTogXCIgKyBuZXcgRGVjaW1hbEZvcm1hdChcIiMuIyNcIikuZm9ybWF0KHRvdEFtb3VudFN1cHBsaWVyKVxubG9nLmRlYnVnIFwiVE9UQUxFIE9GRkVSVEEgQ0xJRU5URTogXCIgKyBuZXcgRGVjaW1hbEZvcm1hdChcIiMuIyNcIikuZm9ybWF0KHRvdEFtb3VudEN1c3RvbWVyKVxuXG5Jc3N1ZUNoYW5nZUhvbGRlciBjaGFuZ2VIb2xkZXIgPSBuZXcgRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyKClcbkN1c3RPZmZlclRvdC51cGRhdGVWYWx1ZShudWxsLCBpc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShDdXN0T2ZmZXJUb3QpLHRvdEFtb3VudEN1c3RvbWVyKSxjaGFuZ2VIb2xkZXIpXG5TdXBwT2ZmZXJUb3QudXBkYXRlVmFsdWUobnVsbCwgaXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoU3VwcE9mZmVyVG90KSx0b3RBbW91bnRTdXBwbGllciksY2hhbmdlSG9sZGVyKVxuXG5DdXN0T2ZmZXJNYXRUb3QudXBkYXRlVmFsdWUobnVsbCwgaXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoQ3VzdE9mZmVyTWF0VG90KSx0b3RDdXN0TWF0KSxjaGFuZ2VIb2xkZXIpXG5TdXBwT2ZmZXJNYXRUb3QudXBkYXRlVmFsdWUobnVsbCwgaXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoU3VwcE9mZmVyTWF0VG90KSx0b3RTdXBwTWF0KSxjaGFuZ2VIb2xkZXIpXG5DdXN0T2ZmZXJMYWJUb3QudXBkYXRlVmFsdWUobnVsbCwgaXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoQ3VzdE9mZmVyTGFiVG90KSx0b3RDdXN0TGFiKSxjaGFuZ2VIb2xkZXIpXG5TdXBwT2ZmZXJMYWJUb3QudXBkYXRlVmFsdWUobnVsbCwgaXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoU3VwcE9mZmVyTGFiVG90KSx0b3RTdXBwTGFiKSxjaGFuZ2VIb2xkZXIpXG5cbiAgICAgICAgICAgIFxuIiwic2NyaXB0UGF0aCI6bnVsbCwicGFyYW1ldGVycyI6e319</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXIKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uU2x1cnBlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb25maWcudXRpbC5KaXJhSG9tZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQKaW1wb3J0IGphdmEudGV4dC5QYXJzZUV4Y2VwdGlvbgppbXBvcnQgamF2YS50ZXh0LkRlY2ltYWxGb3JtYXQKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5Jc3N1ZUNoYW5nZUhvbGRlcgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyCgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpkZWYgQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgovKlNjcmlwdCBWYXJpYWJsZXMqLwovL1BlciBQb3N0IEZ1bmN0aW9uCmlzc3VlID0gaXNzdWUKLy9QZXIgdGVzdCBkYSBjb25zb2xlCi8vSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpCi8vaXNzdWUgPSBpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVCeUtleUlnbm9yZUNhc2UoIk9QVVQtMzM4MiIpCgovKkluc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMqLwpDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCkNsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwpvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwovKiBHZXQgSW5zaWdodCBJUUwgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCkNsYXNzIGlxbEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlIik7IAppcWxGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUoaXFsRmFjYWRlQ2xhc3MpOwpDbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5zZXJ2aWNlcy5tb2RlbC5mYWN0b3J5Lk9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Iik7Cm9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5ID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Q2xhc3MpOwovKiBHZXQgSW5zaWdodCBPYmplY3QgVHlwZSBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3Mgb2JqZWN0VHlwZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZSIpOyAKb2JqZWN0VHlwZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlRmFjYWRlQ2xhc3MpOwoKLypDT1NUQU5USSovCk9QQUE9cHJvcGVydGllc1snaXNjaGVtYS5hYS5pZCddCi8vQXR0cmlidXRlIElEcwpSQVRFX1RPVEFMX0FNT1VOVF9TVVBQTElFUj1wcm9wZXJ0aWVzWydpb2JqLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcC5pZCddClJBVEVfVE9UQUxfQU1PVU5UX0NVU1RPTUVSPXByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0LmlkJ10KQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9TVVBQTElFUj1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RTdXBwLmlkJ10KQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9DVVNUT01FUj1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RDdXN0LmlkJ10KLy9PYmpUeXBlIElEcwpPTlNJVEVfUkFURV9SRVBPUlQ9cHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0J10KQ09NUE9ORU5UPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50J10KCi8qQ3VzdG9tZmllbGRzKi8KZGVmIEN1c3RPZmZlclRvdCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuY3VzdG9tZXJPZmZlclRvdEFtb3VudCddLnRvU3RyaW5nKCkpWzBdCmRlZiBTdXBwT2ZmZXJUb3QgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnN1cHBsaWVyT2ZmZXJUb3RBbW91bnQnXS50b1N0cmluZygpKVswXQoKZGVmIEN1c3RPZmZlck1hdFRvdCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YuY3VzdG9tZXJPZmZlck1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdCmRlZiBTdXBwT2ZmZXJNYXRUb3QgPSAgQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnN1cHBsaWVyT2ZmZXJNYXRlcmlhbHMnXS50b1N0cmluZygpKVswXQpkZWYgQ3VzdE9mZmVyTGFiVG90ID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5jdXN0b21lck9mZmVyTGFib3VyJ10udG9TdHJpbmcoKSlbMF0KZGVmIFN1cHBPZmZlckxhYlRvdCA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2Yuc3VwcGxpZXJPZmZlckxhYm91ciddLnRvU3RyaW5nKCkpWzBdCgpkZWYgcmVwTWF0ZXJpYWxzID0gIENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5xdW90ZU1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdCmRlZiBsYWJvdXJSYXRlcyA9ICBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YucXVvdGVMYWJvdXJSYXRlcyddLnRvU3RyaW5nKCkpWzBdCgpkZWYgbWkgPSAoTXV0YWJsZUlzc3VlKSBpc3N1ZQpkZWYgY3VycmVudFVzZXIgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRKaXJhQXV0aGVudGljYXRpb25Db250ZXh0KCkuZ2V0TG9nZ2VkSW5Vc2VyKCkKCi8qVmFyaWFibGVzKi8KZGVmIGN1c3RvbWVyT2ZmZXJUb3QsIHN1cHBsaWVyT2ZmZXJUb3QKZG91YmxlIHRvdEFtb3VudFN1cHBsaWVyID0gMApkb3VibGUgdG90QW1vdW50Q3VzdG9tZXIgPSAwCmRlZiByZXBNYXRMaXN0ID0gaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMpCmRlZiBsYWJvdXJSYXRlc0xpc3QgPSBpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKGxhYm91clJhdGVzKQoKZGVmIHRvdEN1c3RNYXQgPSAwCmRlZiB0b3RDdXN0TGFiID0gMApkZWYgdG90U3VwcE1hdCA9IDAKZGVmIHRvdFN1cHBMYWI9IDAKCmZvcihtYXQgaW4gcmVwTWF0TGlzdCl7CiAgICAvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5kIGdldCBvYmplY3QKICAgIGRlZiBjb21wb25lbnQ9bWF0LnRvU3RyaW5nKCkKICAgIGRlZiBjb21wb25lbnRLZXkgPSBjb21wb25lbnQuc3Vic3RyaW5nKGNvbXBvbmVudC5pbmRleE9mKCcoJykrMSxjb21wb25lbnQuaW5kZXhPZignKScpKQogICAgZGVmIGNvbXBvbmVudE9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihjb21wb25lbnRLZXkpCgogICAgLy9NQVRFUklBTF9SRUYKICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5tYXRlcmlhbFJlZiddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQogICAgZGVmIG1hdGVyaWFsID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAKICAgIC8vREVMRVRFRAogICAgZGVmIGRlbGV0ZWQKICAgIGlmIChvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmRlbGV0ZWQnXS50b1N0cmluZygpKSl7CiAgICAgICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmRlbGV0ZWQnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKICAgIAlkZWxldGVkID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgZGVsZXRlZCA9IGRlbGV0ZWRbMF0uZ2V0VmFsdWUoKQogICAgfQogICAgCiAgICAvL1RPVEFMX0FNT1VOVF9TVVBQTElFUgogICAgaWYoZGVsZXRlZD09bnVsbCB8fCBkZWxldGVkIT10cnVlKXsKICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90U3VwcCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQogICAgICAgIGRlZiB0b3RTdXBwbGllciA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgIHRvdEFtb3VudFN1cHBsaWVyID0gdG90QW1vdW50U3VwcGxpZXIgKyB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvRG91YmxlKCkKICAgICAgICB0b3RTdXBwTWF0ID0gdG90U3VwcE1hdCArIHRvdFN1cHBsaWVyWzBdLmdldFZhbHVlKCkudG9Eb3VibGUoKQogICAgfQogICAgCiAgICAvL1RPVEFMX0FNT1VOVF9DVVNUT01FUgogICAgaWYoZGVsZXRlZD09bnVsbCB8fCBkZWxldGVkIT10cnVlKXsKICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQogICAgICAgIGRlZiB0b3RDdXN0b21lciA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgIHRvdEFtb3VudEN1c3RvbWVyID0gdG90QW1vdW50Q3VzdG9tZXIgKyB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvRG91YmxlKCkKICAgICAgICB0b3RDdXN0TWF0ID0gdG90Q3VzdE1hdCArIHRvdEN1c3RvbWVyWzBdLmdldFZhbHVlKCkudG9Eb3VibGUoKQogICAgfQogICAgICAgIAogICAgaWYgKG1hdGVyaWFsIT1udWxsICYmIChkZWxldGVkPT1udWxsIHx8IGRlbGV0ZWQhPXRydWUpKXsgCiAgICAgICAgLypWZXJpZmljbyBzZSBzaSB0cmF0dGEgZGkgdW4gbWF0ZXJpYWxlIFNBUCBvIE5PIFNBUCovCiAgICAgICAgbWF0ZXJpYWwgPSBtYXRlcmlhbC50b1N0cmluZygpCiAgICAgICAgbWF0ZXJpYWxLZXkgPSBtYXRlcmlhbC5zdWJzdHJpbmcobWF0ZXJpYWwuaW5kZXhPZignKCcpKzEsbWF0ZXJpYWwuaW5kZXhPZignKScpKQoKICAgICAgICAvKk1BVEVSSUFMIC0gU0FQKi8KICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXRlcmlhbEtleS50b0ludGVnZXIoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5zYXAnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKICAgICAgICBzYXAgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCiAgICAgICAgLypNQVRFUklBTCAtIE1BVE5SKi8KICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXRlcmlhbEtleS50b0ludGVnZXIoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5tYXRuciddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQogICAgICAgIG1hdG5yID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCgogICAgICAgIGlmKHNhcCE9bnVsbCAmJiBtYXRuciE9bnVsbCl7CiAgICAgICAgICAgIG1hdG5yPW1hdG5yLnRvU3RyaW5nKCkKICAgICAgICAgICAgbWF0bnIgPSBtYXRuci5zdWJzdHJpbmcobWF0bnIuaW5kZXhPZignKCcpKzEsbWF0bnIuaW5kZXhPZignKScpKQogICAgICAgICAgICBzYXA9c2FwLnRvU3RyaW5nKCkKICAgICAgICAgICAgc2FwID0gc2FwLnN1YnN0cmluZyhzYXAuaW5kZXhPZignKCcpKzEsc2FwLmluZGV4T2YoJyknKSkKCiAgICAgICAgICAgIGlmKHNhcC5lcXVhbHNJZ25vcmVDYXNlKCJ0cnVlIikpewogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJNYXRlcmlhbGUgc2FwOiAiICsgc2FwCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgbG9nLmRlYnVnICJNYXRlcmlhbGUgTk9OIHNhcDogIiArIHNhcAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KfQoKZm9yKHJhdGUgaW4gbGFib3VyUmF0ZXNMaXN0KXsKICAgIC8vZXh0cmFjdCBpbnNpZ2h0IGtleSBhbmQgZ2V0IG9iamVjdAogICAgZGVmIGxhYlJhdGU9cmF0ZS50b1N0cmluZygpCiAgICBkZWYgbGFiUmF0ZUtleSA9IGxhYlJhdGUuc3Vic3RyaW5nKGxhYlJhdGUuaW5kZXhPZignKCcpKzEsbGFiUmF0ZS5pbmRleE9mKCcpJykpCiAgICBkZWYgbGFiUmF0ZU9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihsYWJSYXRlS2V5KQoKICAgIC8vTUFURVJJQUxfUkVGCiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYWJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5yYXRlUmVmJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpCiAgICBkZWYgcmF0ZURlc2MgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKICAgIAogICAgLy9ERUxFVEVECiAgICBkZWYgZGVsZXRlZAogICAgaWYgKG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYWJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC5kZWxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGxhYlJhdGVPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5vblNpdGVSYXRlUmVwb3J0LmRlbGV0ZWQnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKICAgIAlkZWxldGVkID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgZGVsZXRlZCA9IGRlbGV0ZWRbMF0uZ2V0VmFsdWUoKQogICAgfQogICAgCiAgICAvL1RPVEFMX0FNT1VOVF9TVVBQTElFUgogICAgaWYoZGVsZXRlZD09bnVsbCB8fCBkZWxldGVkIT10cnVlKXsKICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYWJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RTdXBwbGllciddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQogICAgICAgIGRlZiB0b3RTdXBwbGllciA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgIHRvdEFtb3VudFN1cHBsaWVyID0gdG90QW1vdW50U3VwcGxpZXIgKyB0b3RTdXBwbGllclswXS5nZXRWYWx1ZSgpLnRvRG91YmxlKCkKICAgICAgICB0b3RTdXBwTGFiID0gdG90U3VwcExhYiArIHRvdFN1cHBsaWVyWzBdLmdldFZhbHVlKCkudG9Eb3VibGUoKQogICAgfQogICAgCiAgICAvL1RPVEFMX0FNT1VOVF9DVVNUT01FUgogICAgaWYoZGVsZXRlZD09bnVsbCB8fCBkZWxldGVkIT10cnVlKXsKICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihsYWJSYXRlT2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmoub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lciddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQogICAgICAgIGRlZiB0b3RDdXN0b21lciA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgIHRvdEFtb3VudEN1c3RvbWVyID0gdG90QW1vdW50Q3VzdG9tZXIgKyB0b3RDdXN0b21lclswXS5nZXRWYWx1ZSgpLnRvRG91YmxlKCkKICAgICAgICB0b3RDdXN0TGFiID0gdG90Q3VzdExhYiArIHRvdEN1c3RvbWVyWzBdLmdldFZhbHVlKCkudG9Eb3VibGUoKQogICAgfQp9CgoKCmxvZy5kZWJ1ZyAiVE9UQUxFIE9GRkVSVEEgRk9STklUT1JFOiAiICsgbmV3IERlY2ltYWxGb3JtYXQoIiMuIyMiKS5mb3JtYXQodG90QW1vdW50U3VwcGxpZXIpCmxvZy5kZWJ1ZyAiVE9UQUxFIE9GRkVSVEEgQ0xJRU5URTogIiArIG5ldyBEZWNpbWFsRm9ybWF0KCIjLiMjIikuZm9ybWF0KHRvdEFtb3VudEN1c3RvbWVyKQoKSXNzdWVDaGFuZ2VIb2xkZXIgY2hhbmdlSG9sZGVyID0gbmV3IERlZmF1bHRJc3N1ZUNoYW5nZUhvbGRlcigpCkN1c3RPZmZlclRvdC51cGRhdGVWYWx1ZShudWxsLCBpc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShDdXN0T2ZmZXJUb3QpLHRvdEFtb3VudEN1c3RvbWVyKSxjaGFuZ2VIb2xkZXIpClN1cHBPZmZlclRvdC51cGRhdGVWYWx1ZShudWxsLCBpc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShTdXBwT2ZmZXJUb3QpLHRvdEFtb3VudFN1cHBsaWVyKSxjaGFuZ2VIb2xkZXIpCgpDdXN0T2ZmZXJNYXRUb3QudXBkYXRlVmFsdWUobnVsbCwgaXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoQ3VzdE9mZmVyTWF0VG90KSx0b3RDdXN0TWF0KSxjaGFuZ2VIb2xkZXIpClN1cHBPZmZlck1hdFRvdC51cGRhdGVWYWx1ZShudWxsLCBpc3N1ZSwgbmV3IE1vZGlmaWVkVmFsdWUoaXNzdWUuZ2V0Q3VzdG9tRmllbGRWYWx1ZShTdXBwT2ZmZXJNYXRUb3QpLHRvdFN1cHBNYXQpLGNoYW5nZUhvbGRlcikKQ3VzdE9mZmVyTGFiVG90LnVwZGF0ZVZhbHVlKG51bGwsIGlzc3VlLCBuZXcgTW9kaWZpZWRWYWx1ZShpc3N1ZS5nZXRDdXN0b21GaWVsZFZhbHVlKEN1c3RPZmZlckxhYlRvdCksdG90Q3VzdExhYiksY2hhbmdlSG9sZGVyKQpTdXBwT2ZmZXJMYWJUb3QudXBkYXRlVmFsdWUobnVsbCwgaXNzdWUsIG5ldyBNb2RpZmllZFZhbHVlKGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUoU3VwcE9mZmVyTGFiVG90KSx0b3RTdXBwTGFiKSxjaGFuZ2VIb2xkZXIpCgogICAgICAgICAgICAK</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">f66a5f06-1465-410f-b85d-1622703520c0</arg>
                  <arg name="FIELD_NOTES">YCFgT1A6IEdlbmVyYXRlIENvbXBvbmVudHMgJiBwb3B1bGF0ZSBPUEFBX1JFUExBQ0VEX01BVEVSSUFMUw==</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">YCFgeyJzY3JpcHQiOiJpbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlXG5pbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb25cbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29tcG9uZW50LkNvbXBvbmVudEFjY2Vzc29yXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLklzc3VlTWFuYWdlclxuaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnlcbmltcG9ydCBncm9vdnkuanNvbi5Kc29uQnVpbGRlclxuaW1wb3J0IGdyb292eS5qc29uLkpzb25TbHVycGVyXG5pbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXJcbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuY29uZmlnLnV0aWwuSmlyYUhvbWVcbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTXV0YWJsZUlzc3VlXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvblxuaW1wb3J0IGphdmEudGV4dC5TaW1wbGVEYXRlRm9ybWF0XG5pbXBvcnQgamF2YS50ZXh0LlBhcnNlRXhjZXB0aW9uXG5pbXBvcnQgamF2YS50ZXh0LkRlY2ltYWxGb3JtYXRcbmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUuTW9kaWZpZWRWYWx1ZVxuaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS51dGlsLklzc3VlQ2hhbmdlSG9sZGVyXG5pbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyXG5cbmltcG9ydCBjb20ub25yZXNvbHZlLnNjcmlwdHJ1bm5lci5ydW5uZXIuU2NyaXB0UnVubmVyXG5pbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGxcblxuUHJvcGVydGllcyBwcm9wZXJ0aWVzID0gbmV3IFByb3BlcnRpZXMoKVxuRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJylcbnByb3BlcnRpZXNGaWxlLndpdGhJbnB1dFN0cmVhbSB7XG5cdHByb3BlcnRpZXMubG9hZChpdClcbn1cbmRlZiBDYXRlZ29yeSBsb2cgPSBDYXRlZ29yeS5nZXRJbnN0YW5jZShcImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uXCIpXG5sb2cuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5ERUJVRylcblxuLypTY3JpcHQgVmFyaWFibGVzKi9cbi8vUGVyIFBvc3QgRnVuY3Rpb25cbmlzc3VlID0gaXNzdWVcbi8vUGVyIHRlc3QgZGEgY29uc29sZVxuLy9Jc3N1ZU1hbmFnZXIgaXNzdWVNYW5hZ2VyID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKClcbi8vaXNzdWUgPSBpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVCeUtleUlnbm9yZUNhc2UoXCJPUFVULTMzODJcIilcblxuLypJbnNpZ2h0IGNsYXNzZXMgJiBjb21wb25lbnRzKi9cbkNsYXNzIG9iamVjdEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcyhcImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZVwiKTsgIFxuQ2xhc3Mgb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcyhcImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVcIik7XG5vYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyk7XG5vYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpO1xuLyogR2V0IEluc2lnaHQgSVFMIEZhY2FkZSBmcm9tIHBsdWdpbiBhY2Nlc3NvciAqL1xuQ2xhc3MgaXFsRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlXCIpOyBcbmlxbEZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShpcWxGYWNhZGVDbGFzcyk7XG5DbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcyhcImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuc2VydmljZXMubW9kZWwuZmFjdG9yeS5PYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeVwiKTtcbm9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5ID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Q2xhc3MpO1xuLyogR2V0IEluc2lnaHQgT2JqZWN0IFR5cGUgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovXG5DbGFzcyBvYmplY3RUeXBlRmFjYWRlQ2xhc3MgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRQbHVnaW5BY2Nlc3NvcigpLmdldENsYXNzTG9hZGVyKCkuZmluZENsYXNzKFwiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZVwiKTsgXG5vYmplY3RUeXBlRmFjYWRlID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdFR5cGVGYWNhZGVDbGFzcyk7XG5cbmRlZiBEQk89cHJvcGVydGllc1snaXNjaGVtYS5kYm8uaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpXG5kZWYgT1BBQT1wcm9wZXJ0aWVzWydpc2NoZW1hLmFhLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuLy9BdHRyaWJ1dGUgSURzXG5kZWYgUkFURV9UT1RBTF9BTU9VTlRfU1VQUExJRVI9cHJvcGVydGllc1snaWJvai5vblNpdGVSYXRlUmVwb3J0LnRvdFN1cHBsaWVyLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuZGVmIFJBVEVfVE9UQUxfQU1PVU5UX0NVU1RPTUVSPXByb3BlcnRpZXNbJ2lib2oub25TaXRlUmF0ZVJlcG9ydC50b3RDdXN0b21lci5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKClcbmRlZiBDT01QT05FTlRfVE9UQUxfQU1PVU5UX1NVUFBMSUVSPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdFN1cHAuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpXG5kZWYgQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9DVVNUT01FUj1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RDdXN0LmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuXG5kZWYgQ09NUE9ORU5UX05BTUU9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQubmFtZS5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKClcbmRlZiBDT01QT05FTlRfSEFSRFdBUkVfUkVGPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmhhcmR3YXJlUmVmLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuZGVmIENPTVBPTkVOVF9TQVA9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2FwLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuZGVmIENPTVBPTkVOVF9TVVBQTElFRF9CWV9GQUFDPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnN1cHBsaWVkQnlGYWFjLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuZGVmIENPTVBPTkVOVF9RVUFOVElUWT1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5xdWFudGl0eS5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKClcbmRlZiBDT01QT05FTlRfUVVPVEVfUkVRVUlSRUQ9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQucXVvdGVSZXF1aXJlZC5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKClcbmRlZiBDT01QT05FTlRfU1VQUExJRVJfUVVPVEVfVE9fRkFBQz1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zdXBwbGllclF1b3RlLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuZGVmIENPTVBPTkVOVF9GQUFDX1FVT1RFX1RPX0NVU1RPTUVSPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmN1c3RvbWVyUXVvdGUuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpXG5kZWYgQ09NUE9ORU5UX0FQUExJRURfVE89cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYXBwbGllZFRvLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuZGVmIENPTVBPTkVOVF9NQVRFUklBTF9SRUY9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpXG5kZWYgQ09NUE9ORU5UX0FDQ09VTlRJTkdfU1VQUExJRVJfTUFURVJJQUxfUkVGPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFjY291bnRpbmdTdXBwTWF0UmVmLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuZGVmIENPTVBPTkVOVF9BQ0NPVU5USU5HX0NVU1RPTUVSX01BVEVSSUFMX1JFRj1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hY2NvdW50aW5nQ3VzdE1hdFJlZi5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKClcbmRlZiBDT01QT05FTlRfRlJPTV9RVU9URV9US1Q9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZnJvbVF1b3RlVGt0LmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuZGVmIENPTVBPTkVOVF9ERUxFVEVEPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmRlbGV0ZWQuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpXG4gICAgXG4vL09ialR5cGUgSURzXG5kZWYgQ09NUE9ORU5UPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50J10udG9TdHJpbmcoKS50b0ludGVnZXIoKVxuXG5cbi8qQ3VzdG9tZmllbGRzKi9cbmRlZiBxdW90ZVJlcE1hdGVyaWFscyA9IENvbXBvbmVudEFjY2Vzc29yLmdldEN1c3RvbUZpZWxkTWFuYWdlcigpLmdldEN1c3RvbUZpZWxkT2JqZWN0c0J5TmFtZShwcm9wZXJ0aWVzWydjZi5xdW90ZU1hdGVyaWFscyddLnRvU3RyaW5nKCkpWzBdXG5kZWYgcmVwTWF0ZXJpYWxzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnJlcGxhY2VkTWF0ZXJpYWxzJ10udG9TdHJpbmcoKSlbMF1cblxuZGVmIG1pID0gKE11dGFibGVJc3N1ZSkgaXNzdWVcbmRlZiBjdXJyZW50VXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKVxuXG4vKlZhcmlhYmxlcyovXG5kZWYgcmVwTWF0TGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocXVvdGVSZXBNYXRlcmlhbHMpXG5kZWYgb2JqTGlzdCA9IG5ldyBBcnJheUxpc3QoKVxuXG5mb3IobWF0IGluIHJlcE1hdExpc3Qpe1xuXHQvL2V4dHJhY3QgaW5zaWdodCBrZXkgYW5kIGdldCBvYmplY3RcbiAgICBkZWYgY29tcG9uZW50PW1hdC50b1N0cmluZygpXG4gICAgZGVmIGNvbXBvbmVudEtleSA9IGNvbXBvbmVudC5zdWJzdHJpbmcoY29tcG9uZW50LmluZGV4T2YoJygnKSsxLGNvbXBvbmVudC5pbmRleE9mKCcpJykpXG4gICAgZGVmIGNvbXBvbmVudE9iamVjdCA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QmVhbihjb21wb25lbnRLZXkpXG4gICAgXG4gICAgZGVmIG5ld09iakF0dHJpYnV0ZXNMaXN0ID0gbmV3IEFycmF5TGlzdCgpXG4gICAgZGVmIGkgPSAwXG4gICAgXG4gICAgZGVmIG9iamVjdFR5cGVDb21wb25lbnQgPSBvYmplY3RUeXBlRmFjYWRlLmxvYWRPYmplY3RUeXBlQmVhbihDT01QT05FTlQpO1xuICAgIC8qIENyZWF0ZSBhIG5ldyB1bnNhdmVkIG9iamVjdCBiZWFuICovXG4gICAgZGVmIG5ld09iamVjdEJlYW4gPSBvYmplY3RUeXBlQ29tcG9uZW50LmNyZWF0ZU9iamVjdEJlYW4oKTtcblxuICAgIC8qIFNldCB1cCB0aGUgYXR0cmlidXRlIGxpc3QgKi9cbiAgICBkZWYgb2JqZWN0QXR0cmlidXRlQmVhbnMgPSBuZXcgQXJyYXlMaXN0KCk7XG5cbiAgICAvKiBTZXQgdGhlIG5hbWUgb2YgdGhlIENvbXBvbmVudCAqL1xuICAgIC8qTm9tZSBDb21wb25lbnQqL1xuICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5uYW1lJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpXG5cdGRlZiBjb21wTmFtZSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRjb21wTmFtZT1jb21wTmFtZVswXS5nZXRWYWx1ZSgpXG4gICAgbG9nLmRlYnVnIFwib2JqZWN0IG5hbWU6IFwiICsgY29tcE5hbWVcbiAgICBkZWYgbmFtZU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX05BTUUpOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSBcIk5hbWVcIlxuICAgIGRlZiBuYW1lT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihuYW1lT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0XG4gICAgZGVmIG5hbWVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBuYW1lT2JqZWN0QXR0cmlidXRlQmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4oKTsgLy8gVGhpcyBpcyB0aGUgYWN0dWFsIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGVcbiAgICBuYW1lT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFRleHRWYWx1ZVNob3J0KGNvbXBOYW1lKTsgLy8gU2V0IHRoZSBuYW1lXG5cbiAgICBkZWYgdmFsdWVzID0gbmFtZU9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICB2YWx1ZXMuYWRkKG5hbWVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlXG5cdGxvZy5kZWJ1ZyB2YWx1ZXNcbiAgICBuYW1lT2JqZWN0QXR0cmlidXRlQmVhbi5zZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKHZhbHVlcyk7IFxuXHRvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQobmFtZU9iamVjdEF0dHJpYnV0ZUJlYW4pO1xuICAgIFxuICAgIC8qIFNldCB0aGUgSEFSRFdBUkVfUkVGIG9mIHRoZSBuZXcgb2JqICovXG4gICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmhhcmR3YXJlUmVmJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpXG5cdGRlZiBodyA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRod0tleT1od1swXS5nZXRWYWx1ZSgpICAgIFxuICAgIGRlZiBId1JlZk9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX0hBUkRXQVJFX1JFRik7IC8vIFRoZSBJRCBmb3IgdGhlIHJlZmVyZW5jZWQgb2JqZWN0IHR5cGVcbiAgICBId1JlZk9iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4oSHdSZWZPYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IFxuICAgIEh3UmVmT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuID0gSHdSZWZPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZVxuICAgIEh3UmVmT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFJlZmVyZW5jZWRPYmplY3RCZWFuSWQoaHdLZXkpOyAvLyBTZXQgdGhlIElEXG5cbiAgICB2YWx1ZXMgPSBId1JlZk9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICB2YWx1ZXMuYWRkKEh3UmVmT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZVxuXHRsb2cuZGVidWcgdmFsdWVzXG4gICAgSHdSZWZPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgXG5cbiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQoSHdSZWZPYmplY3RBdHRyaWJ1dGVCZWFuKTsgLy8gQWRkIHRvIHRoZSBsaXN0IG9mIG9iamVjdCBhdHRyaWJ1dGVzXG5cbiAgICAvKiBTZXQgdGhlIENPTVBPTkVOVF9TQVAgZmxhZyBvZiB0aGUgSGFyZHdhcmUgKi9cbiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuc2FwJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpXG5cdGRlZiBzYXAgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcblx0c2FwPXNhcFswXS5nZXRWYWx1ZSgpXG4gICAgZGVmIGNvbXBTYXBPYmplY3RUeXBlQXR0cmlidXRlQmVhbiA9IG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKENPTVBPTkVOVF9TQVApOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSBcIkRJU0FCTEVEXCJcbiAgICBkZWYgY29tcFNhcE9iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcFNhcE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdFxuICAgIGRlZiBjb21wU2FwT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuID0gY29tcFNhcE9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlXG4gICAgY29tcFNhcE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXRCb29sZWFuVmFsdWUoc2FwKTsgLy8gU2V0IHRoZSBuYW1lXG5cbiAgICB2YWx1ZXMgPSBjb21wU2FwT2JqZWN0QXR0cmlidXRlQmVhbi5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCk7IFxuICAgIHZhbHVlcy5hZGQoY29tcFNhcE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGVcblx0bG9nLmRlYnVnIHZhbHVlc1xuICAgIGNvbXBTYXBPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgXG5cdG9iamVjdEF0dHJpYnV0ZUJlYW5zLmFkZChjb21wU2FwT2JqZWN0QXR0cmlidXRlQmVhbik7XG4gICAgXG4gICAgLyogU2V0IHRoZSBERUxFVEVEIGZsYWcgb2YgdGhlIEhhcmR3YXJlICovXG4gICAgZGVmIGRlbGV0ZWQgXG4gICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkpe1xuICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuXHRcdGRlbGV0ZWQgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcbiAgICAgICAgZGVsZXRlZD1kZWxldGVkWzBdLmdldFZhbHVlKClcbiAgICB9XG4gICAgaWYoZGVsZXRlZCE9bnVsbCl7XG4gICAgICAgIGRlZiBkZWxldGVkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4gPSBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlLmxvYWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbihDT01QT05FTlRfREVMRVRFRCk7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlIFwiRElTQUJMRURcIlxuICAgICAgICBkZWYgZGVsZXRlZE9iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4oZGVsZXRlZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdFxuICAgICAgICBkZWYgZGVsZXRlZE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGRlbGV0ZWRPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZVxuICAgICAgICBkZWxldGVkT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldEJvb2xlYW5WYWx1ZShkZWxldGVkKTsgLy8gU2V0IHRoZSBuYW1lXG5cbiAgICAgICAgdmFsdWVzID0gZGVsZXRlZE9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICAgICAgdmFsdWVzLmFkZChkZWxldGVkT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZVxuXHRcdGxvZy5kZWJ1ZyB2YWx1ZXNcbiAgICAgICAgZGVsZXRlZE9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyBcbiAgICAgICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKGRlbGV0ZWRPYmplY3RBdHRyaWJ1dGVCZWFuKTtcbiAgICB9XG4gICAgICAgICBcbiAgICAvKk5vbWUgQ09NUE9ORU5UX1FVQU5USVRZKi9cbiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQucXVhbnRpdHknXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKClcblx0ZGVmIHF0YSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRxdGE9cXRhWzBdLmdldFZhbHVlKClcbiAgICBkZWYgcXRhT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4gPSBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlLmxvYWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbihDT01QT05FTlRfUVVBTlRJVFkpOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSBcIkRJU0FCTEVEXCJcbiAgICBkZWYgcXRhT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihxdGFPYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IC8vIFRoaXMgaXMgdGhlIG5hbWUgb2JqZWN0IGF0dHJpYnV0ZSBmb3IgdGhlIG5ldyBvYmplY3RcbiAgICBkZWYgcXRhT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuID0gcXRhT2JqZWN0QXR0cmlidXRlQmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4oKTsgLy8gVGhpcyBpcyB0aGUgYWN0dWFsIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGVcbiAgICBxdGFPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0RG91YmxlVmFsdWUocXRhKTsgLy8gU2V0IHRoZSBuYW1lXG5cbiAgICB2YWx1ZXMgPSBxdGFPYmplY3RBdHRyaWJ1dGVCZWFuLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsgXG4gICAgdmFsdWVzLmFkZChxdGFPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlXG5cdGxvZy5kZWJ1ZyB2YWx1ZXNcbiAgICBxdGFPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgXG4gICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKHF0YU9iamVjdEF0dHJpYnV0ZUJlYW4pO1xuICAgIFxuXHQvKk5vbWUgQ09NUE9ORU5UX1FVT1RFX1JFUVVJUkVEKi9cbiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQucXVvdGVSZXF1aXJlZCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuXHRkZWYgcXVvdGVSZXEgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcblx0cXVvdGVSZXE9cXVvdGVSZXFbMF0uZ2V0VmFsdWUoKVxuICAgIGRlZiBxdW90ZVJlcU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX1FVT1RFX1JFUVVJUkVEKTsgLy8gVGhlIElEIG9mIHRoZSBvYmplY3QgdHlwZSBhdHRyaWJ1dGUgXCJESVNBQkxFRFwiXG4gICAgZGVmIHF1b3RlUmVxT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihxdW90ZVJlcU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdFxuICAgIGRlZiBxdW90ZVJlcU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IHF1b3RlUmVxT2JqZWN0QXR0cmlidXRlQmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4oKTsgLy8gVGhpcyBpcyB0aGUgYWN0dWFsIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGVcbiAgICBxdW90ZVJlcU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXRCb29sZWFuVmFsdWUocXVvdGVSZXEpOyAvLyBTZXQgdGhlIG5hbWVcblxuICAgIHZhbHVlcyA9IHF1b3RlUmVxT2JqZWN0QXR0cmlidXRlQmVhbi5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCk7IFxuICAgIHZhbHVlcy5hZGQocXVvdGVSZXFPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlXG5cdGxvZy5kZWJ1ZyB2YWx1ZXNcbiAgICBxdW90ZVJlcU9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyBcbiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQocXVvdGVSZXFPYmplY3RBdHRyaWJ1dGVCZWFuKTtcbiAgICBcbiAgICAvKk5vbWUgQ09NUE9ORU5UX1NVUFBMSUVSX1FVT1RFX1RPX0ZBQUMqL1xuICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zdXBwUXVvdGUnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKClcblx0ZGVmIHN1cHBRdW90ZSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRzdXBwUXVvdGU9c3VwcFF1b3RlWzBdLmdldFZhbHVlKClcbiAgICBkZWYgc3VwcFF1b3RlT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4gPSBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlLmxvYWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbihDT01QT05FTlRfU1VQUExJRVJfUVVPVEVfVE9fRkFBQyk7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlIFwiRElTQUJMRURcIlxuICAgIGRlZiBzdXBwUXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuID0gbmV3T2JqZWN0QmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVCZWFuKHN1cHBRdW90ZU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdFxuICAgIGRlZiBzdXBwUXVvdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBzdXBwUXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZVxuICAgIHN1cHBRdW90ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXREb3VibGVWYWx1ZShzdXBwUXVvdGUpOyAvLyBTZXQgdGhlIG5hbWVcblxuICAgIHZhbHVlcyA9IHN1cHBRdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICB2YWx1ZXMuYWRkKHN1cHBRdW90ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGVcblx0bG9nLmRlYnVnIHZhbHVlc1xuICAgIHN1cHBRdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyBcbiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQoc3VwcFF1b3RlT2JqZWN0QXR0cmlidXRlQmVhbik7XG4gICBcdFxuXHQvKk5vbWUgQ09NUE9ORU5UX0ZBQUNfUVVPVEVfVE9fQ1VTVE9NRVIqL1xuICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5jdXN0UXVvdGUnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKClcblx0ZGVmIGN1c3RRdW90ZSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRjdXN0UXVvdGU9Y3VzdFF1b3RlWzBdLmdldFZhbHVlKClcbiAgICBkZWYgY3VzdFF1b3RlT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4gPSBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlLmxvYWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbihDT01QT05FTlRfRkFBQ19RVU9URV9UT19DVVNUT01FUik7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlIFwiRElTQUJMRURcIlxuICAgIGRlZiBjdXN0UXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuID0gbmV3T2JqZWN0QmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVCZWFuKGN1c3RRdW90ZU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdFxuICAgIGRlZiBjdXN0UXVvdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBjdXN0UXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZVxuICAgIGN1c3RRdW90ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXREb3VibGVWYWx1ZShjdXN0UXVvdGUpOyAvLyBTZXQgdGhlIG5hbWVcblxuICAgIHZhbHVlcyA9IGN1c3RRdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICB2YWx1ZXMuYWRkKGN1c3RRdW90ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGVcblx0bG9nLmRlYnVnIHZhbHVlc1xuICAgIGN1c3RRdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyBcbiAgIFx0b2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKGN1c3RRdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4pO1xuXG5cdC8qTm9tZSBDT01QT05FTlRfQVBQTElFRF9UTyovXG4gICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuXHRkZWYgYXBwbGllZFRvID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpXG5cdGFwcGxpZWRUbz1hcHBsaWVkVG9bMF0uZ2V0VmFsdWUoKVxuICAgIGRlZiBhcHBsaWVkVG9PYmplY3RUeXBlQXR0cmlidXRlQmVhbiA9IG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKENPTVBPTkVOVF9BUFBMSUVEX1RPKTsgLy8gVGhlIElEIG9mIHRoZSBvYmplY3QgdHlwZSBhdHRyaWJ1dGUgXCJESVNBQkxFRFwiXG4gICAgZGVmIGFwcGxpZWRUb09iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4oYXBwbGllZFRvT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0XG4gICAgZGVmIGFwcGxpZWRUb09iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGFwcGxpZWRUb09iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlXG4gICAgYXBwbGllZFRvT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFRleHRWYWx1ZShhcHBsaWVkVG8pOyAvLyBTZXQgdGhlIG5hbWVcblxuICAgIHZhbHVlcyA9IGFwcGxpZWRUb09iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICB2YWx1ZXMuYWRkKGFwcGxpZWRUb09iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGVcblx0bG9nLmRlYnVnIHZhbHVlc1xuICAgIGFwcGxpZWRUb09iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyBcbiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQoYXBwbGllZFRvT2JqZWN0QXR0cmlidXRlQmVhbik7XG5cdFxuICAgIFxuXHQvKk5vbWUgQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9TVVBQTElFUiovXG4gICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdFN1cHAnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKClcblx0ZGVmIHRvdFN1cHAgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcblx0dG90U3VwcD10b3RTdXBwWzBdLmdldFZhbHVlKClcbiAgICBkZWYgdG90U3VwcE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9TVVBQTElFUik7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlIFwiRElTQUJMRURcIlxuICAgIGRlZiB0b3RTdXBwT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbih0b3RTdXBwT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0XG4gICAgZGVmIHRvdFN1cHBPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSB0b3RTdXBwT2JqZWN0QXR0cmlidXRlQmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4oKTsgLy8gVGhpcyBpcyB0aGUgYWN0dWFsIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGVcbiAgICB0b3RTdXBwT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldERvdWJsZVZhbHVlKHRvdFN1cHApOyAvLyBTZXQgdGhlIG5hbWVcblxuICAgIHZhbHVlcyA9IHRvdFN1cHBPYmplY3RBdHRyaWJ1dGVCZWFuLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsgXG4gICAgdmFsdWVzLmFkZCh0b3RTdXBwT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZVxuXHRsb2cuZGVidWcgdmFsdWVzXG4gICAgdG90U3VwcE9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyBcbiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQodG90U3VwcE9iamVjdEF0dHJpYnV0ZUJlYW4pO1xuXHRcblx0LypOb21lIENPTVBPTkVOVF9UT1RBTF9BTU9VTlRfQ1VTVE9NRVIqL1xuICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC50b3RDdXN0J10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpXG5cdGRlZiB0b3RDdXN0ID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpXG5cdHRvdEN1c3Q9dG90Q3VzdFswXS5nZXRWYWx1ZSgpXG4gICAgZGVmIHRvdEN1c3RPYmplY3RUeXBlQXR0cmlidXRlQmVhbiA9IG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKENPTVBPTkVOVF9UT1RBTF9BTU9VTlRfQ1VTVE9NRVIpOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSBcIkRJU0FCTEVEXCJcbiAgICBkZWYgdG90Q3VzdE9iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4odG90Q3VzdE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdFxuICAgIGRlZiB0b3RDdXN0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuID0gdG90Q3VzdE9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlXG4gICAgdG90Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXREb3VibGVWYWx1ZSh0b3RDdXN0KTsgLy8gU2V0IHRoZSBuYW1lXG5cbiAgICB2YWx1ZXMgPSB0b3RDdXN0T2JqZWN0QXR0cmlidXRlQmVhbi5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCk7IFxuICAgIHZhbHVlcy5hZGQodG90Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGVcblx0bG9nLmRlYnVnIHZhbHVlc1xuICAgIHRvdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgXG4gICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKHRvdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuKTtcbiBcblx0LypOb21lIENPTVBPTkVOVF9NQVRFUklBTF9SRUYqL1xuICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5tYXRlcmlhbFJlZiddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuXHRkZWYgbWF0ZXJpYWwgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcblx0bWF0ZXJpYWw9bWF0ZXJpYWxbMF0uZ2V0VmFsdWUoKVxuICAgIGRlZiBtYXRSZWZPYmplY3RUeXBlQXR0cmlidXRlQmVhbiA9IG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKENPTVBPTkVOVF9NQVRFUklBTF9SRUYpOyAvLyBUaGUgSUQgZm9yIHRoZSByZWZlcmVuY2VkIG9iamVjdCB0eXBlXG4gICAgbWF0UmVmT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihtYXRSZWZPYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IFxuICAgIG1hdFJlZk9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IG1hdFJlZk9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlXG4gICAgbWF0UmVmT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFJlZmVyZW5jZWRPYmplY3RCZWFuSWQobWF0ZXJpYWwpOyAvLyBTZXQgdGhlIElEXG5cbiAgICB2YWx1ZXMgPSBtYXRSZWZPYmplY3RBdHRyaWJ1dGVCZWFuLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsgXG4gICAgdmFsdWVzLmFkZChtYXRSZWZPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlXG5cdGxvZy5kZWJ1ZyB2YWx1ZXNcbiAgICBtYXRSZWZPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgXG5cbiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQobWF0UmVmT2JqZWN0QXR0cmlidXRlQmVhbik7IC8vIEFkZCB0byB0aGUgbGlzdCBvZiBvYmplY3QgYXR0cmlidXRlc1xuICAgICAgICBcbiAgICBcbiAgICBkZWYgbWF0ZXJpYWxTQVAgICAgICAgXG5cdGlmIChtYXRlcmlhbCE9bnVsbCl7XG4gICAgICAgIC8qTUFURVJJQUwgLSBTQVAqL1xuICAgICAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihtYXRlcmlhbC50b0ludGVnZXIoKSwgcHJvcGVydGllc1snaW9iai5tYXRlcmlhbC5zYXAnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKClcbiAgICAgICAgbWF0ZXJpYWxTQVAgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKClcbiAgICAgICAgbWF0ZXJpYWxTQVAgPSBtYXRlcmlhbFNBUFswXS5nZXRWYWx1ZSgpXG4gICAgICAgIGxvZy5kZWJ1ZyBcIm1hdGVyaWFsU0FQOiBcIiArIG1hdGVyaWFsU0FQXG4gICAgfVxuICAgICAgICAgICAgXG5cdC8qTm9tZSBDT01QT05FTlRfU1VQUExJRURfQllfRkFBQyovXG4gICAgZGVmIHN1cHBsaWVkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4gPSBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlLmxvYWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbihDT01QT05FTlRfU1VQUExJRURfQllfRkFBQyk7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlIFwiRElTQUJMRURcIlxuICAgIGRlZiBzdXBwbGllZE9iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4oc3VwcGxpZWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IC8vIFRoaXMgaXMgdGhlIG5hbWUgb2JqZWN0IGF0dHJpYnV0ZSBmb3IgdGhlIG5ldyBvYmplY3RcbiAgICBkZWYgc3VwcGxpZWRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBzdXBwbGllZE9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlXG5cdGlmKG1hdGVyaWFsU0FQPT10cnVlKXtcbiAgICBcdHN1cHBsaWVkT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFRleHRWYWx1ZShcIlllc1wiKTsgLy8gU2V0IHRoZSBuYW1lXG4gICAgfWVsc2V7XG4gICAgICAgIHN1cHBsaWVkT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFRleHRWYWx1ZShcIk5vXCIpOyAvLyBTZXQgdGhlIG5hbWVcbiAgICB9XG5cbiAgICB2YWx1ZXMgPSBzdXBwbGllZE9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICB2YWx1ZXMuYWRkKHN1cHBsaWVkT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZVxuXHRsb2cuZGVidWcgdmFsdWVzXG4gICAgc3VwcGxpZWRPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgXG4gICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKHN1cHBsaWVkT2JqZWN0QXR0cmlidXRlQmVhbik7XG4gICAgXG4gICAgLypOb21lIEFDQ09VTlRJTkdfU1VQUExJRVJfTUFURVJJQUxfUkVGKi9cbiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYWNjb3VudGluZ1N1cHBNYXRlcmlhbCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuXHRkZWYgYWNjTWF0U3VwcCA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRhY2NNYXRTdXBwPWFjY01hdFN1cHBbMF0uZ2V0VmFsdWUoKVxuICAgIGRlZiBhY2NvdW50aW5nQ3VzdFJlZk9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX0FDQ09VTlRJTkdfU1VQUExJRVJfTUFURVJJQUxfUkVGKTsgLy8gVGhlIElEIGZvciB0aGUgcmVmZXJlbmNlZCBvYmplY3QgdHlwZVxuICAgIGFjY291bnRpbmdDdXN0UmVmT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihhY2NvdW50aW5nQ3VzdFJlZk9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgXG4gICAgYWNjb3VudGluZ0N1c3RSZWZPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBhY2NvdW50aW5nQ3VzdFJlZk9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlXG4gICAgYWNjb3VudGluZ0N1c3RSZWZPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0UmVmZXJlbmNlZE9iamVjdEJlYW5JZChhY2NNYXRTdXBwKTsgLy8gU2V0IHRoZSBJRFxuXG4gICAgdmFsdWVzID0gYWNjb3VudGluZ0N1c3RSZWZPYmplY3RBdHRyaWJ1dGVCZWFuLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsgXG4gICAgdmFsdWVzLmFkZChhY2NvdW50aW5nQ3VzdFJlZk9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGVcblx0bG9nLmRlYnVnIHZhbHVlc1xuICAgIGFjY291bnRpbmdDdXN0UmVmT2JqZWN0QXR0cmlidXRlQmVhbi5zZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKHZhbHVlcyk7IFxuXG4gICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKGFjY291bnRpbmdDdXN0UmVmT2JqZWN0QXR0cmlidXRlQmVhbik7IC8vIEFkZCB0byB0aGUgbGlzdCBvZiBvYmplY3QgYXR0cmlidXRlc1xuICAgIFxuXHQvKk5vbWUgQ09NUE9ORU5UX0FDQ09VTlRJTkdfQ1VTVE9NRVJfTUFURVJJQUxfUkVGKi9cbiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYWNjb3VudGluZ0N1c3RNYXRlcmlhbCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKVxuXHRkZWYgYWNjTWF0Q3VzdCA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKVxuXHRhY2NNYXRDdXN0PWFjY01hdEN1c3RbMF0uZ2V0VmFsdWUoKVxuICAgIGRlZiBhY2NNYXRDdXN0T2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4gPSBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlLmxvYWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbihDT01QT05FTlRfQUNDT1VOVElOR19DVVNUT01FUl9NQVRFUklBTF9SRUYpOyAvLyBUaGUgSUQgZm9yIHRoZSByZWZlcmVuY2VkIG9iamVjdCB0eXBlXG4gICAgYWNjTWF0Q3VzdE9iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4oYWNjTWF0Q3VzdE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgXG4gICAgYWNjTWF0Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGFjY01hdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZVxuICAgIGFjY01hdEN1c3RPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0UmVmZXJlbmNlZE9iamVjdEJlYW5JZChhY2NNYXRDdXN0KTsgLy8gU2V0IHRoZSBJRFxuXG4gICAgdmFsdWVzID0gYWNjTWF0Q3VzdE9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICB2YWx1ZXMuYWRkKGFjY01hdEN1c3RPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlXG5cdGxvZy5kZWJ1ZyB2YWx1ZXNcbiAgICBhY2NNYXRDdXN0T2JqZWN0QXR0cmlidXRlQmVhbi5zZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKHZhbHVlcyk7IFxuXG4gICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKGFjY01hdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuKTsgLy8gQWRkIHRvIHRoZSBsaXN0IG9mIG9iamVjdCBhdHRyaWJ1dGVzXG4gICAgICAgIFxuXHQvKk5vbWUgQ09NUE9ORU5UX0ZST01fUVVPVEVfVEtUKi9cblx0ZGVmIGZyb21RdW90ZU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX0ZST01fUVVPVEVfVEtUKTsgLy8gVGhlIElEIG9mIHRoZSBvYmplY3QgdHlwZSBhdHRyaWJ1dGUgXCJESVNBQkxFRFwiXG4gICAgZGVmIGZyb21RdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4oZnJvbVF1b3RlT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0XG4gICAgZGVmIGZyb21RdW90ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGZyb21RdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlXG4gICAgaWYobWF0ZXJpYWxTQVA9PXRydWUpe1xuICAgICAgICBmcm9tUXVvdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0Qm9vbGVhblZhbHVlKHRydWUpOyAvLyBTZXQgdGhlIG5hbWVcbiAgICB9ZWxzZXtcbiAgICAgICAgZnJvbVF1b3RlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldEJvb2xlYW5WYWx1ZShmYWxzZSk7IC8vIFNldCB0aGUgbmFtZVxuICAgIH1cblxuICAgIHZhbHVlcyA9IGZyb21RdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyBcbiAgICB2YWx1ZXMuYWRkKGZyb21RdW90ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGVcblx0bG9nLmRlYnVnIHZhbHVlc1xuICAgIGZyb21RdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyBcbiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQoZnJvbVF1b3RlT2JqZWN0QXR0cmlidXRlQmVhbik7XG4gICAgXG4gICAgbG9nLmRlYnVnIFwib2JqZWN0QXR0cmlidXRlQmVhbnM6IFwiICsgb2JqZWN0QXR0cmlidXRlQmVhbnNcbiAgICAvKiBTZXQgYWxsIG9iamVjdCBhdHRyaWJ1dGVzIHRvIHRoZSBvYmplY3QgKi9cbiAgICBuZXdPYmplY3RCZWFuLnNldE9iamVjdEF0dHJpYnV0ZUJlYW5zKG9iamVjdEF0dHJpYnV0ZUJlYW5zKTtcblxuICAgIHRyeSB7XG4gICAgIFx0bmV3T2JqZWN0QmVhbiA9IG9iamVjdEZhY2FkZS5zdG9yZU9iamVjdEJlYW4obmV3T2JqZWN0QmVhbik7XG4gICAgICAgIG9iakxpc3QuYWRkKG5ld09iamVjdEJlYW4pXG4gICAgIFx0bG9nLmRlYnVnKFwibmV3T2JqZWN0QmVhbjogXCIgKyBuZXdPYmplY3RCZWFuKTtcbiAgICB9IGNhdGNoIChFeGNlcHRpb24gdmllKSB7XG4gICAgIFx0bG9nLndhcm4oXCJDb3VsZCBub3QgY3JlYXRlIGlzc3VlIGR1ZSB0byB2YWxpZGF0aW9uIGV4Y2VwdGlvbjpcIiArIHZpZS5nZXRNZXNzYWdlKCkpO1xuICAgIH1cbiAgICBcbn1cblxubWkuc2V0Q3VzdG9tRmllbGRWYWx1ZShyZXBNYXRlcmlhbHMsIG9iakxpc3QpO1xuQ29tcG9uZW50QWNjZXNzb3IuZ2V0SXNzdWVNYW5hZ2VyKCkudXBkYXRlSXNzdWUoY3VycmVudFVzZXIsIG1pLCBFdmVudERpc3BhdGNoT3B0aW9uLkRPX05PVF9ESVNQQVRDSCwgZmFsc2UpO1xuICAgICAgICAgICIsInNjcmlwdFBhdGgiOm51bGwsInBhcmFtZXRlcnMiOnt9fQ==</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">YCFgaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZQppbXBvcnQgY29tLm9wZW5zeW1waG9ueS53b3JrZmxvdy5JbnZhbGlkSW5wdXRFeGNlcHRpb24KaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb21wb25lbnQuQ29tcG9uZW50QWNjZXNzb3IKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Jc3N1ZU1hbmFnZXIKaW1wb3J0IG9yZy5hcGFjaGUubG9nNGouQ2F0ZWdvcnkKaW1wb3J0IGdyb292eS5qc29uLkpzb25CdWlsZGVyCmltcG9ydCBncm9vdnkuanNvbi5Kc29uU2x1cnBlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uU3RyZWFtaW5nSnNvbkJ1aWxkZXIKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5jb25maWcudXRpbC5KaXJhSG9tZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLk11dGFibGVJc3N1ZQppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmV2ZW50LnR5cGUuRXZlbnREaXNwYXRjaE9wdGlvbgppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQKaW1wb3J0IGphdmEudGV4dC5QYXJzZUV4Y2VwdGlvbgppbXBvcnQgamF2YS50ZXh0LkRlY2ltYWxGb3JtYXQKaW1wb3J0IGNvbS5hdGxhc3NpYW4uamlyYS5pc3N1ZS5Nb2RpZmllZFZhbHVlCmltcG9ydCBjb20uYXRsYXNzaWFuLmppcmEuaXNzdWUudXRpbC5Jc3N1ZUNoYW5nZUhvbGRlcgppbXBvcnQgY29tLmF0bGFzc2lhbi5qaXJhLmlzc3VlLnV0aWwuRGVmYXVsdElzc3VlQ2hhbmdlSG9sZGVyCgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lcgppbXBvcnQgY29tLm9ucmVzb2x2ZS5zY3JpcHRydW5uZXIucnVubmVyLlNjcmlwdFJ1bm5lckltcGwKClByb3BlcnRpZXMgcHJvcGVydGllcyA9IG5ldyBQcm9wZXJ0aWVzKCkKRmlsZSBwcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFNjcmlwdFJ1bm5lckltcGwuZ2V0UGx1Z2luQ29tcG9uZW50KFNjcmlwdFJ1bm5lcikuZ2V0Um9vdHNGb3JEaXNwbGF5KCkgKyAnL29wcHJvamVjdC5wcm9wZXJ0aWVzJykKcHJvcGVydGllc0ZpbGUud2l0aElucHV0U3RyZWFtIHsKCXByb3BlcnRpZXMubG9hZChpdCkKfQpkZWYgQ2F0ZWdvcnkgbG9nID0gQ2F0ZWdvcnkuZ2V0SW5zdGFuY2UoImNvbS5vbnJlc29sdmUuamlyYS5ncm9vdnkuUG9zdEZ1bmN0aW9uIikKbG9nLnNldExldmVsKG9yZy5hcGFjaGUubG9nNGouTGV2ZWwuREVCVUcpCgovKlNjcmlwdCBWYXJpYWJsZXMqLwovL1BlciBQb3N0IEZ1bmN0aW9uCmlzc3VlID0gaXNzdWUKLy9QZXIgdGVzdCBkYSBjb25zb2xlCi8vSXNzdWVNYW5hZ2VyIGlzc3VlTWFuYWdlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpCi8vaXNzdWUgPSBpc3N1ZU1hbmFnZXIuZ2V0SXNzdWVCeUtleUlnbm9yZUNhc2UoIk9QVVQtMzM4MiIpCgovKkluc2lnaHQgY2xhc3NlcyAmIGNvbXBvbmVudHMqLwpDbGFzcyBvYmplY3RGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdEZhY2FkZSIpOyAgCkNsYXNzIG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGVDbGFzcyA9IENvbXBvbmVudEFjY2Vzc29yLmdldFBsdWdpbkFjY2Vzc29yKCkuZ2V0Q2xhc3NMb2FkZXIoKS5maW5kQ2xhc3MoImNvbS5yaWFkYWxhYnMuamlyYS5wbHVnaW5zLmluc2lnaHQuY2hhbm5lbC5leHRlcm5hbC5hcGkuZmFjYWRlLk9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUiKTsKb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlQ2xhc3MpOwpvYmplY3RGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUob2JqZWN0RmFjYWRlQ2xhc3MpOwovKiBHZXQgSW5zaWdodCBJUUwgRmFjYWRlIGZyb20gcGx1Z2luIGFjY2Vzc29yICovCkNsYXNzIGlxbEZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuSVFMRmFjYWRlIik7IAppcWxGYWNhZGUgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRPU0dpQ29tcG9uZW50SW5zdGFuY2VPZlR5cGUoaXFsRmFjYWRlQ2xhc3MpOwpDbGFzcyBvYmplY3RBdHRyaWJ1dGVCZWFuRmFjdG9yeUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5zZXJ2aWNlcy5tb2RlbC5mYWN0b3J5Lk9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Iik7Cm9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5ID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0T1NHaUNvbXBvbmVudEluc3RhbmNlT2ZUeXBlKG9iamVjdEF0dHJpYnV0ZUJlYW5GYWN0b3J5Q2xhc3MpOwovKiBHZXQgSW5zaWdodCBPYmplY3QgVHlwZSBGYWNhZGUgZnJvbSBwbHVnaW4gYWNjZXNzb3IgKi8KQ2xhc3Mgb2JqZWN0VHlwZUZhY2FkZUNsYXNzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0UGx1Z2luQWNjZXNzb3IoKS5nZXRDbGFzc0xvYWRlcigpLmZpbmRDbGFzcygiY29tLnJpYWRhbGFicy5qaXJhLnBsdWdpbnMuaW5zaWdodC5jaGFubmVsLmV4dGVybmFsLmFwaS5mYWNhZGUuT2JqZWN0VHlwZUZhY2FkZSIpOyAKb2JqZWN0VHlwZUZhY2FkZSA9IENvbXBvbmVudEFjY2Vzc29yLmdldE9TR2lDb21wb25lbnRJbnN0YW5jZU9mVHlwZShvYmplY3RUeXBlRmFjYWRlQ2xhc3MpOwoKZGVmIERCTz1wcm9wZXJ0aWVzWydpc2NoZW1hLmRiby5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKZGVmIE9QQUE9cHJvcGVydGllc1snaXNjaGVtYS5hYS5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKLy9BdHRyaWJ1dGUgSURzCmRlZiBSQVRFX1RPVEFMX0FNT1VOVF9TVVBQTElFUj1wcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90U3VwcGxpZXIuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiBSQVRFX1RPVEFMX0FNT1VOVF9DVVNUT01FUj1wcm9wZXJ0aWVzWydpYm9qLm9uU2l0ZVJhdGVSZXBvcnQudG90Q3VzdG9tZXIuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiBDT01QT05FTlRfVE9UQUxfQU1PVU5UX1NVUFBMSUVSPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdFN1cHAuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiBDT01QT05FTlRfVE9UQUxfQU1PVU5UX0NVU1RPTUVSPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnRvdEN1c3QuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCgpkZWYgQ09NUE9ORU5UX05BTUU9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQubmFtZS5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKZGVmIENPTVBPTkVOVF9IQVJEV0FSRV9SRUY9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuaGFyZHdhcmVSZWYuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiBDT01QT05FTlRfU0FQPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnNhcC5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKZGVmIENPTVBPTkVOVF9TVVBQTElFRF9CWV9GQUFDPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnN1cHBsaWVkQnlGYWFjLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQpkZWYgQ09NUE9ORU5UX1FVQU5USVRZPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnF1YW50aXR5LmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQpkZWYgQ09NUE9ORU5UX1FVT1RFX1JFUVVJUkVEPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnF1b3RlUmVxdWlyZWQuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiBDT01QT05FTlRfU1VQUExJRVJfUVVPVEVfVE9fRkFBQz1wcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zdXBwbGllclF1b3RlLmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQpkZWYgQ09NUE9ORU5UX0ZBQUNfUVVPVEVfVE9fQ1VTVE9NRVI9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuY3VzdG9tZXJRdW90ZSddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKZGVmIENPTVBPTkVOVF9BUFBMSUVEX1RPPXByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFwcGxpZWRUbyddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKZGVmIENPTVBPTkVOVF9NQVRFUklBTF9SRUY9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiBDT01QT05FTlRfQUNDT1VOVElOR19TVVBQTElFUl9NQVRFUklBTF9SRUY9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYWNjb3VudGluZ1N1cHBNYXRSZWYuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiBDT01QT05FTlRfQUNDT1VOVElOR19DVVNUT01FUl9NQVRFUklBTF9SRUY9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYWNjb3VudGluZ0N1c3RNYXRSZWYuaWQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCmRlZiBDT01QT05FTlRfRlJPTV9RVU9URV9US1Q9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZnJvbVF1b3RlVGt0LmlkJ10udG9TdHJpbmcoKS50b0ludGVnZXIoKQpkZWYgQ09NUE9ORU5UX0RFTEVURUQ9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQuZGVsZXRlZC5pZCddLnRvU3RyaW5nKCkudG9JbnRlZ2VyKCkKICAgIAovL09ialR5cGUgSURzCmRlZiBDT01QT05FTlQ9cHJvcGVydGllc1snaW9iai5jb21wb25lbnQnXS50b1N0cmluZygpLnRvSW50ZWdlcigpCgoKLypDdXN0b21maWVsZHMqLwpkZWYgcXVvdGVSZXBNYXRlcmlhbHMgPSBDb21wb25lbnRBY2Nlc3Nvci5nZXRDdXN0b21GaWVsZE1hbmFnZXIoKS5nZXRDdXN0b21GaWVsZE9iamVjdHNCeU5hbWUocHJvcGVydGllc1snY2YucXVvdGVNYXRlcmlhbHMnXS50b1N0cmluZygpKVswXQpkZWYgcmVwTWF0ZXJpYWxzID0gQ29tcG9uZW50QWNjZXNzb3IuZ2V0Q3VzdG9tRmllbGRNYW5hZ2VyKCkuZ2V0Q3VzdG9tRmllbGRPYmplY3RzQnlOYW1lKHByb3BlcnRpZXNbJ2NmLnJlcGxhY2VkTWF0ZXJpYWxzJ10udG9TdHJpbmcoKSlbMF0KCmRlZiBtaSA9IChNdXRhYmxlSXNzdWUpIGlzc3VlCmRlZiBjdXJyZW50VXNlciA9IENvbXBvbmVudEFjY2Vzc29yLmdldEppcmFBdXRoZW50aWNhdGlvbkNvbnRleHQoKS5nZXRMb2dnZWRJblVzZXIoKQoKLypWYXJpYWJsZXMqLwpkZWYgcmVwTWF0TGlzdCA9IGlzc3VlLmdldEN1c3RvbUZpZWxkVmFsdWUocXVvdGVSZXBNYXRlcmlhbHMpCmRlZiBvYmpMaXN0ID0gbmV3IEFycmF5TGlzdCgpCgpmb3IobWF0IGluIHJlcE1hdExpc3QpewoJLy9leHRyYWN0IGluc2lnaHQga2V5IGFuZCBnZXQgb2JqZWN0CiAgICBkZWYgY29tcG9uZW50PW1hdC50b1N0cmluZygpCiAgICBkZWYgY29tcG9uZW50S2V5ID0gY29tcG9uZW50LnN1YnN0cmluZyhjb21wb25lbnQuaW5kZXhPZignKCcpKzEsY29tcG9uZW50LmluZGV4T2YoJyknKSkKICAgIGRlZiBjb21wb25lbnRPYmplY3QgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEJlYW4oY29tcG9uZW50S2V5KQogICAgCiAgICBkZWYgbmV3T2JqQXR0cmlidXRlc0xpc3QgPSBuZXcgQXJyYXlMaXN0KCkKICAgIGRlZiBpID0gMAogICAgCiAgICBkZWYgb2JqZWN0VHlwZUNvbXBvbmVudCA9IG9iamVjdFR5cGVGYWNhZGUubG9hZE9iamVjdFR5cGVCZWFuKENPTVBPTkVOVCk7CiAgICAvKiBDcmVhdGUgYSBuZXcgdW5zYXZlZCBvYmplY3QgYmVhbiAqLwogICAgZGVmIG5ld09iamVjdEJlYW4gPSBvYmplY3RUeXBlQ29tcG9uZW50LmNyZWF0ZU9iamVjdEJlYW4oKTsKCiAgICAvKiBTZXQgdXAgdGhlIGF0dHJpYnV0ZSBsaXN0ICovCiAgICBkZWYgb2JqZWN0QXR0cmlidXRlQmVhbnMgPSBuZXcgQXJyYXlMaXN0KCk7CgogICAgLyogU2V0IHRoZSBuYW1lIG9mIHRoZSBDb21wb25lbnQgKi8KICAgIC8qTm9tZSBDb21wb25lbnQqLwogICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50Lm5hbWUnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKCWRlZiBjb21wTmFtZSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoJY29tcE5hbWU9Y29tcE5hbWVbMF0uZ2V0VmFsdWUoKQogICAgbG9nLmRlYnVnICJvYmplY3QgbmFtZTogIiArIGNvbXBOYW1lCiAgICBkZWYgbmFtZU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX05BTUUpOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSAiTmFtZSIKICAgIGRlZiBuYW1lT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihuYW1lT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0CiAgICBkZWYgbmFtZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IG5hbWVPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgbmFtZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXRUZXh0VmFsdWVTaG9ydChjb21wTmFtZSk7IC8vIFNldCB0aGUgbmFtZQoKICAgIGRlZiB2YWx1ZXMgPSBuYW1lT2JqZWN0QXR0cmlidXRlQmVhbi5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCk7IAogICAgdmFsdWVzLmFkZChuYW1lT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZQoJbG9nLmRlYnVnIHZhbHVlcwogICAgbmFtZU9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyAKCW9iamVjdEF0dHJpYnV0ZUJlYW5zLmFkZChuYW1lT2JqZWN0QXR0cmlidXRlQmVhbik7CiAgICAKICAgIC8qIFNldCB0aGUgSEFSRFdBUkVfUkVGIG9mIHRoZSBuZXcgb2JqICovCiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuaGFyZHdhcmVSZWYnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKCWRlZiBodyA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoJaHdLZXk9aHdbMF0uZ2V0VmFsdWUoKSAgICAKICAgIGRlZiBId1JlZk9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX0hBUkRXQVJFX1JFRik7IC8vIFRoZSBJRCBmb3IgdGhlIHJlZmVyZW5jZWQgb2JqZWN0IHR5cGUKICAgIEh3UmVmT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihId1JlZk9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgCiAgICBId1JlZk9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IEh3UmVmT2JqZWN0QXR0cmlidXRlQmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4oKTsgLy8gVGhpcyBpcyB0aGUgYWN0dWFsIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUKICAgIEh3UmVmT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFJlZmVyZW5jZWRPYmplY3RCZWFuSWQoaHdLZXkpOyAvLyBTZXQgdGhlIElECgogICAgdmFsdWVzID0gSHdSZWZPYmplY3RBdHRyaWJ1dGVCZWFuLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsgCiAgICB2YWx1ZXMuYWRkKEh3UmVmT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZQoJbG9nLmRlYnVnIHZhbHVlcwogICAgSHdSZWZPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCgogICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKEh3UmVmT2JqZWN0QXR0cmlidXRlQmVhbik7IC8vIEFkZCB0byB0aGUgbGlzdCBvZiBvYmplY3QgYXR0cmlidXRlcwoKICAgIC8qIFNldCB0aGUgQ09NUE9ORU5UX1NBUCBmbGFnIG9mIHRoZSBIYXJkd2FyZSAqLwogICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LnNhcCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQoJZGVmIHNhcCA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoJc2FwPXNhcFswXS5nZXRWYWx1ZSgpCiAgICBkZWYgY29tcFNhcE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX1NBUCk7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlICJESVNBQkxFRCIKICAgIGRlZiBjb21wU2FwT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihjb21wU2FwT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0CiAgICBkZWYgY29tcFNhcE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGNvbXBTYXBPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgY29tcFNhcE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXRCb29sZWFuVmFsdWUoc2FwKTsgLy8gU2V0IHRoZSBuYW1lCgogICAgdmFsdWVzID0gY29tcFNhcE9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyAKICAgIHZhbHVlcy5hZGQoY29tcFNhcE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGUKCWxvZy5kZWJ1ZyB2YWx1ZXMKICAgIGNvbXBTYXBPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCglvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQoY29tcFNhcE9iamVjdEF0dHJpYnV0ZUJlYW4pOwogICAgCiAgICAvKiBTZXQgdGhlIERFTEVURUQgZmxhZyBvZiB0aGUgSGFyZHdhcmUgKi8KICAgIGRlZiBkZWxldGVkIAogICAgaWYob2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkpewogICAgICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5kZWxldGVkJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpCgkJZGVsZXRlZCA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQogICAgICAgIGRlbGV0ZWQ9ZGVsZXRlZFswXS5nZXRWYWx1ZSgpCiAgICB9CiAgICBpZihkZWxldGVkIT1udWxsKXsKICAgICAgICBkZWYgZGVsZXRlZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX0RFTEVURUQpOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSAiRElTQUJMRUQiCiAgICAgICAgZGVmIGRlbGV0ZWRPYmplY3RBdHRyaWJ1dGVCZWFuID0gbmV3T2JqZWN0QmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVCZWFuKGRlbGV0ZWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IC8vIFRoaXMgaXMgdGhlIG5hbWUgb2JqZWN0IGF0dHJpYnV0ZSBmb3IgdGhlIG5ldyBvYmplY3QKICAgICAgICBkZWYgZGVsZXRlZE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGRlbGV0ZWRPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgICAgIGRlbGV0ZWRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0Qm9vbGVhblZhbHVlKGRlbGV0ZWQpOyAvLyBTZXQgdGhlIG5hbWUKCiAgICAgICAgdmFsdWVzID0gZGVsZXRlZE9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyAKICAgICAgICB2YWx1ZXMuYWRkKGRlbGV0ZWRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlCgkJbG9nLmRlYnVnIHZhbHVlcwogICAgICAgIGRlbGV0ZWRPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCiAgICAgICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKGRlbGV0ZWRPYmplY3RBdHRyaWJ1dGVCZWFuKTsKICAgIH0KICAgICAgICAgCiAgICAvKk5vbWUgQ09NUE9ORU5UX1FVQU5USVRZKi8KICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5xdWFudGl0eSddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQoJZGVmIHF0YSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoJcXRhPXF0YVswXS5nZXRWYWx1ZSgpCiAgICBkZWYgcXRhT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4gPSBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlLmxvYWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbihDT01QT05FTlRfUVVBTlRJVFkpOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSAiRElTQUJMRUQiCiAgICBkZWYgcXRhT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihxdGFPYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IC8vIFRoaXMgaXMgdGhlIG5hbWUgb2JqZWN0IGF0dHJpYnV0ZSBmb3IgdGhlIG5ldyBvYmplY3QKICAgIGRlZiBxdGFPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBxdGFPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgcXRhT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldERvdWJsZVZhbHVlKHF0YSk7IC8vIFNldCB0aGUgbmFtZQoKICAgIHZhbHVlcyA9IHF0YU9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyAKICAgIHZhbHVlcy5hZGQocXRhT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZQoJbG9nLmRlYnVnIHZhbHVlcwogICAgcXRhT2JqZWN0QXR0cmlidXRlQmVhbi5zZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKHZhbHVlcyk7IAogICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKHF0YU9iamVjdEF0dHJpYnV0ZUJlYW4pOwogICAgCgkvKk5vbWUgQ09NUE9ORU5UX1FVT1RFX1JFUVVJUkVEKi8KICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5xdW90ZVJlcXVpcmVkJ10udG9TdHJpbmcoKSkuY3JlYXRlTXV0YWJsZSgpCglkZWYgcXVvdGVSZXEgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCXF1b3RlUmVxPXF1b3RlUmVxWzBdLmdldFZhbHVlKCkKICAgIGRlZiBxdW90ZVJlcU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX1FVT1RFX1JFUVVJUkVEKTsgLy8gVGhlIElEIG9mIHRoZSBvYmplY3QgdHlwZSBhdHRyaWJ1dGUgIkRJU0FCTEVEIgogICAgZGVmIHF1b3RlUmVxT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihxdW90ZVJlcU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdAogICAgZGVmIHF1b3RlUmVxT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuID0gcXVvdGVSZXFPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgcXVvdGVSZXFPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0Qm9vbGVhblZhbHVlKHF1b3RlUmVxKTsgLy8gU2V0IHRoZSBuYW1lCgogICAgdmFsdWVzID0gcXVvdGVSZXFPYmplY3RBdHRyaWJ1dGVCZWFuLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsgCiAgICB2YWx1ZXMuYWRkKHF1b3RlUmVxT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZQoJbG9nLmRlYnVnIHZhbHVlcwogICAgcXVvdGVSZXFPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQocXVvdGVSZXFPYmplY3RBdHRyaWJ1dGVCZWFuKTsKICAgIAogICAgLypOb21lIENPTVBPTkVOVF9TVVBQTElFUl9RVU9URV9UT19GQUFDKi8KICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5zdXBwUXVvdGUnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKCWRlZiBzdXBwUXVvdGUgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCXN1cHBRdW90ZT1zdXBwUXVvdGVbMF0uZ2V0VmFsdWUoKQogICAgZGVmIHN1cHBRdW90ZU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX1NVUFBMSUVSX1FVT1RFX1RPX0ZBQUMpOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSAiRElTQUJMRUQiCiAgICBkZWYgc3VwcFF1b3RlT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihzdXBwUXVvdGVPYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IC8vIFRoaXMgaXMgdGhlIG5hbWUgb2JqZWN0IGF0dHJpYnV0ZSBmb3IgdGhlIG5ldyBvYmplY3QKICAgIGRlZiBzdXBwUXVvdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBzdXBwUXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgc3VwcFF1b3RlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldERvdWJsZVZhbHVlKHN1cHBRdW90ZSk7IC8vIFNldCB0aGUgbmFtZQoKICAgIHZhbHVlcyA9IHN1cHBRdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyAKICAgIHZhbHVlcy5hZGQoc3VwcFF1b3RlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKTsgLy8gQWRkIHRoZSB2YWx1ZSB0byB0aGUgb2JqZWN0IGF0dHJpYnV0ZQoJbG9nLmRlYnVnIHZhbHVlcwogICAgc3VwcFF1b3RlT2JqZWN0QXR0cmlidXRlQmVhbi5zZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKHZhbHVlcyk7IAogICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKHN1cHBRdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4pOwogICAJCgkvKk5vbWUgQ09NUE9ORU5UX0ZBQUNfUVVPVEVfVE9fQ1VTVE9NRVIqLwogICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmN1c3RRdW90ZSddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQoJZGVmIGN1c3RRdW90ZSA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoJY3VzdFF1b3RlPWN1c3RRdW90ZVswXS5nZXRWYWx1ZSgpCiAgICBkZWYgY3VzdFF1b3RlT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4gPSBvYmplY3RUeXBlQXR0cmlidXRlRmFjYWRlLmxvYWRPYmplY3RUeXBlQXR0cmlidXRlQmVhbihDT01QT05FTlRfRkFBQ19RVU9URV9UT19DVVNUT01FUik7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlICJESVNBQkxFRCIKICAgIGRlZiBjdXN0UXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuID0gbmV3T2JqZWN0QmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVCZWFuKGN1c3RRdW90ZU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdAogICAgZGVmIGN1c3RRdW90ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGN1c3RRdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlCiAgICBjdXN0UXVvdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0RG91YmxlVmFsdWUoY3VzdFF1b3RlKTsgLy8gU2V0IHRoZSBuYW1lCgogICAgdmFsdWVzID0gY3VzdFF1b3RlT2JqZWN0QXR0cmlidXRlQmVhbi5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCk7IAogICAgdmFsdWVzLmFkZChjdXN0UXVvdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlCglsb2cuZGVidWcgdmFsdWVzCiAgICBjdXN0UXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCiAgIAlvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQoY3VzdFF1b3RlT2JqZWN0QXR0cmlidXRlQmVhbik7CgoJLypOb21lIENPTVBPTkVOVF9BUFBMSUVEX1RPKi8KICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKGNvbXBvbmVudE9iamVjdC5nZXRJZCgpLCBwcm9wZXJ0aWVzWydpb2JqLmNvbXBvbmVudC5hcHBsaWVkVG8nXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKCWRlZiBhcHBsaWVkVG8gPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCWFwcGxpZWRUbz1hcHBsaWVkVG9bMF0uZ2V0VmFsdWUoKQogICAgZGVmIGFwcGxpZWRUb09iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX0FQUExJRURfVE8pOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSAiRElTQUJMRUQiCiAgICBkZWYgYXBwbGllZFRvT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihhcHBsaWVkVG9PYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IC8vIFRoaXMgaXMgdGhlIG5hbWUgb2JqZWN0IGF0dHJpYnV0ZSBmb3IgdGhlIG5ldyBvYmplY3QKICAgIGRlZiBhcHBsaWVkVG9PYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBhcHBsaWVkVG9PYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgYXBwbGllZFRvT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFRleHRWYWx1ZShhcHBsaWVkVG8pOyAvLyBTZXQgdGhlIG5hbWUKCiAgICB2YWx1ZXMgPSBhcHBsaWVkVG9PYmplY3RBdHRyaWJ1dGVCZWFuLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsgCiAgICB2YWx1ZXMuYWRkKGFwcGxpZWRUb09iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGUKCWxvZy5kZWJ1ZyB2YWx1ZXMKICAgIGFwcGxpZWRUb09iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyAKICAgIG9iamVjdEF0dHJpYnV0ZUJlYW5zLmFkZChhcHBsaWVkVG9PYmplY3RBdHRyaWJ1dGVCZWFuKTsKCQogICAgCgkvKk5vbWUgQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9TVVBQTElFUiovCiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90U3VwcCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQoJZGVmIHRvdFN1cHAgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCXRvdFN1cHA9dG90U3VwcFswXS5nZXRWYWx1ZSgpCiAgICBkZWYgdG90U3VwcE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9TVVBQTElFUik7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlICJESVNBQkxFRCIKICAgIGRlZiB0b3RTdXBwT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbih0b3RTdXBwT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0CiAgICBkZWYgdG90U3VwcE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IHRvdFN1cHBPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgdG90U3VwcE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXREb3VibGVWYWx1ZSh0b3RTdXBwKTsgLy8gU2V0IHRoZSBuYW1lCgogICAgdmFsdWVzID0gdG90U3VwcE9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyAKICAgIHZhbHVlcy5hZGQodG90U3VwcE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGUKCWxvZy5kZWJ1ZyB2YWx1ZXMKICAgIHRvdFN1cHBPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQodG90U3VwcE9iamVjdEF0dHJpYnV0ZUJlYW4pOwoJCgkvKk5vbWUgQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9DVVNUT01FUiovCiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQudG90Q3VzdCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQoJZGVmIHRvdEN1c3QgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCXRvdEN1c3Q9dG90Q3VzdFswXS5nZXRWYWx1ZSgpCiAgICBkZWYgdG90Q3VzdE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX1RPVEFMX0FNT1VOVF9DVVNUT01FUik7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlICJESVNBQkxFRCIKICAgIGRlZiB0b3RDdXN0T2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbih0b3RDdXN0T2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0CiAgICBkZWYgdG90Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IHRvdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgdG90Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXREb3VibGVWYWx1ZSh0b3RDdXN0KTsgLy8gU2V0IHRoZSBuYW1lCgogICAgdmFsdWVzID0gdG90Q3VzdE9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyAKICAgIHZhbHVlcy5hZGQodG90Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGUKCWxvZy5kZWJ1ZyB2YWx1ZXMKICAgIHRvdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQodG90Q3VzdE9iamVjdEF0dHJpYnV0ZUJlYW4pOwogCgkvKk5vbWUgQ09NUE9ORU5UX01BVEVSSUFMX1JFRiovCiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQubWF0ZXJpYWxSZWYnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKCWRlZiBtYXRlcmlhbCA9IG9iVHJpYWdlLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKQoJbWF0ZXJpYWw9bWF0ZXJpYWxbMF0uZ2V0VmFsdWUoKQogICAgZGVmIG1hdFJlZk9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX01BVEVSSUFMX1JFRik7IC8vIFRoZSBJRCBmb3IgdGhlIHJlZmVyZW5jZWQgb2JqZWN0IHR5cGUKICAgIG1hdFJlZk9iamVjdEF0dHJpYnV0ZUJlYW4gPSBuZXdPYmplY3RCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZUJlYW4obWF0UmVmT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAKICAgIG1hdFJlZk9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IG1hdFJlZk9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlCiAgICBtYXRSZWZPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0UmVmZXJlbmNlZE9iamVjdEJlYW5JZChtYXRlcmlhbCk7IC8vIFNldCB0aGUgSUQKCiAgICB2YWx1ZXMgPSBtYXRSZWZPYmplY3RBdHRyaWJ1dGVCZWFuLmdldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnMoKTsgCiAgICB2YWx1ZXMuYWRkKG1hdFJlZk9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGUKCWxvZy5kZWJ1ZyB2YWx1ZXMKICAgIG1hdFJlZk9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyAKCiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQobWF0UmVmT2JqZWN0QXR0cmlidXRlQmVhbik7IC8vIEFkZCB0byB0aGUgbGlzdCBvZiBvYmplY3QgYXR0cmlidXRlcwogICAgICAgIAogICAgCiAgICBkZWYgbWF0ZXJpYWxTQVAgICAgICAgCglpZiAobWF0ZXJpYWwhPW51bGwpewogICAgICAgIC8qTUFURVJJQUwgLSBTQVAqLwogICAgICAgIG9iVHJpYWdlID0gb2JqZWN0RmFjYWRlLmxvYWRPYmplY3RBdHRyaWJ1dGVCZWFuKG1hdGVyaWFsLnRvSW50ZWdlcigpLCBwcm9wZXJ0aWVzWydpb2JqLm1hdGVyaWFsLnNhcCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQogICAgICAgIG1hdGVyaWFsU0FQID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCiAgICAgICAgbWF0ZXJpYWxTQVAgPSBtYXRlcmlhbFNBUFswXS5nZXRWYWx1ZSgpCiAgICAgICAgbG9nLmRlYnVnICJtYXRlcmlhbFNBUDogIiArIG1hdGVyaWFsU0FQCiAgICB9CiAgICAgICAgICAgIAoJLypOb21lIENPTVBPTkVOVF9TVVBQTElFRF9CWV9GQUFDKi8KICAgIGRlZiBzdXBwbGllZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuID0gb2JqZWN0VHlwZUF0dHJpYnV0ZUZhY2FkZS5sb2FkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4oQ09NUE9ORU5UX1NVUFBMSUVEX0JZX0ZBQUMpOyAvLyBUaGUgSUQgb2YgdGhlIG9iamVjdCB0eXBlIGF0dHJpYnV0ZSAiRElTQUJMRUQiCiAgICBkZWYgc3VwcGxpZWRPYmplY3RBdHRyaWJ1dGVCZWFuID0gbmV3T2JqZWN0QmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVCZWFuKHN1cHBsaWVkT2JqZWN0VHlwZUF0dHJpYnV0ZUJlYW4pOyAvLyBUaGlzIGlzIHRoZSBuYW1lIG9iamVjdCBhdHRyaWJ1dGUgZm9yIHRoZSBuZXcgb2JqZWN0CiAgICBkZWYgc3VwcGxpZWRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4gPSBzdXBwbGllZE9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlCglpZihtYXRlcmlhbFNBUD09dHJ1ZSl7CiAgICAJc3VwcGxpZWRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0VGV4dFZhbHVlKCJZZXMiKTsgLy8gU2V0IHRoZSBuYW1lCiAgICB9ZWxzZXsKICAgICAgICBzdXBwbGllZE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXRUZXh0VmFsdWUoIk5vIik7IC8vIFNldCB0aGUgbmFtZQogICAgfQoKICAgIHZhbHVlcyA9IHN1cHBsaWVkT2JqZWN0QXR0cmlidXRlQmVhbi5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCk7IAogICAgdmFsdWVzLmFkZChzdXBwbGllZE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGUKCWxvZy5kZWJ1ZyB2YWx1ZXMKICAgIHN1cHBsaWVkT2JqZWN0QXR0cmlidXRlQmVhbi5zZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKHZhbHVlcyk7IAogICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKHN1cHBsaWVkT2JqZWN0QXR0cmlidXRlQmVhbik7CiAgICAKICAgIC8qTm9tZSBBQ0NPVU5USU5HX1NVUFBMSUVSX01BVEVSSUFMX1JFRiovCiAgICBvYlRyaWFnZSA9IG9iamVjdEZhY2FkZS5sb2FkT2JqZWN0QXR0cmlidXRlQmVhbihjb21wb25lbnRPYmplY3QuZ2V0SWQoKSwgcHJvcGVydGllc1snaW9iai5jb21wb25lbnQuYWNjb3VudGluZ1N1cHBNYXRlcmlhbCddLnRvU3RyaW5nKCkpLmNyZWF0ZU11dGFibGUoKQoJZGVmIGFjY01hdFN1cHAgPSBvYlRyaWFnZS5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCkKCWFjY01hdFN1cHA9YWNjTWF0U3VwcFswXS5nZXRWYWx1ZSgpCiAgICBkZWYgYWNjb3VudGluZ0N1c3RSZWZPYmplY3RUeXBlQXR0cmlidXRlQmVhbiA9IG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKENPTVBPTkVOVF9BQ0NPVU5USU5HX1NVUFBMSUVSX01BVEVSSUFMX1JFRik7IC8vIFRoZSBJRCBmb3IgdGhlIHJlZmVyZW5jZWQgb2JqZWN0IHR5cGUKICAgIGFjY291bnRpbmdDdXN0UmVmT2JqZWN0QXR0cmlidXRlQmVhbiA9IG5ld09iamVjdEJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlQmVhbihhY2NvdW50aW5nQ3VzdFJlZk9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgCiAgICBhY2NvdW50aW5nQ3VzdFJlZk9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGFjY291bnRpbmdDdXN0UmVmT2JqZWN0QXR0cmlidXRlQmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4oKTsgLy8gVGhpcyBpcyB0aGUgYWN0dWFsIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUKICAgIGFjY291bnRpbmdDdXN0UmVmT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldFJlZmVyZW5jZWRPYmplY3RCZWFuSWQoYWNjTWF0U3VwcCk7IC8vIFNldCB0aGUgSUQKCiAgICB2YWx1ZXMgPSBhY2NvdW50aW5nQ3VzdFJlZk9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyAKICAgIHZhbHVlcy5hZGQoYWNjb3VudGluZ0N1c3RSZWZPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlCglsb2cuZGVidWcgdmFsdWVzCiAgICBhY2NvdW50aW5nQ3VzdFJlZk9iamVjdEF0dHJpYnV0ZUJlYW4uc2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucyh2YWx1ZXMpOyAKCiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQoYWNjb3VudGluZ0N1c3RSZWZPYmplY3RBdHRyaWJ1dGVCZWFuKTsgLy8gQWRkIHRvIHRoZSBsaXN0IG9mIG9iamVjdCBhdHRyaWJ1dGVzCiAgICAKCS8qTm9tZSBDT01QT05FTlRfQUNDT1VOVElOR19DVVNUT01FUl9NQVRFUklBTF9SRUYqLwogICAgb2JUcmlhZ2UgPSBvYmplY3RGYWNhZGUubG9hZE9iamVjdEF0dHJpYnV0ZUJlYW4oY29tcG9uZW50T2JqZWN0LmdldElkKCksIHByb3BlcnRpZXNbJ2lvYmouY29tcG9uZW50LmFjY291bnRpbmdDdXN0TWF0ZXJpYWwnXS50b1N0cmluZygpKS5jcmVhdGVNdXRhYmxlKCkKCWRlZiBhY2NNYXRDdXN0ID0gb2JUcmlhZ2UuZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpCglhY2NNYXRDdXN0PWFjY01hdEN1c3RbMF0uZ2V0VmFsdWUoKQogICAgZGVmIGFjY01hdEN1c3RPYmplY3RUeXBlQXR0cmlidXRlQmVhbiA9IG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKENPTVBPTkVOVF9BQ0NPVU5USU5HX0NVU1RPTUVSX01BVEVSSUFMX1JFRik7IC8vIFRoZSBJRCBmb3IgdGhlIHJlZmVyZW5jZWQgb2JqZWN0IHR5cGUKICAgIGFjY01hdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuID0gbmV3T2JqZWN0QmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVCZWFuKGFjY01hdEN1c3RPYmplY3RUeXBlQXR0cmlidXRlQmVhbik7IAogICAgYWNjTWF0Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGFjY01hdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuLmNyZWF0ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbigpOyAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZQogICAgYWNjTWF0Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbi5zZXRSZWZlcmVuY2VkT2JqZWN0QmVhbklkKGFjY01hdEN1c3QpOyAvLyBTZXQgdGhlIElECgogICAgdmFsdWVzID0gYWNjTWF0Q3VzdE9iamVjdEF0dHJpYnV0ZUJlYW4uZ2V0T2JqZWN0QXR0cmlidXRlVmFsdWVCZWFucygpOyAKICAgIHZhbHVlcy5hZGQoYWNjTWF0Q3VzdE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbik7IC8vIEFkZCB0aGUgdmFsdWUgdG8gdGhlIG9iamVjdCBhdHRyaWJ1dGUKCWxvZy5kZWJ1ZyB2YWx1ZXMKICAgIGFjY01hdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCgogICAgb2JqZWN0QXR0cmlidXRlQmVhbnMuYWRkKGFjY01hdEN1c3RPYmplY3RBdHRyaWJ1dGVCZWFuKTsgLy8gQWRkIHRvIHRoZSBsaXN0IG9mIG9iamVjdCBhdHRyaWJ1dGVzCiAgICAgICAgCgkvKk5vbWUgQ09NUE9ORU5UX0ZST01fUVVPVEVfVEtUKi8KCWRlZiBmcm9tUXVvdGVPYmplY3RUeXBlQXR0cmlidXRlQmVhbiA9IG9iamVjdFR5cGVBdHRyaWJ1dGVGYWNhZGUubG9hZE9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKENPTVBPTkVOVF9GUk9NX1FVT1RFX1RLVCk7IC8vIFRoZSBJRCBvZiB0aGUgb2JqZWN0IHR5cGUgYXR0cmlidXRlICJESVNBQkxFRCIKICAgIGRlZiBmcm9tUXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuID0gbmV3T2JqZWN0QmVhbi5jcmVhdGVPYmplY3RBdHRyaWJ1dGVCZWFuKGZyb21RdW90ZU9iamVjdFR5cGVBdHRyaWJ1dGVCZWFuKTsgLy8gVGhpcyBpcyB0aGUgbmFtZSBvYmplY3QgYXR0cmlidXRlIGZvciB0aGUgbmV3IG9iamVjdAogICAgZGVmIGZyb21RdW90ZU9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbiA9IGZyb21RdW90ZU9iamVjdEF0dHJpYnV0ZUJlYW4uY3JlYXRlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuKCk7IC8vIFRoaXMgaXMgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlCiAgICBpZihtYXRlcmlhbFNBUD09dHJ1ZSl7CiAgICAgICAgZnJvbVF1b3RlT2JqZWN0QXR0cmlidXRlVmFsdWVCZWFuLnNldEJvb2xlYW5WYWx1ZSh0cnVlKTsgLy8gU2V0IHRoZSBuYW1lCiAgICB9ZWxzZXsKICAgICAgICBmcm9tUXVvdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4uc2V0Qm9vbGVhblZhbHVlKGZhbHNlKTsgLy8gU2V0IHRoZSBuYW1lCiAgICB9CgogICAgdmFsdWVzID0gZnJvbVF1b3RlT2JqZWN0QXR0cmlidXRlQmVhbi5nZXRPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW5zKCk7IAogICAgdmFsdWVzLmFkZChmcm9tUXVvdGVPYmplY3RBdHRyaWJ1dGVWYWx1ZUJlYW4pOyAvLyBBZGQgdGhlIHZhbHVlIHRvIHRoZSBvYmplY3QgYXR0cmlidXRlCglsb2cuZGVidWcgdmFsdWVzCiAgICBmcm9tUXVvdGVPYmplY3RBdHRyaWJ1dGVCZWFuLnNldE9iamVjdEF0dHJpYnV0ZVZhbHVlQmVhbnModmFsdWVzKTsgCiAgICBvYmplY3RBdHRyaWJ1dGVCZWFucy5hZGQoZnJvbVF1b3RlT2JqZWN0QXR0cmlidXRlQmVhbik7CiAgICAKICAgIGxvZy5kZWJ1ZyAib2JqZWN0QXR0cmlidXRlQmVhbnM6ICIgKyBvYmplY3RBdHRyaWJ1dGVCZWFucwogICAgLyogU2V0IGFsbCBvYmplY3QgYXR0cmlidXRlcyB0byB0aGUgb2JqZWN0ICovCiAgICBuZXdPYmplY3RCZWFuLnNldE9iamVjdEF0dHJpYnV0ZUJlYW5zKG9iamVjdEF0dHJpYnV0ZUJlYW5zKTsKCiAgICB0cnkgewogICAgIAluZXdPYmplY3RCZWFuID0gb2JqZWN0RmFjYWRlLnN0b3JlT2JqZWN0QmVhbihuZXdPYmplY3RCZWFuKTsKICAgICAgICBvYmpMaXN0LmFkZChuZXdPYmplY3RCZWFuKQogICAgIAlsb2cuZGVidWcoIm5ld09iamVjdEJlYW46ICIgKyBuZXdPYmplY3RCZWFuKTsKICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiB2aWUpIHsKICAgICAJbG9nLndhcm4oIkNvdWxkIG5vdCBjcmVhdGUgaXNzdWUgZHVlIHRvIHZhbGlkYXRpb24gZXhjZXB0aW9uOiIgKyB2aWUuZ2V0TWVzc2FnZSgpKTsKICAgIH0KICAgIAp9CgptaS5zZXRDdXN0b21GaWVsZFZhbHVlKHJlcE1hdGVyaWFscywgb2JqTGlzdCk7CkNvbXBvbmVudEFjY2Vzc29yLmdldElzc3VlTWFuYWdlcigpLnVwZGF0ZUlzc3VlKGN1cnJlbnRVc2VyLCBtaSwgRXZlbnREaXNwYXRjaE9wdGlvbi5ET19OT1RfRElTUEFUQ0gsIGZhbHNlKTsKICAgICAgICAgIA==</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE"></arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="321" name="Offerta Rifiutata da Cliente">
          <meta name="opsbar-sequence">20</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="13">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="331" name="Richiesta Preventivo Scaduta">
          <meta name="opsbar-sequence">30</meta>
          <meta name="jira.description"></meta>
          <meta name="jira.fieldscreen.id"></meta>
          <results>
            <unconditional-result old-status="null" status="null" step="14">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="12" name="Required">
      <meta name="jira.status.id">14335</meta>
      <actions>
<common-action id="51" />
      </actions>
    </step>
    <step id="13" name="Rejected">
      <meta name="jira.status.id">11436</meta>
    </step>
    <step id="14" name="Quote Expired">
      <meta name="jira.status.id">14336</meta>
    </step>
    <step id="15" name="Deleted">
      <meta name="jira.status.id">10335</meta>
      <actions>
<common-action id="371" />
      </actions>
    </step>
    <step id="16" name="Suspended">
      <meta name="jira.status.id">14337</meta>
      <actions>
<common-action id="371" />
      </actions>
    </step>
    <step id="17" name="Canceled">
      <meta name="jira.status.id">11728</meta>
      <actions>
<common-action id="371" />
      </actions>
    </step>
  </steps>
</workflow>
