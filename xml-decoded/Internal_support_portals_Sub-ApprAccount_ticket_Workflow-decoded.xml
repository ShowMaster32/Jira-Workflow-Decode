<?xml version='1.0' encoding='UTF-8'?>
<workflow>
  <meta name="jira.description" />
  <meta name="jira.update.author.key">katia.chinaglia</meta>
  <meta name="jira.updated.date">1740742746823</meta>
  <initial-actions>
    <action id="1" name="Create">
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="žée" status="¢—§" step="1">
          <post-functions>
            <function type="class">
              <arg name="FIELD_SECURITY_LEVEL_ID">11201</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SetIssueSecurity</arg>
              <arg name="FIELD_CONDITION" />
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">1</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Send mail to approval account subtask to assignee</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS">customfield_25202</arg>
              <arg name="FIELD_TO_USER_FIELDS">jË"w</arg>
              <arg name="FIELD_FUNCTION_ID">ó­çúk~½Ý¶kNøqöãwúi·k®|w]t</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
														&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                        &lt;b&gt;IDTS Support Portal&lt;/b&gt;&lt;/a&gt;
                                                        	- Sub task Approval Account 
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; Created &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue.parentObject"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
										Dear &lt;% out &lt;&lt; issue.assignee?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        in regards to the Account request &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject %&gt;&lt;/b&gt; with subject &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject.summary %&gt;&lt;/b&gt;, the approval ticket &lt;b&gt;&lt;% out &lt;&lt; issue%&gt;&lt;/b&gt; has been created.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.assignee?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        relativamente alla richiesta di Account &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject %&gt;&lt;/b&gt; con oggetto &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject.summary %&gt;&lt;/b&gt;, è stato creato il ticket di approvazione &lt;b&gt;&lt;% out &lt;&lt; issue%&gt;&lt;/b&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval For Account Request Ticket [$issue.key] $issue.summary: created</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="v+nWù">false</arg>
              <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"faacithelpdesk@faacgroup.com\")","scriptPath":null,"parameters":{}}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">IDTS-47021</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <steps>
    <step id="1" name=":—§">
      <meta name="jira.status.id">1</meta>
      <actions>
        <action id="11" name="k¢÷" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">19425</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">f120ff16-5b3a-43bb-8f5a-283216e1197d</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">{"script":"currentUser.name == \"atlassian_faac_service_desk\" || currentUser.name == \"katia.chinaglia\" || currentUser.name == \"ester.bergonzoni\" || currentUser.name == \"enrico.minelle\" || currentUser.name == \"alessandra.tiengo\"","scriptPath":null,"parameters":{}}</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="2">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">{GÕýÝoVßq×üëiÝ¹×Ýÿ=q¯usÝ8</arg>
                  <arg name="FIELD_NOTES">aggiunto il commento al db del portale così che possa essere visibile agli utenti, il commento lo preso da Comment/notes che aggiungo ai commenti</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.jql.parser.JqlQueryParser
import com.atlassian.jira.web.bean.PagerFilter
import com.atlassian.jira.bc.issue.search.SearchService
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.comments.CommentManager
//Project Service Desk - key: SD
import org.apache.log4j.Category
import com.atlassian.jira.issue.comments.Comment
import com.atlassian.jira.issue.comments.MutableComment
import org.ofbiz.core.entity.GenericValue
import com.atlassian.jira.issue.history.ChangeItemBean

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

IssueManager 		issueManager 		= ComponentAccessor.getIssueManager()

def jqlQueryParser = ComponentAccessor.getComponent(JqlQueryParser)
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()

//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6397")

ApplicationUser oldUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
ApplicationUser user = ComponentAccessor.jiraAuthenticationContext.loggedInUser

CustomField CommentNotes = customFieldManager.getCustomFieldObject(Long.parseLong("22306"))
def CommentNotesV = issue.getCustomFieldValue(CommentNotes)

CommentManager commentMgr = ComponentAccessor.getCommentManager()
//commentMgr = (CommentManager) ComponentAccessor.getComponentInstanceOfType(CommentManager.class)
if (CommentNotesV != null &amp;&amp; CommentNotesV.toString()!= "" &amp;&amp; CommentNotesV.toString()!= "{html}null{html}"){
	Comment comment=commentMgr.create(issue, issue.getAssignee(), CommentNotesV.toString(), false)

    def delegator = (DelegatorInterface) ComponentAccessor.getComponent(DelegatorInterface)
    String helperName = delegator.getGroupHelperName("default");
    def sqlStmt
    Connection conn
    Sql sql

    if (comment != null){

        MutableComment comment_to_be_updated = ComponentAccessor.getCommentManager().getMutableComment(comment.getId());
        comment_to_be_updated.setRoleLevelId("10300".toLong())
        ComponentAccessor.getCommentManager().update(comment_to_be_updated, false);

        sqlStmt = "INSERT INTO FC_SD_REQUESTCOMMENTS (JIRA_COMMENT_ID, JIRA_ISSUE_KEY) VALUES (" + comment.id + ", '" + issue.key + "')"

        conn = ConnectionFactory.getConnection(helperName);
        sql = new Sql(conn)

        try {
            StringBuffer sb = new StringBuffer()
            sql.execute(sqlStmt)
        }
        finally {
            sql.close()
        }    
    }
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="v+nWù">false</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">У·Ыу‡Ѕг_wo~щuэ№kVєo·[ЫЯ8бохЫЋЯ</arg>
                  <arg name="FIELD_NOTES">Update campo Software/hardware della issue corrente e della issue padre</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.issue.MutableIssue\nimport com.atlassian.jira.issue.IssueManager\nimport com.atlassian.jira.bc.user.search.UserSearchService\nimport com.atlassian.jira.user.ApplicationUser\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport com.atlassian.jira.issue.fields.CustomField\nimport com.atlassian.jira.issue.CustomFieldManager\nimport com.atlassian.jira.workflow.WorkflowTransitionUtil;\nimport com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;\nimport com.atlassian.jira.util.JiraUtils;\nimport com.atlassian.jira.issue.Issue;\nimport org.apache.commons.codec.binary.Base64;\nimport org.apache.log4j.Category\nimport com.atlassian.jira.user.util.UserManager\nimport com.atlassian.jira.workflow.WorkflowTransitionUtil;\nimport com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;\n\ndef issueFactory = ComponentAccessor.getIssueFactory()\ndef constantManager = ComponentAccessor.getConstantsManager()\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\n\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\n\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\n\n/* Get issue \"Group Assignee\" custom field value */\nIssueManager issueManager = ComponentAccessor.getIssueManager()\nMutableIssue parentIssue = issue.parentObject;\n\n//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-6118\")\n\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\nlog.setLevel(org.apache.log4j.Level.DEBUG)\n\n// aggiorno il campo solo se Audit approval \u00e8 diverso da \"1\"\ndef AuditApproval = parentIssue.getCustomFieldValue(customFieldManager.getCustomFieldObject(Long.parseLong(\"24100\")))\nlog.debug AuditApproval\nif (AuditApproval != \"1\")\n{\n    //Software/Hardware Approvation PROD 22260 - TEST 22343\n    CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22260\"))\n    def SoftHardV = issue.getCustomFieldValue(SoftHard)\n\n    //Software/Hardware PROD 22253 - TEST 22023\n    CustomField SoftHardIssue = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\n\n    issue.setCustomFieldValue(SoftHardIssue, SoftHardV)\n    parentIssue.setCustomFieldValue(SoftHardIssue, SoftHardV)\n\n    issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\n    issueIndexingService.reIndex(issue)\n    issueManager.updateIssue(LoggedInUser, parentIssue, EventDispatchOption.DO_NOT_DISPATCH, false)\n    issueIndexingService.reIndex(parentIssue)\n}\n/*\nMutableIssue parentIssue = issue.parentObject;\n\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian\"))\n                                                            \ndef currentUser = ComponentAccessor.jiraAuthenticationContext.getLoggedInUser();\n\nWorkflowTransitionUtil workflowTransitionUtil = (WorkflowTransitionUtil) JiraUtils.loadComponent(WorkflowTransitionUtilImpl.class);\nworkflowTransitionUtil.setIssue(parentIssue);\nworkflowTransitionUtil.setAction(51);\nworkflowTransitionUtil.validate();\nworkflowTransitionUtil.progress();\n\n*/\n\n\n","scriptPath":null,"parameters":{}}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()

CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()

IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()
MutableIssue parentIssue = issue.parentObject;

//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6118")

Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

//Software/Hardware Approvation PROD 22260 - TEST 22343
CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22260"))
def SoftHardV = issue.getCustomFieldValue(SoftHard)

//Software/Hardware PROD 22253 - TEST 22023
CustomField SoftHardIssue = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))

issue.setCustomFieldValue(SoftHardIssue, SoftHardV)
parentIssue.setCustomFieldValue(SoftHardIssue, SoftHardV)

issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)
issueIndexingService.reIndex(issue)
issueManager.updateIssue(LoggedInUser, parentIssue, EventDispatchOption.DO_NOT_DISPATCH, false)
issueIndexingService.reIndex(parentIssue)

/*
MutableIssue parentIssue = issue.parentObject;

ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian"))
                                                            
def currentUser = ComponentAccessor.jiraAuthenticationContext.getLoggedInUser();

WorkflowTransitionUtil workflowTransitionUtil = (WorkflowTransitionUtil) JiraUtils.loadComponent(WorkflowTransitionUtilImpl.class);
workflowTransitionUtil.setIssue(parentIssue);
workflowTransitionUtil.setAction(51);
workflowTransitionUtil.validate();
workflowTransitionUtil.progress();

*/


</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="v+nWù">¶»ž</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">814f63cd-1773-4121-8110-b892453a617d</arg>
                  <arg name="FIELD_NOTES">Update campo Software/hardware/workstation e user copy della issue corrente e della issue padre</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport com.atlassian.jira.issue.IssueManager\r\nimport com.atlassian.jira.bc.user.search.UserSearchService\r\nimport com.atlassian.jira.user.ApplicationUser\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\nimport com.atlassian.jira.issue.fields.CustomField\r\nimport com.atlassian.jira.issue.CustomFieldManager\r\nimport com.atlassian.jira.util.JiraUtils;\r\nimport com.atlassian.jira.issue.Issue;\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.user.util.UserManager\r\nimport com.atlassian.jira.event.type.EventDispatchOption;\r\nimport org.apache.log4j.Level\r\nimport com.atlassian.jira.issue.IssueManager\r\n\r\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\r\nlog.setLevel(org.apache.log4j.Level.DEBUG)\r\n\r\ndef issueFactory = ComponentAccessor.getIssueFactory()\r\ndef constantManager = ComponentAccessor.getConstantsManager()\r\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\r\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\r\n\r\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\r\n\r\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\r\n\r\n\r\n/* Get Insight Object Facade from plugin accessor */\r\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\"); \r\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\r\n/* Get Insight IQL Facade from plugin accessor */\r\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \r\ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\r\n\r\n/* Get issue \"Group Assignee\" custom field value */\r\nIssueManager issueManager = ComponentAccessor.getIssueManager()\r\n\r\n\r\n//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-49848\")\r\nMutableIssue parentIssue = issue.parentObject;\r\n\r\nCustomField WorkstationType = customFieldManager.getCustomFieldObject(Long.parseLong(\"26205\"))\r\ndef WorkstationTypeV = issue.getCustomFieldValue(WorkstationType)\r\n\r\nCustomField UserCopy = customFieldManager.getCustomFieldObject(Long.parseLong(\"26206\"))\r\ndef UserCopyV = issue.getCustomFieldValue(UserCopy)\r\n\r\nCustomField EmployeeSystemID = customFieldManager.getCustomFieldObject(Long.parseLong(\"20500\"))\r\ndef EmployeeSystemIDV = issue.getCustomFieldValue(EmployeeSystemID)\r\n\r\n//Software/Hardware Approvation PROD 22260 - TEST 22343\r\nCustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22260\"))\r\n\r\n//se arrivo da GEMS per new hiew quindi ho il campo Employee System ID valorizzato entro nell IF\r\ndef ApplicationLicense=[]\r\nString queryParam\r\n\r\nif (EmployeeSystemIDV.toString() != \"\" &amp;&amp; EmployeeSystemIDV != null){    \r\n\r\n    //aggiungo Software da user copy\r\n    if (UserCopyV!=null){\r\n        if (objectFacade.loadObjectAttributeBean(UserCopyV[0].getId(), 6590)!=\"\" &amp;&amp; objectFacade.loadObjectAttributeBean(UserCopyV[0].getId(), 6590)!=null)\r\n        {\r\n            for (objAppl in objectFacade.loadObjectAttributeBean(UserCopyV[0].getId(), 6590).getObjectAttributeValueBeans()){\r\n                queryParam = \"\\\"\" + objAppl.getValue() + \"\\\"\"\r\n                def objectsAccountTypeAppl = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"TypeAccounts\\\" AND \\\"objectid\\\" = \" + queryParam); \r\n                log.debug objectsAccountTypeAppl\r\n                log.debug objectFacade.loadObjectAttributeBean(objectsAccountTypeAppl[0].getId(), 2201).getObjectAttributeValueBeans()[0].getValue()\r\n                ApplicationLicense.add(objectsAccountTypeAppl[0]);\r\n            }\r\n        }\r\n    }\r\n\r\n    //aggiungo Hardware da workstation da user copy\r\n    if (WorkstationTypeV!=null){\r\n        if (objectFacade.loadObjectAttributeBean(WorkstationTypeV[0].getId(), 6596)!=\"\" &amp;&amp; objectFacade.loadObjectAttributeBean(WorkstationTypeV[0].getId(), 6596)!=null)\r\n        {\r\n            for (objAppl in objectFacade.loadObjectAttributeBean(WorkstationTypeV[0].getId(), 6596).getObjectAttributeValueBeans()){\r\n                queryParam = \"\\\"\" + objAppl.getValue() + \"\\\"\"\r\n                def objectsAccountTypeInfra = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"TypeAccounts\\\" AND \\\"objectid\\\" = \" + queryParam); \r\n                \r\n                log.debug objectsAccountTypeInfra[0]\r\n                ApplicationLicense.add(objectsAccountTypeInfra[0]);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (ApplicationLicense.size()&gt;0){\r\n        issue.setCustomFieldValue(SoftHard, ApplicationLicense)\r\n        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\r\n        issueIndexingService.reIndex(issue)\r\n    }\r\n}\r\n\r\n// aggiorno il campo solo se Audit approval \u00e8 diverso da \"1\"\r\ndef AuditApproval = parentIssue.getCustomFieldValue(customFieldManager.getCustomFieldObject(Long.parseLong(\"24100\")))\r\n\r\nif (AuditApproval != \"1\")\r\n{\r\n    //Software/Hardware Approvation PROD 22260 - TEST 22343\r\n    def SoftHardV = issue.getCustomFieldValue(SoftHard)\r\n    \r\n    //Software/Hardware PROD 22253 - TEST 22023\r\n    CustomField SoftHardIssue = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\r\n\r\n    issue.setCustomFieldValue(SoftHardIssue, SoftHardV)\r\n\r\n    parentIssue.setCustomFieldValue(SoftHardIssue, SoftHardV)\r\n    parentIssue.setCustomFieldValue(WorkstationType, WorkstationTypeV)\r\n    parentIssue.setCustomFieldValue(UserCopy, UserCopyV)\r\n    log.debug SoftHardV\r\n    issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\r\n    issueIndexingService.reIndex(issue)\r\n    issueManager.updateIssue(LoggedInUser, parentIssue, EventDispatchOption.DO_NOT_DISPATCH, false)\r\n    issueIndexingService.reIndex(parentIssue)\r\n}\r\n\r\n\r\n","scriptPath":null}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="v+nWù">false</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">{nÞñ¾·í§ûÕ¾úëN|áßá¾uÝ×Ý_5ç®õ</arg>
                  <arg name="FIELD_NOTES">creo sub task</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()
def subTaskManager = ComponentAccessor.getSubTaskManager()
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()
/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()

MutableIssue parentIssue = issue.parentObject
//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6247")

Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

//Software/Hardware Approvation PROD 22260 - TEST 22343
CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22260"))
//Software/Hardware PROD 22253 - TEST 22023
CustomField fieldSoftHard2 = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
//Type Account PROD 22259 - TEST 22417
CustomField fieldTypeAccount = customFieldManager.getCustomFieldObject(Long.parseLong("22259"))
//Reporter Company PROD 20104 - TEST 20104
CustomField fieldReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong("20104"))

def fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)
def fieldReporterCompanyV = parentIssue.getCustomFieldValue(fieldReporterCompany)

log.debug fieldSoftHardV
for (sofHard in fieldSoftHardV){
    MutableIssue newSubTask = issueFactory.getIssue()
    log.debug "sofHard " +  sofHard
    def sofHardList = []
	sofHardList.add(sofHard)
    
    if (sofHard != null &amp;&amp; sofHard != ""){
        
        /* Specify the schema id as well as the IQL that will fetch objects. In this case all objects with Name matching the valueCF, be sure to include " around value */
        
        def queryParam = "\"" + sofHard.getName() + "\""

        //Recupero il funzionario legato al site selezionato
        def objects = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"TypeAccounts\" AND \"Name\" IN (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
		log.debug "1"
        def userPropertyManager = ComponentAccessor.getUserPropertyManager()
        def userManager = ComponentAccessor.getUserManager()
        def userSearchService = ComponentAccessor.getComponent(UserSearchService.class)
        
        def assigneeList = [];
        ApplicationUser assignee = null;
        
        //Assignee su insight nella tabella TypeAccounts PROD 2205 - TEST 2451
        if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 2205) != null){
        	assigneeList = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objects[0].getId(), 2205).getObjectAttributeValueBeans()[0].getValue())
        	for (ass in assigneeList){
                if (ComponentAccessor.groupManager.getUsersInGroup("IDTS-agents").contains(ass) || ComponentAccessor.groupManager.getUsersInGroup("IDTS-external-agents").contains(ass)){
                    assignee=(ApplicationUser) ass
                }	
            } 
        }
        
        ApplicationUser assigneeCompany
        
        if (assignee != null &amp;&amp; assignee!=""){
        	newSubTask.setAssignee(assignee)
        }
        else {
            //se assignee non è valorizzato allora vado per company a vedere la tabella AssigneeInfrastructureCompany
            if (fieldReporterCompanyV != null &amp;&amp; fieldReporterCompanyV!=""){
                queryParam = "\"" + fieldReporterCompanyV + "\""
                def objectsAssignee = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"AssigneeInfrastructureCompany\" AND \"CompanyAD\" = (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
				if (objectsAssignee.size()&gt;0){
                    if (objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != ""){
                        assigneeList = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232).getObjectAttributeValueBeans()[0].getValue())
				
                    	for (ass in assigneeList){
                            if (ComponentAccessor.groupManager.getUsersInGroup("IDTS-agents").contains(ass) || ComponentAccessor.groupManager.getUsersInGroup("IDTS-external-agents").contains(ass)){
                                assigneeCompany=(ApplicationUser) ass
                            }	
                        } 
                    }
                    
                    if (assigneeCompany != null &amp;&amp; assigneeCompany!="")
                        newSubTask.setAssignee(assigneeCompany)
               	}
        	} 
        }
        
        /*if (assignee != null &amp;&amp; assignee!=""){
        	newSubTask.setAssignee(assignee)
        }
        else {
            //se assignee non è valorizzato allora vado per company a vedere la tabella AssigneeInfrastructureCompany
            if (fieldReporterCompanyV != null &amp;&amp; fieldReporterCompanyV!=""){
                queryParam = "\"" + fieldReporterCompanyV + "\""
                def objectsAssignee = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"AssigneeInfrastructureCompany\" AND \"CompanyAD\" = (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
				if (objectsAssignee.size()&gt;0){
                    if (objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != "")
                        assigneeCompany = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232).getObjectAttributeValueBeans()[0].getValue()).getAt(0)

                    if (assigneeCompany != null &amp;&amp; assigneeCompany!="")
                        newSubTask.setAssignee(assigneeCompany)
            	}
        	} 
        }*/
        
        newSubTask.setReporter(LoggedInUser)
        newSubTask.setSummary(sofHard.getName() + " - " + parentIssue.getSummary())
        newSubTask.setParentObject(parentIssue)
        newSubTask.setProjectObject(parentIssue.getProjectObject())
        newSubTask.setCustomFieldValue(fieldSoftHard2, sofHardList)
        newSubTask.setCustomFieldValue(fieldReporterCompany, fieldReporterCompanyV)
        //type su insight nella tabella TypeAccounts PROD 2204 - TEST 2450
        newSubTask.setCustomFieldValue(fieldTypeAccount, objectFacade.loadObjectAttributeBean(objects[0].getId(), 2204).getObjectAttributeValueBeans()[0].getValue())
       
        newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{
            it.getName() == "Sub-TaskAccount"
        }.id)
        
		def newIssueParams = ["issue" : newSubTask] as Map&lt;String,Object&gt;
        issueManager.createIssueObject(LoggedInUser, newIssueParams)
        log.debug newIssueParams
       
        subTaskManager.createSubTaskIssueLink(parentIssue, newSubTask, LoggedInUser)
        issueIndexingService.reIndex(newSubTask)
    }
    
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="v+nWù">false</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">Уќ7Ч^8ЯћЯЫЧщпGќЫЦыпnј}ю]wќywGш</arg>
                  <arg name="FIELD_NOTES">metto in progress padre se ho dei HW/SW altrimenti chiudo il ticekt</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.issue.MutableIssue\nimport com.atlassian.jira.issue.IssueManager\nimport com.atlassian.jira.bc.user.search.UserSearchService\nimport com.atlassian.jira.user.ApplicationUser\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport com.atlassian.jira.issue.fields.CustomField\nimport com.atlassian.jira.issue.CustomFieldManager\nimport com.atlassian.jira.util.JiraUtils;\nimport com.atlassian.jira.issue.Issue;\nimport org.apache.commons.codec.binary.Base64;\nimport org.apache.log4j.Category\nimport com.atlassian.jira.user.util.UserManager\nimport com.atlassian.jira.workflow.TransitionOptions\nimport com.atlassian.jira.bc.issue.IssueService\n\ndef issueFactory = ComponentAccessor.getIssueFactory()\ndef constantManager = ComponentAccessor.getConstantsManager()\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\nIssueService issueService = ComponentAccessor.getIssueService()\nTransitionOptions transitionOptions = new TransitionOptions.Builder().skipConditions().skipPermissions().skipValidators().build()\n\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\n\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\n\n/* Get issue \"Group Assignee\" custom field value */\nIssueManager issueManager = ComponentAccessor.getIssueManager()\n\nMutableIssue parentIssue = issue.parentObject;\n\n//Software/Hardware Approvation  22260 \nCustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22260\"))\ndef fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)\n\nIssueService.TransitionValidationResult result = issueService.validateTransition(LoggedInUser, parentIssue.getId(),161, issueService.newIssueInputParameters(), transitionOptions)\nif (result.isValid()) {\n    issueService.transition(LoggedInUser, result)\n}\n\nresult = issueService.validateTransition(LoggedInUser, parentIssue.getId(),51, issueService.newIssueInputParameters(), transitionOptions)\nif (result.isValid()) {\n    issueService.transition(LoggedInUser, result)\n}\n\nif (fieldSoftHardV == null)\n{\n    result = issueService.validateTransition(LoggedInUser, parentIssue.getId(),221, issueService.newIssueInputParameters(), transitionOptions)\n    if (result.isValid()) {\n        issueService.transition(LoggedInUser, result)\n    }\n}\n\n/*WorkflowTransitionUtil workflowTransitionUtil = (WorkflowTransitionUtil) JiraUtils.loadComponent(WorkflowTransitionUtilImpl.class);\nworkflowTransitionUtil.setIssue(parentIssue);\nworkflowTransitionUtil.setAction(161);\nworkflowTransitionUtil.validate();\nworkflowTransitionUtil.progress();\n\nworkflowTransitionUtil.setAction(51);\nworkflowTransitionUtil.validate();\nworkflowTransitionUtil.progress();\n*/","scriptPath":null,"parameters":{}}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()

CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()

IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()

MutableIssue parentIssue = issue.parentObject;

WorkflowTransitionUtil workflowTransitionUtil = (WorkflowTransitionUtil) JiraUtils.loadComponent(WorkflowTransitionUtilImpl.class);
workflowTransitionUtil.setIssue(parentIssue);
workflowTransitionUtil.setAction(161);
workflowTransitionUtil.validate();
workflowTransitionUtil.progress();

workflowTransitionUtil.setAction(51);
workflowTransitionUtil.validate();
workflowTransitionUtil.progress();
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="field.name">resolution</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">6</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Invio email agli auditors se ci sono in caso di approvazione</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM" />
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS">customfield_25202</arg>
                  <arg name="FIELD_FUNCTION_ID">30bea965-d9b5-4683-ae14-42d10fa3d14a</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
														&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                        &lt;b&gt;IDTS Support Portal&lt;/b&gt;&lt;/a&gt;
                                                        	- Sub task Approval Account 
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; Approved &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue.parentObject"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
										Dear &lt;% out &lt;&lt; issue.assignee?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        in regards to the Account request &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject %&gt;&lt;/b&gt; with subject &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject.summary %&gt;&lt;/b&gt;, the approval ticket &lt;b&gt;&lt;% out &lt;&lt; issue%&gt;&lt;/b&gt; has been approved.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.assignee?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        relativamente alla richiesta di Account &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject %&gt;&lt;/b&gt; con oggetto &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject.summary %&gt;&lt;/b&gt;, è stato approvato il ticket di approvazione &lt;b&gt;&lt;% out &lt;&lt; issue%&gt;&lt;/b&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval For Account Request Ticket [$issue.key] $issue.summary: Approved</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"faacithelpdesk@faacgroup.com\")","scriptPath":null,"parameters":{}}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-52827</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="21" name="EèÞr×" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">19426</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">92f44f08-3de4-49cc-9a7a-a2e43d8938bb</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">{"script":"currentUser.name == \"atlassian_faac_service_desk\" || currentUser.name == \"katia.chinaglia\"","scriptPath":null}</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="3">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">aggiunto il commento al db del portale così che possa essere visibile agli utenti, il commento lo preso da Comment/notes che aggiungo ai commenti</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.jql.parser.JqlQueryParser
import com.atlassian.jira.web.bean.PagerFilter
import com.atlassian.jira.bc.issue.search.SearchService
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.comments.CommentManager
//Project Service Desk - key: SD
import org.apache.log4j.Category
import com.atlassian.jira.issue.comments.Comment
import com.atlassian.jira.issue.comments.MutableComment
import org.ofbiz.core.entity.GenericValue
import com.atlassian.jira.issue.history.ChangeItemBean

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

IssueManager 		issueManager 		= ComponentAccessor.getIssueManager()

def jqlQueryParser = ComponentAccessor.getComponent(JqlQueryParser)
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()

//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6397")

ApplicationUser oldUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
ApplicationUser user = ComponentAccessor.jiraAuthenticationContext.loggedInUser

CustomField CommentNotes = customFieldManager.getCustomFieldObject(Long.parseLong("22306"))
def CommentNotesV = issue.getCustomFieldValue(CommentNotes)

CommentManager commentMgr = ComponentAccessor.getCommentManager()
//commentMgr = (CommentManager) ComponentAccessor.getComponentInstanceOfType(CommentManager.class)

Comment comment=commentMgr.create(issue, issue.getAssignee(), CommentNotesV.toString(), false)
log.debug comment.id


def delegator = (DelegatorInterface) ComponentAccessor.getComponent(DelegatorInterface)
String helperName = delegator.getGroupHelperName("default");
def sqlStmt
Connection conn
Sql sql

if (comment != null){

    MutableComment comment_to_be_updated = ComponentAccessor.getCommentManager().getMutableComment(comment.getId());
    comment_to_be_updated.setRoleLevelId("10300".toLong())
    ComponentAccessor.getCommentManager().update(comment_to_be_updated, false);

    sqlStmt = "INSERT INTO FC_SD_REQUESTCOMMENTS (JIRA_COMMENT_ID, JIRA_ISSUE_KEY) VALUES (" + comment.id + ", '" + issue.key + "')"
    
    conn = ConnectionFactory.getConnection(helperName);
    sql = new Sql(conn)
    
    try {
        StringBuffer sb = new StringBuffer()
        sql.execute(sqlStmt)
    }
    finally {
        sql.close()
    }    
}

</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="v+nWù">false</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">í¶ûmÝuÓÍ»wvµkûmýyÕ×ô}ÿéî»÷</arg>
                  <arg name="FIELD_NOTES">se rigetto il sub task rigetto anche il padre</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.issue.MutableIssue\nimport com.atlassian.jira.issue.IssueManager\nimport com.atlassian.jira.bc.user.search.UserSearchService\nimport com.atlassian.jira.user.ApplicationUser\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport com.atlassian.jira.issue.fields.CustomField\nimport com.atlassian.jira.issue.CustomFieldManager\nimport com.atlassian.jira.util.JiraUtils;\nimport com.atlassian.jira.issue.Issue;\nimport org.apache.commons.codec.binary.Base64;\nimport org.apache.log4j.Category\nimport com.atlassian.jira.user.util.UserManager\nimport com.atlassian.jira.workflow.TransitionOptions\nimport com.atlassian.jira.bc.issue.IssueService\n\n\ndef issueFactory = ComponentAccessor.getIssueFactory()\ndef constantManager = ComponentAccessor.getConstantsManager()\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\nIssueService issueService = ComponentAccessor.getIssueService()\nTransitionOptions transitionOptions = new TransitionOptions.Builder().skipConditions().skipPermissions().skipValidators().build()\n\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\n\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\n\n/* Get issue \"Group Assignee\" custom field value */\nIssueManager issueManager = ComponentAccessor.getIssueManager()\n\nMutableIssue parentIssue = issue.parentObject;\n\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\n                                                            \ndef currentUser = ComponentAccessor.jiraAuthenticationContext.getLoggedInUser();\n\nIssueService.TransitionValidationResult result = issueService.validateTransition(LoggedInUser, parentIssue.getId(),151, issueService.newIssueInputParameters(), transitionOptions)\nif (result.isValid()) {\n    issueService.transition(LoggedInUser, result)\n}\n\n/*\nWorkflowTransitionUtil workflowTransitionUtil = (WorkflowTransitionUtil) JiraUtils.loadComponent(WorkflowTransitionUtilImpl.class);\nworkflowTransitionUtil.setIssue(parentIssue);\nworkflowTransitionUtil.setAction(151);\nworkflowTransitionUtil.validate();\nworkflowTransitionUtil.progress();\n*/\n","scriptPath":null,"parameters":{}}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()

CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()

IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()



MutableIssue parentIssue = issue.parentObject;

ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
                                                            
def currentUser = ComponentAccessor.jiraAuthenticationContext.getLoggedInUser();

WorkflowTransitionUtil workflowTransitionUtil = (WorkflowTransitionUtil) JiraUtils.loadComponent(WorkflowTransitionUtilImpl.class);
workflowTransitionUtil.setIssue(parentIssue);
workflowTransitionUtil.setAction(151);
workflowTransitionUtil.validate();
workflowTransitionUtil.progress();
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Invio email agli auditors se ci sono in caso di reject</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM" />
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS">customfield_25202</arg>
                  <arg name="FIELD_FUNCTION_ID">b3496ec3-a8a9-46ac-a60b-c56a7d4b8d26</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
														&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                        &lt;b&gt;IDTS Support Portal&lt;/b&gt;&lt;/a&gt;
                                                        	- Sub task Approval Account 
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; Rejected &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue.parentObject"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
										Dear &lt;% out &lt;&lt; issue.assignee?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        in regards to the Account request &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject %&gt;&lt;/b&gt; with subject &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject.summary %&gt;&lt;/b&gt;, the approval ticket &lt;b&gt;&lt;% out &lt;&lt; issue%&gt;&lt;/b&gt; has been rejected.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.assignee?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        relativamente alla richiesta di Account &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject %&gt;&lt;/b&gt; con oggetto &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject.summary %&gt;&lt;/b&gt;, è stato respinto il ticket di approvazione &lt;b&gt;&lt;% out &lt;&lt; issue%&gt;&lt;/b&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval For Account Request Ticket [$issue.key] $issue.summary: Approved</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"faacithelpdesk@faacgroup.com\")","scriptPath":null}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-52827</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="41" name="Send Approval Reminder">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AlwaysFalseCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="1">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to approval account subtask to assignee</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS">jË"w</arg>
                  <arg name="FIELD_FUNCTION_ID">6cbeb926-4cfd-4af1-b02c-60bd810eddf3</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
														&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                        &lt;b&gt;IDTS Support Portal&lt;/b&gt;&lt;/a&gt;
                                                        	- Approval Reminder
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue.parentObject&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue.parentObject"&gt;
											$issue.parentObject.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; REMINDER &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue.parentObject"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
										Dear &lt;% out &lt;&lt; issue.assignee?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        your approval is required regarding the Account request &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject %&gt;&lt;/b&gt; with subject &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject.summary %&gt;&lt;/b&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.assignee?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        è richiesta la tua approvazione relativamente alla richiesta di Account &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject %&gt;&lt;/b&gt; con oggetto &lt;b&gt;&lt;% out &lt;&lt; issue.parentObject.summary %&gt;&lt;/b&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Reminder Approval Required - Account Request [$issue.parentObject.key] $issue.parentObject.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"faacithelpdesk@faacgroup.com\")","scriptPath":null,"parameters":{}}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-99557</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="2" name="k¢÷">
      <meta name="jira.status.id">10932</meta>
      <actions>
        <action id="31" name="Reopen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "katia.chinaglia" |||</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="1">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="3" name="EèÞr×">
      <meta name="jira.status.id">11436</meta>
    </step>
  </steps>
</workflow>