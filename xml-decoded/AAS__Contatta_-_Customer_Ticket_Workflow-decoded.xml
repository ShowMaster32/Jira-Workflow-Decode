<?xml version='1.0' encoding='UTF-8'?>
<workflow>
  <meta name="jira.description" />
  <meta name="jira.update.author.key">arianna.fabbri</meta>
  <meta name="jira.updated.date">1722265749005</meta>
  <initial-actions>
    <action id="1" name="Create">
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="žée" status="¢—§" step="1">
          <post-functions>
            <function type="class">
              <arg name="FIELD_SECURITY_LEVEL_ID">11601</arg>
              <arg name="FIELD_NOTES">Contatta - Customer Tickets</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SetIssueSecurity</arg>
              <arg name="FIELD_CONDITION" />
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">1</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_ACTION">11 Close Tkt</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
              <arg name="FIELD_CONDITION">cfValues['CONTATTA_TICKET_STATUS']?.value == 'Closed'|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_TRANSITION_OPTIONS" />
              <arg name="FIELD_ADDITIONAL_SCRIPT">`!`</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">73916c92-68a5-46b7-905b-467550b65174</arg>
              <arg name="FIELD_ACTION">21 Send to II° Level</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
              <arg name="FIELD_CONDITION">{"script":"cfValues['CONTATTA_TICKET_STATUS']?.value == 'II\u00b0 Level - Backlog'","scriptPath":null,"parameters":{}}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_TRANSITION_OPTIONS" />
              <arg name="FIELD_ADDITIONAL_SCRIPT" />
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <common-actions>
    <action id="61" name="Back To Progress">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="žée" status="žée" step="4">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </common-actions>
  <steps>
    <step id="1" name=":—§">
      <meta name="jira.status.id">1</meta>
      <actions>
        <action id="11" name="Close Tkt">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="2">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="21" name="Send to II° Level">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">1e490ec2-6a1e-4f12-8eb3-7009c619e21e</arg>
                <arg name="FIELD_NOTES">Rendo visibile la transazione solo per Francia e Italia (SAT IT OR SAT IT - DMT)</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">{"script":"\r\nimport org.springframework.http.MediaType\r\nimport org.springframework.http.HttpHeaders\r\n\r\nimport com.atlassian.jira.issue.CustomFieldManager;\r\nimport com.atlassian.jira.issue.fields.CustomField;\r\nimport com.atlassian.jira.issue.IssueManager;\r\nimport com.atlassian.jira.issue.Issue;\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\nimport com.atlassian.jira.component.ComponentAccessor\r\n\r\nlog.setLevel(org.apache.log4j.Level.DEBUG)\r\n\r\ndef requestMethod = \"POST\";\r\n\r\n\r\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\r\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\r\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\r\n\r\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \r\ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\r\n\r\nIssueManager issueManager = ComponentAccessor.getIssueManager();\r\nCustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager();\r\n//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"AAS-256668\")\r\n\r\nCustomField AgentContatta = customFieldManager.getCustomFieldObjectsByName('CONTATTA_AGENT')[0];\r\n\r\n//Test e Prod id 3484 campo COMPANY_REF nella tabella ContactManager_Operator\r\n//15.07.2024 AF: aggiunta abilitazione II livello per IT (1100) solo SAT IT\r\ndef AgentContattaInsight = objectFacade.loadObjectAttributeBean(issue.getCustomFieldValue(AgentContatta)[0].getId(), 3484).getObjectAttributeValueBeans()[0].getValue()\r\ndef AgentContattaGroup = objectFacade.loadObjectAttributeBean(issue.getCustomFieldValue(AgentContatta)[0].getId(), 3498).getObjectAttributeValueBeans()[0].getValue()\r\ndef company = iqlFacade.findObjectsByIQLAndSchema(10, \"objectType=\\\"Company\\\" AND objectid = \" + AgentContattaInsight)\r\ndef group = iqlFacade.findObjectsByIQLAndSchema(10, \"objectType=\\\"ContactManager_OperatorsGroup\\\" AND objectid = \" + AgentContattaGroup)\r\n\r\n//Test e Prod id 667 campo COMPANY_CODE nella tabella Company\r\nif (objectFacade.loadObjectAttributeBean(company[0].getId(), 667).getObjectAttributeValueBeans()[0].getValue().toString() == \"1007\" || (objectFacade.loadObjectAttributeBean(company[0].getId(), 667).getObjectAttributeValueBeans()[0].getValue().toString() == \"1100\" &amp;&amp; (objectFacade.loadObjectAttributeBean(group[0].getId(), 3495).getObjectAttributeValueBeans()[0].getValue().toString() == \"SAT IT\")))\r\n    return true\r\nelse \r\n    return false\r\n","scriptPath":null,"parameters":{}}</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE">AAS-434640</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="3">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="scopeSource-linkEnd" />
                  <arg name="maxAllowed-integerValue" />
                  <arg name="runAsUser-user">atlassian_faac_service_desk</arg>
                  <arg name="ºè">bd4a6a02-97bd-4e3a-abbd-0dc5d192ca76</arg>
                  <arg name="field">customfield_26201</arg>
                  <arg name="scopeType">H</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="scopeDestination-linkEnd" />
                  <arg name="jsuWorkflowParamsVersion-textValue">2.43.0</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql" />
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                  <arg name="scopeSource-jql" />
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="2" name="Closed">
      <meta name="jira.status.id">6</meta>
      <actions>
        <action id="101" name="Re-Open">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">87ee72bc-3884-4245-940a-79ff71112ede</arg>
                <arg name="FIELD_NOTES">Rendo visibile la transazione solo per Francia</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">{"script":"\r\nimport org.springframework.http.MediaType\r\nimport org.springframework.http.HttpHeaders\r\n\r\nimport com.atlassian.jira.issue.CustomFieldManager;\r\nimport com.atlassian.jira.issue.fields.CustomField;\r\nimport com.atlassian.jira.issue.IssueManager;\r\nimport com.atlassian.jira.issue.Issue;\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\nimport com.atlassian.jira.component.ComponentAccessor\r\n\r\nlog.setLevel(org.apache.log4j.Level.DEBUG)\r\n\r\ndef requestMethod = \"POST\";\r\n\r\n\r\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\r\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\r\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\r\n\r\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \r\ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\r\n\r\nIssueManager issueManager = ComponentAccessor.getIssueManager();\r\nCustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager();\r\n//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"AAS-256668\")\r\n\r\nCustomField AgentContatta = customFieldManager.getCustomFieldObjectsByName('CONTATTA_AGENT')[0];\r\n\r\n//Test e Prod id 3484 campo COMPANY_REF nella tabella ContactManager_Operator\r\ndef AgentContattaInsight = objectFacade.loadObjectAttributeBean(issue.getCustomFieldValue(AgentContatta)[0].getId(), 3484).getObjectAttributeValueBeans()[0].getValue()\r\ndef company = iqlFacade.findObjectsByIQLAndSchema(10, \"objectType=\\\"Company\\\" AND objectid = \" + AgentContattaInsight)\r\n\r\n//Test e Prod id 667 campo COMPANY_CODE nella tabella Company\r\nif (objectFacade.loadObjectAttributeBean(company[0].getId(), 667).getObjectAttributeValueBeans()[0].getValue().toString() == \"1007\")\r\n    return true\r\nelse \r\n    return false\r\n","scriptPath":null}</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE">AAS-434640</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="1">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="scopeSource-linkEnd" />
                  <arg name="maxAllowed-integerValue" />
                  <arg name="runAsUser-user">atlassian_faac_service_desk</arg>
                  <arg name="ºè">bce6c22b-9039-4c6a-b931-aae6b7b348e0</arg>
                  <arg name="field">customfield_26201</arg>
                  <arg name="scopeType">H</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="scopeDestination-linkEnd" />
                  <arg name="jsuWorkflowParamsVersion-textValue">2.43.0</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql" />
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                  <arg name="scopeSource-jql" />
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="3" name="II° Level - Backlog">
      <meta name="jira.status.id">15627</meta>
      <actions>
        <action id="31" name="Start Progress">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="4">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="4" name="II° Level - In Progress">
      <meta name="jira.status.id">15628</meta>
      <actions>
        <action id="41" name="Hold for investigation">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="5">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="51" name="Transfer to Customer">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="6">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="71" name="Resend To Backoffice">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="3">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="scopeSource-linkEnd" />
                  <arg name="maxAllowed-integerValue" />
                  <arg name="runAsUser-user">atlassian_faac_service_desk</arg>
                  <arg name="ºè">2f88e587-0a68-4dd6-b206-3d9e831ede5a</arg>
                  <arg name="field">customfield_26201</arg>
                  <arg name="scopeType">H</arg>
                  <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="scopeDestination-linkEnd" />
                  <arg name="jsuWorkflowParamsVersion-textValue">2.43.0</arg>
                  <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
                  <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
                  <arg name="scopeDestination-jql" />
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                  <arg name="scopeSource-jql" />
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="81" name="Click To Call">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">ea235f0f-8f2d-450a-ad36-e1142a477f41</arg>
                <arg name="FIELD_NOTES">la transazione non sarà visibile che manca il numero di telefono</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">{"script":"cfValues['SPO_CUSTOMER_CONTACT_NUMBER'] != null","scriptPath":null}</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="4">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">e0c6f061-50ba-4b9d-8c1d-b09197d2df8c</arg>
                  <arg name="FIELD_NOTES">Click to call</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import org.springframework.http.MediaType\r\nimport org.springframework.http.HttpHeaders\r\nimport org.springframework.http.HttpEntity\r\nimport org.springframework.http.HttpMethod\r\nimport org.springframework.http.ResponseEntity\r\nimport org.springframework.web.client.RestTemplate\r\nimport com.atlassian.jira.util.json.JSONObject\r\nimport groovy.json.JsonSlurper;\r\nimport groovy.json.StreamingJsonBuilder;\r\nimport com.atlassian.jira.issue.CustomFieldManager;\r\nimport com.atlassian.jira.issue.fields.CustomField;\r\nimport com.atlassian.jira.issue.IssueManager;\r\nimport com.atlassian.jira.component.ComponentAccessor;\r\nimport com.atlassian.jira.issue.Issue;\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport org.apache.commons.codec.binary.Base64;\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\n\r\nlog.setLevel(org.apache.log4j.Level.DEBUG)\r\n\r\ndef requestMethod = \"POST\";\r\n\r\n\r\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\r\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\r\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\r\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \r\ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\r\n\r\nIssueManager issueManager = ComponentAccessor.getIssueManager();\r\nCustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager();\r\nCustomField contactNumber = customFieldManager.getCustomFieldObjectsByName('SPO_CUSTOMER_CONTACT_NUMBER')[0];\r\nCustomField AssigneeContatta = customFieldManager.getCustomFieldObjectsByName('CONTATTA_ASSIGNEE_BACKOFFICE')[0];\r\n\r\n\r\nString url = \"http://ms-prod.faacspa.local:8090/spo-service/\"\r\n\r\nJSONObject json = new JSONObject();\r\n//campo AGENTE_MAIL 3482 sia TEST CHE PROD\r\njson.put(\"agentemail\", objectFacade.loadObjectAttributeBean(issue.getCustomFieldValue(AssigneeContatta)[0].getId(), 3482).getObjectAttributeValueBeans()[0].getValue());\r\njson.put(\"telefono\", issue.getCustomFieldValue(contactNumber).toString());\r\njson.put(\"description\",issue.getCustomFieldValue(contactNumber).toString());\r\n\r\ndef idcampaign = 0\r\nif (issue.getCustomFieldValue(AssigneeContatta)!= \"\")\r\n{\r\n    //campo GROUP_REF 3498 sia TEST CHE PROD\r\n    def GroupAssignee = objectFacade.loadObjectAttributeBean(issue.getCustomFieldValue(AssigneeContatta)[0].getId(), 3498).getObjectAttributeValueBeans()[0].getValue()\r\n    def group = iqlFacade.findObjectsByIQLAndSchema(10, \"objectType=\\\"ContactManager_OperatorsGroup\\\" AND objectid = \" + GroupAssignee)\r\n\r\n    //Test campo IDCAMPAIGN 6328 in PROD 6577\r\n    idcampaign = objectFacade.loadObjectAttributeBean(group[0].getId(), 6577).getObjectAttributeValueBeans()[0].getValue().toString()\r\n    log.debug idcampaign\r\n}\r\n \r\njson.put(\"idcampaign\", idcampaign);\r\nlog.debug json\r\nHttpHeaders headersPost = new HttpHeaders();\r\nheadersPost.setContentType(MediaType.APPLICATION_JSON);\r\n\r\nHttpEntity&lt;String&gt; entity = new HttpEntity&lt;&gt;(json.toString(), headersPost);\r\n\r\nResponseEntity responseEntity = new RestTemplate().exchange(url + \"clickToCall\", HttpMethod.POST, entity, String.class);\r\n\r\nlog.debug \"ResponseCode:\" + responseEntity.getStatusCode()\r\nlog.debug \"ResponseMessage:\" + responseEntity.getBody()\r\n\r\n\r\n","scriptPath":null}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="91" name="Close Ticket">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="2">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="5" name="II° Level - Hold for investigation">
      <meta name="jira.status.id">15629</meta>
      <actions>
<common-action id="61" />
      </actions>
    </step>
    <step id="6" name="II° Level - Waiting for customer">
      <meta name="jira.status.id">15630</meta>
      <actions>
<common-action id="61" />
      </actions>
    </step>
  </steps>
</workflow>