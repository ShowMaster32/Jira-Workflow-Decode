<?xml version='1.0' encoding='UTF-8'?>
<workflow>
  <meta name="jira.description" />
  <meta name="jira.update.author.key">claudio.menetti</meta>
  <meta name="jira.updated.date">1521110728102</meta>
  <initial-actions>
    <action id="1" name="Create">
      <meta name="jira.i18n.submit">common.forms.create</meta>
      <meta name="jira.i18n.title">common.forms.create</meta>
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
        <validator name="" type="class">
          <arg name="FIELD_FUNCTION_ID">}√á&lt;√´=√•¬∑‚Ä∫m√∂√∫√´F¬Ωi¬¶√ªsMx√≥√ùZ√∑√áy√°¬ß√ù</arg>
          <arg name="FIELD_NOTES" />
          <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.validators.SimpleScriptedValidator</arg>
          <arg name="FIELD_CONDITION">cfValues.get("Department/Job Title")?.keySet()?.size() == 2</arg>
          <arg name="class.name">com.onresolve.jira.groovy.GroovyValidator</arg>
          <arg name="FIELD_ERROR_MSG">Please complete the "Department/Job Title" selection</arg>
          <arg name="FIELD_FORM_FIELD">customfield_14402</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="≈æ√©e" status="¬¢‚Äî¬ß" step="4">
          <post-functions>
            <function type="class">
              <arg name="field.name">–∂‚ïï–∏–æ+r</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value" />
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Set HQ HR CC</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.component.ComponentAccessor

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

def customFieldManager = ComponentAccessor.getCustomFieldManager()
def issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())

def delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select email addresses to set as BCC to send notifications to HQ HR reference
def sqlStmt_hq_hr_cc = "SELECT hq_hr_cc FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)

StringBuffer sq_hq_hr_cc = new StringBuffer()
sql.eachRow(sqlStmt_hq_hr_cc) {
	sq_hq_hr_cc &lt;&lt; it.hq_hr_cc
}
sql.close()
//log.debug "hq_hr_cc: " + sq_hq_hr_cc

if (sq_hq_hr_cc.toString()){
    sq_hq_hr_ccField.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(sq_hq_hr_ccField),sq_hq_hr_cc.toString()),changeHolder)
    //log.debug "field updated " + issue.getCustomFieldValue(sq_hq_hr_ccField)
}



</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">√£^_√≥¬≠¬õ√ì¬ñ¬û√•¬¶√¥√Øg[w¬æ8√ù√∂¬ú√ë¬æ√ü√∑¬á√º√ï¬≠4</arg>
              <arg name="FIELD_NOTES">Set Approval Status - In Progress</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.ComponentManager
import org.ofbiz.core.entity.GenericValue
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.index.Index.Manager
import com.atlassian.jira.issue.index.IssueIndexingService

def customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField approvalStatus = customFieldManager.getCustomFieldObject(Long.parseLong("15500"))
def fieldConfig = approvalStatus.getRelevantConfig(issue)
approvalStatus.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(approvalStatus),ComponentAccessor.optionsManager.getOptions(fieldConfig)?.find { it.optionId == 18770 }),changeHolder)
issueIndexingService.reIndex(issue)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">–ûG[ww6‚Ññw{m–ü]w—î‚î§–ûW–∏–∑–∏|‚ñÄ–à–∑m—ä—Ä¬§7</arg>
              <arg name="FIELD_NOTES">Set BU Controller</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level
import com.atlassian.jira.user.util.UserManager

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
//14.01.2016 AF
//[BU Controller]
//Alimentiamo il campo BU Controller che verr√† notificato in copia della nuova issue
//da approvare e verr√† abilitato ad avere visibilit√† su tutte le issue che riguardano
//la sua BU di riferimento dall'inizio. 
//Prima era solo dal momento in cui queste raggiungeranno l'approvazione
//del BU director. In questo modo tutte le richieste che dovessero essere annullate prima
//non andranno a creare confusione nelle dashboard dei controller. =&gt; questo meccanismo non funziona.
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")

log.setLevel(org.apache.log4j.Level.DEBUG)

//ComponentManager componentManager = ComponentManager.getInstance()
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
Object buValue = issue.getCustomFieldValue(bu)

//14.01.2016 AF
//[BU Controller]
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

Option parent
Option child

//14.01.2016 AF
//[BU Controller]
CustomField buController = customFieldManager.getCustomFieldObject("15301".toLong())

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//14.01.2016 AF
//[BU Controller]
//Il BU Controller viene selezionato direttamente da DB dalla stessa tabella e con gli stessi
//filtri utilizzati per l'interrogazione del BU Director.
//Mappare i BU Controller a livello di DB ci permetter√† di gestire/modificare/aggiungere in 
//modo dinamico utenti diversi per diverse funzioni e BU.
//N.B. Nel momento in cui si dovesse decidere di modificare l'utente responsabile per una certa BU,
//affinch√® questo visualizzi tutte le issue prima visualizzate dall'utente che lo precedeva,
//√® necessario fare una bulk change su tutte le issue con "BU Controller" = vecchio utente impostandolo
//uguale al nuovo nome utente.
def sqlStmt2 = "SELECT bu_controller FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
//14.01.2016 AF
//[BU Controller]
StringBuffer db_bu_controller = new StringBuffer()
//14.01.2016 AF
//[BU Controller]
sql.eachRow(sqlStmt2) {
	db_bu_controller &lt;&lt; it.bu_controller
}
sql.close()

//14.01.2016 AF
//[BU Controller]
//Dal momento che il campo "BU Controller" √® un campo di tipo User Picker, √® necessario
//convertire il nome utente (Stringa) in un elemento di tipo Application User.
//Questo elemento potr√† poi essere utilizzato per popolare il campo "BU Controller"
if (db_bu_controller.toString()){
    ApplicationUser newuser = ComponentAccessor.getUserManager().getUserByKey(db_bu_controller.toString())
    buController.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(buController),newuser),changeHolder)
}

issueIndexingService.reIndex(issue)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">√ì¬≠¬π√Ø}]{¬ΩZ√Øf√∏√ë√∑¬∏√∑M&lt;√ØN√ö¬Ü¬ù{¬á¬µi√á}</arg>
              <arg name="FIELD_NOTES">Enable "Local HR Team" as Visibility group</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level
import com.atlassian.jira.user.util.UserManager
import com.atlassian.crowd.embedded.api.Group
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")

log.setLevel(org.apache.log4j.Level.DEBUG)

//ComponentManager componentManager = ComponentManager.getInstance()
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)

//31.05.2017 AF
//[Local HR Team]
CustomField localHRteam = customFieldManager.getCustomFieldObject("18101".toLong())
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//31.05.2017 AF
//[Local HR Team]
def sqlStmt = "SELECT local_hr_group FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
//31.05.2017 AF
//[Local HR Team]
StringBuffer local_hr_team = new StringBuffer()
//31.05.2017 AF
//[Local HR Team]
sql.eachRow(sqlStmt) {
	local_hr_team &lt;&lt; it.local_hr_group
}
sql.close()

//31.05.2017 AF
//[Local HR Team]
log.debug "HR team: " + local_hr_team
if (local_hr_team.toString()){
    Group HRteam = ComponentAccessor.getGroupManager().getGroup(local_hr_team.toString())
    List&lt;Group&gt; groupList = new ArrayList&lt;Group&gt;()
    groupList.add(HRteam)
    localHRteam.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(localHRteam),groupList),changeHolder)
}                     
                            
issueIndexingService.reIndex(issue)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_ACTION">71 Ask Approval</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
              <arg name="FIELD_CONDITION">//If FAAC S.p.A. =&gt; Execute transition 11 (Ask Approval)
cfValues['Company']?.value == 'FAAC S.p.A.'</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_ADDITIONAL_SCRIPT" />
            </function>
            <function type="class">
              <arg name="FIELD_ACTION">181 Ask  Approval</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
              <arg name="FIELD_CONDITION">//If NOT FAAC S.p.A. =&gt; Execute transition 71 (Ask Approval)
cfValues['Company']?.value != 'FAAC S.p.A.'</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_ADDITIONAL_SCRIPT" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <common-actions>
    <action id="241" name="Approve" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">13100</meta>
      <restrict-to>
        <conditions type="OR">
          <condition type="class">
            <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
          </condition>
          <condition type="class">
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">currentUser.name == "francesca.mure"</arg>
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="16">
          <post-functions>
            <function type="class">
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowassigntoreporter-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.AssignToReporterFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">k¬∑^–ª¬¶—õi–ó–ªN—ôu–ß—ç¬ßx–Ω–ækw9q¬∑—ö–•–≠¬µ</arg>
              <arg name="FIELD_NOTES">Set Approval Status - Approved</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.ComponentManager
import org.ofbiz.core.entity.GenericValue
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.index.Index.Manager
import com.atlassian.jira.issue.index.IssueIndexingService

def customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField approvalStatus = customFieldManager.getCustomFieldObject(Long.parseLong("15500"))
def fieldConfig = approvalStatus.getRelevantConfig(issue)
approvalStatus.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(approvalStatus),ComponentAccessor.optionsManager.getOptions(fieldConfig)?.find { it.optionId == 18771 }),changeHolder)
issueIndexingService.reIndex(issue)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Send mail to Reporter - Approved</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS">group:RR-HR-team</arg>
              <arg name="FIELD_FUNCTION_ID">√Ø¬á9√ô√Ω[√µ√ß¬¥√Øm√º√≥√á¬ö√û√´n√úow√é[s√üx</arg>
              <arg name="FIELD_TO_USER_FIELDS">¬≠√™h¬Æ√ó¬´</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #14892C; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #14892C; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #14892C; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;

				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #14892C; border-color: #14892C; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: 
                    	&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().contains(',')){ %&gt; 
                        	&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt;
                        	- &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1)%&gt;
                    	&lt;%}%&gt;
                    	&lt;% if(!issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().contains(',')){ %&gt;
                    		&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
                        &lt;%}%&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().contains(',') &amp;&amp; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to view the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #FFFFFF; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request APPROVED</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(241): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(241): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(241): To =&gt; " + issue.reporter
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(241): CC =&gt; Gruppo:RR-HR-team"

return true</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="211" name="Approve" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">13100</meta>
      <restrict-to>
        <conditions type="AND">
          <condition type="class">
            <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
          </condition>
          <condition type="class">
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">cfValues['DeptBU Dir Clarifications'] == null</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="12">
          <post-functions>
            <function type="class">
              <arg name="field.name">j√ã"¬Çw¬û</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value">luca.bauckneht</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_FUNCTION_ID">√ù√¶√öq√á¬∏√ë√ó¬π{Nwwg√£Oz√ï√æ¬µ¬óZ√£}\√õG√ú</arg>
              <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")
import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(211): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(211): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(211): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(211): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="231" name="Reject" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">13100</meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="15">
          <post-functions>
            <function type="class">
              <arg name="field.name">j√ã"¬Çw¬û</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value" />
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">√õMx√ØM¬ª√ù√ç¬∫m√Ü√õ√±√ù¬Ω√´¬ß[√µ√∂¬πwg;√£G¬¥√©¬∂¬ü</arg>
              <arg name="FIELD_NOTES">Set Approval Status - Rejected</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.ComponentManager
import org.ofbiz.core.entity.GenericValue
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.index.Index.Manager
import com.atlassian.jira.issue.index.IssueIndexingService

def customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField approvalStatus = customFieldManager.getCustomFieldObject(Long.parseLong("15500"))
def fieldConfig = approvalStatus.getRelevantConfig(issue)
approvalStatus.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(approvalStatus),ComponentAccessor.optionsManager.getOptions(fieldConfig)?.find { it.optionId == 18772 }),changeHolder)
issueIndexingService.reIndex(issue)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Send mail to Reporter - Rejected</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS">group:RR-HR-team</arg>
              <arg name="FIELD_FUNCTION_ID">√õ¬∑√º√≥¬∑¬∂}¬≠√∏√ßWZ√ï√ù¬Ω√´√û}¬æ¬ö√±√Ω4√≠√üt√±√≠Z</arg>
              <arg name="FIELD_TO_USER_FIELDS">¬≠√™h¬Æ√ó¬´</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #A52019; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #A52019; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #A52019; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #A52019; border-color: #A52019; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to view the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #FFFFFF; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request REJECTED</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Reject'(231): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Reject'(231): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Reject'(231): To =&gt; " + issue.reporter
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Reject'(231): CC =&gt; Gruppo:RR-HR-team"

true</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="251" name="Approve " view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">13100</meta>
      <restrict-to>
        <conditions type="AND">
          <condition type="class">
            <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
          </condition>
          <condition type="class">
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">cfValues['DeptBU Dir Clarifications'] != null</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="13">
          <post-functions>
            <function type="class">
              <arg name="field.name">j√ã"¬Çw¬û</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value">andrea.marcellan</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_FUNCTION_ID">√üW8√ó√Ω√∑√Ü√ª√£Nws~√ï√Ω=√ï√é¬µkn¬ö√ë√∂√Ω√≥¬Æ</arg>
              <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruiment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruiment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruiment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruiment Request</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(251): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(251): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(251): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(251): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">RR-255</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="221" name="Approve" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">13100</meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="FIELD_FUNCTION_ID">√ù¬ßv{gv√ó√è√ìo}√≥N5√´¬á√ù√±¬æw√£^√õ√•¬∑ZwN√û</arg>
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())

issue.getCustomFieldValue(contract_type).getValue().equals("Permanent") &amp;&amp;
    (currentUser.name == "francesca.mure" || currentUser.name == issue.assignee.name)</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="13">
          <post-functions>
            <function type="class">
              <arg name="field.name">j√ã"¬Çw¬û</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value">andrea.marcellan</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_FUNCTION_ID">√≠√é√ü]]√ù√Æu√ü¬Ω√ü√óV√¥s~√óm^√≥¬Ωv√´¬Ü√öwM¬ö</arg>
              <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(221): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(221): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(221): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(221): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="301" name="Reject" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">13100</meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="15">
          <post-functions>
            <function type="class">
              <arg name="field.name">j√ã"¬Çw¬û</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value" />
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">√õMx√ØM¬ª√ù√ç¬∫m√Ü√õ√±√ù¬Ω√´¬ß[√µ√∂¬πwg;√£G¬¥√©¬∂¬ü</arg>
              <arg name="FIELD_NOTES">Set Approval Status - Rejected</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.ComponentManager
import org.ofbiz.core.entity.GenericValue
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.index.Index.Manager
import com.atlassian.jira.issue.index.IssueIndexingService

def customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField approvalStatus = customFieldManager.getCustomFieldObject(Long.parseLong("15500"))
def fieldConfig = approvalStatus.getRelevantConfig(issue)
approvalStatus.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(approvalStatus),ComponentAccessor.optionsManager.getOptions(fieldConfig)?.find { it.optionId == 18772 }),changeHolder)
issueIndexingService.reIndex(issue)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Send mail to Reporter - Rejected</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS">group:RR-HR-team</arg>
              <arg name="FIELD_FUNCTION_ID">o–ä—å–Ω—èt‚Äû–≠—É–ó–™—û–∂–è–Ω–å“ë–±¬∂—Ñsv—Ñ—ü—ëu{–Ü}</arg>
              <arg name="FIELD_TO_USER_FIELDS">¬≠√™h¬Æ√ó¬´</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #A52019; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #A52019; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #A52019; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #A52019; border-color: #A52019; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to view the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #FFFFFF; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request REJECTED</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Reject'(301): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Reject'(301): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Reject'(301): To =&gt; " + issue.reporter
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Reject'(301): CC =&gt; Gruppo:RR-HR-team"

true</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">RR-255</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="351" name="Approve " view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">13100</meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">cfValues['Contract Type']?.value == 'Temporary' &amp;&amp; (currentUser.name == "francesca.mure" || currentUser.name == issue.assignee.name)</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="16">
          <post-functions>
            <function type="class">
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowassigntoreporter-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.AssignToReporterFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">–°–ø;–•¬ß¬∂–ß}q–æ—ôW‚Ä∫s_\–£–¶¬∑{v–™–´M|sW—ô</arg>
              <arg name="FIELD_NOTES">Set Approval Status - Approved</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.ComponentManager
import org.ofbiz.core.entity.GenericValue
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.index.Index.Manager
import com.atlassian.jira.issue.index.IssueIndexingService

def customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField approvalStatus = customFieldManager.getCustomFieldObject(Long.parseLong("15500"))
def fieldConfig = approvalStatus.getRelevantConfig(issue)
approvalStatus.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(approvalStatus),ComponentAccessor.optionsManager.getOptions(fieldConfig)?.find { it.optionId == 18771 }),changeHolder)
issueIndexingService.reIndex(issue)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Send mail to Reporter - Approved</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS">group:RR-HR-team</arg>
              <arg name="FIELD_FUNCTION_ID">—Ö–óyi–∑x–∑—ï—õy–¶—à—Ém{–Ø—ü8–Ø–ß–™–£wu–ª–û{–≠–≠9</arg>
              <arg name="FIELD_TO_USER_FIELDS">¬≠√™h¬Æ√ó¬´</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #14892C; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #14892C; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #14892C; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;

				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #14892C; border-color: #14892C; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: 
                    	&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().contains(',')){ %&gt; 
                        	&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt;
                        	- &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1)%&gt;
                    	&lt;%}%&gt;
                    	&lt;% if(!issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().contains(',')){ %&gt;
                    		&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
                        &lt;%}%&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().contains(',') &amp;&amp; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to view the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #FFFFFF; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request APPROVED</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(241): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(241): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(241): To =&gt; " + issue.reporter
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(241): CC =&gt; Gruppo:RR-HR-team"

return true</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE" />
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </common-actions>
  <steps>
    <step id="4" name=":‚Äî¬ß">
      <meta name="jira.status.id">1</meta>
      <actions>
        <action id="71" name="Ask Approval">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="conditionList">3</arg>
                <arg name="comparisonType">1</arg>
                <arg name="class.name">com.googlecode.jsu.workflow.condition.ValueFieldCondition</arg>
                <arg name="fieldValue">FAAC S.p.A.</arg>
                <arg name="fieldsList">customfield_14300</arg>
              </condition>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyReporter</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="5">
              <post-functions>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">–£—ü7m9–ª^¬ª–•—ç{O–Ø¬¶—ò—á¬∂—ä–´NZ–ªG[—É‚Äì—â</arg>
                  <arg name="FIELD_NOTES">Set Department Manager</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.user.util.UserManager
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.issue.index.IssueIndexingService

CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

CustomField deptManager = customFieldManager.getCustomFieldObject("12400".toLong())
ApplicationUser deptManagerUser = (ApplicationUser)issue.getCustomFieldValue(deptManager)
def deptManagerValue = deptManagerUser.name

issue.setAssignee(ComponentAccessor.userManager.getUserByKey(deptManagerValue.toString()))

issueIndexingService.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_ALL</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">{~√ï¬ß¬¥√£V¬Ω}√∑t¬ß√ó¬æ;m√é√πk¬á√∫√µ¬æ8√ü¬∑</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;
					&amp;nbsp;
				  &lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

//ComponentManager componentManager = ComponentManager.getInstance()
CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
currentUser = ComponentAccessor.jiraAuthenticationContext.getLoggedInUser()

CustomField UserPicker = customFieldManager.getCustomFieldObject("12400".toLong())
Object UserPickerValue = issue.getCustomFieldValue(UserPicker)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(71): UserPrickerValue.key =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(71): UserPrickerValue.key =&gt; " + UserPickerValue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(71): currentUser.name =&gt; " + currentUser.name
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(71): Evaluated condition =&gt; " + UserPickerValue.key != currentUser.name
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(71): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(71): CC =&gt; francesca.mure@faacgroup.com"

UserPickerValue.key != currentUser.name</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-249</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">√ë√∑o¬é√ü√ù√µww¬ö√£Wkm√∫√µ√ó:}√Æ√ù√°¬Ω√ú√±√≠7</arg>
                  <arg name="FIELD_ACTION">151 Approve  </arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">//RR - (FAAC S.p.A.) If Reporter = Dept.Manager =&gt; Automatic transition to HQ HR Approval
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.component.ComponentAccessor

ComponentManager componentManager = ComponentManager.getInstance()
def user = ComponentAccessor.jiraAuthenticationContext.loggedInUser

CustomField UserPicker = customFieldManager.getCustomFieldObject(Long.parseLong("12400"))
Object UserPickerValue = issue.getCustomFieldValue(UserPicker)

UserPickerValue.key == currentUser.name &amp;&amp; cfValues['Contract Type']?.value == 'Temporary'</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS" />
                  <arg name="FIELD_ADDITIONAL_SCRIPT" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">√±¬∑¬∏√ì]6√ë√Ω4√è4√õ¬¶√π√ó¬Ωt{f√Ω√©√æ9√∑‚Ä°√ìm‚Ä∫</arg>
                  <arg name="FIELD_ACTION">81 Approve</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">//RR - (FAAC S.p.A.) If Reporter = Dept.Manager =&gt; Automatic transition to HQ HR Approval
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.component.ComponentAccessor

ComponentManager componentManager = ComponentManager.getInstance()
currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser

CustomField UserPicker = customFieldManager.getCustomFieldObject(Long.parseLong("12400"))
Object UserPickerValue = issue.getCustomFieldValue(UserPicker)

UserPickerValue.key == currentUser.name &amp;&amp; cfValues['Contract Type']?.value == 'Permanent'</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS" />
                  <arg name="FIELD_ADDITIONAL_SCRIPT" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="181" name="Ask  Approval">
          <meta name="jira.description">
</meta>
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="conditionList">6</arg>
                <arg name="comparisonType">1</arg>
                <arg name="class.name">com.googlecode.jsu.workflow.condition.ValueFieldCondition</arg>
                <arg name="fieldValue">FAAC S.p.A.</arg>
                <arg name="fieldsList">customfield_14300</arg>
              </condition>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyReporter</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">cfValues['GeneralManager Clarifications'] == null</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="9">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set General Manager</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
//import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")

log.setLevel(org.apache.log4j.Level.DEBUG)
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()
def userUtil = ComponentAccessor.getUserUtil()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)
CustomField general_manager = customFieldManager.getCustomFieldObject("14405".toLong())
CustomField local_controller = customFieldManager.getCustomFieldObject("14406".toLong())
CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

//UserUtil userUtil = componentManager.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

def sqlStmt_gm = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt_gm) {
	sq_generalManager &lt;&lt; it.general_manager
}
sql.close()

if(sq_generalManager){
    ApplicationUser newuser = ComponentAccessor.getUserManager().getUserByKey(sq_generalManager.toString())
	general_manager.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(general_manager),newuser),changeHolder)
}
issueIndexingService.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">√≠√è:√∑W¬û√≥¬∑¬∫√ü√ü6s]√∫√ó^√üM√Ω√±¬æ[sv√π√•¬Æv</arg>
                  <arg name="FIELD_NOTES">Set Local Controller</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
//import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")

log.setLevel(org.apache.log4j.Level.DEBUG)
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()
def userUtil = ComponentAccessor.getUserUtil()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)
CustomField general_manager = customFieldManager.getCustomFieldObject("14405".toLong())
CustomField local_controller = customFieldManager.getCustomFieldObject("14406".toLong())
CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
def sqlStmt_controller
if (parent.getValue().toString().equals("General Manager")){
	sqlStmt_controller = "SELECT TOP 1 bu_controller AS controller FROM FC_RR_OrganizationalChartHQ WHERE bu = '" + buValue.toString() + "'"   
}else{
    sqlStmt_controller = "SELECT controller FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
}
 
StringBuffer sq_controller = new StringBuffer()
sql.eachRow(sqlStmt_controller) {
	sq_controller &lt;&lt; it.controller
}
sql.close()

if (sq_controller){
    ApplicationUser newuser2 = ComponentAccessor.getUserManager().getUserByKey(sq_controller.toString())
	local_controller.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(local_controller),newuser2),changeHolder)
}

issueIndexingService.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">–≤–Ω_–ò‚ïù7—Å^‚ï§}–Ω—á—â‚ïûx—àM\–ì‚ñà—áu–ºx—è–§‚ï™—è‚ïï‚ï¢</arg>
                  <arg name="FIELD_NOTES">Assign issue to Local Controller</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserManager

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)
CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");
def sqlStmt_controller

//Select project key on service desk
if (parent.getValue().toString().equals("General Manager")){
	sqlStmt_controller = "SELECT TOP 1 bu_controller AS controller FROM FC_RR_OrganizationalChartHQ WHERE bu = '" + buValue.toString() + "'"   
}else{
	sqlStmt_controller = "SELECT controller FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
}
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_controller = new StringBuffer()
sql.eachRow(sqlStmt_controller) {
	sq_controller &lt;&lt; it.controller
}
sql.close()

if (sq_controller) {
    issue.setAssignee(ComponentAccessor.getUserManager().getUserByKey(sq_controller.toString()) as ApplicationUser)
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_ALL</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">–õ—ç—çN‚îå–û^–™–∑–ô8—à–æ—à—à‚ñ†–ßy–∏‚ñÄ–≤–∫‚î§y¬ß–©–∏</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;


				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")


import com.atlassian.jira.issue.fields.CustomField
import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

//CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())

//mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())




import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.component.ComponentAccessor

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService


def customFieldManager = ComponentAccessor.getCustomFieldManager()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)

def delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select email addresses to set as BCC to send notifications to HQ HR reference
def sqlStmt_hq_hr_cc = "SELECT hq_hr_cc FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)

StringBuffer sq_hq_hr_cc = new StringBuffer()
sql.eachRow(sqlStmt_hq_hr_cc) {
	sq_hq_hr_cc &lt;&lt; it.hq_hr_cc
}
sql.close()

mail.setCc(sq_hq_hr_cc.toString())

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(181): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(181): Evaluated condition =&gt; always true"
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(181): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(181): CC =&gt; ----" + sq_hq_hr_cc + "-----"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-255</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="291" name="Ask   Approval">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyReporter</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">cfValues['GeneralManager Clarifications'] != null</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
              <condition type="class">
                <arg name="conditionList">6</arg>
                <arg name="comparisonType">1</arg>
                <arg name="class.name">com.googlecode.jsu.workflow.condition.ValueFieldCondition</arg>
                <arg name="fieldValue">FAAC S.p.A.</arg>
                <arg name="fieldsList">customfield_14300</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="10">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">—ü—ë—ã–Ω‚àÜ—Ü‚Äûw9o–≠‚Ññ—û–Ü:—è~5‚Äù—úogZwG—ów–äy</arg>
                  <arg name="FIELD_NOTES">Assign issue to General Manager</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
//import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)

//UserUtil userUtil = componentManager.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");


//Check country manager
def sqlStmt = "SELECT country_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_countryManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_countryManager &lt;&lt; it.country_manager
}
sql.close()

if (sq_countryManager != null &amp;&amp; !sq_countryManager.toString().equals("") &amp;&amp; !sq_countryManager.toString().equals("null")){
	issue.setAssignee(ComponentManager.instance.userUtil.getUserObject(sq_countryManager.toString()))    
}else{
    sqlStmt = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

    conn = ConnectionFactory.getConnection(helperName);
    sql = new Sql(conn)
    StringBuffer sq_generalManager = new StringBuffer()
    sql.eachRow(sqlStmt) {
        sq_generalManager &lt;&lt; it.general_manager
    }
    sql.close()

    issue.setAssignee(ComponentManager.instance.userUtil.getUserObject(sq_generalManager.toString()))
}</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">√ù√Ü¬∑k¬ç{√´G^y√ø√∑N√∑√£^|√£¬ç√û}¬æ√º¬≠t√©√û¬ü</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to assignee if sq_generalManager.toString() != issue.reporter.name</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">‚ñà–î_‚îò–ö5‚ñà–å–©‚Ññ–πy–≤–∏&lt;‚ñà–á–è—Å]—è—Å–û}‚Ññ–™x—ç–à4</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if(currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())

import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
//import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
//import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level
import com.atlassian.jira.component.ComponentAccessor
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)

def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Check country manager
def sqlStmt = "SELECT country_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_countryManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_countryManager &lt;&lt; it.country_manager
}
sql.close()

//log.debug "country manager: " + sq_countryManager

if (sq_countryManager != null &amp;&amp; sq_countryManager != ""){
    
    sqlStmt = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

    conn = ConnectionFactory.getConnection(helperName);
    sql = new Sql(conn)
    StringBuffer sq_generalManager = new StringBuffer()
    sql.eachRow(sqlStmt) {
        sq_generalManager &lt;&lt; it.general_manager
    }
    sql.close()
    
    String cc_addresses = issue.getCustomFieldValue(sq_hq_hr_ccField).toString() + "," + ComponentAccessor.getUserManager().getUserByKey(sq_generalManager.toString()).getEmailAddress()
	mail.setCc(cc_addresses)
}else{
    mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())
}

customFieldManager = ComponentAccessor.getCustomFieldManager()
currentUser = ComponentAccessor.jiraAuthenticationContext.getLoggedInUser()
issueManager = ComponentAccessor.getIssueManager()

CustomField departmentManager = customFieldManager.getCustomFieldObject("12400".toLong())
Object departmentManagerValue = issue.getCustomFieldValue(departmentManager)


sqlStmt = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
 
conn = ConnectionFactory.getConnection(helperName);
sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_generalManager &lt;&lt; it.general_manager
}
sql.close()

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(291): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(291): sq_generalManager =&gt; " + sq_generalManager.toString()
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(291): issue.reporter.name =&gt; " + issue.reporter.name
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(291): Evaluated condition =&gt; " + sq_generalManager.toString() != issue.reporter.name
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(291): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Approval'(291): CC =&gt; francesca.mure@faacgroup.com"

(sq_countryManager != null &amp;&amp; sq_countryManager != "" &amp;&amp; sq_countryManager!= issue.reporter.name) || (sq_countryManager == null || sq_countryManager == "" &amp;&amp; (sq_generalManager.toString() != issue.reporter.name))</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-255</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">√ìW√∏√ßW√∂√ØN|√õ√û√º√©¬Ωxu¬Ω√ï√∑4√ì√á:o¬ù√π√´√á√ª</arg>
                  <arg name="FIELD_ACTION">201 Approve</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.component.ComponentAccessor
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

ComponentManager componentManager = ComponentManager.getInstance()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField company = customFieldManager.getCustomFieldObject(Long.parseLong("14300"))
Object companyValue = issue.getCustomFieldValue(company)
CustomField generalManager = customFieldManager.getCustomFieldObject(Long.parseLong("14405"))
Object generalManagerValue = issue.getCustomFieldValue(generalManager)


//UserUtil userUtil = componentManager.getUserUtil()
def cfassignee = ""

def delegator = (DelegatorInterface) componentManager.getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select project key on service desk
def sqlStmt = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_generalManager &lt;&lt; it.general_manager
}
sql.close()

sq_generalManager.toString() == issue.reporter.name</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS" />
                  <arg name="FIELD_ADDITIONAL_SCRIPT" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="5" name="Dept.Manager Approval">
      <meta name="jira.status.id">11427</meta>
      <meta name="jira.permission.assign.user">francesca.mure</meta>
      <actions>
        <action id="81" name="Approve" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">√≠¬ß\}√ù¬ü√∑¬Ωu√∑G}√ë¬¶¬∂s^[√õ¬æ¬ùm√ùuo]¬µ√ë√ù√ª</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">cfValues['DeptBU Dir Clarifications'] == null &amp;&amp; cfValues['Contract Type']?.value == 'Permanent'</arg>
                <arg name="FIELD_PREVIEW_ISSUE">RR-554</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">cfValues['HR Clarifications'] == null</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="6">
              <post-functions>
                <function type="class">
                  <arg name="field.name">j√ã"¬Çw¬û</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">elisabetta.luppi</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_ALL</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">oM√ô√Æ√°√¶¬õk√û¬õw¬æ7√õ√ó¬ù√Ø√ó√ª√±√≠8s¬Ü¬∫kV√∑</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
					  &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if(currentUser) {%&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;%}%&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")
mail.setCc("francesca.mure@faacgroup.com, luca.bauckneht@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(81): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(81): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(81): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(81): CC =&gt; francesca.mure@faacgroup.com, luca.bauckneht@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-255</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="151" name="Approve  " view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">√Øv√ª√∑¬û√π√µ¬Æ√µ√©√∑√ö√´√ó√ßF¬µs¬Øx√ØNym√ñ√ºk√áv</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">cfValues['HR Clarifications'] != null || cfValues['Contract Type']?.value == 'Temporary'</arg>
                <arg name="FIELD_PREVIEW_ISSUE">RR-553</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="7">
              <post-functions>
                <function type="class">
                  <arg name="field.name">j√ã"¬Çw¬û</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">luca.bauckneht</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√≠√ó√∑o¬áy√°¬Ω¬ª√ï√á√π√ô√è7√°√æ√ù√ï√è}¬Æ√∏on√Ωk¬ç¬π</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
					  &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
//14.01.2016 AF
//[BU Controller]
//Contestualmente all'individuazione del BU Director a cui verr√† assegnata la issue
//alimentiamo il campo BU Controller che verr√† notificato in copia della nuova issue
//da approvare e verr√† abilitato ad avere visibilit√† su tutte le issue che riguardano
//la sua BU di riferimento solo dal momento in cui queste raggiungeranno l'approvazione
//del BU director. In questo modo tutte le richieste che dovessero essere annullate prima
//non andranno a creare confusione nelle dashboard dei controller.
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(151): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(151): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(151): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(151): CC =&gt; francesca.mure@faacgroup.com"

CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())
if(issue.getCustomFieldValue(contract_type) == 'Temporary'){
    /*
    Le modifiche apportate a questo script devono essere riportate anche sullo script di esecuzione automatica della transazione Approve(211).
    Tale script si trova sulla transazione Approve da General Manager Approval e BU/Group Function Dir. Approval
    */
    
    CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
    IssueManager issueManager = ComponentAccessor.getIssueManager()
    IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

    //14.01.2016 AF
    //[BU Controller]
    IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

    CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
    Object buValue = issue.getCustomFieldValue(bu)
    CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
    Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

    //14.01.2016 AF
    //[BU Controller]
    CustomField buController = customFieldManager.getCustomFieldObject("15301".toLong())

    Option parent
    Option child

    HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
    if (hashMapEntries != null) {
    parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
    child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
    }

    UserUtil userUtil = ComponentAccessor.getUserUtil()
    def cfassignee = ""


    DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
    String helperName = delegator.getGroupHelperName("default");

    //Select project key on service desk
    def sqlStmt = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

    //14.01.2016 AF
    //[BU Controller]
    //Il BU Controller viene selezionato direttamente da DB dalla stessa tabella e con gli stessi
    //filtri utilizzati per l'interrogazione del BU Director.
    //Mappare i BU Controller a livello di DB ci permetter√† di gestire/modificare/aggiungere in 
    //modo dinamico utenti diversi per diverse funzioni e BU.
    //N.B. Nel momento in cui si dovesse decidere di modificare l'utente responsabile per una certa BU,
    //affinch√® questo visualizzi tutte le issue prima visualizzate dall'utente che lo precedeva,
    //√® necessario fare una bulk change su tutte le issue con "BU Controller" = vecchio utente impostandolo
    //uguale al nuovo nome utente.
    //def sqlStmt2 = "SELECT bu_controller FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

    //log.debug "Set assignee - query statement x director: " +sqlStmt

    Connection conn = ConnectionFactory.getConnection(helperName);
    Sql sql = new Sql(conn)
    StringBuffer sq_BUFunctDirector = new StringBuffer()

    //14.01.2016 AF
    //[BU Controller]
    StringBuffer db_bu_controller = new StringBuffer()

    sql.eachRow(sqlStmt) {
        sq_BUFunctDirector &lt;&lt; it.director
    }

    String recipients = "francesca.mure@faacgroup.com" + "," + ComponentAccessor.getUserManager().getUserByKey(sq_BUFunctDirector.toString()).getEmailAddress() + "," + ComponentAccessor.getUserManager().getUserByKey(issue.getCustomFieldValue(buController).name.toString()).getEmailAddress()
    mail.setCc(recipients)
}else{
    mail.setCc("francesca.mure@faacgroup.com")
}

//***** NEW *****

CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
    parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
    child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

def delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)

//Select hr business partner for selected Job Title and BU
def sqlStmt_hr_business_partner = "SELECT hr_business_partner FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer sq_HRBusPartner = new StringBuffer()
sql.eachRow(sqlStmt_hr_business_partner) {
    sq_HRBusPartner &lt;&lt; it.hr_business_partner
}
sql.close()

if(sq_HRBusPartner!=null){
    def currentCc = mail.getCc()

    def NamesList = sq_HRBusPartner.toString().split(", ")
	def i =0
    
    for (i = 0; i &lt;NamesList.length; i++) {
    	if (currentCc!=null) {currentCc=currentCc+', '}
		currentCc = currentCc + ComponentAccessor.getUserManager().getUserByKey(NamesList[i]).getEmailAddress()
	}

    mail.setCc(currentCc)
}
//***** END NEW *****

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="161" name="Approve " view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">cfValues['DeptBU Dir Clarifications'] != null</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="8">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">u—á–ú–æ&lt;–í—Ñ‚ïß}–ù–∑–≤–≤w—á‚ï§i‚ïï–í—â‚ïú‚ï™–Ø‚ïûZ{g–ñ</arg>
                  <arg name="FIELD_NOTES">Assign issue to BU Director</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
Object buValue = issue.getCustomFieldValue(bu)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select project key on service desk
def sqlStmt = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_generalManager &lt;&lt; it.director
}
sql.close()

issue.setAssignee(ComponentAccessor.getUserManager().getUserByKey(sq_generalManager.toString()))
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√≠√ó√∑o¬áy√°¬Ω¬ª√ï√á√π√ô√è7√°√æ√ù√ï√è}¬Æ√∏on√Ωk¬ç¬π</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
					  &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(161): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(161): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(161): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(161): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="171" name="Ask Clarifications" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="4">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowassigntoreporter-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.AssignToReporterFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√õw√∫√ßV¬∏√ØM√π√´√ù√∂√ó¬Ω=√ï¬æ√º√£n]√ì^√ü√ß¬é√ª√ó¬ó¬ú</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #FFD351; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Further clarifications needed for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #4A6785; border-color: #4A6785; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to review the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Further clarifications needed for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(171): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(171): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(171): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(171): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="6" name="Budget Checking">
      <meta name="jira.status.id">11428</meta>
      <meta name="jira.permission.assign.user">francesca.mure</meta>
      <actions>
        <action id="91" name="Budget checked" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13200</meta>
          <restrict-to>
            <conditions type="OR">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "francesca.mure"</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="hidFieldsList">customfield_14401@@</arg>
              <arg name="class.name">com.googlecode.jsu.workflow.validator.FieldsRequiredValidator</arg>
            </validator>
            <validator name="" type="class">
              <arg name="contextHandling" />
              <arg name="hidFieldsList">customfield_14414@@customfield_14415@@</arg>
              <arg name="class.name">com.googlecode.jsu.workflow.validator.FieldsRequiredValidator</arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="7">
              <post-functions>
                <function type="class">
                  <arg name="field.name">j√ã"¬Çw¬û</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">luca.bauckneht</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√≠√ó√∑o¬áy√°¬Ω¬ª√ï√á√π√ô√è7√°√æ√ù√ï√è}¬Æ√∏on√Ωk¬ç¬π</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
					  &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">//***** NEW *****
import org.apache.log4j.Category
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.component.ComponentAccessor
//***** END NEW *****

mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

//***** NEW *****

CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
    parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
    child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

def delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)

//Select hr business partner for selected Job Title and BU
def sqlStmt_hr_business_partner = "SELECT hr_business_partner FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer sq_HRBusPartner = new StringBuffer()
sql.eachRow(sqlStmt_hr_business_partner) {
    sq_HRBusPartner &lt;&lt; it.hr_business_partner
}
sql.close()

if(sq_HRBusPartner!=null){
    def currentCc = mail.getCc()

    def NamesList = sq_HRBusPartner.toString().split(", ")
	def i =0
    
    for (i = 0; i &lt;NamesList.length; i++) {
    	if (currentCc!=null) {currentCc=currentCc+', '}
		currentCc = currentCc + ComponentAccessor.getUserManager().getUserByKey(NamesList[i]).getEmailAddress()
	}

    mail.setCc(currentCc)
}
//***** END NEW *****

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(91): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(91): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(91): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(91): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="7" name="HQ HR Approval">
      <meta name="jira.status.id">11429</meta>
      <meta name="jira.permission.assign.denied">denied</meta>
      <actions>
<common-action id="301" />
<common-action id="351" />
        <action id="101" name="Approve" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">‚Äî—á—ë–øm—à–≥^|—ü–≠–à—û¬´–á–Ω—ö5–≥n–è–µ–∑—ñ–µ–ø–µ–å–¨</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">cfValues['Contract Type']?.value == 'Permanent' &amp;&amp; (currentUser.name == "francesca.mure" || currentUser.name == issue.assignee.name)</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="8">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">m√û√Ω√Ø√ç√ös√ù¬ºu√Ü¬∂√•√ù¬õ√ë√∑{√ß¬èt√ï√ó7u√ç¬º√ì¬è_</arg>
                  <arg name="FIELD_NOTES">Set BU Director</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
//14.01.2016 AF
//[BU Controller]
//Contestualmente all'individuazione del BU Director a cui verr√† assegnata la issue
//alimentiamo il campo BU Controller che verr√† notificato in copia della nuova issue
//da approvare e verr√† abilitato ad avere visibilit√† su tutte le issue che riguardano
//la sua BU di riferimento solo dal momento in cui queste raggiungeranno l'approvazione
//del BU director. In questo modo tutte le richieste che dovessero essere annullate prima
//non andranno a creare confusione nelle dashboard dei controller.
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

//ComponentManager componentManager = ComponentManager.getInstance()
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
Object buValue = issue.getCustomFieldValue(bu)

//14.01.2016 AF
//[BU Controller]
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

Option parent
Option child

//14.01.2016 AF
//[BU Controller]
//CustomField buController = customFieldManager.getCustomFieldObject("15301".toLong())

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select project key on service desk
def sqlStmt = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

//14.01.2016 AF
//[BU Controller]
//Il BU Controller viene selezionato direttamente da DB dalla stessa tabella e con gli stessi
//filtri utilizzati per l'interrogazione del BU Director.
//Mappare i BU Controller a livello di DB ci permetter√† di gestire/modificare/aggiungere in 
//modo dinamico utenti diversi per diverse funzioni e BU.
//N.B. Nel momento in cui si dovesse decidere di modificare l'utente responsabile per una certa BU,
//affinch√® questo visualizzi tutte le issue prima visualizzate dall'utente che lo precedeva,
//√® necessario fare una bulk change su tutte le issue con "BU Controller" = vecchio utente impostandolo
//uguale al nuovo nome utente.
//def sqlStmt2 = "SELECT bu_controller FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()

//14.01.2016 AF
//[BU Controller]
StringBuffer db_bu_controller = new StringBuffer()

sql.eachRow(sqlStmt) {
	sq_generalManager &lt;&lt; it.director
}
sql.close()

//14.01.2016 AF
//[BU Controller]
//sql.eachRow(sqlStmt2) {
//	db_bu_controller &lt;&lt; it.bu_controller
//}
//log.debug "Director: " + sq_generalManager
issue.setAssignee(ComponentAccessor.userManager.getUserByKey(sq_generalManager.toString()))
//14.01.2016 AF
//[BU Controller]
//Dal momento che il campo "BU Controller" √® un campo di tipo User Picker, √® necessario
//convertire il nome utente (Stringa) in un elemento di tipo Application User.
//Questo elemento potr√† poi essere utilizzato per popolare il campo "BU Controller"
//ApplicationUser newuser = userUtil.getUserByKey(db_bu_controller.toString())
//buController.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(buController),newuser),changeHolder)

issueIndexingService.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS">customfield_15301</arg>
                  <arg name="FIELD_FUNCTION_ID">—ã‚ï•u–£—á‚å°—Å‚ï•‚ï©–û¬∑‚ï®–£‚ïú\—Å—á}—à√∑}–¶^[—ä‚ï¨8—ä~–í</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;



				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
					  &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setBcc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

//ComponentManager componentManager = ComponentManager.getInstance()
CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
currentUser = ComponentAccessor.jiraAuthenticationContext.getLoggedInUser()

CustomField DeptManager = customFieldManager.getCustomFieldObject("12400".toLong())
Object DeptManagerValue = issue.getCustomFieldValue(DeptManager)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(101): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(101): DeptManagerValue.key =&gt; " + DeptManagerValue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(101): issue.assignee.name =&gt; " + issue.assignee.name
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(101): Evaluated condition =&gt; " + DeptManagerValue.key != issue.assignee.name
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(101): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(101): CC =&gt; francesca.mure@faacgroup.com, " + issue.getCustomFieldValue(customFieldManager.getCustomFieldObject("15301".toLong()))

DeptManagerValue.key != issue.assignee.name</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-290</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">~—à–úMq—å—èq—å—é—Ä‚îê^y—É\o~}‚ñÄW]u–®‚ïë—çG–®</arg>
                  <arg name="FIELD_ACTION">111 Approve</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser

CustomField DeptManager = customFieldManager.getCustomFieldObject(Long.parseLong("12400"))
Object DeptManagerValue = issue.getCustomFieldValue(DeptManager)

DeptManagerValue.key == issue.assignee.name</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS" />
                  <arg name="FIELD_ADDITIONAL_SCRIPT" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="141" name="Ask Clarifications" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions type="OR">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "francesca.mure"</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="5">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_14302</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">%%CURRENT_DATETIME%%</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">–£—ü7m9–ª^¬ª–•—ç{O–Ø¬¶—ò—á¬∂—ä–´NZ–ªG[—É‚Äì—â</arg>
                  <arg name="FIELD_NOTES">Set Department Manager as Assignee</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.user.util.UserManager
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.issue.index.IssueIndexingService

CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

CustomField deptManager = customFieldManager.getCustomFieldObject("12400".toLong())
ApplicationUser deptManagerUser = (ApplicationUser)issue.getCustomFieldValue(deptManager)
def deptManagerValue = deptManagerUser.name

issue.setAssignee(ComponentAccessor.userManager.getUserByKey(deptManagerValue.toString()))

issueIndexingService.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√ó}¬∑√ì¬ó¬ú√õG√Ω√ï¬≠¬úo¬Øvs¬éwi√á¬ü√´¬¶√º√ù√∂¬∏√ë¬∑√π</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #FFD351; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Further clarifications needed for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to review the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Further clarifications needed for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(141): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(141): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(141): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(141): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="8" name="Dept./BU Director Approval">
      <meta name="jira.status.id">11430</meta>
      <meta name="jira.permission.assign.user">francesca.mure</meta>
      <actions>
        <action id="111" name="Approve" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions type="OR">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">œáGœâyŒΩwŒ∑g|ŒØ‚Äì‚Ä∫yŒùŒ≥ŒÆ|œÖŒæœäoOvŒ£N7Œøwv</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level

import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser

CustomField jobTitle = customFieldManager.getCustomFieldObject(Long.parseLong("14402"))
CustomField bu = customFieldManager.getCustomFieldObject(Long.parseLong("14403"))
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
Object buValue = issue.getCustomFieldValue(bu)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

def delegator = (DelegatorInterface) ComponentAccessor.getComponent(DelegatorInterface)
String helperName = delegator.getGroupHelperName("default");

//Select project key on service desk
def sqlStmt = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_generalManager &lt;&lt; it.director
}
sql.close()

CustomField DeptManager = customFieldManager.getCustomFieldObject(Long.parseLong("12400"))
Object DeptManagerValue = issue.getCustomFieldValue(DeptManager)

sq_generalManager.toString() == DeptManagerValue.key &amp;&amp; currentUser.name == 'francesca.mure'</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == 'francesca.mure'</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="13">
              <post-functions>
                <function type="class">
                  <arg name="field.name">j√ã"¬Çw¬û</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">andrea.marcellan</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">–≥n—ã–µ–É—î—Å–Ü—ñ–ªn‚Ññ–ø^–Ñ–∑–≠t—ü–Éy–ªW—Ü‚Äî¬´–Ø‚Äù–¶–Å</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(111): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(111): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(111): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(111): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="131" name="Ask Clarifications" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="5">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_14301</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">%%CURRENT_DATETIME%%</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">–£—ü7m9–ª^¬ª–•—ç{O–Ø¬¶—ò—á¬∂—ä–´NZ–ªG[—É‚Äì—â</arg>
                  <arg name="FIELD_NOTES">Set Department Manager as Assignee</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.user.util.UserManager
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.issue.index.IssueIndexingService

CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

CustomField deptManager = customFieldManager.getCustomFieldObject("12400".toLong())
ApplicationUser deptManagerUser = (ApplicationUser)issue.getCustomFieldValue(deptManager)
def deptManagerValue = deptManagerUser.name

issue.setAssignee(ComponentAccessor.getUserManager().getUserByKey(deptManagerValue.toString()))

issueIndexingService.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√ó}¬∑√ì¬ó¬ú√õG√Ω√ï¬≠¬úo¬Øvs¬éwi√á¬ü√´¬¶√º√ù√∂¬∏√ë¬∑√π</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #FFD351; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Further clarifications needed for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to review the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Further clarifications needed for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(131): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(131): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(131): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(131): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="9" name="Local Controller Approval">
      <meta name="jira.status.id">11431</meta>
      <meta name="jira.permission.assign.user">francesca.mure</meta>
      <actions>
        <action id="191" name="Budget checked" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13200</meta>
          <restrict-to>
            <conditions type="OR">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "francesca.mure"</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="hidFieldsList">customfield_14401@@</arg>
              <arg name="class.name">com.googlecode.jsu.workflow.validator.FieldsRequiredValidator</arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="10">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">—ü—ë—ã–Ω‚àÜ—Ü‚Äûw9o–≠‚Ññ—û–Ü:—è~5‚Äù—úogZwG—ów–äy</arg>
                  <arg name="FIELD_NOTES">Set General Manager/Country Manager as Assignee</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
//import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level
import org.apache.log4j.Category
import com.atlassian.jira.component.ComponentAccessor
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)

def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Check country manager
def sqlStmt_country_manager = "SELECT country_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_countryManager = new StringBuffer()
sql.eachRow(sqlStmt_country_manager) {
	sq_countryManager &lt;&lt; it.country_manager
}
sql.close()

//log.debug "country manager: " + sq_countryManager
//log.debug "check condition 1: " + (sq_countryManager != null)
//log.debug "check condition 2: " + (!sq_countryManager.toString().equals(""))
//log.debug "check condition 3: " + (!sq_countryManager.toString().equals("null"))

if (sq_countryManager != null &amp;&amp; !sq_countryManager.toString().equals("") &amp;&amp; !sq_countryManager.toString().equals("null")){
	issue.setAssignee(ComponentAccessor.userManager.getUserByKey(sq_countryManager.toString()))    
}else{
	//log.debug "check general manager --&gt; country manager is null"
    def sqlStmt_gm = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

    conn = ConnectionFactory.getConnection(helperName);
    sql = new Sql(conn)
    StringBuffer sq_generalManager = new StringBuffer()
    sql.eachRow(sqlStmt_gm) {
        sq_generalManager &lt;&lt; it.general_manager
    }
	sql.close()
    
    //log.debug "general manager: " + sq_generalManager
    
    issue.setAssignee(ComponentAccessor.userManager.getUserByKey(sq_generalManager.toString()))
}

</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√£¬ç¬ü{¬áy√°√áy√≥_√õ]√õ{√ûs¬ß¬∏√Ø√û√õ√•√ß√º√≥¬ñ√Ω</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.ApplicationUsers

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
//import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level
import com.atlassian.jira.component.ComponentAccessor
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)


CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())

CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)
CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())

def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Check country manager
def sqlStmt = "SELECT country_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_countryManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_countryManager &lt;&lt; it.country_manager
}
sql.close()

//Check Company "no bu"
def sqlStmt_company = "SELECT count(*) AS tot_row FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

conn = ConnectionFactory.getConnection(helperName);
Sql sql_company = new Sql(conn)
StringBuffer result = new StringBuffer()
sql_company.eachRow(sqlStmt_company) {
 result &lt;&lt; it.tot_row
}
sql.close()

//Check HQ Controller
def sqlStmt_hq_controller = "SELECT hq_controller FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

conn = ConnectionFactory.getConnection(helperName);
Sql sql_hq_controller = new Sql(conn)
StringBuffer result_hq_controller = new StringBuffer()
sql_hq_controller.eachRow(sqlStmt_hq_controller) {
 result_hq_controller &lt;&lt; it.hq_controller
}
sql.close()

//Se esiste un country manager invio la notifica a lui per l'approvazione, in copia a Francesca Mur√® e al General Manager
if (sq_countryManager != null &amp;&amp; !sq_countryManager.toString().equals("") &amp;&amp; !sq_countryManager.toString().equals("null")){
    
    sqlStmt = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

    conn = ConnectionFactory.getConnection(helperName);
    sql = new Sql(conn)
    StringBuffer sq_generalManager = new StringBuffer()
    sql.eachRow(sqlStmt) {
        sq_generalManager &lt;&lt; it.general_manager
    }
    sql.close()
    String cc_addresses = issue.getCustomFieldValue(sq_hq_hr_ccField).toString() + "," + ComponentAccessor.getUserManager().getUserByKey(sq_generalManager.toString()).getEmailAddress()
	mail.setCc(cc_addresses)
}else{
    /*//Se si tratta di una company "no bu" e richiesta Perm la notifica, inviata al general manager per approvazione, deve andare in copia all'HQ controller e Francesca Mur√®
    if(result.toString().equals("1") &amp;&amp; issue.getCustomFieldValue(contract_type).getValue().equals("Permanent")){
        String recipients = "francesca.mure@faacgroup.com" + "," + ComponentAccessor.getUserManager().getUserByKey(result_hq_controller.toString()).getEmailAddress()
        mail.setCc(recipients)
    }else{
    	//Se non si verifica nessuna delle precedenti condizioni, la notifica va in copia solo a Francesca Mur√®*/
    	mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())
	//}
}

//ComponentManager componentManager = ComponentManager.getInstance()
//CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
currentUser = ComponentAccessor.jiraAuthenticationContext.getLoggedInUser()
//IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField general_manager = customFieldManager.getCustomFieldObject("14405".toLong())

CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

ApplicationUser generalManager = (ApplicationUser)issue.getCustomFieldValue(general_manager)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(191): issue.getCustomFieldValue(general_manager).name =&gt; " + generalManager.name
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(191): issue.reporter.name =&gt; " + issue.reporter.name
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(191): Evaluated condition =&gt; " + (generalManager.name.toString() != issue.reporter.name.toString())
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(191): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Budget Checked'(191): CC =&gt; " + issue.getCustomFieldValue(sq_hq_hr_ccField).toString()

(sq_countryManager != null &amp;&amp; !sq_countryManager.toString().equals("") &amp;&amp; !sq_countryManager.toString().equals("null") &amp;&amp; sq_countryManager!= issue.reporter.name.toString() &amp;&amp; !parent.getValue().toString().equals("General Manager")) ||
((sq_countryManager == null || sq_countryManager.toString().equals("") || sq_countryManager.toString().equals("null")) &amp;&amp; (generalManager.name.toString() != issue.reporter.name.toString() &amp;&amp; !parent.getValue().toString().equals("General Manager")))

</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-260</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">—É—öw—Ö¬´t–Ω—á7k__–≥‚Äû—áF—Ñ—á√∑—ü~—Ü–Ω—è8</arg>
                  <arg name="FIELD_ACTION">201 Approve</arg>
                  <arg name="FIELD_NOTES" />
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.ComponentManager

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField general_manager = customFieldManager.getCustomFieldObject(Long.parseLong("14405"))

CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
CustomField local_controller = customFieldManager.getCustomFieldObject("14406".toLong())
CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())
CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Check country manager
def sqlStmt = "SELECT count(*) AS tot_row FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer result = new StringBuffer()
sql.eachRow(sqlStmt) {
 result &lt;&lt; it.tot_row
}
sql.close()

//log.debug "Verifica General Manager e Reporter:"
//log.debug "GM: " + issue.getCustomFieldValue(general_manager).name
//log.debug "Reporter: " + issue.reporter.name
//log.debug "Check: " + (issue.getCustomFieldValue(general_manager).name == issue.reporter.name)
	
log.debug "ClaudioMenetti fasttrack 201 check"
log.debug "Issue: " + issue.key.toString()
log.debug "Company: " + issue.getCustomFieldValue(company).toString()
log.debug "No BU count: " + result.toString()
log.debug "Job title parent: " + parent.getValue().toString()
log.debug "Contract type: " + issue.getCustomFieldValue(contract_type).getValue()
log.debug "General manager custom field: " + issue.getCustomFieldValue(general_manager).name
log.debug "Reporter: " + issue.reporter.name

(result.toString().equals("0") || (result.toString().equals("1") &amp;&amp; (parent.getValue().toString().equals("General Management") || parent.getValue().toString().equals("Information Technology") || parent.getValue().toString().equals("HR") || parent.getValue().toString().equals("Administration &amp; Finance")))) &amp;&amp; issue.getCustomFieldValue(contract_type).getValue().equals("Permanent") &amp;&amp; issue.getCustomFieldValue(general_manager).name == issue.reporter.name || parent.getValue().toString().equals("General Manager")

</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS" />
                  <arg name="FIELD_ADDITIONAL_SCRIPT" />
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">–û–á‚Ññ‚ïê–ò–≤–∏–πs—è—á–ûg–•y–ô5–û¬§tm–ö–™~–π–∏–ò</arg>
                  <arg name="FIELD_ACTION">341 Approve </arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">import com.atlassian.jira.component.ComponentAccessor

import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.ComponentManager

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField general_manager = customFieldManager.getCustomFieldObject(Long.parseLong("14405"))
CustomField local_controller = customFieldManager.getCustomFieldObject("14406".toLong())
CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())
CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())

CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Check country manager
def sqlStmt = "SELECT count(*) AS tot_row FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer result = new StringBuffer()
sql.eachRow(sqlStmt) {
 result &lt;&lt; it.tot_row
}
sql.close()


//log.debug "Verifica General Manager e Reporter:"
//log.debug "GM: " + issue.getCustomFieldValue(general_manager).name
//log.debug "Reporter: " + issue.reporter.name
//log.debug "Check: " + (issue.getCustomFieldValue(general_manager).name == issue.reporter.name)

log.debug "ClaudioMenetti fasttrack 341 check"
log.debug "Issue: " + issue.key.toString()
log.debug "Company: " + issue.getCustomFieldValue(company).toString()
log.debug "No BU count: " + result.toString()
log.debug "Job title parent: " + parent.getValue().toString()
log.debug "Contract type: " + issue.getCustomFieldValue(contract_type).getValue()
log.debug "General manager custom field: " + issue.getCustomFieldValue(general_manager).name
log.debug "Reporter: " + issue.reporter.name


((result.toString().equals("1") &amp;&amp; !parent.getValue().toString().equals("General Management") &amp;&amp; !parent.getValue().toString().equals("Information Technology") &amp;&amp; !parent.getValue().toString().equals("HR") &amp;&amp; !parent.getValue().toString().equals("Administration &amp; Finance")) || issue.getCustomFieldValue(contract_type).getValue().equals("Temporary")) &amp;&amp; issue.getCustomFieldValue(general_manager).name == issue.reporter.name || parent.getValue().toString().equals("General Manager")

</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS" />
                  <arg name="FIELD_ADDITIONAL_SCRIPT" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="10" name="General Manager Approval">
      <meta name="jira.status.id">11432</meta>
      <meta name="jira.permission.assign.user">francesca.mure</meta>
      <actions>
<common-action id="301" />
        <action id="201" name="Approve" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">—áN^–ß^—á–π–ß–ø–ß–™–≠—é¬∂o–Öz–ø}“ë–Ø–å]–Ø–ß—É¬≠—Ö</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.ComponentManager

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField general_manager = customFieldManager.getCustomFieldObject("14405".toLong())
CustomField local_controller = customFieldManager.getCustomFieldObject("14406".toLong())
CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())
CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}


DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Check country manager
def sqlStmt = "SELECT count(*) AS tot_row FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer result = new StringBuffer()
sql.eachRow(sqlStmt) {
 result &lt;&lt; it.tot_row
}
sql.close()
//log.debug "Current User: " + currentUser.name
//log.debug "Local Controller: " + issue.getCustomFieldValue(local_controller).name
//log.debug "General Manager: " + issue.getCustomFieldValue(general_manager).name
//log.debug "Check contract type: " + issue.getCustomFieldValue(contract_type).getValue().equals("Permanent")
//log.debug "Result: " + ((result.toString().equals("0") || (result.toString().equals("1") &amp;&amp; (parent.getValue().toString().equals("General Management") || parent.getValue().toString().equals("Information Technology") || parent.getValue().toString().equals("HR") || parent.getValue().toString().equals("Administration &amp; Finance")))) &amp;&amp; issue.getCustomFieldValue(contract_type).getValue().equals("Permanent"))

/* True IF: */
// - Contract Type = Permanent AND
//   - Company CON BU OR
//   - Company NO BU AND Funzione di staff

//issue.getCustomFieldValue(general_manager).name == issue.reporter.name &amp;&amp; currentUser.name == issue.getCustomFieldValue(local_controller).name
(result.toString().equals("0") || (result.toString().equals("1") &amp;&amp; (parent.getValue().toString().equals("General Management") || parent.getValue().toString().equals("Information Technology") || parent.getValue().toString().equals("HR") || parent.getValue().toString().equals("Administration &amp; Finance")))) &amp;&amp; issue.getCustomFieldValue(contract_type).getValue().equals("Permanent") &amp;&amp;
((currentUser != null &amp;&amp; issue.assignee != null &amp;&amp; currentUser.name == issue.assignee.name) || (issue.getCustomFieldValue(general_manager) != null &amp;&amp; issue.reporter != null &amp;&amp; currentUser != null &amp;&amp; issue.getCustomFieldValue(local_controller) != null &amp;&amp; issue.getCustomFieldValue(general_manager).name == issue.reporter.name &amp;&amp; currentUser.name == issue.getCustomFieldValue(local_controller).name))
 
 </arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="11">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">w¬á7i√ç¬û√é√∑w}√º√ó¬∂√¥√óNzm√¶¬∑w¬ó√πm√ç√ú}√á¬¥</arg>
                  <arg name="FIELD_NOTES">Set BU Director as Assignee</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">/*
Le modifiche apportate a questo script devono essere riportate anche sullo script di esecuzione automatica della transazione Approve(211).
Tale script si trova sulla transazione Approve da General Manager Approval e BU/Group Function Dir. Approval
*/
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
//14.01.2016 AF
//[BU Controller]
//Contestualmente all'individuazione del BU Director a cui verr√† assegnata la issue
//alimentiamo il campo BU Controller che verr√† notificato in copia della nuova issue
//da approvare e verr√† abilitato ad avere visibilit√† su tutte le issue che riguardano
//la sua BU di riferimento solo dal momento in cui queste raggiungeranno l'approvazione
//del BU director. In questo modo tutte le richieste che dovessero essere annullate prima
//non andranno a creare confusione nelle dashboard dei controller.
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

//14.01.2016 AF
//[BU Controller]
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)

//14.01.2016 AF
//[BU Controller]
CustomField buController = customFieldManager.getCustomFieldObject("15301".toLong())

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""


DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Check no bu company
def sqlStmt_no_bu_company = "SELECT count(*) AS tot_row FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

//14.01.2016 AF
//[BU Controller]
//Il BU Controller viene selezionato direttamente da DB dalla stessa tabella e con gli stessi
//filtri utilizzati per l'interrogazione del BU Director.
//Mappare i BU Controller a livello di DB ci permetter√† di gestire/modificare/aggiungere in 
//modo dinamico utenti diversi per diverse funzioni e BU.
//N.B. Nel momento in cui si dovesse decidere di modificare l'utente responsabile per una certa BU,
//affinch√® questo visualizzi tutte le issue prima visualizzate dall'utente che lo precedeva,
//√® necessario fare una bulk change su tutte le issue con "BU Controller" = vecchio utente impostandolo
//uguale al nuovo nome utente.
//def sqlStmt2 = "SELECT bu_controller FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)

StringBuffer result_no_bu_company = new StringBuffer()
sql.eachRow(sqlStmt_no_bu_company) {
 result_no_bu_company &lt;&lt; it.tot_row
}
sql.close()

def sqlStmt_director
if(result_no_bu_company.toString().equals("1")){
    //Company NO BU
    sqlStmt_director = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = 'FAAC Group'"
}else{
	//Company CON BU
    sqlStmt_director = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
}

//log.debug "Set assignee - query statement x director: " + sqlStmt_director
//14.01.2016 AF
//[BU Controller]
StringBuffer db_bu_controller = new StringBuffer()
StringBuffer sq_BUFunctDirector = new StringBuffer()

conn = ConnectionFactory.getConnection(helperName);
sql = new Sql(conn)
sql.eachRow(sqlStmt_director) {
	sq_BUFunctDirector &lt;&lt; it.director
}
sql.close()

//14.01.2016 AF
//[BU Controller]
/*
sql.eachRow(sqlStmt2) {
	db_bu_controller &lt;&lt; it.bu_controller
}
*/
//log.debug "Set assignee: " + ComponentAccessor.userManager.getUserByKey(sq_BUFunctDirector.toString())

issue.setAssignee(ComponentAccessor.userManager.getUserByKey(sq_BUFunctDirector.toString()))
//14.01.2016 AF
//[BU Controller]
//Dal momento che il campo "BU Controller" √® un campo di tipo User Picker, √® necessario
//convertire il nome utente (Stringa) in un elemento di tipo Application User.
//Questo elemento potr√† poi essere utilizzato per popolare il campo "BU Controller"
/*ApplicationUser newuser = userUtil.getUserByKey(db_bu_controller.toString())
buController.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(buController),newuser),changeHolder)
*/
issueIndexingService.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√ë√æ¬ù√±√á√∫√ô√é¬∫√ì¬Ω^√ô√è^s√ù[√≠¬Ω9m√ç[√ù√¶¬úoV¬û</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.component.ComponentAccessor

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

def customFieldManager = ComponentAccessor.getCustomFieldManager()
def issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
CustomField buController = customFieldManager.getCustomFieldObject("15301".toLong())
CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())
CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)
UserUtil userUtil = ComponentAccessor.getUserUtil()
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())

Option parent
Option child

//UserUtil userUtil = componentManager.getUserUtil()
def cfassignee = ""

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

def delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select email addresses to set as BCC to send notifications to HQ HR reference
def sqlStmt_hq_hr_cc = "SELECT hq_hr_cc FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
//Select HQ Controller for the selected company
def sqlStmt_hq_controller = "SELECT hq_controller FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
//Select Staff Functions Controllers for the selected company
def sqlStmt_staff_funct_controller = "SELECT staff_funct_controller FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
//Select general manager for selected company
def sqlStmt_gm = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
//Select director for selected Job Title and BU
def sqlStmt_director = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
//Select BU controller for selected Job Title and BU
def sqlStmt_bu_controller = "SELECT bu_controller FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
//Check no bu company
def sqlStmt_no_bu_company = "SELECT count(*) AS tot_row FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

//***** NEW *****
//Select hr business partner for selected Job Title and BU
def sqlStmt_hr_business_partner = "SELECT hr_business_partner FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
//***** END NEW *****

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)

conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer sq_hqController = new StringBuffer()
sql.eachRow(sqlStmt_hq_controller) {
	sq_hqController &lt;&lt; it.hq_controller
}
sql.close()
log.debug "hq_controller: " + sq_hqController

conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer sq_staff_funct_controller = new StringBuffer()
sql.eachRow(sqlStmt_staff_funct_controller) {
	sq_staff_funct_controller &lt;&lt; it.staff_funct_controller
}
sql.close()
log.debug "staff_funct_controller: " + sq_staff_funct_controller

conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt_gm) {
	sq_generalManager &lt;&lt; it.general_manager
}
sql.close()

conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer sq_BUFunctDirector = new StringBuffer()
sql.eachRow(sqlStmt_director) {
	sq_BUFunctDirector &lt;&lt; it.director
}
sql.close()

//***** NEW *****
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer sq_HRBusPartner = new StringBuffer()
sql.eachRow(sqlStmt_hr_business_partner) {
    sq_HRBusPartner &lt;&lt; it.hr_business_partner
}
sql.close()
//***** END NEW *****

conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer db_bu_controller = new StringBuffer()
sql.eachRow(sqlStmt_bu_controller) {
	db_bu_controller &lt;&lt; it.bu_controller
}
sql.close()
log.debug "db_bu_controller: " + db_bu_controller

conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer result_no_bu_company = new StringBuffer()
sql.eachRow(sqlStmt_no_bu_company) {
 result_no_bu_company &lt;&lt; it.tot_row
}
sql.close()
//Object buControllerValue = issue.getCustomFieldValue(buController)

/* Notifications settings */
/* Caso 1: Company "no bu" + Funzione di staff + Contract Type = "Permanent" =&gt; CC: HQ Controller */
/* Caso 2: Company "con bu" + Funzione di staff + Contract Type = "Permanent" =&gt; CC: Staff Functions Controller */
/* Caso 3: Company "con bu" + Funzione non di staff + Contract Type = "Permanent" =&gt; CC: BU Controller */

// BU Controller: user key
// HQ Controller: user key
// HQ HR CC: email addresses
// Staff Function Controllers: email addresses

if (parent.getValue().toString().equals("General Management") || parent.getValue().toString().equals("Information Technology") || parent.getValue().toString().equals("HR") || parent.getValue().toString().equals("Administration &amp; Finance")){
    log.debug "Funzione di staff"
    //Funzione di staff
    if(result_no_bu_company.toString().equals("1")){
        //Company NO BU
        if(issue.getCustomFieldValue(contract_type).getValue().equals("Permanent")){
            //Tipo contratto Permanent
            //=&gt; Caso 1
            mail.setCc(ComponentAccessor.getUserManager().getUserByKey(sq_hqController.toString()).getEmailAddress())
            log.debug "Caso 1 =&gt; CC: " + sq_hqController.toString()
        }
   	}else{
        //Company CON BU + Funzione di staff
        if(issue.getCustomFieldValue(contract_type).getValue().equals("Permanent")){
            //Tipo contratto Permanent
            if (parent.getValue().toString().equals("General Management") || parent.getValue().toString().equals("Information Technology") || parent.getValue().toString().equals("HR") || parent.getValue().toString().equals("Administration &amp; Finance")){
                //Funzione di staff
                //=&gt; Caso 2
                mail.setCc(sq_staff_funct_controller.toString())
                log.debug "Caso 2 =&gt; CC: " + sq_staff_funct_controller.toString()
			}
		}
   	}
}else{
	//Funzione NO staff
    if(result_no_bu_company.toString().equals("0") &amp;&amp; issue.getCustomFieldValue(contract_type).getValue().equals("Permanent")){
        //Company CON BU + Tipo contratto Permanent
		//=&gt; Caso 3
        mail.setCc(ComponentAccessor.getUserManager().getUserByKey(db_bu_controller.toString()).getEmailAddress())
        log.debug "Caso 3 =&gt; CC: " + db_bu_controller.toString()
	}
}

//***** NEW *****
if(sq_HRBusPartner!=null){
    def currentCc = mail.getCc()

    def NamesList = sq_HRBusPartner.toString().split(", ")
	def i =0
    
    for (i = 0; i &lt;NamesList.length; i++) {
    	if (currentCc!=null) {currentCc=currentCc+', '}
		currentCc = currentCc + ComponentAccessor.getUserManager().getUserByKey(NamesList[i]).getEmailAddress()
	}

    mail.setCc(currentCc)
}
//***** END NEW *****

mail.setBcc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(201): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(201): sq_generalManager.toString() =&gt; " + sq_generalManager.toString()
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(201): sq_BUFunctDirector.toString() =&gt; " + sq_BUFunctDirector.toString()
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(201): Evaluated condition =&gt; " + (sq_generalManager.toString() != sq_BUFunctDirector.toString()).toString()
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(201): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(201): CC =&gt; francesca.mure@faacgroup.com, " + issue.getCustomFieldValue(buController)

sq_generalManager.toString() != sq_BUFunctDirector.toString()</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-255</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">}√û√©√ù\√ë√øz√ù¬ß[y√ù8√ì¬≠¬º√ü¬≠¬∫√ï¬∑{s¬≠√º√õ¬ç¬ö</arg>
                  <arg name="FIELD_ACTION">211 Approve</arg>
                  <arg name="FIELD_NOTES" />
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
                  <arg name="FIELD_CONDITION">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.index.IssueIndexingService

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

CustomField bu = customFieldManager.getCustomFieldObject(Long.parseLong("14403"))
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject(Long.parseLong("14402"))
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

CustomField company = customFieldManager.getCustomFieldObject(Long.parseLong("14300"))
Object companyValue = issue.getCustomFieldValue(company)

//UserUtil userUtil = componentManager.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select project key on service desk
def sqlStmt = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"

//log.debug "Transizione automatica - query statement x general manager: " + sqlStmt

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_generalManager &lt;&lt; it.general_manager
}
sql.close()
HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()

//Select project key on service desk
def sqlStmt_director = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
//log.debug "Transizione automatica - query statement x director: " + sqlStmt

//conn = ConnectionFactory.getConnection(helperName);
//sql = new Sql(conn)
conn = ConnectionFactory.getConnection(helperName);
sql = new Sql(conn)
StringBuffer sq_BUFunctDirector = new StringBuffer()
sql.eachRow(sqlStmt_director) {
	sq_BUFunctDirector &lt;&lt; it.director
}
sql.close()
log.debug "Transizione automatica - general manager: " + sq_generalManager.toString()
log.debug "Transizione automatica - director: " + sq_BUFunctDirector.toString()
log.debug "Transizione automatica - check condizione: " + (sq_generalManager.toString() == sq_BUFunctDirector.toString())
log.debug "Transizione automatica - check condizione 2: " + (sq_generalManager.toString().equals(sq_BUFunctDirector.toString()))

sq_generalManager.toString() == sq_BUFunctDirector.toString() || sq_BUFunctDirector.toString() == issue.reporter.name</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_TRANSITION_OPTIONS" />
                  <arg name="FIELD_ADDITIONAL_SCRIPT" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="281" name="Ask Clarifications" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="4">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_14407</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">%%CURRENT_DATETIME%%</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowassigntoreporter-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.AssignToReporterFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">¬é√ûi√ù^√ì¬Ü¬º√ï√Ü¬π√µ√Ω√∑¬û√∏√≠√ù√π}√ü7√°√Ü√ª√õf√º</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #FFD351; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Further clarifications needed for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #4A6785; border-color: #4A6785; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;%}%&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to review the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Further clarifications needed for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(281): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(281): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(281): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(281): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-255</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="341" name="Approve " view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">k√é;w¬Ω√ûq√é{w¬∑¬Ω√≥¬é√∏√•¬ß¬∑s¬ó8√ë¬ß}{√é√ºm¬ß√π</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.user.util.UserManager
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.ComponentManager

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager()
def currentUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField general_manager = customFieldManager.getCustomFieldObject("14405".toLong())
CustomField local_controller = customFieldManager.getCustomFieldObject("14406".toLong())
CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())
CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Check country manager
def sqlStmt = "SELECT count(*) AS tot_row FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer result = new StringBuffer()
sql.eachRow(sqlStmt) {
 result &lt;&lt; it.tot_row
}
sql.close()

//log.debug "Current User: " + currentUser.name
//log.debug "Local Controller: " + issue.getCustomFieldValue(local_controller).name
//log.debug "Check contract type: " + issue.getCustomFieldValue(contract_type).getValue().equals("Temporary")

// True IF:
// - Contract Type = Temporary OR
// - Company NO BU AND NOT Funzione di staff

//issue.getCustomFieldValue(general_manager).name == issue.reporter.name &amp;&amp; currentUser.name == issue.getCustomFieldValue(local_controller).name
((result.toString().equals("1") &amp;&amp; !parent.getValue().toString().equals("General Management") &amp;&amp; !parent.getValue().toString().equals("Information Technology") &amp;&amp; !parent.getValue().toString().equals("HR") &amp;&amp; !parent.getValue().toString().equals("Administration &amp; Finance")) || issue.getCustomFieldValue(contract_type).getValue().equals("Temporary")) &amp;&amp;
(currentUser.name == issue.assignee.name || (issue.getCustomFieldValue(general_manager).name == issue.reporter.name &amp;&amp; currentUser.name == issue.getCustomFieldValue(local_controller).name))



</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="12">
              <post-functions>
                <function type="class">
                  <arg name="field.name">j√ã"¬Çw¬û</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value">luca.bauckneht</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">—É¬Æ“ë–ø–ª‚ÄîZw–è–Ø–û—å–©–∑–´–£—ó\sg{–∑nx–°–¶‚Ä∫</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #f5f5f5; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #f5f5f5; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to validate the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Approval for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)

/*
Le modifiche apportate a questo script devono essere riportate anche sullo script di esecuzione automatica della transazione Approve(211).
Tale script si trova sulla transazione Approve da General Manager Approval e BU/Group Function Dir. Approval
*/
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
//14.01.2016 AF
//[BU Controller]
//Contestualmente all'individuazione del BU Director a cui verr√† assegnata la issue
//alimentiamo il campo BU Controller che verr√† notificato in copia della nuova issue
//da approvare e verr√† abilitato ad avere visibilit√† su tutte le issue che riguardano
//la sua BU di riferimento solo dal momento in cui queste raggiungeranno l'approvazione
//del BU director. In questo modo tutte le richieste che dovessero essere annullate prima
//non andranno a creare confusione nelle dashboard dei controller.
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.issue.index.IssueIndexingService

import org.apache.log4j.Category
log.setLevel(org.apache.log4j.Level.DEBUG)
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

//14.01.2016 AF
//[BU Controller]
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
CustomField contract_type = customFieldManager.getCustomFieldObject("17001".toLong())
Object companyValue = issue.getCustomFieldValue(company)
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())

//14.01.2016 AF
//[BU Controller]
CustomField buController = customFieldManager.getCustomFieldObject("15301".toLong())

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select director for selected Job Title and BU
def sqlStmt_director = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
//Select email addresses to set as BCC to send notifications to HQ HR reference
def sqlStmt_hq_hr_cc = "SELECT hq_hr_cc FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
//Select HQ Controller for the selected company
def sqlStmt_hq_controller = "SELECT hq_controller FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
//Select Staff Functions Controllers for the selected company
def sqlStmt_staff_funct_controller = "SELECT staff_funct_controller FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
//Check Company "no bu"
def sqlStmt_company = "SELECT count(*) AS tot_row FROM FC_RR_OrganizationalChartExp WHERE company = '" + issue.getCustomFieldValue(company).toString() + "' AND no_bu = 'x'"

//***** NEW *****
//Select hr business partner for selected Job Title and BU
def sqlStmt_hr_business_partner = "SELECT hr_business_partner FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
//***** END NEW *****



//14.01.2016 AF
//[BU Controller]
//Il BU Controller viene selezionato direttamente da DB dalla stessa tabella e con gli stessi
//filtri utilizzati per l'interrogazione del BU Director.
//Mappare i BU Controller a livello di DB ci permetter√† di gestire/modificare/aggiungere in 
//modo dinamico utenti diversi per diverse funzioni e BU.
//N.B. Nel momento in cui si dovesse decidere di modificare l'utente responsabile per una certa BU,
//affinch√® questo visualizzi tutte le issue prima visualizzate dall'utente che lo precedeva,
//√® necessario fare una bulk change su tutte le issue con "BU Controller" = vecchio utente impostandolo
//uguale al nuovo nome utente.
//def sqlStmt2 = "SELECT bu_controller FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

//log.debug "Set assignee - query statement x director: " +sqlStmt

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_hq_hr_cc = new StringBuffer()
sql.eachRow(sqlStmt_hq_hr_cc) {
	sq_hq_hr_cc &lt;&lt; it.hq_hr_cc
}
sql.close()
mail.setBcc(sq_hq_hr_cc.toString())

StringBuffer sq_hqController = new StringBuffer()
conn = ConnectionFactory.getConnection(helperName);
sql = new Sql(conn)
sql.eachRow(sqlStmt_hq_controller) {
	sq_hqController &lt;&lt; it.hq_controller
}
sql.close()

StringBuffer sq_staff_funct_controller = new StringBuffer()
conn = ConnectionFactory.getConnection(helperName);
sql = new Sql(conn)
sql.eachRow(sqlStmt_staff_funct_controller) {
	sq_staff_funct_controller &lt;&lt; it.staff_funct_controller
}
sql.close()

StringBuffer sq_BUFunctDirector = new StringBuffer()

//14.01.2016 AF
//[BU Controller]
StringBuffer db_bu_controller = new StringBuffer()

conn = ConnectionFactory.getConnection(helperName);
sql = new Sql(conn)
sql.eachRow(sqlStmt_director) {
	sq_BUFunctDirector &lt;&lt; it.director
}
sql.close()

StringBuffer result_no_bu_company = new StringBuffer()
conn = ConnectionFactory.getConnection(helperName);
sql = new Sql(conn)
sql.eachRow(sqlStmt_company) {
 result_no_bu_company &lt;&lt; it.tot_row
}
sql.close()

//***** NEW *****
conn = ConnectionFactory.getConnection(helperName)
sql = new Sql(conn)
StringBuffer sq_HRBusPartner = new StringBuffer()
sql.eachRow(sqlStmt_hr_business_partner) {
    sq_HRBusPartner &lt;&lt; it.hr_business_partner
}
sql.close()
//***** END NEW *****


//log.debug "sq_BUFunctDirector: " + sq_BUFunctDirector
//log.debug "bu controller: " + ComponentAccessor.getUserManager().getUserByKey(issue.getCustomFieldValue(buController).name.toString())

// BU Controller: user key
// HQ Controller: user key
// HQ HR CC: email addresses
// Staff Function Controllers: email addresses

/* Caso 1: Company "no bu" + Funzione non di staff OR Contract Type = "Temporary" =&gt; CC: HQ Controller */
/* Caso 2: Company "con bu" + Funzione di staff + Contract Type = "Temporary" =&gt; CC: Staff Functions Controller */
/* Caso 3: Company "con bu" + Funzione non di staff + Contract Type = "Temporary" =&gt; CC: BU Controller */
if(result_no_bu_company.toString().equals("1")){
    //Company NO BU
    if ((!parent.getValue().toString().equals("General Management") &amp;&amp; !parent.getValue().toString().equals("Information Technology") &amp;&amp; !parent.getValue().toString().equals("HR") &amp;&amp; !parent.getValue().toString().equals("Administration &amp; Finance")) || (issue.getCustomFieldValue(contract_type).equals("Temporary"))){
        //Funzione non di staff OR Contract Type = "Temporary"
        //=&gt; Caso 1
        mail.setCc(ComponentAccessor.getUserManager().getUserByKey(sq_hqController.toString()).getEmailAddress())
        //log.debug "Caso 1 =&gt; CC: " + sq_hqController.toString()
   	}
}else{
	//Company CON BU
    log.debug "Company con bu"
    if(issue.getCustomFieldValue(contract_type).getValue().equals("Temporary")){
        //log.debug "Temporary contract"
        //Contract Type = Temporary
        if(parent.getValue().toString().equals("General Management") || parent.getValue().toString().equals("Information Technology") || parent.getValue().toString().equals("HR") || parent.getValue().toString().equals("Administration &amp; Finance")){
            //Funzione di staff
            log.debug "Funzione di staff"
            //=&gt; Caso 2
            mail.setCc(sq_staff_funct_controller.toString())
            //log.debug "Caso 2 =&gt; CC: " + sq_staff_funct_controller.toString()
        }else{
            //Funzione non di staff
            log.debug "Funzione non di staff"
            //=&gt; Caso 3
            mail.setCc(ComponentAccessor.getUserManager().getUserByKey(issue.getCustomFieldValue(buController).name.toString()).getEmailAddress())
			//log.debug "Caso 3 =&gt; CC: " + issue.getCustomFieldValue(buController).name.toString()
        }
    }
}

mail.setBcc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

//***** NEW *****
if(sq_HRBusPartner!=null){
    def currentCc = mail.getCc()

    def NamesList = sq_HRBusPartner.toString().split(", ")
	def i =0
    
    for (i = 0; i &lt;NamesList.length; i++) {
    	if (currentCc!=null) {currentCc=currentCc+', '}
		currentCc = currentCc + ComponentAccessor.getUserManager().getUserByKey(NamesList[i]).getEmailAddress()
	}

    mail.setCc(currentCc)
}
//***** END NEW *****

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(211): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(211): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(211): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Approve'(211): CC =&gt; " + issue.getCustomFieldValue(sq_hq_hr_ccField).toString()

true

</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-391</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="11" name="BU/Group Funct. Director Approval">
      <meta name="jira.status.id">11433</meta>
      <meta name="jira.permission.assign.user">francesca.mure</meta>
      <actions>
<common-action id="251" />
<common-action id="211" />
        <action id="271" name="Ask Clarifications" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="10">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">q¬Ωv√≥√ù√ùsm√Ø¬øk¬ùz√°¬æ¬∂of¬öy√Æ}√ó¬Æ√õ¬æ√∏</arg>
                  <arg name="FIELD_NOTES">Set General Manager as Assignee</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level
import com.atlassian.jira.component.ComponentAccessor
import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField company = customFieldManager.getCustomFieldObject("14300".toLong())
Object companyValue = issue.getCustomFieldValue(company)

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

def sqlStmt = "SELECT general_manager FROM FC_RR_OrganizationalChartExp WHERE company = '" + companyValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_generalManager &lt;&lt; it.general_manager
}
sql.close()

issue.setAssignee(ComponentAccessor.userManager.getUserByKey(sq_generalManager.toString()))
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">‚ïôN\—è–Ω‚ï¢—ã~—û—á‚ñê–éy–é‚àô—Ö‚ñÄ^w‚ïê‚ï¢‚ïí—Ü–ás^zi‚ñÄ[</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #FFD351; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Further clarifications needed for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to review the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Further clarifications needed for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

return true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="311" name="Reject" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="15">
              <post-functions>
                <function type="class">
                  <arg name="field.name">j√ã"¬Çw¬û</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value" />
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">√õMx√ØM¬ª√ù√ç¬∫m√Ü√õ√±√ù¬Ω√´¬ß[√µ√∂¬πwg;√£G¬¥√©¬∂¬ü</arg>
                  <arg name="FIELD_NOTES">Set Approval Status - Rejected</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.ComponentManager
import org.ofbiz.core.entity.GenericValue
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.index.Index.Manager

def customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexManager indexManager = ComponentAccessor.getIssueIndexManager()
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField approvalStatus = customFieldManager.getCustomFieldObject(Long.parseLong("15500"))
def fieldConfig = approvalStatus.getRelevantConfig(issue)
approvalStatus.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(approvalStatus),ComponentAccessor.optionsManager.getOptions(fieldConfig)?.find { it.optionId == 18772 }),changeHolder)
indexManager.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Reporter - Rejected</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS">group:RR-HR-team</arg>
                  <arg name="FIELD_FUNCTION_ID">o–ä—å–Ω—èt‚Äû–≠—É–ó–™—û–∂–è–Ω–å“ë–±¬∂—Ñsv—Ñ—ü—ëu{–Ü}</arg>
                  <arg name="FIELD_TO_USER_FIELDS">¬≠√™h¬Æ√ó¬´</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #A52019; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #A52019; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #A52019; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; componentManager.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; componentManager.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; componentManager.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; componentManager.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; componentManager.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #A52019; border-color: #A52019; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to view the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #FFFFFF; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(componentManager.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request REJECTED</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Rejected'(311): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Rejected'(311): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Rejected'(311): To =&gt; " + issue.reporter
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Rejected'(311): CC =&gt; Gruppo:RR-HR-team"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="12" name="HQ HR Dir. Approval">
      <meta name="jira.status.id">11434</meta>
      <meta name="jira.permission.assign.denied">denied</meta>
      <actions>
<common-action id="221" />
<common-action id="301" />
<common-action id="351" />
      </actions>
    </step>
    <step id="13" name="CEO Approval">
      <meta name="jira.status.id">11435</meta>
      <meta name="jira.permission.assign.denied">denied</meta>
      <actions>
<common-action id="231" />
<common-action id="241" />
        <action id="121" name="Ask Clarifications" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="conditionList">3</arg>
                <arg name="comparisonType">1</arg>
                <arg name="class.name">com.googlecode.jsu.workflow.condition.ValueFieldCondition</arg>
                <arg name="fieldValue">FAAC S.p.A.</arg>
                <arg name="fieldsList">customfield_14300</arg>
              </condition>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="8">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">u—á–ú–æ&lt;–í—Ñ‚ïß}–ù–∑–≤–≤w—á‚ï§i‚ïï–í—â‚ïú‚ï™–Ø‚ïûZ{g–ñ</arg>
                  <arg name="FIELD_NOTES">Set BU Director as Assignee</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import org.apache.log4j.Level

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)
Object buValue = issue.getCustomFieldValue(bu)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

def sqlStmt = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"
 
Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_generalManager = new StringBuffer()
sql.eachRow(sqlStmt) {
	sq_generalManager &lt;&lt; it.director
}
sql.close()

issue.setAssignee(ComponentAccessor.userManager.getUserByKey(sq_generalManager.toString()))
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">–©–Æ–´o–Ö–Æ–•–∑—î–ßf–´–£~—â—Å–Æ5–±–≠x–©–ø;–£—õ:</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #FFD351; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Further clarifications needed for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to review the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Further clarifications needed for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="261" name="Ask  Clarifications" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions type="AND">
              <condition type="class">
                <arg name="conditionList">6</arg>
                <arg name="comparisonType">1</arg>
                <arg name="class.name">com.googlecode.jsu.workflow.condition.ValueFieldCondition</arg>
                <arg name="fieldValue">FAAC S.p.A.</arg>
                <arg name="fieldsList">customfield_14300</arg>
              </condition>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="11">
              <post-functions>
                <function type="class">
                  <arg name="field.name">customfield_14301</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
                  <arg name="field.value">%%CURRENT_DATETIME%%</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">√∑¬ß;√£g¬ºi¬Ø9√≥Gm√è√©√Æ√∂sW:√≠√é√õ√ù√õ√µ√ù¬Ω</arg>
                  <arg name="FIELD_NOTES">Set BU Director as Assignee</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">/*
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.component.ComponentAccessor
import org.apache.log4j.Level
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()

CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)?.optionId
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}


UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""

switch (buValue) {
    //Access Automation
    case "18570":
        cfassignee = "jacopo.malacarne"
        break
	//HUB Parking
    case "18571":
        cfassignee = "enrico.nardi"
        break
	//Access Control Magnetic
    case "18572":
        cfassignee = "arno.steiner"
        break
	//FAAC Group
    case "18573":
    	switch(parent.getValue().toString()){
            case "Administration &amp; Finance":
            	cfassignee = "ezechiele.galloni"
            	break
            case "Information Technology":
            	cfassignee = "enrico.minelle"
            	break
            case "HR":
            	cfassignee = "michele.conchetto"
            	break
        }
    	break
}
issue.setAssignee(ComponentManager.instance.userUtil.getUserObject(cfassignee))
*/
/*
Le modifiche apportate a questo script devono essere riportate anche sullo script di esecuzione automatica della transazione Approve(211).
Tale script si trova sulla transazione Approve da General Manager Approval e BU/Group Function Dir. Approval
*/
import com.atlassian.jira.ComponentManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.Option
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.customfields.view.CustomFieldParams
import com.atlassian.jira.issue.customfields.option.LazyLoadedOption
import com.atlassian.jira.issue.customfields.impl.CascadingSelectCFType
import com.atlassian.jira.issue.index.IssueIndexManager
//14.01.2016 AF
//[BU Controller]
//Contestualmente all'individuazione del BU Director a cui verr√† assegnata la issue
//alimentiamo il campo BU Controller che verr√† notificato in copia della nuova issue
//da approvare e verr√† abilitato ad avere visibilit√† su tutte le issue che riguardano
//la sua BU di riferimento solo dal momento in cui queste raggiungeranno l'approvazione
//del BU director. In questo modo tutte le richieste che dovessero essere annullate prima
//non andranno a creare confusione nelle dashboard dei controller.
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.index.IssueIndexingService

import groovy.sql.Sql
import java.sql.Connection
import org.ofbiz.core.entity.ConnectionFactory
import org.ofbiz.core.entity.DelegatorInterface

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy")
log.setLevel(org.apache.log4j.Level.DEBUG)
 
CustomFieldManager customFieldManager =	ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

//14.01.2016 AF
//[BU Controller]
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

CustomField bu = customFieldManager.getCustomFieldObject("14403".toLong())
Object buValue = issue.getCustomFieldValue(bu)
CustomField jobTitle = customFieldManager.getCustomFieldObject("14402".toLong())
Object jobTitleValue = issue.getCustomFieldValue(jobTitle)

//14.01.2016 AF
//[BU Controller]
CustomField buController = customFieldManager.getCustomFieldObject("15301".toLong())

Option parent
Option child

HashMap&lt;String, Option&gt; hashMapEntries = (HashMap&lt;String, Option&gt;) jobTitleValue
if (hashMapEntries != null) {
parent = hashMapEntries.get(CascadingSelectCFType.PARENT_KEY)
child = hashMapEntries.get(CascadingSelectCFType.CHILD_KEY)
}

UserUtil userUtil = ComponentAccessor.getUserUtil()
def cfassignee = ""


DelegatorInterface delegator = (DelegatorInterface) ComponentManager.getInstance().getComponentInstanceOfType(DelegatorInterface.class)
String helperName = delegator.getGroupHelperName("default");

//Select project key on service desk
def sqlStmt = "SELECT director FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

//14.01.2016 AF
//[BU Controller]
//Il BU Controller viene selezionato direttamente da DB dalla stessa tabella e con gli stessi
//filtri utilizzati per l'interrogazione del BU Director.
//Mappare i BU Controller a livello di DB ci permetter√† di gestire/modificare/aggiungere in 
//modo dinamico utenti diversi per diverse funzioni e BU.
//N.B. Nel momento in cui si dovesse decidere di modificare l'utente responsabile per una certa BU,
//affinch√® questo visualizzi tutte le issue prima visualizzate dall'utente che lo precedeva,
//√® necessario fare una bulk change su tutte le issue con "BU Controller" = vecchio utente impostandolo
//uguale al nuovo nome utente.
//def sqlStmt2 = "SELECT bu_controller FROM FC_RR_OrganizationalChartHQ WHERE job_title = '" + parent.getValue().toString() + "' AND bu = '" + buValue.toString() + "'"

//log.debug "Set assignee - query statement x director: " +sqlStmt

Connection conn = ConnectionFactory.getConnection(helperName);
Sql sql = new Sql(conn)
StringBuffer sq_BUFunctDirector = new StringBuffer()

//14.01.2016 AF
//[BU Controller]
StringBuffer db_bu_controller = new StringBuffer()

sql.eachRow(sqlStmt) {
	sq_BUFunctDirector &lt;&lt; it.director
}
sql.close()

//14.01.2016 AF
//[BU Controller]
/*
sql.eachRow(sqlStmt2) {
	db_bu_controller &lt;&lt; it.bu_controller
}
*/
//log.debug "Set assignee: " + sq_BUFunctDirector

issue.setAssignee(ComponentAccessor.userManager.getUserByKey(sq_BUFunctDirector.toString()))
//14.01.2016 AF
//[BU Controller]
//Dal momento che il campo "BU Controller" √® un campo di tipo User Picker, √® necessario
//convertire il nome utente (Stringa) in un elemento di tipo Application User.
//Questo elemento potr√† poi essere utilizzato per popolare il campo "BU Controller"
/*ApplicationUser newuser = userUtil.getUserByKey(db_bu_controller.toString())
buController.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(buController),newuser),changeHolder)
*/
issueIndexingService.reIndex(issue)</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts\RR_UpdateVisibilityGroups.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Assignee for approval</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">‚ïôN\—è–Ω‚ï¢—ã~—û—á‚ñê–éy–é‚àô—Ö‚ñÄ^w‚ïê‚ï¢‚ïí—Ü–ás^zi‚ñÄ[</arg>
                  <arg name="FIELD_TO_USER_FIELDS">j√ã"¬Çw¬û</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #FFD351; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #FFD351; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;
				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Further clarifications needed for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #ffd351; border-color: #ffd351; color: #594300; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
                &lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to review the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #707070; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Further clarifications needed for &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Recruitment Request</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import com.atlassian.jira.issue.fields.CustomField
CustomField sq_hq_hr_ccField = customFieldManager.getCustomFieldObject("18900".toLong())
mail.setCc(issue.getCustomFieldValue(sq_hq_hr_ccField).toString())

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(261): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(261): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(261): To =&gt; " + issue.assignee
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Ask Clarifications'(261): CC =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-307</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="15" name="E√®√ûr√ó¬ù">
      <meta name="jira.status.id">11436</meta>
      <meta name="jira.permission.assign.denied">denied</meta>
    </step>
    <step id="16" name="Candidate Search">
      <meta name="jira.status.id">11727</meta>
      <meta name="jira.permission.assign.denied">denied</meta>
      <actions>
        <action id="321" name="Candidate selected" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13700</meta>
          <restrict-to>
            <conditions type="OR">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">√ó¬û¬∑√Ø√á&lt;√±√ó¬õ√µ¬≠√≥¬∂√Ωkw6√£¬èxw√ù6√±√û¬∏√ï√≠z</arg>
                <arg name="FIELD_NOTES" />
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "francesca.mure"</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.InGroupCFCondition</arg>
                <arg name="groupcf">customfield_18101</arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="contextHandling" />
              <arg name="hidFieldsList">customfield_17004@@customfield_17003@@customfield_17005@@customfield_14900@@customfield_17500@@</arg>
              <arg name="class.name">com.googlecode.jsu.workflow.validator.FieldsRequiredValidator</arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="17">
              <post-functions>
                <function type="class">
                  <arg name="field.name">j√ã"¬Çw¬û</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value" />
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Francesca Mur√® - Candidate Selected</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES">francesca.mure@faacgroup.com</arg>
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">w¬ç¬ö√ô¬ø=√ßn√ù√≥¬é}√≥O;√ï√ù√¥√ë√∂¬∫√ü¬∑&lt;√ß¬è&lt;kWZ</arg>
                  <arg name="FIELD_TO_USER_FIELDS" />
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #14892C; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #14892C; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #14892C; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;

				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #14892C; border-color: #14892C; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
                &lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Selected Candidate&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Selected Candidate")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to view the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #FFFFFF; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Candidate selected</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Candidate Selected'(321): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Candidate Selected'(321): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Candidate Selected'(321): To =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-62</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="331" name="Cancel process" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">13100</meta>
          <restrict-to>
            <conditions type="OR">
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.AllowOnlyAssignee</arg>
              </condition>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "francesca.mure"</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
              </condition>
              <condition type="class">
                <arg name="class.name">com.atlassian.jira.workflow.condition.InGroupCFCondition</arg>
                <arg name="groupcf">customfield_18101</arg>
              </condition>
            </conditions>
          </restrict-to>
          <validators>
            <validator name="" type="class">
              <arg name="hidFieldsList">comment@@</arg>
              <arg name="class.name">com.googlecode.jsu.workflow.validator.FieldsRequiredValidator</arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="18">
              <post-functions>
                <function type="class">
                  <arg name="field.name">j√ã"¬Çw¬û</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value" />
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail to Francesca Mur√® - Cancel Process</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">recruitment.requests@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES">francesca.mure@faacgroup.com</arg>
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">√≠√ß√õ¬é√•¬∑√ù√Ø]√õ√õ¬é\√µ√ó√º√ï√Ü¬∂√≥^wy√è;√ì¬Æt</arg>
                  <arg name="FIELD_TO_USER_FIELDS" />
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;body style="background-color: #14892C; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
 &lt;center&gt;
  &lt;table id="email-wrap" valign="top" border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif; background-color: #14892C; font-size: 16px; font-family:tahoma,geneva,sans-serif;"&gt;
   &lt;tbody&gt;
    &lt;tr&gt;
     &lt;td align="center" id="email-wrap-cell" style="padding: 15px 10px 10px"&gt;
      &lt;table id="email-container" border="0" cellpadding="0" cellspacing="0" style="width: 100%; width: 850px; font-family:tahoma,geneva,sans-serif; line-height: 1,500"&gt;
       &lt;tbody&gt;
        &lt;tr&gt;
         &lt;td align="left"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
           &lt;tbody&gt;
            &lt;tr&gt;
             &lt;td class="email-header" style="padding: 10px 20px; border: solid #ddd; border-width: 1px 2px 1px 1px; border-bottom-color: #14892C; background-color: #fff; font-weight: normal; line-height: 1,200"&gt;
              &lt;table border="0" style="width: 100%; font-family:tahoma,geneva,sans-serif;"&gt;
				&lt;!-- Logo in base alla bu selezionata --&gt;
                &lt;tr&gt;
				  &lt;td colspan="2" align="left"&gt;
					&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Automation") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;                        
					&lt;% } %&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "HUB Parking") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_HUB_Parking.jpg"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Access Control Magnetic") { %&gt;
                        &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Control_Magnetic.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "Headquarters") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Headquarters.png"/&gt;
					&lt;% }%&gt;
                    &lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() == "FAAC Group") { %&gt;
					  &lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_FAAC_Group.png"/&gt;
					&lt;% }%&gt;
				  &lt;/td&gt;

				  &lt;!--td&gt;&amp;nbsp;&lt;/td--&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td width="40%"&gt;
					&amp;nbsp;
				  &lt;/td&gt;
				  &lt;td width="60%" class="request-key" style="text-align: right; font-size: 12px; line-height: 18px; text-decoration: none"&gt;
					Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Department/Job Title --&gt;
				&lt;tr&gt;
				  &lt;td class="request-key" style="text-align: left; font-size: 16px; line-height: 18px; text-decoration: none"&gt;
					  &lt;b&gt;Approval for Recruitment Request&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
                      &lt;span class="request-status aui-lozenge aui-lozenge-current" style="background-color: #cccccd; border: 1px solid #cccccd; border-radius: 3px; color: #333; display: inline-block; font-size: 11px; font-weight: bold; line-height: 1; padding: 2px 5px 1px 5px; text-align: center; text-decoration: none; text-transform: uppercase; background-color: #14892C; border-color: #14892C; color: #FFFFFF; margin-left: 5px; font-weight: bold; font-size: 14px"&gt;$issue.status.name&lt;/span&gt;
				  &lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Department/Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;
				  &lt;/td&gt;
				&lt;!-- Detailed Job Title --&gt;
				&lt;/tr&gt;
				&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) == "Other") { %&gt;
				  &lt;tr&gt;
					&lt;td&gt;&amp;nbsp;&lt;/td&gt;
					&lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					  &lt;u&gt;Detailed Job Title&lt;/u&gt;: &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Detailed Job Title")).toString() %&gt;
					&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;% }%&gt;
				&lt;!-- Job Description --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Job Description&lt;/u&gt;: 
					&lt;% if(issue.description != null){ %&gt;			
						&lt;% out &lt;&lt; issue.description %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Starting Date --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Starting Date&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().substring(0,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Starting Date")).toString().indexOf("00:00")-1) %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;!-- Direct Manager --&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Direct Manager&lt;/u&gt;: 
					&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")) != null) { %&gt;
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Direct Manager")).toString() %&gt;
					&lt;% } %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Reporter&lt;/u&gt;: &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				
				&lt;!-- Expected in Budget? --&gt;
				&lt;% if(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")) != null) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				  &lt;td style="text-align: left; font-size: 14px; line-height: 20px; text-decoration: none"&gt;
					&lt;u&gt;Expected in Budget?&lt;/u&gt;: 
						&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Expected in Budget?")).toString() %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
				
				&lt;% if (lastComment) { %&gt;
				&lt;tr&gt;
				  &lt;td&gt;&lt;b&gt;Last Comment&lt;/b&gt;&lt;/td&gt;
				  &lt;td&gt;&amp;nbsp;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
				  &lt;td colspan="2"&gt;
					&lt;% out &lt;&lt; lastComment %&gt;
				  &lt;/td&gt;
				&lt;/tr&gt;
				&lt;% } %&gt;
                &lt;% if (currentUser) { %&gt;
				&lt;tr&gt;
					&lt;td align="right" colspan="2"&gt;&lt;% out &lt;&lt; currentUser.displayName %&gt;&lt;/td&gt;
				&lt;/tr&gt;
                &lt;% } %&gt;
			  &lt;/table&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
             &lt;td class="email-actions email-content-important" style="text-align: center; font-size: 14px; padding: 20px; border-style: solid; border-width: 0 2px 0 1px; border-color: #fff #ddd #ddd; background-color: #fff; padding: 20px; padding-top: 20px; padding-bottom: 20px; border-top-width: 0; border-bottom-width: 2px"&gt;
              &lt;b&gt;In order to view the Recruitment Request, please &lt;a href="http://itatlass-app01.faacspa.local:8080/browse/$issue"&gt;view the full request&lt;/a&gt;&lt;/b&gt;
             &lt;/td&gt;
            &lt;/tr&gt;
           &lt;/tbody&gt;
          &lt;/table&gt;
         &lt;/td&gt;
        &lt;/tr&gt;
       &lt;/tbody&gt;
      &lt;/table&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
     &lt;td id="foot-note" style="padding-bottom: 20px; color: #FFFFFF; font-size: 12px; line-height: 1,200"&gt;
      &lt;p style="width: 600px; text-align: center; margin: 0 auto"&gt;This message is automatically generated by FAAC Group Recruitment Request Portal.&lt;br /&gt;&lt;/p&gt;
     &lt;/td&gt;
    &lt;/tr&gt;
   &lt;/tbody&gt;
  &lt;/table&gt;
 &lt;/center&gt;
&lt;/body&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("HQ/BU")).toString() %&gt; [&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(':')+1,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')) %&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().substring(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().indexOf(',')+4,issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Department/Job Title")).toString().length()-1) %&gt;] Process CANCELED</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("recruitment.requests@faacgroup.com")

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.CreateDependentIssue")
log.setLevel(org.apache.log4j.Level.DEBUG)

log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Cancel Process'(331): Issue =&gt; " + issue.key
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Cancel Process'(331): Evaluated condition =&gt; always true" 
log.debug "[RR Workflow Outgoing Emails Log] Transazione 'Cancel Process'(331): To =&gt; francesca.mure@faacgroup.com"

true</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">RR-62</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="17" name="Closed">
      <meta name="jira.status.id">6</meta>
      <meta name="jira.permission.assign.denied">denied</meta>
    </step>
    <step id="18" name="&#09;¬©‚ÄπzW√π">
      <meta name="jira.status.id">11728</meta>
      <meta name="jira.permission.assign.denied">denied</meta>
    </step>
  </steps>
</workflow>