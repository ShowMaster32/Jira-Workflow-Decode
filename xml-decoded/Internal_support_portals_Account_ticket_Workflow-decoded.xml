<?xml version='1.0' encoding='UTF-8'?>
<workflow>
  <meta name="jira.description" />
  <meta name="jira.update.author.key">JIRAUSER62115</meta>
  <meta name="jira.updated.date">1746612905234</meta>
  <meta name="jira.update.author.name">admin</meta>
  <meta name="gh.version">7.3.0-DAILY20170302150106</meta>
  <initial-actions>
    <action id="1" name="Create">
      <meta name="jira.i18n.title">common.forms.create</meta>
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="žée" status="Backlog" step="50">
          <post-functions>
            <function type="class">
              <arg name="FIELD_SECURITY_LEVEL_ID">11201</arg>
              <arg name="FIELD_FUNCTION_ID">é§ùw®Ýá×¼sß5q×´qÍwçnçMöïß^ßü</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SetIssueSecurity</arg>
              <arg name="FIELD_CONDITION" />
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">69e8aef5-23b1-4409-8faf-446bc025c2a2</arg>
              <arg name="FIELD_NOTES">pulisco il campo reference employee id se sto creando un external user</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.ClearField</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.ClearField</arg>
              <arg name="FIELD_CONDITION">{"script":"cfValues['External FAAC User'].toString() == 'Yes'","scriptPath":null}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SELECTED_FIELDS">customfield_22301</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="field.type">9</arg>
              <arg name="field.objectTypeId">494</arg>
              <arg name="field.type9-ot-494-ota-6584">customfield_26203</arg>
              <arg name="field.objectSchemaId">9</arg>
              <arg name="field.type9-ot-494-ota-6585">customfield_26202</arg>
              <arg name="field.type9-ot-494-ota-6586">­êh®×«</arg>
              <arg name="field.type9-ot-494-ota-6587">customfield_20104</arg>
              <arg name="field.type9-ot-494-ota-6588" />
              <arg name="field.type9-ot-494-ota-6589" />
              <arg name="field.assignToIssueCustomFieldId">-1</arg>
              <arg name="field.type9-ot-494-ota-6581">customfield_26203</arg>
              <arg name="full.module.key">com.riadalabs.jira.plugins.insightinsight-post-function</arg>
              <arg name="field.ignoreValidationsOnCreate">false</arg>
              <arg name="class.name">com.riadalabs.jira.plugins.insight.services.jira.postfunction.InsightPostFunction</arg>
              <arg name="field.groovyCondition">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue;
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import org.apache.log4j.Category

IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()
IssueManager issueManager = ComponentAccessor.getIssueManager()
//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-49549")


def userManager = ComponentAccessor.getUserManager()
def watcherManager = ComponentAccessor.getWatcherManager()

/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);


Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomField ExternalEmail = customFieldManager.getCustomFieldObject(Long.parseLong("26203"))
def ExternalEmailV = issue.getCustomFieldValue(ExternalEmail)

CustomField ExternalFaacUser = customFieldManager.getCustomFieldObject(Long.parseLong("26204"))
def ExternalFaacUserV = issue.getCustomFieldValue(ExternalFaacUser)


def queryParam = "\"" + ExternalEmailV + "\""

  log.debug ExternalFaacUserV.toString() == "Yes"      
def objectsExternalEmployee = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"External Employee\" AND \"Name\" = " + queryParam ); // See the complete list of possible IQL on the Insight Query Language documentation page
log.debug objectsExternalEmployee
if (ExternalFaacUserV.toString() == "Yes"){
	if (objectsExternalEmployee.size()==0 )
		return true
	else
		return false
}
else{
	return false
}

  
    

</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">1</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="scopeSource-linkEnd" />
              <arg name="append.value" />
              <arg name="field.value">26</arg>
              <arg name="field.name">customfield_17102</arg>
              <arg name="scopeType">H</arg>
              <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="scopeDestination-linkEnd" />
              <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="scopeDestination-jql" />
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
              <arg name="scopeSource-jql" />
            </function>
            <function type="class">
              <arg name="scopeSource-linkEnd" />
              <arg name="append.value" />
              <arg name="field.value">126</arg>
              <arg name="field.name">customfield_17110</arg>
              <arg name="scopeType">H</arg>
              <arg name="destination-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="full.module.key">com.googlecode.jira-suite-utilitiesupdateIssueCustomField-function</arg>
              <arg name="scopeDestination-linkEnd" />
              <arg name="preconditionAwareFunctionMode-textValue">ALWAYS</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="source-scopeTarget">ISSUE_IN_TRANSITION</arg>
              <arg name="scopeDestination-jql" />
              <arg name="class.name">com.googlecode.jsu.workflow.function.UpdateIssueCustomFieldPostFunction</arg>
              <arg name="scopeSource-jql" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">mÇöé­øÓÞ\é¾yß®õñ§&lt;ñß6{Üï}¼ñÝº</arg>
              <arg name="FIELD_NOTES">assegno a HR di company le issue che arrivano da GEMS e la company di AD se arrivo da GEMS (trascodifica da comapny di GEMS a quella di AD)</arg>
              <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport com.atlassian.jira.issue.fields.CustomField\nimport com.atlassian.jira.issue.CustomFieldManager\nimport org.apache.log4j.Category\n\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\n\ndef issueManager = ComponentAccessor.getIssueManager()\ndef userManager = ComponentAccessor.getUserManager()\ndef watcherManager = ComponentAccessor.getWatcherManager()\n\n/* Get Insight IQL Facade from plugin accessor */\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\n/* Get Insight Object Facade from plugin accessor */\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\n\n\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\nlog.setLevel(org.apache.log4j.Level.DEBUG)\n\nCustomField IdTeams = customFieldManager.getCustomFieldObject(Long.parseLong(\"20500\"))\ndef IdTeamsV = issue.getCustomFieldValue(IdTeams)\n\ndef companyAD =\"\"\ndef user\n\nif (IdTeamsV != null &amp;&amp; IdTeamsV !=\"\"){\n    //leggo da insight la company corretta da inserire nel campo Reporter Company 20104\n    CustomField fieldReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong(\"20104\"))\n    def fieldReporterCompanyV = issue.getCustomFieldValue(fieldReporterCompany)\n    \n    if (fieldReporterCompanyV.toString()==\"FAAC France S.A.S\"){\n        user = userManager.getUserByName(\"laurie.botte\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"FAAC S.p.A.\"){\n        user = userManager.getUserByName(\"chiara.quarneti\")\n        //watcherManager.startWatching(userManager.getUserByName(\"chiara.quarneti\"), issue)\n\t}\n    else if (fieldReporterCompanyV.toString()==\"HUB Parking Technology Canada Ltd.\"){\n        user = userManager.getUserByName(\"lynn.stone\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"HUB Parking Technology USA Inc.\"){\n        user = userManager.getUserByName(\"lynn.stone\")\n    } \n    else if (fieldReporterCompanyV.toString()==\"Associated Time Instruments Company Inc.\"){\n        user = userManager.getUserByName(\"lynn.stone\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"TIBA LLC\"){\n        user = userManager.getUserByName(\"lynn.stone\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"FAAC International Inc.\"){\n        user = userManager.getUserByName(\"elizabeth.ortiz\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"FAAC Electronics Ltd.\"){\n        user = userManager.getUserByName(\"Colm.McCarthy\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"FAAC ESF\" || fieldReporterCompanyV.toString()==\"FAAC Entrance Solutions France Sas\"){\n        user = userManager.getUserByName(\"laurie.botte\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"FAAC Entrance Solutions UK\" || fieldReporterCompanyV.toString()==\"FAAC UK Ltd.\" || fieldReporterCompanyV.toString()==\"FAAC Doors &amp; Shutters UK Limited\"){\n        user = userManager.getUserByName(\"beatriz.james\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"CoMETA S.p.A.\"){\n        user = userManager.getUserByName(\"francesco.fusetto\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"CICOS S.c.r.l.\"){\n        user = userManager.getUserByName(\"tommaso.francini\")\n    }\n    else if (fieldReporterCompanyV.toString()==\"Magnetic Faac India Pvt Ltd\"){\n        user = userManager.getUserByName(\"vijaya.kumari\")\n    } \n    else {\n        user = userManager.getUserByName(\"laura.leser\")\n    }\n    issue.setSummary(\"New Hire IT Equipment: \" + issue.getSummary())\n\tissue.setReporter(user)\n    \n    /*if (fieldReporterCompanyV != null &amp;&amp; fieldReporterCompanyV!=\"\"){\n        def queryParam = \"\\\"\" + fieldReporterCompanyV + \"\\\"\"\n        \n        def objectsCompany = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"AssigneeInfrastructureCompany\\\" AND \\\"Company\\\" = (\" + queryParam + \")\"); // See the complete list of possible IQL on the Insight Query Language documentation page\n        log.debug objectFacade.loadObjectAttributeBean(objectsCompany[0].getId(), 2233).getObjectAttributeValueBeans()[0].getValue()\n\t\tif (objectFacade.loadObjectAttributeBean(objectsCompany[0].getId(), 2233) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objectsCompany[0].getId(), 2233) != \"\")\n        \tcompanyAD = objectFacade.loadObjectAttributeBean(objectsCompany[0].getId(), 2233).getObjectAttributeValueBeans()[0].getValue()\n       \n        if (companyAD != null &amp;&amp; companyAD!=\"\"){\n            issue.setCustomFieldValue(fieldReporterCompany, companyAD)\n        }\n    }*/\n    \n\tComponentAccessor.getIssueManager().updateIssue(user, issue, EventDispatchOption.DO_NOT_DISPATCH, false);\n\tissueIndexingService.reIndex(issue)\n}","scriptPath":null,"parameters":{}}</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import org.apache.log4j.Category

IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()

def issueManager = ComponentAccessor.getIssueManager()
def userManager = ComponentAccessor.getUserManager()
def watcherManager = ComponentAccessor.getWatcherManager()

/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);


Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

CustomField IdTeams = customFieldManager.getCustomFieldObject(Long.parseLong("20500"))
def IdTeamsV = issue.getCustomFieldValue(IdTeams)

def companyAD =""
def user

if (IdTeamsV != null &amp;&amp; IdTeamsV !=""){
    //leggo da insight la company corretta da inserire nel campo Reporter Company 20104
    CustomField fieldReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong("20104"))
    def fieldReporterCompanyV = issue.getCustomFieldValue(fieldReporterCompany)
    
    if (fieldReporterCompanyV.toString()=="FAAC France S.A.S"){
        user = userManager.getUserByName("laurie.botte")
    }
    else if (fieldReporterCompanyV.toString()=="FAAC S.p.A. Soc. Unipersonale"){
        user = userManager.getUserByName("francesco.fusetto")
        watcherManager.startWatching(userManager.getUserByName("chiara.quarneti"), issue)
	}
    else if (fieldReporterCompanyV.toString()=="HUB Parking Technology Canada Ltd."){
        user = userManager.getUserByName("melissa.deighan")
    }
    else if (fieldReporterCompanyV.toString()=="FAAC Electronics Ltd."){
        user = userManager.getUserByName("Colm.McCarthy")
    }
    else {
        user = userManager.getUserByName("claudia.thielbar")
    }
    
	issue.setReporter(user)
    
    /*if (fieldReporterCompanyV != null &amp;&amp; fieldReporterCompanyV!=""){
        def queryParam = "\"" + fieldReporterCompanyV + "\""
        
        def objectsCompany = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"AssigneeInfrastructureCompany\" AND \"Company\" = (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
        log.debug objectFacade.loadObjectAttributeBean(objectsCompany[0].getId(), 2233).getObjectAttributeValueBeans()[0].getValue()
		if (objectFacade.loadObjectAttributeBean(objectsCompany[0].getId(), 2233) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objectsCompany[0].getId(), 2233) != "")
        	companyAD = objectFacade.loadObjectAttributeBean(objectsCompany[0].getId(), 2233).getObjectAttributeValueBeans()[0].getValue()
       
        if (companyAD != null &amp;&amp; companyAD!=""){
            issue.setCustomFieldValue(fieldReporterCompany, companyAD)
        }
    }*/
    
	ComponentAccessor.getIssueManager().updateIssue(user, issue, EventDispatchOption.DO_NOT_DISPATCH, false);
	issueIndexingService.reIndex(issue)
}</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">ÓÞ¸Ûå½Üyç{¾ýëg·½Û^&lt;Ý¾ÛW;</arg>
              <arg name="FIELD_NOTES">Creazione automatica subtask assegnato al direct manager preso da teams NUOVO HD DISABILITARE</arg>
              <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.issue.MutableIssue\nimport com.atlassian.jira.issue.IssueManager\nimport com.atlassian.jira.bc.user.search.UserSearchService\nimport com.atlassian.jira.user.ApplicationUser\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport org.apache.log4j.Category\nimport com.atlassian.jira.issue.fields.CustomField\nimport com.atlassian.jira.issue.CustomFieldManager\nimport com.atlassian.jira.workflow.WorkflowTransitionUtil;\nimport com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;\nimport com.atlassian.jira.util.JiraUtils;\nimport groovy.json.JsonSlurper;\nimport groovy.json.StreamingJsonBuilder;\nimport com.atlassian.jira.issue.Issue;\nimport org.apache.commons.codec.binary.Base64;\nimport groovy.json.JsonSlurper;\nimport groovy.json.StreamingJsonBuilder;\nimport org.apache.log4j.Category\nimport com.atlassian.jira.user.util.UserManager\n\ndef issueFactory = ComponentAccessor.getIssueFactory()\ndef constantManager = ComponentAccessor.getConstantsManager()\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\ndef subTaskManager = ComponentAccessor.getSubTaskManager()\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\n/* Get Insight IQL Facade from plugin accessor */\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\n/* Get Insight Object Facade from plugin accessor */\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\n\n/* Get issue \"Group Assignee\" custom field value */\nIssueManager issueManager = ComponentAccessor.getIssueManager()\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\nlog.setLevel(org.apache.log4j.Level.DEBUG)\n\ndef groupManager = ComponentAccessor.getGroupManager()\ndef daTeams=false\ndef EmployeeReferenceMail = \"\"\ndef IDTEAMSV = null\ndef creaSubTask\ndef dManagerList = []\ndef userPropertyManager = ComponentAccessor.getUserPropertyManager()\ndef userManager = ComponentAccessor.getUserManager()\ndef userSearchService = ComponentAccessor.getComponent(UserSearchService.class)\n\nCustomField ReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong(\"20104\"))\ndef ReporterCompanyV = issue.getCustomFieldValue(ReporterCompany)\n//Reference Employee ID PROD 22301 - TEST 23001\nCustomField EmployeeReference = customFieldManager.getCustomFieldObject(Long.parseLong(\"22301\"))\ndef EmployeeReferenceMailV = issue.getCustomFieldValue(EmployeeReference)\nlog.debug EmployeeReferenceMailV\n\nif ( EmployeeReferenceMailV != null &amp;&amp;  EmployeeReferenceMailV != \"\"){\n    def objectCompany = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND objectId = \" + EmployeeReferenceMailV[0].getId() + \" AND \\\"Company\\\" IN (\\\"FAAC France S.A.S\\\",\\\"FAAC S.p.A.\\\",\\\"FAAC Entrance Solutions France Sas\\\",\\\"FAAC Entrance Solutions UK\\\",\\\"HUB Parking Technology Canada Ltd.\\\",\\\"HUB Parking Technology USA Inc.\\\",\\\"FAAC Electronics Ltd.\\\",\\\"CoMETA S.p.A.\\\",\\\"CICOS S.c.r.l.\\\",\\\"FAAC UK Ltd.\\\",\\\"FAAC Doors &amp; Shutters UK Limited\\\",\\\"Magnetic Autocontrol GmbH\\\")\"); \n     log.debug objectCompany\n    if (objectCompany.size()&gt;0)\n        creaSubTask=true\n    else\n        creaSubTask=false\n} \nelse{\n    log.debug ReporterCompanyV\n\tif (ReporterCompanyV==\"FAAC S.p.A.\" || ReporterCompanyV==\"FAAC France S.A.S\" || ReporterCompanyV == 'Magnetic Autocontrol GmbH' || ReporterCompanyV == 'HUB Parking Technology Canada Ltd.' || ReporterCompanyV == 'FAAC Electronics Ltd.' || ReporterCompanyV == 'FAAC Entrance Solutions France Sas' || ReporterCompanyV == 'FAAC Entrance Solutions UK' || ReporterCompanyV == 'CoMETA S.p.A.' || ReporterCompanyV == 'CICOS S.c.r.l.' || ReporterCompanyV == 'FAAC UK Ltd.' ||  ReporterCompanyV == 'FAAC Doors &amp; Shutters UK Limited' || ReporterCompanyV == 'HUB Parking Technology USA Inc.') \n\t\tcreaSubTask=true\n    else\n\t\tcreaSubTask=false\n} \nlog.debug \"creaSubTask \" + creaSubTask\ndef isVIP\n\nif (EmployeeReferenceMailV != null) {\n\tdef queryParam = \"\\\"\" + EmployeeReferenceMailV[0].getName() + \"\\\"\"\n    log.debug queryParam\n    def objects = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND \\\"Name\\\" IN (\" + queryParam + \")\"); // See the complete list of possible IQL on the Insight Query Language documentation page\n    log.debug objects\n    if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239) != \"\")\n        isVIP = objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239).getObjectAttributeValueBeans()[0].getValue()    \n    \n    if (isVIP==true)\n    \tcreaSubTask =false\n}\n\nlog.debug creaSubTask\nif (creaSubTask) {\n    if(!groupManager.getUsersInGroup(\"Helpdesk VIP\").contains(issue.getReporter())){\n        //MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-6118\")\n        log.debug \"crea sub\"\n        // Employee System ID uguale PROD E TEST\n        CustomField IDTEAMS = customFieldManager.getCustomFieldObject(Long.parseLong(\"20500\"))\n        def IDTEAMSV_daTeams = issue.getCustomFieldValue(IDTEAMS)\n        \n        if (IDTEAMSV_daTeams != null)\n        {\n            daTeams=true\n           \n            //imposto la mail che leggo dal campo direct manager\n            CustomField directManagerDaTeams = customFieldManager.getCustomFieldObject(Long.parseLong(\"14411\"))\n            def directManagerDaTeamsV = issue.getCustomFieldValue(directManagerDaTeams)\n            EmployeeReferenceMail = directManagerDaTeamsV \n        } \n\n\n\t\n        if (IDTEAMSV == null &amp;&amp; daTeams==false)\n        {\n            if (EmployeeReferenceMailV == null || EmployeeReferenceMailV==\"\")\n            {\n                EmployeeReferenceMail = issue.reporter.getEmailAddress()\n                log.debug \"EmployeeReferenceMail\" + EmployeeReferenceMail\n            }\n            else {\n                def idTeamsEmployee= EmployeeReferenceMailV[0].getName().split(\"-\")\n                IDTEAMSV = idTeamsEmployee[0].trim()\n           }     \n        }\n        def requestMethod = \"GET\";\n\n        def baseURL=\"\"\n        //se ho IDTEAMS perch\u00e8 arrivo da WF di TEAMS allora chiamo questo:\n        //TEST http://172.30.3.230:8080\n        //PROD https://gems.faacgroup.com\n\t\tif (daTeams==false){\n            if (IDTEAMSV == null)\n                baseURL = \"https://gems.faacgroup.com/faac-hrportal-web/rest/jira/directManager?email=\" + EmployeeReferenceMail\t\n            else\n                baseURL = \"https://gems.faacgroup.com/faac-hrportal-web/rest/jira/employee/\" + IDTEAMSV.toString() + \"/directManager\"\n\n            URL url\n            url = new URL(baseURL)\n            \n            log.debug baseURL\n            \n            HttpURLConnection connection = (HttpURLConnection)url.openConnection();\n\t\t\t\n            connection.setRequestMethod(requestMethod);\n            connection.setRequestProperty(\"Content-Type\", \"application/json\");\n            connection.setRequestProperty(\"Accept\", \"*/*\");\n            connection.setDoOutput(true);\n            connection.setDoInput(true);\n            connection.connect();\n\n            log.debug \"ResponseCode:\" + connection.getResponseCode();\n\n            def httpResponseScanner = new Scanner(connection.getInputStream())\n\n            def jsonResp =  httpResponseScanner.nextLine()\n            def json = new JsonSlurper().parseText(jsonResp)\n\n        \tdManagerList = userSearchService.findUsersByEmail(json.email)\n            httpResponseScanner.close()\n        } \n        else{\n             dManagerList = userSearchService.findUsersByEmail(EmployeeReferenceMail)\n        }\n        \n        ApplicationUser directManager\n\n        //se ho piu user utilizzo quello che ha il gruppo IDTS-customers altrimenti uso l'unico utente che c'\u00e8\n        if (dManagerList.size()&gt;1) {\n            for (directM in dManagerList){\n               if (groupManager.getUsersInGroup(\"IDTS-customers\").contains(directM)){\n                    directManager=(ApplicationUser) directM\n                }\t\n           } \n        }\n        else {\n            directManager=dManagerList.getAt(0)\n        }\n\n        //se ho piu user e non ne ho nemmeno uno con IDTS-customers allora prendo quello che appartiere alla directory di crowd\n        if (directManager == null){\n            for (directM in dManagerList){\n\n               log.debug (directM.getDirectoryId() == 10000)\n                if (directM.getDirectoryId() == 10000){\n                    directManager=(ApplicationUser) directM\n                }\t\n            } \n        }\n\n\n        /* Create sub-task to be assigned to user */\n        MutableIssue newSubTask = issueFactory.getIssue()\n        //dobbiamo mettere il direct manager proveniente da teams\n        def directManagerList = []\n        directManagerList.add(directManager)\n        log.debug directManagerList\n        \n        // IDTS WF Account PROD 22256 - TEST 22100\n        CustomField WFAccount = customFieldManager.getCustomFieldObject(Long.parseLong(\"22256\"))\n        issue.setCustomFieldValue(WFAccount, directManagerList)\n        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\n\n        newSubTask.setAssignee(directManager)\n        newSubTask.setReporter(LoggedInUser)\n        newSubTask.setSummary(directManager.getUsername() + \" - \" + issue.getSummary())\n        // Software/Hardware PROD 22253 - TYEST 22023\n        CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\n        //Software/Hardware Approvation PROD 22260 - TEST 22343\n        CustomField SoftHardAppr = customFieldManager.getCustomFieldObject(Long.parseLong(\"22260\"))\n\n       \n\n        def fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)\n\n        newSubTask.setCustomFieldValue(fieldSoftHard, fieldSoftHardV)\n        newSubTask.setCustomFieldValue(SoftHardAppr, fieldSoftHardV)\n        newSubTask.setCustomFieldValue(ReporterCompany, ReporterCompanyV)\n\n        newSubTask.setParentObject(issue)\n        newSubTask.setProjectObject(issue.getProjectObject())\n\n        newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{\n            it.getName() == \"Sub-ApprAccount\"\n        }.id)\n\n        def newIssueParams = [\"issue\" : newSubTask] as Map&lt;String,Object&gt;\n\t\t\n        issueManager.createIssueObject(LoggedInUser, newIssueParams)\n        subTaskManager.createSubTaskIssueLink(issue, newSubTask, LoggedInUser)\n        issueIndexingService.reIndex(newSubTask)\n        //Software/Hardware PROD 22253 - TEST 22023\n        //CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\n        //def SoftHardV = issue.getCustomFieldValue(SoftHard)\n        //issue.setCustomFieldValue(SoftHardAppr, SoftHard)\n\n        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\n        issueIndexingService.reIndex(issue)      \n    }\n}\n\n","scriptPath":null,"parameters":{}}</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()
def subTaskManager = ComponentAccessor.getSubTaskManager()
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()
/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()
Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

def groupManager = ComponentAccessor.getGroupManager()
def daTeams=false
def EmployeeReferenceMail = ""
def IDTEAMSV = null
def creaSubTask
def dManagerList = []
def userPropertyManager = ComponentAccessor.getUserPropertyManager()
def userManager = ComponentAccessor.getUserManager()
def userSearchService = ComponentAccessor.getComponent(UserSearchService.class)

CustomField ReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong("20104"))
def ReporterCompanyV = issue.getCustomFieldValue(ReporterCompany)
//Reference Employee ID PROD 22301 - TEST 23001
CustomField EmployeeReference = customFieldManager.getCustomFieldObject(Long.parseLong("22301"))
def EmployeeReferenceMailV = issue.getCustomFieldValue(EmployeeReference)
log.debug EmployeeReferenceMailV

if ( EmployeeReferenceMailV != null &amp;&amp;  EmployeeReferenceMailV != ""){
    def objectCompany = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"Employee\" AND objectId = " + EmployeeReferenceMailV[0].getId() + " AND \"Company\" IN (\"FAAC France S.A.S\",\"FAAC S.p.A. Soc. Unipersonale\",\"HUB Parking Technology Canada Ltd.\",\"FAAC Electronics Ltd.\",\"Magnetic Autocontrol GmbH\")"); 
     log.debug objectCompany
    if (objectCompany.size()&gt;0)
        creaSubTask=true
    else
        creaSubTask=false
} 
else{
    log.debug ReporterCompanyV
	if (ReporterCompanyV=="FAAC S.p.A. Soc. Unipersonale" || ReporterCompanyV=="FAAC France S.A.S" || ReporterCompanyV == 'Magnetic Autocontrol GmbH' || ReporterCompanyV == 'HUB Parking Technology Canada Ltd.' || ReporterCompanyV == 'FAAC Electronics Ltd.') 
		creaSubTask=true
    else
		creaSubTask=false
} 
log.debug "creaSubTask " + creaSubTask
def isVIP

if (EmployeeReferenceMailV != null) {
	def queryParam = "\"" + EmployeeReferenceMailV[0].getName() + "\""
    log.debug queryParam
    def objects = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"Employee\" AND \"Name\" IN (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
    log.debug objects
    if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239) != "")
        isVIP = objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239).getObjectAttributeValueBeans()[0].getValue()    
    
    if (isVIP==true)
    	creaSubTask =false
}

log.debug creaSubTask
if (creaSubTask) {
    if(!groupManager.getUsersInGroup("Helpdesk VIP").contains(issue.getReporter())){
        //MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6118")
        log.debug "crea sub"
        // Employee System ID uguale PROD E TEST
        CustomField IDTEAMS = customFieldManager.getCustomFieldObject(Long.parseLong("20500"))
        def IDTEAMSV_daTeams = issue.getCustomFieldValue(IDTEAMS)
        
        if (IDTEAMSV_daTeams != null)
        {
            daTeams=true
           
            //imposto la mail che leggo dal campo direct manager
            CustomField directManagerDaTeams = customFieldManager.getCustomFieldObject(Long.parseLong("14411"))
            def directManagerDaTeamsV = issue.getCustomFieldValue(directManagerDaTeams)
            EmployeeReferenceMail = directManagerDaTeamsV 
        } 


	
        if (IDTEAMSV == null &amp;&amp; daTeams==false)
        {
            if (EmployeeReferenceMailV == null || EmployeeReferenceMailV=="")
            {
                EmployeeReferenceMail = issue.reporter.getEmailAddress()
                log.debug "EmployeeReferenceMail" + EmployeeReferenceMail
            }
            else {
                def idTeamsEmployee= EmployeeReferenceMailV[0].getName().split("-")
                IDTEAMSV = idTeamsEmployee[0].trim()
           }     
        }
        def requestMethod = "GET";

        def baseURL=""
        //se ho IDTEAMS perchè arrivo da WF di TEAMS allora chiamo questo:
        //TEST http://172.30.3.230:8080
        //PROD https://gems.faacgroup.com
		if (daTeams==false){
            if (IDTEAMSV == null)
                baseURL = "https://gems.faacgroup.com/faac-hrportal-web/rest/jira/directManager?email=" + EmployeeReferenceMail	
            else
                baseURL = "https://gems.faacgroup.com/faac-hrportal-web/rest/jira/employee/" + IDTEAMSV.toString() + "/directManager"

            URL url
            url = new URL(baseURL)
            
            log.debug baseURL
            
            HttpURLConnection connection = (HttpURLConnection)url.openConnection();
			
            connection.setRequestMethod(requestMethod);
            connection.setRequestProperty("Content-Type", "application/json");
            connection.setRequestProperty("Accept", "*/*");
            connection.setDoOutput(true);
            connection.setDoInput(true);
            connection.connect();

            log.debug "ResponseCode:" + connection.getResponseCode();

            def httpResponseScanner = new Scanner(connection.getInputStream())

            def jsonResp =  httpResponseScanner.nextLine()
            def json = new JsonSlurper().parseText(jsonResp)

        	dManagerList = userSearchService.findUsersByEmail(json.email)
            httpResponseScanner.close()
        } 
        else{
             dManagerList = userSearchService.findUsersByEmail(EmployeeReferenceMail)
        }
        
        ApplicationUser directManager

        //se ho piu user utilizzo quello che ha il gruppo IDTS-customers altrimenti uso l'unico utente che c'è
        if (dManagerList.size()&gt;1) {
            for (directM in dManagerList){
               if (groupManager.getUsersInGroup("IDTS-customers").contains(directM)){
                    directManager=(ApplicationUser) directM
                }	
           } 
        }
        else {
            directManager=dManagerList.getAt(0)
        }

        //se ho piu user e non ne ho nemmeno uno con IDTS-customers allora prendo quello che appartiere alla directory di crowd
        if (directManager == null){
            for (directM in dManagerList){

               log.debug (directM.getDirectoryId() == 10000)
                if (directM.getDirectoryId() == 10000){
                    directManager=(ApplicationUser) directM
                }	
            } 
        }


        /* Create sub-task to be assigned to user */
        MutableIssue newSubTask = issueFactory.getIssue()
        //dobbiamo mettere il direct manager proveniente da teams
        def directManagerList = []
        directManagerList.add(directManager)
        log.debug directManagerList
        
        // IDTS WF Account PROD 22256 - TEST 22100
        CustomField WFAccount = customFieldManager.getCustomFieldObject(Long.parseLong("22256"))
        issue.setCustomFieldValue(WFAccount, directManagerList)
        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)

        newSubTask.setAssignee(directManager)
        newSubTask.setReporter(LoggedInUser)
        newSubTask.setSummary(directManager.getUsername() + " - " + issue.getSummary())
        // Software/Hardware PROD 22253 - TYEST 22023
        CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
        //Software/Hardware Approvation PROD 22260 - TEST 22343
        CustomField SoftHardAppr = customFieldManager.getCustomFieldObject(Long.parseLong("22260"))

       

        def fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)

        newSubTask.setCustomFieldValue(fieldSoftHard, fieldSoftHardV)
        newSubTask.setCustomFieldValue(SoftHardAppr, fieldSoftHardV)
        newSubTask.setCustomFieldValue(ReporterCompany, ReporterCompanyV)

        newSubTask.setParentObject(issue)
        newSubTask.setProjectObject(issue.getProjectObject())

        newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{
            it.getName() == "Sub-ApprAccount"
        }.id)

        def newIssueParams = ["issue" : newSubTask] as Map&lt;String,Object&gt;
		
        issueManager.createIssueObject(LoggedInUser, newIssueParams)
        subTaskManager.createSubTaskIssueLink(issue, newSubTask, LoggedInUser)
        issueIndexingService.reIndex(newSubTask)
        //Software/Hardware PROD 22253 - TEST 22023
        //CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
        //def SoftHardV = issue.getCustomFieldValue(SoftHard)
        //issue.setCustomFieldValue(SoftHardAppr, SoftHard)

        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)
        issueIndexingService.reIndex(issue)      
    }
}

</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="v+nWù">¶»ž</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">ÓÞ¸Ûå½Üyç{¾ýëg·½Û^&lt;Ý¾ÛW;</arg>
              <arg name="FIELD_NOTES">Creazione automatica subtask assegnato al direct manager preso da teams NUOVO HELPDESK DA ABILITARE</arg>
              <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.issue.MutableIssue\nimport com.atlassian.jira.issue.IssueManager\nimport com.atlassian.jira.bc.user.search.UserSearchService\nimport com.atlassian.jira.user.ApplicationUser\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport org.apache.log4j.Category\nimport com.atlassian.jira.issue.fields.CustomField\nimport com.atlassian.jira.issue.CustomFieldManager\nimport com.atlassian.jira.workflow.WorkflowTransitionUtil;\nimport com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;\nimport com.atlassian.jira.util.JiraUtils;\nimport groovy.json.JsonSlurper;\nimport groovy.json.StreamingJsonBuilder;\nimport com.atlassian.jira.issue.Issue;\nimport org.apache.commons.codec.binary.Base64;\nimport groovy.json.JsonSlurper;\nimport groovy.json.StreamingJsonBuilder;\nimport org.apache.log4j.Category\nimport com.atlassian.jira.user.util.UserManager\n\ndef issueFactory = ComponentAccessor.getIssueFactory()\ndef constantManager = ComponentAccessor.getConstantsManager()\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\ndef subTaskManager = ComponentAccessor.getSubTaskManager()\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\n/* Get Insight IQL Facade from plugin accessor */\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\n/* Get Insight Object Facade from plugin accessor */\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\n\n/* Get issue \"Group Assignee\" custom field value */\nIssueManager issueManager = ComponentAccessor.getIssueManager()\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\nlog.setLevel(org.apache.log4j.Level.DEBUG)\n//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-91558\")\ndef groupManager = ComponentAccessor.getGroupManager()\ndef daTeams=false\ndef EmployeeReferenceMail = \"\"\ndef IDTEAMSV = null\ndef creaSubTask\ndef dManagerList = []\ndef userPropertyManager = ComponentAccessor.getUserPropertyManager()\ndef userManager = ComponentAccessor.getUserManager()\ndef userSearchService = ComponentAccessor.getComponent(UserSearchService.class)\n\nCustomField ReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong(\"20104\"))\ndef ReporterCompanyV = issue.getCustomFieldValue(ReporterCompany)\n//Reference Employee ID PROD 22301 - TEST 23001\nCustomField EmployeeReference = customFieldManager.getCustomFieldObject(Long.parseLong(\"22301\"))\ndef EmployeeReferenceMailV = issue.getCustomFieldValue(EmployeeReference)\nlog.debug EmployeeReferenceMailV\n\nif ( EmployeeReferenceMailV != null &amp;&amp;  EmployeeReferenceMailV != \"\" &amp;&amp; EmployeeReferenceMailV.size()==1){\n    def objectCompany = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND objectId = \" + EmployeeReferenceMailV[0].getId() + \" AND \\\"Company\\\" IN (\\\"FAAC France S.A.S\\\",\\\"FAAC S.p.A.\\\",\\\"FAAC Entrance Solutions France Sas\\\",\\\"FAAC Entrance Solutions UK\\\",\\\"HUB Parking Technology Canada Ltd.\\\",\\\"HUB Parking Technology USA Inc.\\\",\\\"FAAC International Inc.\\\",\\\"Associated Time Instruments Company Inc.\\\",\\\"TIBA LLC\\\",\\\"FAAC Electronics Ltd.\\\",\\\"CoMETA S.p.A.\\\",\\\"CICOS S.c.r.l.\\\",\\\"FAAC UK Ltd.\\\",\\\"FAAC Doors &amp; Shutters UK Limited\\\",\\\"Magnetic Faac India Pvt Ltd\\\",\\\"Magnetic Autocontrol GmbH\\\")\"); \n     log.debug objectCompany\n    if (objectCompany.size()&gt;0)\n        creaSubTask=true\n    else\n        creaSubTask=false\n} \nelse{\n    log.debug ReporterCompanyV\n\tif (ReporterCompanyV==\"FAAC S.p.A.\" || ReporterCompanyV==\"FAAC France S.A.S\" || ReporterCompanyV == 'Magnetic Autocontrol GmbH' || ReporterCompanyV == 'HUB Parking Technology Canada Ltd.' || ReporterCompanyV == 'FAAC Electronics Ltd.' || ReporterCompanyV == 'FAAC Entrance Solutions France Sas' || ReporterCompanyV == 'FAAC Entrance Solutions UK' || ReporterCompanyV == 'CoMETA S.p.A.' || ReporterCompanyV == 'CICOS S.c.r.l.' || ReporterCompanyV == 'FAAC UK Ltd.' ||  ReporterCompanyV == 'FAAC Doors &amp; Shutters UK Limited' ||  ReporterCompanyV == 'Magnetic Faac India Pvt Ltd' || ReporterCompanyV == 'HUB Parking Technology USA Inc.'|| ReporterCompanyV == 'Associated Time Instruments Company Inc.'|| ReporterCompanyV == 'FAAC International Inc.'|| ReporterCompanyV == 'TIBA LLC') \n\t\tcreaSubTask=true\n    else\n\t\tcreaSubTask=false\n} \n\nif (issue.getSummary().toString()==\"AutomaticalDismissalFromInsight\"){\n    creaSubTask=false\n}\n\nlog.debug \"creaSubTask \" + creaSubTask\ndef isVIP\n\nif (EmployeeReferenceMailV != null &amp;&amp; EmployeeReferenceMailV.size()==1) {\n\tdef queryParam = \"\\\"\" + EmployeeReferenceMailV[0].getName() + \"\\\"\"\n    log.debug queryParam\n    def objects = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND \\\"Name\\\" IN (\" + queryParam + \")\"); // See the complete list of possible IQL on the Insight Query Language documentation page\n    log.debug objects\n    if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 6541) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objects[0].getId(), 6541) != \"\")\n        isVIP = objectFacade.loadObjectAttributeBean(objects[0].getId(), 6541).getObjectAttributeValueBeans()[0].getValue()    \n    \n    if (isVIP==true)\n    \tcreaSubTask =false\n}\n\nlog.debug creaSubTask\nif (creaSubTask) {\n    if(!groupManager.getUsersInGroup(\"Helpdesk VIP\").contains(issue.getReporter())){\n        //MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-6118\")\n        log.debug \"crea sub\"\n        // Employee System ID uguale PROD E TEST\n        CustomField IDTEAMS = customFieldManager.getCustomFieldObject(Long.parseLong(\"20500\"))\n        def IDTEAMSV_daTeams = issue.getCustomFieldValue(IDTEAMS)\n        \n        if (IDTEAMSV_daTeams != null)\n        {\n            daTeams=true\n           \n            //imposto la mail che leggo dal campo direct manager\n            CustomField directManagerDaTeams = customFieldManager.getCustomFieldObject(Long.parseLong(\"14411\"))\n            def directManagerDaTeamsV = issue.getCustomFieldValue(directManagerDaTeams)\n            EmployeeReferenceMail = directManagerDaTeamsV \n        } \n\n\n\t\n        if (IDTEAMSV == null &amp;&amp; daTeams==false)\n        {\n            if (EmployeeReferenceMailV == null || EmployeeReferenceMailV==\"\" || EmployeeReferenceMailV.size()!=1)\n            {\n                EmployeeReferenceMail = issue.reporter.getEmailAddress()\n                log.debug \"EmployeeReferenceMail\" + EmployeeReferenceMail\n            }\n            else {\n                def idTeamsEmployee= EmployeeReferenceMailV[0].getName().split(\"-\")\n                IDTEAMSV = idTeamsEmployee[0].trim()\n           }     \n        }\n        def requestMethod = \"GET\";\n\n        def baseURL=\"\"\n        //se ho IDTEAMS perch\u00e8 arrivo da WF di TEAMS allora chiamo questo:\n        //TEST http://172.30.3.230:8080\n        //PROD https://gems.faacgroup.com\n\t\tif (daTeams==false){\n            if (IDTEAMSV == null)\n                baseURL = \"https://gems.faacgroup.com/faac-hrportal-web/rest/jira/directManager?email=\" + EmployeeReferenceMail\t\n            else\n                baseURL = \"https://gems.faacgroup.com/faac-hrportal-web/rest/jira/employee/\" + IDTEAMSV.toString() + \"/directManager\"\n\n            URL url\n            url = new URL(baseURL)\n            \n            log.debug baseURL\n            \n            HttpURLConnection connection = (HttpURLConnection)url.openConnection();\n\t\t\t\n            connection.setRequestMethod(requestMethod);\n            connection.setRequestProperty(\"Content-Type\", \"application/json\");\n            connection.setRequestProperty(\"Accept\", \"*/*\");\n            connection.setDoOutput(true);\n            connection.setDoInput(true);\n            connection.connect();\n\n            log.debug \"ResponseCode:\" + connection.getResponseCode();\n\n            def httpResponseScanner = new Scanner(connection.getInputStream())\n\n            def jsonResp =  httpResponseScanner.nextLine()\n            def json = new JsonSlurper().parseText(jsonResp)\n\n        \tdManagerList = userSearchService.findUsersByEmail(json.email)\n            httpResponseScanner.close()\n        } \n        else{\n             dManagerList = userSearchService.findUsersByEmail(EmployeeReferenceMail)\n        }\n        \n        ApplicationUser directManager\n\n        //se ho piu user utilizzo quello che ha il gruppo IDTS-customers altrimenti uso l'unico utente che c'\u00e8\n        if (dManagerList.size()&gt;1) {\n            for (directM in dManagerList){\n               if (groupManager.getUsersInGroup(\"IDTS-customers\").contains(directM)){\n                    directManager=(ApplicationUser) directM\n                }\t\n           } \n        }\n        else {\n            directManager=dManagerList.getAt(0)\n        }\n\n        //se ho piu user e non ne ho nemmeno uno con IDTS-customers allora prendo quello che appartiere alla directory di crowd\n        if (directManager == null){\n            for (directM in dManagerList){\n\n               log.debug (directM.getDirectoryId() == 10000)\n                if (directM.getDirectoryId() == 10000){\n                    directManager=(ApplicationUser) directM\n                    break\n                }\t\n            } \n        }\n\n\n        /* Create sub-task to be assigned to user */\n        MutableIssue newSubTask = issueFactory.getIssue()\n        //dobbiamo mettere il direct manager proveniente da teams\n        def directManagerList = []\n        directManagerList.add(directManager)\n        log.debug directManagerList\n        \n        // IDTS WF Account PROD 22256 - TEST 22100\n        CustomField WFAccount = customFieldManager.getCustomFieldObject(Long.parseLong(\"22256\"))\n        issue.setCustomFieldValue(WFAccount, directManagerList)\n        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\n\n        newSubTask.setAssignee(directManager)\n        newSubTask.setReporter(LoggedInUser)\n        newSubTask.setSummary(directManager.getUsername() + \" - \" + issue.getSummary())\n        // Software/Hardware PROD 22253 - TYEST 22023\n        CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\n        //Software/Hardware Approvation PROD 22260 - TEST 22343\n        CustomField SoftHardAppr = customFieldManager.getCustomFieldObject(Long.parseLong(\"22260\"))\n\n       \n\n        def fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)\n\n        newSubTask.setCustomFieldValue(fieldSoftHard, fieldSoftHardV)\n        newSubTask.setCustomFieldValue(SoftHardAppr, fieldSoftHardV)\n        newSubTask.setCustomFieldValue(ReporterCompany, ReporterCompanyV)\n\n\n        //new license \n        CustomField EmployeeSystemID = customFieldManager.getCustomFieldObject(Long.parseLong(\"20500\"))\n        def EmployeeSystemIDV = issue.getCustomFieldValue(EmployeeSystemID)\n        newSubTask.setCustomFieldValue(EmployeeSystemID, EmployeeSystemIDV)\n        //new license \n        \n        newSubTask.setParentObject(issue)\n        newSubTask.setProjectObject(issue.getProjectObject())\n\n        newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{\n            it.getName() == \"Sub-ApprAccount\"\n        }.id)\n\n        def newIssueParams = [\"issue\" : newSubTask] as Map&lt;String,Object&gt;\n\t\t\n        issueManager.createIssueObject(LoggedInUser, newIssueParams)\n        subTaskManager.createSubTaskIssueLink(issue, newSubTask, LoggedInUser)\n        issueIndexingService.reIndex(newSubTask)\n        //Software/Hardware PROD 22253 - TEST 22023\n        //CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\n        //def SoftHardV = issue.getCustomFieldValue(SoftHard)\n        //issue.setCustomFieldValue(SoftHardAppr, SoftHard)\n\n        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\n        issueIndexingService.reIndex(issue)      \n    }\n}\n\n","scriptPath":null,"parameters":{}}</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()
def subTaskManager = ComponentAccessor.getSubTaskManager()
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()
/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()
Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

def groupManager = ComponentAccessor.getGroupManager()
def daTeams=false
def EmployeeReferenceMail = ""
def IDTEAMSV = null
def creaSubTask
def dManagerList = []
def userPropertyManager = ComponentAccessor.getUserPropertyManager()
def userManager = ComponentAccessor.getUserManager()
def userSearchService = ComponentAccessor.getComponent(UserSearchService.class)

CustomField ReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong("20104"))
def ReporterCompanyV = issue.getCustomFieldValue(ReporterCompany)
//Reference Employee ID PROD 22301 - TEST 23001
CustomField EmployeeReference = customFieldManager.getCustomFieldObject(Long.parseLong("22301"))
def EmployeeReferenceMailV = issue.getCustomFieldValue(EmployeeReference)
log.debug EmployeeReferenceMailV

if ( EmployeeReferenceMailV != null &amp;&amp;  EmployeeReferenceMailV != ""){
    def objectCompany = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"Employee\" AND objectId = " + EmployeeReferenceMailV[0].getId() + " AND \"Company\" IN (\"FAAC France S.A.S\",\"FAAC S.p.A. Soc. Unipersonale\",\"HUB Parking Technology Canada Ltd.\",\"FAAC Electronics Ltd.\",\"Magnetic Autocontrol GmbH\")"); 
     log.debug objectCompany
    if (objectCompany.size()&gt;0)
        creaSubTask=true
    else
        creaSubTask=false
} 
else{
    log.debug ReporterCompanyV
	if (ReporterCompanyV=="FAAC S.p.A. Soc. Unipersonale" || ReporterCompanyV=="FAAC France S.A.S" || ReporterCompanyV == 'Magnetic Autocontrol GmbH' || ReporterCompanyV == 'HUB Parking Technology Canada Ltd.' || ReporterCompanyV == 'FAAC Electronics Ltd.') 
		creaSubTask=true
    else
		creaSubTask=false
} 
log.debug "creaSubTask " + creaSubTask
def isVIP

if (EmployeeReferenceMailV != null) {
	def queryParam = "\"" + EmployeeReferenceMailV[0].getName() + "\""
    log.debug queryParam
    def objects = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"Employee\" AND \"Name\" IN (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
    log.debug objects
    if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239) != "")
        isVIP = objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239).getObjectAttributeValueBeans()[0].getValue()    
    
    if (isVIP==true)
    	creaSubTask =false
}

log.debug creaSubTask
if (creaSubTask) {
    if(!groupManager.getUsersInGroup("Helpdesk VIP").contains(issue.getReporter())){
        //MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6118")
        log.debug "crea sub"
        // Employee System ID uguale PROD E TEST
        CustomField IDTEAMS = customFieldManager.getCustomFieldObject(Long.parseLong("20500"))
        def IDTEAMSV_daTeams = issue.getCustomFieldValue(IDTEAMS)
        
        if (IDTEAMSV_daTeams != null)
        {
            daTeams=true
           
            //imposto la mail che leggo dal campo direct manager
            CustomField directManagerDaTeams = customFieldManager.getCustomFieldObject(Long.parseLong("14411"))
            def directManagerDaTeamsV = issue.getCustomFieldValue(directManagerDaTeams)
            EmployeeReferenceMail = directManagerDaTeamsV 
        } 


	
        if (IDTEAMSV == null &amp;&amp; daTeams==false)
        {
            if (EmployeeReferenceMailV == null || EmployeeReferenceMailV=="")
            {
                EmployeeReferenceMail = issue.reporter.getEmailAddress()
                log.debug "EmployeeReferenceMail" + EmployeeReferenceMail
            }
            else {
                def idTeamsEmployee= EmployeeReferenceMailV[0].getName().split("-")
                IDTEAMSV = idTeamsEmployee[0].trim()
           }     
        }
        def requestMethod = "GET";

        def baseURL=""
        //se ho IDTEAMS perchè arrivo da WF di TEAMS allora chiamo questo:
        //TEST http://172.30.3.230:8080
        //PROD https://gems.faacgroup.com
		if (daTeams==false){
            if (IDTEAMSV == null)
                baseURL = "https://gems.faacgroup.com/faac-hrportal-web/rest/jira/directManager?email=" + EmployeeReferenceMail	
            else
                baseURL = "https://gems.faacgroup.com/faac-hrportal-web/rest/jira/employee/" + IDTEAMSV.toString() + "/directManager"

            URL url
            url = new URL(baseURL)
            
            log.debug baseURL
            
            HttpURLConnection connection = (HttpURLConnection)url.openConnection();
			
            connection.setRequestMethod(requestMethod);
            connection.setRequestProperty("Content-Type", "application/json");
            connection.setRequestProperty("Accept", "*/*");
            connection.setDoOutput(true);
            connection.setDoInput(true);
            connection.connect();

            log.debug "ResponseCode:" + connection.getResponseCode();

            def httpResponseScanner = new Scanner(connection.getInputStream())

            def jsonResp =  httpResponseScanner.nextLine()
            def json = new JsonSlurper().parseText(jsonResp)

        	dManagerList = userSearchService.findUsersByEmail(json.email)
            httpResponseScanner.close()
        } 
        else{
             dManagerList = userSearchService.findUsersByEmail(EmployeeReferenceMail)
        }
        
        ApplicationUser directManager

        //se ho piu user utilizzo quello che ha il gruppo IDTS-customers altrimenti uso l'unico utente che c'è
        if (dManagerList.size()&gt;1) {
            for (directM in dManagerList){
               if (groupManager.getUsersInGroup("IDTS-customers").contains(directM)){
                    directManager=(ApplicationUser) directM
                }	
           } 
        }
        else {
            directManager=dManagerList.getAt(0)
        }

        //se ho piu user e non ne ho nemmeno uno con IDTS-customers allora prendo quello che appartiere alla directory di crowd
        if (directManager == null){
            for (directM in dManagerList){

               log.debug (directM.getDirectoryId() == 10000)
                if (directM.getDirectoryId() == 10000){
                    directManager=(ApplicationUser) directM
                }	
            } 
        }


        /* Create sub-task to be assigned to user */
        MutableIssue newSubTask = issueFactory.getIssue()
        //dobbiamo mettere il direct manager proveniente da teams
        def directManagerList = []
        directManagerList.add(directManager)
        log.debug directManagerList
        
        // IDTS WF Account PROD 22256 - TEST 22100
        CustomField WFAccount = customFieldManager.getCustomFieldObject(Long.parseLong("22256"))
        issue.setCustomFieldValue(WFAccount, directManagerList)
        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)

        newSubTask.setAssignee(directManager)
        newSubTask.setReporter(LoggedInUser)
        newSubTask.setSummary(directManager.getUsername() + " - " + issue.getSummary())
        // Software/Hardware PROD 22253 - TYEST 22023
        CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
        //Software/Hardware Approvation PROD 22260 - TEST 22343
        CustomField SoftHardAppr = customFieldManager.getCustomFieldObject(Long.parseLong("22260"))

       

        def fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)

        newSubTask.setCustomFieldValue(fieldSoftHard, fieldSoftHardV)
        newSubTask.setCustomFieldValue(SoftHardAppr, fieldSoftHardV)
        newSubTask.setCustomFieldValue(ReporterCompany, ReporterCompanyV)

        newSubTask.setParentObject(issue)
        newSubTask.setProjectObject(issue.getProjectObject())

        newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{
            it.getName() == "Sub-ApprAccount"
        }.id)

        def newIssueParams = ["issue" : newSubTask] as Map&lt;String,Object&gt;
		
        issueManager.createIssueObject(LoggedInUser, newIssueParams)
        subTaskManager.createSubTaskIssueLink(issue, newSubTask, LoggedInUser)
        issueIndexingService.reIndex(newSubTask)
        //Software/Hardware PROD 22253 - TEST 22023
        //CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
        //def SoftHardV = issue.getCustomFieldValue(SoftHard)
        //issue.setCustomFieldValue(SoftHardAppr, SoftHard)

        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)
        issueIndexingService.reIndex(issue)      
    }
}

</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="v+nWù">false</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Add new request to PORTALREQUESTS table on JIRA_ServiceDesk DB</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/IDTS_AddPortalRequest.groovy</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">ã¯zóÆ·ÕÝ¶÷v½Nüm­·yÇ{×Mß×9Ù­ý</arg>
              <arg name="FIELD_ACTION">181 In Progress VIP</arg>
              <arg name="FIELD_NOTES">Salta approvazione se non faccio parte delle company che la prevedono</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
              <arg name="FIELD_CONDITION">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport org.apache.log4j.Category\nimport com.atlassian.jira.issue.fields.CustomField\nimport com.atlassian.jira.issue.CustomFieldManager\nimport com.atlassian.jira.issue.Issue;\nimport org.apache.log4j.Category\n\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\n\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\n/* Get Insight IQL Facade from plugin accessor */\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\n/* Get Insight Object Facade from plugin accessor */\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\n\n/* Get issue \"Group Assignee\" custom field value */\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\nlog.setLevel(org.apache.log4j.Level.DEBUG)\n\nCustomField ReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong(\"20104\"))\ndef ReporterCompanyV = issue.getCustomFieldValue(ReporterCompany)\n//Reference Employee ID PROD 22301 - TEST 23001\nCustomField EmployeeReference = customFieldManager.getCustomFieldObject(Long.parseLong(\"22301\"))\ndef EmployeeReferenceMailV = issue.getCustomFieldValue(EmployeeReference)\nlog.debug \"EmployeeReferenceMailV \" + EmployeeReferenceMailV\nlog.debug \"ReporterCompanyV \" + ReporterCompanyV\n\nif ( EmployeeReferenceMailV != null &amp;&amp;  EmployeeReferenceMailV != \"\" &amp;&amp; EmployeeReferenceMailV.size()==1){\n    log.debug \"ww\"\n    def objectCompany = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND objectId = \" + EmployeeReferenceMailV[0].getId() + \" AND \\\"Company\\\" IN (\\\"FAAC France S.A.S\\\",\\\"FAAC S.p.A.\\\",\\\"HUB Parking Technology Canada Ltd.\\\",\\\"FAAC Electronics Ltd.\\\",\\\"FAAC Entrance Solutions France Sas\\\",\\\"FAAC Entrance Solutions UK\\\",\\\"HUB Parking Technology USA Inc.\\\",\\\"FAAC International Inc.\\\",\\\"Associated Time Instruments Company Inc.\\\",\\\"TIBA LLC\\\",\\\"CoMETA S.p.A.\\\",\\\"CICOS S.c.r.l.\\\",\\\"FAAC UK Ltd.\\\",\\\"FAAC Doors &amp; Shutters UK Limited\\\",\\\"Magnetic Faac India Pvt Ltd\\\",\\\"Magnetic Autocontrol GmbH\\\")\"); \n    if (objectCompany.size()&gt;0){\n        log.debug \"1\"\n        return false\n    \t\n    }\n    else{\n        log.debug \"2\"\n        return true\n    \t\n    }\n} \nelse{\n\tif (ReporterCompanyV==\"FAAC S.p.A.\" || ReporterCompanyV==\"FAAC France S.A.S\" || ReporterCompanyV == 'Magnetic Autocontrol GmbH' || ReporterCompanyV == 'HUB Parking Technology Canada Ltd.' || ReporterCompanyV == 'FAAC Electronics Ltd.'  || ReporterCompanyV == 'FAAC Entrance Solutions France Sas' || ReporterCompanyV == 'FAAC Entrance Solutions UK' || ReporterCompanyV == 'CoMETA S.p.A.' || ReporterCompanyV == 'CICOS S.c.r.l.' || ReporterCompanyV == 'FAAC Doors &amp; Shutters UK Limited' || ReporterCompanyV == 'Magnetic Faac India Pvt Ltd' || ReporterCompanyV == 'FAAC UK Ltd.' || ReporterCompanyV == 'HUB Parking Technology USA Inc.' || ReporterCompanyV == 'Associated Time Instruments Company Inc.'|| ReporterCompanyV == 'FAAC International Inc.'|| ReporterCompanyV == 'TIBA LLC') \n    {\n        log.debug \"3\"\n\t\treturn false\n        \n    }\n    else {\n        log.debug \"4\"\n\t\treturn true\n        \n    }\n} \n\n//cfValues['Reporter Company'] != 'FAAC SpA' &amp;&amp; cfValues['Reporter Company'] != 'FAAC France S.A.S'","scriptPath":null,"parameters":{}}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_TRANSITION_OPTIONS">FIELD_SKIP_CONDITIONS|||FIELD_SKIP_PERMISSIONS|||FIELD_SKIP_VALIDATORS</arg>
              <arg name="FIELD_ADDITIONAL_SCRIPT" />
              <arg name="events" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">÷5}ÍwÛNüó^óm¹w¸ßÝy×®9ß{gý</arg>
              <arg name="FIELD_ACTION">181 In Progress VIP</arg>
              <arg name="FIELD_NOTES">SAlta approvazione se è utente VIP</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
              <arg name="FIELD_CONDITION">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport org.apache.log4j.Category\n\ndef groupManager = ComponentAccessor.getGroupManager()\n/* Get Insight IQL Facade from plugin accessor */\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\n/* Get Insight Object Facade from plugin accessor */\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\n\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\nlog.setLevel(org.apache.log4j.Level.DEBUG)\n\ndef isVIP=false\n\nlog.debug \"reference employee \" + cfValues['Reference Employee ID']\n\nif (cfValues['Reference Employee ID'] != null) {\n\tdef queryParam = \"\\\"\" + cfValues['Reference Employee ID'][0].getName() + \"\\\"\"\n    log.debug queryParam\n    def objects = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND \\\"Name\\\" IN (\" + queryParam + \")\"); // See the complete list of possible IQL on the Insight Query Language documentation page\n    log.debug objects\n\tlog.debug objectFacade.loadObjectAttributeBean(objects[0].getId(), 6541)\n    \n    if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 6541) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objects[0].getId(), 6541) != \"\")\n        isVIP = objectFacade.loadObjectAttributeBean(objects[0].getId(), 6541).getObjectAttributeValueBeans()[0].getValue()\n    log.debug isVIP\n}\n\n(groupManager.isUserInGroup(issue.reporter?.name, 'Helpdesk VIP') || isVIP) &amp;&amp; (cfValues['Reporter Company'] == 'FAAC S.p.A.' || cfValues['Reporter Company'] == 'FAAC France S.A.S' || cfValues['Reporter Company'] == 'Magnetic Autocontrol GmbH' || cfValues['Reporter Company'] == 'HUB Parking Technology Canada Ltd.' || cfValues['Reporter Company'] == 'FAAC Electronics Ltd.' || cfValues['Reporter Company'] == 'FAAC Entrance Solutions France Sas' || cfValues['Reporter Company'] == 'FAAC Entrance Solutions UK' || cfValues['Reporter Company'] == 'CoMETA S.p.A.' || cfValues['Reporter Company'] == 'CICOS S.c.r.l.' || cfValues['Reporter Company'] == 'FAAC UK Ltd.' || cfValues['Reporter Company'] == 'FAAC Doors &amp; Shutters UK Limited' || cfValues['Reporter Company'] == 'HUB Parking Technology USA Inc.'|| cfValues['Reporter Company'] == 'Associated Time Instruments Company Inc.'|| cfValues['Reporter Company'] == 'FAAC International Inc.'|| cfValues['Reporter Company'] == 'Magnetic Faac India Pvt Ltd'|| cfValues['Reporter Company'] == 'TIBA LLC')\n","scriptPath":null,"parameters":{}}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_TRANSITION_OPTIONS">FIELD_SKIP_CONDITIONS|||FIELD_SKIP_PERMISSIONS|||FIELD_SKIP_VALIDATORS</arg>
              <arg name="FIELD_ADDITIONAL_SCRIPT" />
              <arg name="events" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">daa58593-cd7c-4c41-a2b0-dfd0dec19754</arg>
              <arg name="FIELD_NOTES">Aggiorno la issue con i dati mancanti per dismissal automatiche (software/hardware / operation)</arg>
              <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\r\nimport com.atlassian.jira.event.type.EventDispatchOption\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\nimport com.atlassian.jira.issue.fields.CustomField\r\nimport com.atlassian.jira.issue.CustomFieldManager\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.component.ComponentAccessor\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport com.atlassian.jira.issue.IssueManager\r\nimport com.atlassian.jira.bc.user.search.UserSearchService\r\nimport com.atlassian.jira.user.ApplicationUser\r\nimport com.atlassian.jira.event.type.EventDispatchOption\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.issue.fields.CustomField\r\nimport com.atlassian.jira.issue.CustomFieldManager\r\nimport com.atlassian.jira.workflow.WorkflowTransitionUtil;\r\nimport com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;\r\nimport com.atlassian.jira.util.JiraUtils;\r\nimport groovy.json.JsonSlurper;\r\nimport groovy.json.StreamingJsonBuilder;\r\nimport com.atlassian.jira.issue.Issue;\r\nimport org.apache.commons.codec.binary.Base64;\r\nimport groovy.json.JsonSlurper;\r\nimport groovy.json.StreamingJsonBuilder;\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.user.util.UserManager\r\n\r\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\r\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\r\n\r\ndef issueManager = ComponentAccessor.getIssueManager()\r\ndef userManager = ComponentAccessor.getUserManager()\r\ndef watcherManager = ComponentAccessor.getWatcherManager()\r\n\r\n/* Get Insight IQL Facade from plugin accessor */\r\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \r\ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\r\n/* Get Insight Object Facade from plugin accessor */\r\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\r\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\r\n\r\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\r\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\r\n\r\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\r\nlog.setLevel(org.apache.log4j.Level.DEBUG)\r\n//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-49457\")\r\n\r\nCustomField referenceEmployee = customFieldManager.getCustomFieldObject(Long.parseLong(\"22301\"))\r\ndef referenceEmployeeV = issue.getCustomFieldValue(referenceEmployee)\r\n\r\ndef typeAccounts = []\r\nif (issue.getSummary().toString()==\"AutomaticalDismissalFromInsight\"){\r\n    def queryParam = \"\\\"\" + referenceEmployeeV[0].getName() + \"\\\"\"\r\n    def objectsEmployee = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND \\\"Name\\\" = (\" + queryParam + \")\"); // See the complete list of possible IQL on the Insight Query Language documentation page\r\n\r\n    if (objectFacade.loadObjectAttributeBean(objectsEmployee[0].getId(), 6590) != null){\r\n        for(objAppl in objectFacade.loadObjectAttributeBean(objectsEmployee[0].getId(), 6590).getObjectAttributeValueBeans()){\r\n            def queryParam1 = \"\\\"\" + objAppl.getValue() + \"\\\"\"\r\n            def objTypeApplication = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"TypeAccounts\\\" AND objectid = \" + queryParam1 )\r\n            typeAccounts.add(objTypeApplication[0])\r\n        }\r\n    }\r\n    \r\n    if (objectFacade.loadObjectAttributeBean(objectsEmployee[0].getId(), 6591) != null){\r\n        for(objAppl2 in objectFacade.loadObjectAttributeBean(objectsEmployee[0].getId(), 6591).getObjectAttributeValueBeans()){\r\n            def queryParam2 = \"\\\"\" + objAppl2.getValue() + \"\\\"\"\r\n            def objTypeApplication2 = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"TypeAccounts\\\" AND objectid = \" + queryParam2 )\r\n            typeAccounts.add(objTypeApplication2[0])\r\n        }\r\n    }\r\n\r\n    log.debug typeAccounts\r\n    CustomField fieldSoftHard2 = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\r\n    issue.setCustomFieldValue(fieldSoftHard2, typeAccounts)\r\n\r\n    //aggiorno il reporter company per assegnazione automatica infra\r\n    if (objectFacade.loadObjectAttributeBean(objectsEmployee[0].getId(), 6536) != null){\r\n\t\tdef objTypeCompany = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Company\\\" AND objectid = \" + objectFacade.loadObjectAttributeBean(objectsEmployee[0].getId(), 6536).getObjectAttributeValueBeans()[0].getValue() )\r\n\t\tCustomField CompanyReporter = customFieldManager.getCustomFieldObject(Long.parseLong(\"20104\"))\r\n\t\tissue.setCustomFieldValue(CompanyReporter,  objTypeCompany[0].getName())\r\n\t\t\r\n\t}\r\n    // fine\r\n\r\n    def OptionTypeAccountField = customFieldManager.getCustomFieldObject(Long.parseLong(\"22254\"))\r\n    def config = OptionTypeAccountField.getRelevantConfig(issue)\r\n    def optionsManager = ComponentAccessor.getOptionsManager()\r\n    def options = optionsManager.getOptions(config)\r\n\r\n    def optionDelete = options.find { it.value == \"Delete\" }\r\n    issue.setCustomFieldValue(customFieldManager.getCustomFieldObject(Long.parseLong(\"22254\")), optionDelete)\r\n   \r\n    ComponentAccessor.getIssueManager().updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false);\r\n\r\n\tissueIndexingService.reIndex(issue)\r\n\r\n}\r\n\r\n","scriptPath":null,"parameters":{}}</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Email ad alcuni utenti reception, hse ecc in caso di dismissal </arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM" />
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES">Reception.Faac@faactechnologies.com; antonia.siino@faactechnologies.com; Andrea.Lambertini@faactechnologies.com; Valeria.Gubellini@faactechnologies.com</arg>
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">group:TEAMS-HS-admins</arg>
              <arg name="FIELD_FUNCTION_ID">c982dff8-2640-48e7-a5fb-85ec107e03a2</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;body&gt;
&lt;div style="font-family:calibri;font-size:18px"&gt;
&lt;!--div style="background: #B0E0E6;  margin: 0 auto;  padding: 50px;/* border-radius */ -webkit-border-radius: 5px; -moz-border-radius: 5px; border-radius: 5px; /* box-shadow */ -webkit-box-shadow: rgba(0,0,0,0.2) 0px 1px 3px; -moz-box-shadow: rgba(0,0,0,0.2) 0px 1px 3px; box-shadow: rgba(0,0,0,0.2) 0px 1px 3px;"--&gt;
Dear Colleague,
&lt;br/&gt;
An employee is leaving the company:
&lt;br/&gt;&lt;br/&gt;
&lt;u&gt;Employee&lt;/u&gt;: ${issue.summary.substring("Dismissal IT Equipment: ".length())}&lt;br/&gt;
&lt;u&gt;Employee Dismissal Date&lt;/u&gt;


&lt;%
def valore=
com.atlassian.jira.component.ComponentAccessor.getOSGiComponentInstanceOfType(com.atlassian.jira.component.ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade")).loadObjectAttributeBean(issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("Reference Employee ID"))[0].getId(), 6539).getObjectAttributeValueBeans()[0].getValue()


def dateFormat = new java.text.SimpleDateFormat("dd/MM/yyyy")
out.print(dateFormat.format(valore))  
%&gt;
&lt;br/&gt;&lt;br/&gt;
This is an automatic message to inform you about this dismissal. Please do not answer to this mail.
&lt;br/&gt;&lt;br/&gt;
Regards,
&lt;br/&gt;
HR Team
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Dismissal Employee - &lt;% out &lt;&lt; issue.summary.substring("Dismissal IT Equipment: ".length())%&gt;</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">{"script":"if (issue.getSummary().toString()==\"AutomaticalDismissalFromInsight\"\r\n&amp;&amp; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName(\"Reporter Company\"))=='FAAC S.p.A.')\r\n    return true\r\nelse\r\n    return false","scriptPath":null,"parameters":{}}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">IDTS-93193</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">0b884ee9-8714-402f-a806-206dfd745e59</arg>
              <arg name="FIELD_ACTION">181 In Progress VIP</arg>
              <arg name="FIELD_NOTES">Salta approvazione se issue dismissal e modifico summary con "Dismissal IT Equipment"</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.FasttrackTransition</arg>
              <arg name="FIELD_CONDITION">{"script":"if (issue.getSummary().toString()==\"AutomaticalDismissalFromInsight\")\r\n    return true\r\nelse\r\n    return false","scriptPath":null,"parameters":{}}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_TRANSITION_OPTIONS">FIELD_SKIP_PERMISSIONS|||FIELD_SKIP_VALIDATORS</arg>
              <arg name="FIELD_ADDITIONAL_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport com.atlassian.jira.issue.IssueManager\r\nimport com.atlassian.jira.bc.user.search.UserSearchService\r\nimport com.atlassian.jira.user.ApplicationUser\r\nimport com.atlassian.jira.event.type.EventDispatchOption\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\nimport com.atlassian.jira.issue.fields.CustomField\r\nimport com.atlassian.jira.issue.CustomFieldManager\r\nimport com.atlassian.jira.issue.Issue;\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.user.util.UserManager\r\n\r\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\r\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\r\n\r\ndef issueManager = ComponentAccessor.getIssueManager()\r\ndef userManager = ComponentAccessor.getUserManager()\r\ndef watcherManager = ComponentAccessor.getWatcherManager()\r\n\r\n/* Get Insight IQL Facade from plugin accessor */\r\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \r\ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\r\n/* Get Insight Object Facade from plugin accessor */\r\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\r\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\r\n\r\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\r\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\r\n\r\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\r\nlog.setLevel(org.apache.log4j.Level.DEBUG)\r\n//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-49457\")\r\n\r\nCustomField referenceEmployee = customFieldManager.getCustomFieldObject(Long.parseLong(\"22301\"))\r\ndef referenceEmployeeV = issue.getCustomFieldValue(referenceEmployee)\r\n\r\nif (issue.getSummary().toString()==\"AutomaticalDismissalFromInsight\"){\r\n    issue.setSummary(\"Dismissal IT Equipment: \" + referenceEmployeeV[0].getName().toString().split(/ - /)[1])\r\n    ComponentAccessor.getIssueManager().updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false);\r\n\tissueIndexingService.reIndex(issue)\r\n}\r\n\r\n","scriptPath":null,"parameters":{}}</arg>
              <arg name="events" />
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS">customfield_22252</arg>
              <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
              <arg name="FIELD_FUNCTION_ID">ãÍ¶ÙýÚyî¸áþ7ëmßÞ½õæÝ×wuþ5&lt;</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account 
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; Created &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
										Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        in regards to the request with subject &lt;b&gt;&lt;% out &lt;&lt; issue.summary %&gt;&lt;/b&gt;, the ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; has been created.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        relativamente alla richiesta con oggetto &lt;b&gt;&lt;% out &lt;&lt; issue.summary %&gt;&lt;/b&gt;, è stato creato il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: created</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="v+nWù">false</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com") |||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">IDTS-1</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <global-actions>
    <action id="111" name=" Ask customer" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">17609</meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.JqlQueryCondition</arg>
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
            <arg name="FIELD_JQL_QUERY">status in ("On Hold","Waiting for Customer",Done)</arg>
          </condition>
        </conditions>
      </restrict-to>
      <validators>
        <validator name="" type="class">
          <arg name="contextHandling" />
          <arg name="hidFieldsList">comment@@</arg>
          <arg name="class.name">com.googlecode.jsu.workflow.validator.FieldsRequiredValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="žée" status="žée" step="47">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">11000</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">oÇ·»õ¶ßkgxs]Ýózõ­¶éÎuãÇúç¦º</arg>
              <arg name="FIELD_NOTES">Update public comments and attachments tables on DB</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">`!`</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/IDTS_UpdatePublicCommentsAttachments.groovy</arg>
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
              <arg name="FIELD_FUNCTION_ID">s}°▌╫}сн╜{Ю╣╫~&lt;╙N7▀^6{^¤э╫Ь▀╟▄</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; new comment &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                                Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                                &lt;br /&gt;&lt;br /&gt;
                                                A comment has been added to the ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt;:
                                                &lt;br /&gt;
                                                &lt;% if (lastComment) out &lt;&lt; lastComment %&gt;
                                                &lt;br /&gt;
                                                Kind regards&lt;br /&gt;
                                                &lt;br /&gt;
                                                --------------------------------&lt;br /&gt;
                                                Below repeated in italian&lt;br /&gt;
                                                --------------------------------&lt;br /&gt;
                                                &lt;br /&gt;
                                                Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                                &lt;br /&gt;&lt;br /&gt;
                                                E' stato aggiunto un commento al ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt;:
                                                &lt;br /&gt;
                                                &lt;% if (lastComment) out &lt;&lt; lastComment %&gt;
                                                &lt;br /&gt;
                                                Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: new comment</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">IDTS-1</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="221" name="‰Þ">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="FIELD_FUNCTION_ID">ÙÎï§\u¶÷×F÷Ï_m×ºi­»ÙÝúã­µsÝ</arg>
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">currentUser.name == "atlassian_faac_service_desk"|||</arg>
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="žée" status="žée" step="44">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK" />
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; resolved &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                       	Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        The ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; has been resolved.
                                        &lt;br /&gt;&lt;br /&gt;
                                        &lt;% if (lastComment) out &lt;&lt; "Solution: " + lastComment %&gt;
                                        &lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        Il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; è stato risolto.
                                        &lt;br /&gt;&lt;br /&gt;
                                        &lt;% if (lastComment) out &lt;&lt; " Soluzione: " + lastComment %&gt;
                                        &lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: resolved</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE" />
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </global-actions>
  <common-actions>
    <action id="51" name="InProgress">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="žée" status="žée" step="22">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">11</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
              <arg name="FIELD_FUNCTION_ID">Û»×¼÷^_çxïúñÝöáýõm×:ß^7</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; in progress &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                        Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        The ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; is in progress&lt;% if (issue.assignee != null) out &lt;&lt; " and assigned to " + issue.assignee?.displayName %&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; è in lavorazione&lt;% if (issue.assignee != null) out &lt;&lt; " ed è stato preso in carico da " + issue.assignee?.displayName %&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: in progress</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">IDTS-11997</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="181" name="In Progress VIP">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="FIELD_FUNCTION_ID">dfe6b8df-a727-4a79-8ad0-facd05d115a4</arg>
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">{"script":"currentUser.name == \"atlassian_faac_service_desk\" || currentUser.name == \"katia.chinaglia\" || currentUser.name == \"alessandra.tiengo\"","scriptPath":null,"parameters":{}}</arg>
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="žée" status="žée" step="22">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">íæ»w®\ÑöÝý¼k]uu­tÓ½öïµoO^wÏ]</arg>
              <arg name="FIELD_NOTES">Creo sub task attività</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()
def subTaskManager = ComponentAccessor.getSubTaskManager()
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()
/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()

MutableIssue parentIssue = issue
//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6247")

Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

//Software/Hardware Approvation PROD 22260 - TEST 22343
CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22260"))
//Software/Hardware PROD 22253 - TEST 22023
CustomField fieldSoftHard2 = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
//Type Account PROD 22259 - TEST 22417
CustomField fieldTypeAccount = customFieldManager.getCustomFieldObject(Long.parseLong("22259"))
//Reporter Company PROD 20104 - TEST 20104
CustomField fieldReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong("20104"))

def fieldSoftHardV = parentIssue.getCustomFieldValue(fieldSoftHard2)
def fieldReporterCompanyV = parentIssue.getCustomFieldValue(fieldReporterCompany)

log.debug fieldSoftHardV
for (sofHard in fieldSoftHardV){
    MutableIssue newSubTask = issueFactory.getIssue()
    log.debug "sofHard " +  sofHard
    def sofHardList = []
	sofHardList.add(sofHard)
    
    if (sofHard != null &amp;&amp; sofHard != ""){
        
        /* Specify the schema id as well as the IQL that will fetch objects. In this case all objects with Name matching the valueCF, be sure to include " around value */
        
        def queryParam = "\"" + sofHard.getName() + "\""

        //Recupero il funzionario legato al site selezionato
        def objects = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"TypeAccounts\" AND \"Name\" IN (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
		log.debug "1"
        def userPropertyManager = ComponentAccessor.getUserPropertyManager()
        def userManager = ComponentAccessor.getUserManager()
        def userSearchService = ComponentAccessor.getComponent(UserSearchService.class)
        
        def assigneeList = [];
        ApplicationUser assignee = null;
        
        //Assignee su insight nella tabella TypeAccounts PROD 2205 - TEST 2451
        if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 2205) != null){
        	assigneeList = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objects[0].getId(), 2205).getObjectAttributeValueBeans()[0].getValue())
        	for (ass in assigneeList){
                if (ComponentAccessor.groupManager.getUsersInGroup("IDTS-agents").contains(ass) || ComponentAccessor.groupManager.getUsersInGroup("IDTS-external-agents").contains(ass)){
                    assignee=(ApplicationUser) ass
                }	
            } 
        }
        
        /*if (assignee != null &amp;&amp; assignee!=""){
        	newSubTask.setAssignee(assignee)
        }
        else {
            //se assignee non è valorizzato allora vado per company a vedere la tabella AssigneeInfrastructureCompany
            if (fieldReporterCompanyV != null &amp;&amp; fieldReporterCompanyV!=""){
                queryParam = "\"" + fieldReporterCompanyV + "\""
                def objectsAssignee = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"AssigneeInfrastructureCompany\" AND \"CompanyAD\" = (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
				if (objectsAssignee.size()&gt;0){
                    if (objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != "")
                        assigneeCompany = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232).getObjectAttributeValueBeans()[0].getValue()).getAt(0)

                    if (assigneeCompany != null &amp;&amp; assigneeCompany!="")
                        newSubTask.setAssignee(assigneeCompany)
               	}
        	} 
        }*/
        
        ApplicationUser assigneeCompany
        
        if (assignee != null &amp;&amp; assignee!=""){
        	newSubTask.setAssignee(assignee)
        }
        else {
            //se assignee non è valorizzato allora vado per company a vedere la tabella AssigneeInfrastructureCompany
            if (fieldReporterCompanyV != null &amp;&amp; fieldReporterCompanyV!=""){
                queryParam = "\"" + fieldReporterCompanyV + "\""
                def objectsAssignee = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"AssigneeInfrastructureCompany\" AND \"CompanyAD\" = (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
				if (objectsAssignee.size()&gt;0){
                    if (objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != ""){
                        assigneeList = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232).getObjectAttributeValueBeans()[0].getValue())
				
                    	for (ass in assigneeList){
                            if (ComponentAccessor.groupManager.getUsersInGroup("IDTS-agents").contains(ass) || ComponentAccessor.groupManager.getUsersInGroup("IDTS-external-agents").contains(ass)){
                                assigneeCompany=(ApplicationUser) ass
                            }	
                        } 
                    }
                    
                    if (assigneeCompany != null &amp;&amp; assigneeCompany!="")
                        newSubTask.setAssignee(assigneeCompany)
               	}
        	} 
        }
        
        newSubTask.setReporter(LoggedInUser)
        newSubTask.setSummary(sofHard.getName() + " - " + parentIssue.getSummary())
        newSubTask.setParentObject(parentIssue)
        newSubTask.setProjectObject(parentIssue.getProjectObject())
        newSubTask.setCustomFieldValue(fieldSoftHard2, sofHardList)
        newSubTask.setCustomFieldValue(fieldReporterCompany, fieldReporterCompanyV)
        //type su insight nella tabella TypeAccounts PROD 2204 - TEST 2450
        newSubTask.setCustomFieldValue(fieldTypeAccount, objectFacade.loadObjectAttributeBean(objects[0].getId(), 2204).getObjectAttributeValueBeans()[0].getValue())
       
        newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{
            it.getName() == "Sub-TaskAccount"
        }.id)
        
		def newIssueParams = ["issue" : newSubTask] as Map&lt;String,Object&gt;
        issueManager.createIssueObject(LoggedInUser, newIssueParams)
        log.debug newIssueParams
       
        subTaskManager.createSubTaskIssueLink(parentIssue, newSubTask, LoggedInUser)
        issueIndexingService.reIndex(newSubTask)
    }
    
}
</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
              <arg name="FIELD_FUNCTION_ID">q¯&lt;é½^åÇ:íöž]=åÏyuþžóVºyöšÍ7</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; in progress &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                        Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        The ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; is in progress&lt;% if (issue.assignee!=null) out &lt;&lt;  " and assigned to " + issue.assignee?.displayName %&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; è in lavorazione&lt;% if (issue.assignee!=null) out &lt;&lt; " ed è stato preso in carico da " + issue.assignee?.displayName %&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: in progress</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">IDTS-11997</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="231" name="Return in Approval">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="FIELD_FUNCTION_ID">d8d10026-38a9-4a93-865e-ff7d56641159</arg>
            <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
            <arg name="FIELD_CONDITION">{"script":"currentUser.name == \"katia.chinaglia\" || currentUser.name == \"stefania.landuzzi\" || currentUser.name == \"atlassian_faac_service_desk\"  ","scriptPath":null,"parameters":{}}</arg>
            <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
            <arg name="FIELD_PREVIEW_ISSUE" />
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="žée" status="žée" step="50">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="121" name="Contact helpdesk" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">17609</meta>
      <restrict-to>
        <conditions>
          <condition type="class">
            <arg name="class.name">com.atlassian.jira.workflow.condition.UserInGroupCondition</arg>
            <arg name="group">Administrators</arg>
          </condition>
        </conditions>
      </restrict-to>
      <results>
        <unconditional-result old-status="žée" status="žée" step="49">
          <post-functions>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value" />
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">3063a920-f50c-4a47-a06f-81221ef281cc</arg>
              <arg name="FIELD_NOTES">add watcher</arg>
              <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\r\nimport com.atlassian.jira.issue.Issue\r\nimport com.atlassian.jira.issue.comments.CommentManager\r\nimport com.atlassian.jira.user.ApplicationUser\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport com.atlassian.jira.issue.IssueManager\r\nimport org.apache.log4j.Category\r\n\r\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\r\n\r\nIssueManager \t\tissueManager \t\t= ComponentAccessor.getIssueManager()\r\n\r\ndef userManager = ComponentAccessor.getUserManager()\r\n// Recupera l'issue principale (padre)\r\n//MutableIssue parentIssue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-103562\")\r\nMutableIssue parentIssue = issue\r\n\r\n// Recupera i subtasks dell'issue principale\r\ndef subTasks = parentIssue.subTaskObjects\r\n\r\n// Recupera il manager degli utenti per aggiungere i watcher\r\ndef watcherManager = ComponentAccessor.getWatcherManager()\r\n\r\nlog.debug subTasks\r\n// Aggiungi gli assigne dei subtasks come watcher dell'issue padre\r\nsubTasks.each { subTask -&gt; \r\n    def assignee = (ApplicationUser) subTask.assignee\r\n    if (subTask.getIssueType().name==\"Sub-TaskAccount\"){\r\n        if (assignee) {\r\n            // Aggiungi l'assignee come watcher se non lo \u00e8 gi\u00e0\r\n            if (!watcherManager.isWatching(assignee, parentIssue)) {\r\n                watcherManager.startWatching(assignee, parentIssue)\r\n            }\r\n        }\r\n    }\r\n}","scriptPath":null,"parameters":{}}</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="v+nWù">false</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="91" name="Back to progress">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="žée" status="žée" step="22">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="field.name">resolution</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
              <arg name="field.value" />
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">11001</arg>
              <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS" />
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
              <arg name="FIELD_FUNCTION_ID">mЮњУ§ґsmЮЫћфгVЮЯї7ЧNшЫoqЮ{Я†Ъ</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; in progress &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                        Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        The ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; is back to in progress.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        Il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; è tornato in lavorazione.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: in progress</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">IDTS-1</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="61" name="On hold" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">17608</meta>
      <results>
        <unconditional-result old-status="žée" status="žée" step="46">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">oÇ·»õ¶ßkgxs]Ýózõ­¶éÎuãÇúç¦º</arg>
              <arg name="FIELD_NOTES">Update public comments and attachments tables on DB</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">`!`</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/IDTS_UpdatePublicCommentsAttachments.groovy</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </common-actions>
  <steps>
    <step id="22" name="In Progress">
      <meta name="jira.status.id">3</meta>
      <actions>
<common-action id="61" />
<common-action id="231" />
<common-action id="181" />
        <action id="71" name="Ask customer" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">17609</meta>
          <validators>
            <validator name="" type="class">
              <arg name="contextHandling" />
              <arg name="hidFieldsList">comment@@</arg>
              <arg name="class.name">com.googlecode.jsu.workflow.validator.FieldsRequiredValidator</arg>
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="žée" status="žée" step="47">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">11000</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">oÇ·»õ¶ßkgxs]Ýózõ­¶éÎuãÇúç¦º</arg>
                  <arg name="FIELD_NOTES">Update public comments and attachments tables on DB</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">`!`</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/IDTS_UpdatePublicCommentsAttachments.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
                  <arg name="FIELD_FUNCTION_ID">╤╟}ы╓╡ун╡╙╢╝┘■{qц√{Ю¤╙O;▌Ў█kM°</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; new comment &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                        Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        A comment has been added to the ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt;:
                                        &lt;br /&gt;
                                        &lt;% if (lastComment) out &lt;&lt; lastComment %&gt;
                                        &lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        E' stato aggiunto un commento al ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt;:
                                        &lt;br /&gt;
                                        &lt;% if (lastComment) out &lt;&lt; lastComment %&gt;
                                        &lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: new comment</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-1</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="81" name="Close" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">17610</meta>
          <results>
            <unconditional-result old-status="žée" status="žée" step="44">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">5</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">тПи▀и\m═юЛу:рдяqГхkОyq№xmО5uу=</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">`!`</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/IDTS_UpdatePublicCommentsAttachments.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS">customfield_22252</arg>
                  <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
                  <arg name="FIELD_FUNCTION_ID">ëÝóVùÕÿ7kÝë×Ù§÷Ó¶sÞo&lt;ßG]</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; resolved &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                       	Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        The ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; has been resolved.
                                        &lt;br /&gt;&lt;br /&gt;
                                        &lt;% if (lastComment) out &lt;&lt; "Solution: " + lastComment %&gt;
                                        &lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        Il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; è stato risolto.
                                        &lt;br /&gt;&lt;br /&gt;
                                        &lt;% if (lastComment) out &lt;&lt; " Soluzione: " + lastComment %&gt;
                                        &lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: resolved</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"faacithelpdesk@faacgroup.com\")","scriptPath":null,"parameters":{}}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-11819</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="44" name="‰Þ">
      <meta name="jira.status.id">10007</meta>
      <actions>
<common-action id="121" />
        <action id="101" name="Reopen ticket" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">17611</meta>
          <results>
            <unconditional-result old-status="žée" status="žée" step="48">
              <post-functions>
                <function type="class">
                  <arg name="sourceField">customfield_19401</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiescopyValueFromOtherField-function</arg>
                  <arg name="rärO*^">±©ž</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.CopyValueFromOtherFieldPostFunction</arg>
                  <arg name="uë-Šv­Š‰Å‰é]">customfield_19403</arg>
                </function>
                <function type="class">
                  <arg name="field.name">resolution</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowupdate-issue-field-function</arg>
                  <arg name="field.value" />
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueFieldFunction</arg>
                </function>
                <function type="class">
                  <arg name="field">customfield_19401</arg>
                  <arg name="full.module.key">com.googlecode.jira-suite-utilitiesclearFieldValue-function</arg>
                  <arg name="class.name">com.googlecode.jsu.workflow.function.ClearFieldValuePostFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">mþøwÖýwÝÍÞÙ¦ýïÇ_s×=×N·ß×Û÷ww</arg>
                  <arg name="FIELD_NOTES">Send comment to portal</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">`!`</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/IDTS_UpdatePublicCommentsAttachments.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">7</arg>
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowfireevent-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
                  <arg name="FIELD_FUNCTION_ID">áÇ¸k^yß[ëv»Õ¾÷®¸Ñ¯ë¾;ïmßm·Z</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; reopen &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                        Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        The ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; has been reopen.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        Il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; è stato riaperto.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: reopen</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-1</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="46" name="On Hold">
      <meta name="jira.status.id">10011</meta>
      <actions>
        <action id="131" name="Back to progress from OnHold">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="22">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="full.module.key">com.atlassian.jira.plugin.system.workflowassigntocurrentuser-function</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.AssignToCurrentUserFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="47" name="Waiting for Customer">
      <meta name="jira.status.id">10024</meta>
      <actions>
<common-action id="91" />
<common-action id="121" />
      </actions>
    </step>
    <step id="48" name="EÍ)zwù">
      <meta name="jira.status.id">4</meta>
      <actions>
<common-action id="51" />
      </actions>
    </step>
    <step id="49" name="Waiting for Helpdesk">
      <meta name="jira.status.id">13327</meta>
      <actions>
<common-action id="91" />
      </actions>
    </step>
    <step id="50" name="Waiting for Approval">
      <meta name="jira.status.id">13527</meta>
      <actions>
<common-action id="181" />
        <action id="151" name="Reject">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "atlassian_faac_service_desk"|||</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="51">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail al reporter e a tutti gli approvatori della issue Account del flusso Account approval per approvazione KO</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS">customfield_22256</arg>
                  <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
                  <arg name="FIELD_FUNCTION_ID">w—ќ}ѕ}iюґЦыЧЌќuэфЯЭ4¶эгЧ6yэЪ</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; Rejectd &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
										Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        in regards to the request with subject &lt;b&gt;&lt;% out &lt;&lt; issue.summary %&gt;&lt;/b&gt;, the ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; has been rejected.
                                        &lt;br /&gt;
                                        &lt;p class="author-comment"&gt;
                                            &lt;b&gt;&lt;%  
                                                def search =  com.atlassian.jira.component.ComponentAccessor.getComponent(com.atlassian.jira.bc.issue.search.SearchService.class).search(com.atlassian.jira.component.ComponentAccessor.jiraAuthenticationContext.loggedInUser, com.atlassian.jira.component.ComponentAccessor.getComponent(com.atlassian.jira.jql.parser.JqlQueryParser).parseQuery("project = '" + issue.getProjectObject().name + "' AND issuetype = 'Sub-ApprAccount' AND parent = '" + issue.key + "' ORDER BY updated"),  com.atlassian.jira.web.bean.PagerFilter.getUnlimitedFilter())

                                                if (search.results.size()&gt;0){   
                                                    def comments = com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(search.results[0])
                                                    if (comments) {
                                                        out &lt;&lt; comments.last().body.toString().substring(comments.last().body.toString().indexOf("{html}")+6, comments.last().body.toString().lastIndexOf("{html}"))
                                                    }
                                                } %&gt;
                                            &lt;/b&gt;
                                        &lt;/p&gt;
                                        &lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        relativamente alla richiesta con oggetto &lt;b&gt;&lt;% out &lt;&lt; issue.summary %&gt;&lt;/b&gt;, è stato rigettato il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt;.
                                        &lt;br /&gt;
                                        &lt;p class="author-comment"&gt;
                                            &lt;b&gt;&lt;%  
                                            	if (search.results.size()&gt;0){
                                        			def comments = com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(search.results[0])
                                        			if (comments) {
                                        				out &lt;&lt; comments.last().body.toString().substring(comments.last().body.toString().indexOf("{html}")+6, comments.last().body.toString().lastIndexOf("{html}"))       
                                        			}
                                        		} %&gt;
                                            &lt;/b&gt;
                                        &lt;/p&gt;
                                        &lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: rejected</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com") |||</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-1</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="161" name="Approve">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "atlassian_faac_service_desk"|||</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="52">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Send mail al reporter e tutti gli approvatori della Account del flusso Account Approval per approvazione OK</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS">customfield_22256</arg>
                  <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
                  <arg name="FIELD_FUNCTION_ID">пяwwОЈЁЌЯw_=wя[—«:w~:г]нЌнюЏ</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account 
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; Approved &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
										Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        in regards to the request with subject &lt;b&gt;&lt;% out &lt;&lt; issue.summary %&gt;&lt;/b&gt;, the ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; has been approved.
                                        &lt;br /&gt;
                                        &lt;p class="author-comment"&gt;
                                            &lt;b&gt;&lt;%  
                                                def search =  com.atlassian.jira.component.ComponentAccessor.getComponent(com.atlassian.jira.bc.issue.search.SearchService.class).search(com.atlassian.jira.component.ComponentAccessor.jiraAuthenticationContext.loggedInUser, com.atlassian.jira.component.ComponentAccessor.getComponent(com.atlassian.jira.jql.parser.JqlQueryParser).parseQuery("project = '" + issue.getProjectObject().name + "' AND issuetype = 'Sub-ApprAccount' AND parent = '" + issue.key + "' ORDER BY updated"),  com.atlassian.jira.web.bean.PagerFilter.getUnlimitedFilter())

												if (search.results.size()&gt;0){   
                                                    def comments = com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(search.results[0])
                                                    if (comments) {
                                                        out &lt;&lt; comments.last().body.toString().substring(comments.last().body.toString().indexOf("{html}")+6, comments.last().body.toString().lastIndexOf("{html}"))       
                                                    }
                                                } %&gt;
                                            &lt;/b&gt;
                                        &lt;/p&gt;
                                        &lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        relativamente alla richiesta con oggetto &lt;b&gt;&lt;% out &lt;&lt; issue.summary %&gt;&lt;/b&gt;, è stato approvato il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt;.
                                        &lt;br /&gt;
                                        &lt;p class="author-comment"&gt;
                                            &lt;b&gt;&lt;%  
                                            	if (search.results.size()&gt;0){
                                        			def comments = com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(search.results[0])
                                        			if (comments) {
                                        				out &lt;&lt; comments.last().body.toString().substring(comments.last().body.toString().indexOf("{html}")+6, comments.last().body.toString().lastIndexOf("{html}"))       
                                        			}
                                        		} %&gt;
                                            &lt;/b&gt;
                                        &lt;/p&gt;
                                        &lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: approved</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-1</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="171" name="Crea Appr.Man.">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="FIELD_FUNCTION_ID">ÙÎï§\u¶÷×F÷Ï_m×ºi­»ÙÝúã­µsÝ</arg>
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">{"script":"currentUser.name == \"katia.chinaglia\" || currentUser.name == \"fabrizio.diprato\" || currentUser.name == \"ester.bergonzoni\" || currentUser.name == \"matteo.riva\" || currentUser.name == \"stefania.landuzzi\"","scriptPath":null,"parameters":{}}</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="50">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">b9de5d73-87dc-475d-a950-e135e1aad92f</arg>
                  <arg name="FIELD_NOTES">Creazione automatica subtask assegnato al direct manager preso da teams MANUALE</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport com.atlassian.jira.issue.IssueManager\r\nimport com.atlassian.jira.bc.user.search.UserSearchService\r\nimport com.atlassian.jira.user.ApplicationUser\r\nimport com.atlassian.jira.event.type.EventDispatchOption\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.issue.fields.CustomField\r\nimport com.atlassian.jira.issue.CustomFieldManager\r\nimport com.atlassian.jira.workflow.WorkflowTransitionUtil;\r\nimport com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;\r\nimport com.atlassian.jira.util.JiraUtils;\r\nimport groovy.json.JsonSlurper;\r\nimport groovy.json.StreamingJsonBuilder;\r\nimport com.atlassian.jira.issue.Issue;\r\nimport org.apache.commons.codec.binary.Base64;\r\nimport groovy.json.JsonSlurper;\r\nimport groovy.json.StreamingJsonBuilder;\r\nimport org.apache.log4j.Category\r\nimport com.atlassian.jira.user.util.UserManager\r\n\r\ndef issueFactory = ComponentAccessor.getIssueFactory()\r\ndef constantManager = ComponentAccessor.getConstantsManager()\r\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\r\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\r\ndef subTaskManager = ComponentAccessor.getSubTaskManager()\r\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\r\n/* Get Insight IQL Facade from plugin accessor */\r\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \r\ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\r\n/* Get Insight Object Facade from plugin accessor */\r\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\r\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\r\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\r\n\r\n/* Get issue \"Group Assignee\" custom field value */\r\nIssueManager issueManager = ComponentAccessor.getIssueManager()\r\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\r\nlog.setLevel(org.apache.log4j.Level.DEBUG)\r\n//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-72772\")\r\ndef groupManager = ComponentAccessor.getGroupManager()\r\ndef daTeams=false\r\ndef EmployeeReferenceMail = \"\"\r\ndef IDTEAMSV = null\r\ndef creaSubTask\r\ndef dManagerList = []\r\ndef userPropertyManager = ComponentAccessor.getUserPropertyManager()\r\ndef userManager = ComponentAccessor.getUserManager()\r\ndef userSearchService = ComponentAccessor.getComponent(UserSearchService.class)\r\n\r\nCustomField ReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong(\"20104\"))\r\ndef ReporterCompanyV = issue.getCustomFieldValue(ReporterCompany)\r\n//Reference Employee ID PROD 22301 - TEST 23001\r\nCustomField EmployeeReference = customFieldManager.getCustomFieldObject(Long.parseLong(\"22301\"))\r\ndef EmployeeReferenceMailV = issue.getCustomFieldValue(EmployeeReference)\r\nlog.debug EmployeeReferenceMailV\r\n\r\nif ( EmployeeReferenceMailV != null &amp;&amp;  EmployeeReferenceMailV != \"\" &amp;&amp; EmployeeReferenceMailV.size()==1){\r\n    def objectCompany = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND objectId = \" + EmployeeReferenceMailV[0].getId() + \" AND \\\"Company\\\" IN (\\\"FAAC France S.A.S\\\",\\\"FAAC S.p.A.\\\",\\\"FAAC Entrance Solutions France Sas\\\",\\\"FAAC Entrance Solutions UK\\\",\\\"HUB Parking Technology Canada Ltd.\\\",\\\"HUB Parking Technology USA Inc.\\\",\\\"FAAC International Inc.\\\",\\\"Associated Time Instruments Company Inc.\\\",\\\"TIBA LLC\\\",\\\"FAAC Electronics Ltd.\\\",\\\"CoMETA S.p.A.\\\",\\\"CICOS S.c.r.l.\\\",\\\"FAAC UK Ltd.\\\",\\\"FAAC Doors &amp; Shutters UK Limited\\\",\\\"Magnetic Faac India Pvt Ltd\\\",\\\"Magnetic Autocontrol GmbH\\\")\"); \r\n     log.debug objectCompany\r\n    if (objectCompany.size()&gt;0)\r\n        creaSubTask=true\r\n    else\r\n        creaSubTask=false\r\n} \r\nelse{\r\n    log.debug ReporterCompanyV\r\n\tif (ReporterCompanyV==\"FAAC S.p.A.\" || ReporterCompanyV==\"FAAC France S.A.S\" || ReporterCompanyV == 'Magnetic Autocontrol GmbH' || ReporterCompanyV == 'HUB Parking Technology Canada Ltd.' || ReporterCompanyV == 'FAAC Electronics Ltd.' || ReporterCompanyV == 'FAAC Entrance Solutions France Sas' || ReporterCompanyV == 'FAAC Entrance Solutions UK' || ReporterCompanyV == 'CoMETA S.p.A.' || ReporterCompanyV == 'CICOS S.c.r.l.' || ReporterCompanyV == 'FAAC UK Ltd.' ||  ReporterCompanyV == 'FAAC Doors &amp; Shutters UK Limited' || ReporterCompanyV == 'HUB Parking Technology USA Inc.'|| ReporterCompanyV == 'Magnetic Faac India Pvt Ltd'|| ReporterCompanyV == 'Associated Time Instruments Company Inc.'|| ReporterCompanyV == 'FAAC International Inc.'|| ReporterCompanyV == 'TIBA LLC') \r\n\t\tcreaSubTask=true\r\n    else\r\n\t\tcreaSubTask=false\r\n} \r\n\r\nif (issue.getSummary().toString()==\"AutomaticalDismissalFromInsight\"){\r\n    creaSubTask=false\r\n}\r\n\r\nlog.debug \"creaSubTask \" + creaSubTask\r\ndef isVIP\r\n\r\nif (EmployeeReferenceMailV != null &amp;&amp; EmployeeReferenceMailV.size()==1) {\r\n\tdef queryParam = \"\\\"\" + EmployeeReferenceMailV[0].getName() + \"\\\"\"\r\n    log.debug queryParam\r\n    def objects = iqlFacade.findObjectsByIQLAndSchema(9, \"objectType=\\\"Employee\\\" AND \\\"Name\\\" IN (\" + queryParam + \")\"); // See the complete list of possible IQL on the Insight Query Language documentation page\r\n    log.debug objects\r\n    if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239) != \"\")\r\n        isVIP = objectFacade.loadObjectAttributeBean(objects[0].getId(), 2239).getObjectAttributeValueBeans()[0].getValue()    \r\n    \r\n    if (isVIP==true)\r\n    \tcreaSubTask =false\r\n}\r\n\r\nlog.debug creaSubTask\r\nif (creaSubTask) {\r\n    if(!groupManager.getUsersInGroup(\"Helpdesk VIP\").contains(issue.getReporter())){\r\n        //MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-6118\")\r\n        log.debug \"crea sub\"\r\n        // Employee System ID uguale PROD E TEST\r\n        CustomField IDTEAMS = customFieldManager.getCustomFieldObject(Long.parseLong(\"20500\"))\r\n        def IDTEAMSV_daTeams = issue.getCustomFieldValue(IDTEAMS)\r\n        \r\n        if (IDTEAMSV_daTeams != null)\r\n        {\r\n            daTeams=true\r\n           \r\n            //imposto la mail che leggo dal campo direct manager\r\n            CustomField directManagerDaTeams = customFieldManager.getCustomFieldObject(Long.parseLong(\"14411\"))\r\n            def directManagerDaTeamsV = issue.getCustomFieldValue(directManagerDaTeams)\r\n            EmployeeReferenceMail = directManagerDaTeamsV \r\n        } \r\n\r\n\r\n\t\r\n        if (IDTEAMSV == null &amp;&amp; daTeams==false)\r\n        {\r\n            if (EmployeeReferenceMailV == null || EmployeeReferenceMailV==\"\" || EmployeeReferenceMailV.size()!=1)\r\n            {\r\n                EmployeeReferenceMail = issue.reporter.getEmailAddress()\r\n                log.debug \"EmployeeReferenceMail\" + EmployeeReferenceMail\r\n            }\r\n            else {\r\n                def idTeamsEmployee= EmployeeReferenceMailV[0].getName().split(\"-\")\r\n                IDTEAMSV = idTeamsEmployee[0].trim()\r\n           }     \r\n        }\r\n        def requestMethod = \"GET\";\r\n\r\n        def baseURL=\"\"\r\n        //se ho IDTEAMS perch\u00e8 arrivo da WF di TEAMS allora chiamo questo:\r\n        //TEST http://172.30.3.230:8080\r\n        //PROD https://gems.faacgroup.com\r\n\t\tif (daTeams==false){\r\n            if (IDTEAMSV == null)\r\n                baseURL = \"https://gems.faacgroup.com/faac-hrportal-web/rest/jira/directManager?email=\" + EmployeeReferenceMail\t\r\n            else\r\n                baseURL = \"https://gems.faacgroup.com/faac-hrportal-web/rest/jira/employee/\" + IDTEAMSV.toString() + \"/directManager\"\r\n\r\n            URL url\r\n            url = new URL(baseURL)\r\n            \r\n            log.debug baseURL\r\n            \r\n            HttpURLConnection connection = (HttpURLConnection)url.openConnection();\r\n\t\t\t\r\n            connection.setRequestMethod(requestMethod);\r\n            connection.setRequestProperty(\"Content-Type\", \"application/json\");\r\n            connection.setRequestProperty(\"Accept\", \"*/*\");\r\n            connection.setDoOutput(true);\r\n            connection.setDoInput(true);\r\n            connection.connect();\r\n\r\n            log.debug \"ResponseCode:\" + connection.getResponseCode();\r\n\r\n            def httpResponseScanner = new Scanner(connection.getInputStream())\r\n\r\n            def jsonResp =  httpResponseScanner.nextLine()\r\n            def json = new JsonSlurper().parseText(jsonResp)\r\n\r\n        \tdManagerList = userSearchService.findUsersByEmail(json.email)\r\n            httpResponseScanner.close()\r\n        } \r\n        else{\r\n             dManagerList = userSearchService.findUsersByEmail(EmployeeReferenceMail)\r\n        }\r\n        \r\n        ApplicationUser directManager\r\n\r\n        //se ho piu user utilizzo quello che ha il gruppo IDTS-customers altrimenti uso l'unico utente che c'\u00e8\r\n        if (dManagerList.size()&gt;1) {\r\n            for (directM in dManagerList){\r\n               if (groupManager.getUsersInGroup(\"IDTS-customers\").contains(directM)){\r\n                    directManager=(ApplicationUser) directM\r\n                }\t\r\n           } \r\n        }\r\n        else {\r\n            directManager=dManagerList.getAt(0)\r\n        }\r\n\r\n        //se ho piu user e non ne ho nemmeno uno con IDTS-customers allora prendo quello che appartiere alla directory di crowd\r\n        if (directManager == null){\r\n            for (directM in dManagerList){\r\n\r\n               log.debug (directM.getDirectoryId() == 10000)\r\n                if (directM.getDirectoryId() == 10000){\r\n                    directManager=(ApplicationUser) directM\r\n                }\t\r\n            } \r\n        }\r\n\r\n\r\n        /* Create sub-task to be assigned to user */\r\n        MutableIssue newSubTask = issueFactory.getIssue()\r\n        //dobbiamo mettere il direct manager proveniente da teams\r\n        def directManagerList = []\r\n        directManagerList.add(directManager)\r\n        log.debug directManagerList\r\n        \r\n        // IDTS WF Account PROD 22256 - TEST 22100\r\n        CustomField WFAccount = customFieldManager.getCustomFieldObject(Long.parseLong(\"22256\"))\r\n        issue.setCustomFieldValue(WFAccount, directManagerList)\r\n        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\r\n\r\n        newSubTask.setAssignee(directManager)\r\n        newSubTask.setReporter(LoggedInUser)\r\n        newSubTask.setSummary(directManager.getUsername() + \" - \" + issue.getSummary())\r\n        // Software/Hardware PROD 22253 - TYEST 22023\r\n        CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\r\n        //Software/Hardware Approvation PROD 22260 - TEST 22343\r\n        CustomField SoftHardAppr = customFieldManager.getCustomFieldObject(Long.parseLong(\"22260\"))\r\n\r\n       \r\n\r\n        def fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)\r\n\r\n        newSubTask.setCustomFieldValue(fieldSoftHard, fieldSoftHardV)\r\n        newSubTask.setCustomFieldValue(SoftHardAppr, fieldSoftHardV)\r\n        newSubTask.setCustomFieldValue(ReporterCompany, ReporterCompanyV)\r\n\r\n\r\n        //new license \r\n        CustomField EmployeeSystemID = customFieldManager.getCustomFieldObject(Long.parseLong(\"20500\"))\r\n        def EmployeeSystemIDV = issue.getCustomFieldValue(EmployeeSystemID)\r\n        newSubTask.setCustomFieldValue(EmployeeSystemID, EmployeeSystemIDV)\r\n        //new license \r\n        \r\n        newSubTask.setParentObject(issue)\r\n        newSubTask.setProjectObject(issue.getProjectObject())\r\n\r\n        newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{\r\n            it.getName() == \"Sub-ApprAccount\"\r\n        }.id)\r\n\r\n        def newIssueParams = [\"issue\" : newSubTask] as Map&lt;String,Object&gt;\r\n\t\t\r\n        issueManager.createIssueObject(LoggedInUser, newIssueParams)\r\n        subTaskManager.createSubTaskIssueLink(issue, newSubTask, LoggedInUser)\r\n        issueIndexingService.reIndex(newSubTask)\r\n        //Software/Hardware PROD 22253 - TEST 22023\r\n        //CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\r\n        //def SoftHardV = issue.getCustomFieldValue(SoftHard)\r\n        //issue.setCustomFieldValue(SoftHardAppr, SoftHard)\r\n\r\n        issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\r\n        issueIndexingService.reIndex(issue)      \r\n    }\r\n}\r\n\r\n","scriptPath":null,"parameters":{}}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">sN▄т wkW╣yу5ы■Эs»=зЪ]ш¤Zт■zОдя</arg>
                  <arg name="FIELD_NOTES">Creazione automatica subtask assegnato al direct manager preso da teams MANUALE</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":"import com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.issue.MutableIssue\nimport com.atlassian.jira.issue.IssueManager\nimport com.atlassian.jira.bc.user.search.UserSearchService\nimport com.atlassian.jira.user.ApplicationUser\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport org.apache.log4j.Category\nimport com.atlassian.jira.issue.fields.CustomField\nimport com.atlassian.jira.issue.CustomFieldManager\nimport com.atlassian.jira.workflow.WorkflowTransitionUtil;\nimport com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;\nimport com.atlassian.jira.util.JiraUtils;\nimport groovy.json.JsonSlurper;\nimport groovy.json.StreamingJsonBuilder;\nimport com.atlassian.jira.issue.Issue;\nimport org.apache.commons.codec.binary.Base64;\nimport groovy.json.JsonSlurper;\nimport groovy.json.StreamingJsonBuilder;\nimport org.apache.log4j.Category\nimport com.atlassian.jira.user.util.UserManager\n\ndef issueFactory = ComponentAccessor.getIssueFactory()\ndef constantManager = ComponentAccessor.getConstantsManager()\nComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey(\"atlassian_faac_service_desk\"))\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\ndef subTaskManager = ComponentAccessor.getSubTaskManager()\nCustomFieldManager \tcustomFieldManager \t= ComponentAccessor.getCustomFieldManager()\n/* Get Insight IQL Facade from plugin accessor */\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\n/* Get Insight Object Facade from plugin accessor */\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\n\n/* Get issue \"Group Assignee\" custom field value */\nIssueManager issueManager = ComponentAccessor.getIssueManager()\n\ndef groupManager = ComponentAccessor.getGroupManager()\n\nif(!groupManager.getUsersInGroup(\"Helpdesk VIP\").contains(issue.getReporter())){\n    //MutableIssue issue = issueManager.getIssueByKeyIgnoreCase(\"IDTS-6118\")\n    Category log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\n    log.setLevel(org.apache.log4j.Level.DEBUG)\n    // Employee System ID uguale PROD E TEST\n    CustomField IDTEAMS = customFieldManager.getCustomFieldObject(Long.parseLong(\"20500\"))\n    def IDTEAMSV = issue.getCustomFieldValue(IDTEAMS)\n\n    //Reference Employee ID PROD 22301 - TEST 23001\n    CustomField EmployeeReference = customFieldManager.getCustomFieldObject(Long.parseLong(\"22301\"))\n    def EmployeeReferenceMailV = issue.getCustomFieldValue(EmployeeReference)\n    def EmployeeReferenceMail = \"\"\n\n    if (IDTEAMSV == null)\n    {\n        if (EmployeeReferenceMailV == null || EmployeeReferenceMailV==\"\")\n        {\n            EmployeeReferenceMail = issue.reporter.getEmailAddress()\n            log.debug \"EmployeeReferenceMail\" + EmployeeReferenceMail\n        }\n        else {\n        \tdef idTeamsEmployee= EmployeeReferenceMailV[0].getName().split(\"-\")\n        \tIDTEAMSV = idTeamsEmployee[0].trim()\n       }     \n    }\n\n    def requestMethod = \"GET\";\n\n    def baseURL=\"\"\n    //se ho IDTEAMS perch\u00e8 arrivo da WF di TEAMS allora chiamo questo:\n    //TEST http://172.30.3.230:8080\n    //PROD https://gems.faacgroup.com\n\n    if (IDTEAMSV == null)\n    \tbaseURL = \"https://gems.faacgroup.com/faac-hrportal-web/rest/jira/directManager?email=\" + EmployeeReferenceMail\t\n    else\n    \tbaseURL = \"https://gems.faacgroup.com/faac-hrportal-web/rest/jira/employee/\" + IDTEAMSV.toString() + \"/directManager\"\n\n    URL url\n    url = new URL(baseURL)\n    HttpURLConnection connection = (HttpURLConnection)url.openConnection();\n\n    connection.setRequestMethod(requestMethod);\n    connection.setRequestProperty(\"Content-Type\", \"application/json\");\n    connection.setRequestProperty(\"Accept\", \"*/*\");\n    connection.setDoOutput(true);\n    connection.setDoInput(true);\n    log.debug connection\n    connection.connect();\n\n    log.debug \"ResponseCode:\" + connection.getResponseCode();\n\n    def httpResponseScanner = new Scanner(connection.getInputStream())\n\n    def jsonResp =  httpResponseScanner.nextLine()\n    def json = new JsonSlurper().parseText(jsonResp)\n\n    def userPropertyManager = ComponentAccessor.getUserPropertyManager()\n    def userManager = ComponentAccessor.getUserManager()\n    def userSearchService = ComponentAccessor.getComponent(UserSearchService.class)\n\n    def dManagerList = []\n    dManagerList = userSearchService.findUsersByEmail(json.email)\n    ApplicationUser directManager\n\t\n    //se ho piu user utilizzo quello che ha il gruppo IDTS-customers altrimenti uso l'unico utente che c'\u00e8\n    if (dManagerList.size()&gt;1) {\n        for (directM in dManagerList){\n           if (groupManager.getUsersInGroup(\"IDTS-customers\").contains(directM)){\n                directManager=(ApplicationUser) directM\n            }\t\n       } \n    }\n    else {\n        directManager=dManagerList.getAt(0)\n    }\n\t\n    //se ho piu user e non ne ho nemmeno uno con IDTS-customers allora prendo quello che appartiere alla directory di crowd\n    if (directManager == null){\n        for (directM in dManagerList){\n\n           log.debug (directM.getDirectoryId() == 10000)\n            if (directM.getDirectoryId() == 10000){\n                directManager=(ApplicationUser) directM\n            }\t\n        } \n    }\n    \n    //ApplicationUser directManager = userSearchService.findUsersByEmail(json.email).getAt(0)\n    httpResponseScanner.close()\n\n    /* Create sub-task to be assigned to user */\n    MutableIssue newSubTask = issueFactory.getIssue()\n    //dobbiamo mettere il direct manager proveniente da teams\n    def directManagerList = []\n    directManagerList.add(directManager)\n    // IDTS WF Account PROD 22256 - TEST 22100\n    CustomField WFAccount = customFieldManager.getCustomFieldObject(Long.parseLong(\"22256\"))\n    issue.setCustomFieldValue(WFAccount, directManagerList)\n    issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\n\n    newSubTask.setAssignee(directManager)\n    newSubTask.setReporter(LoggedInUser)\n    newSubTask.setSummary(directManager.getUsername() + \" - \" + issue.getSummary())\n    // Software/Hardware PROD 22253 - TYEST 22023\n    CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\n    //Software/Hardware Approvation PROD 22260 - TEST 22343\n    CustomField SoftHardAppr = customFieldManager.getCustomFieldObject(Long.parseLong(\"22260\"))\n\n    CustomField ReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong(\"20104\"))\n    def ReporterCompanyV = issue.getCustomFieldValue(ReporterCompany)\n\n    def fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)\n\n    newSubTask.setCustomFieldValue(fieldSoftHard, fieldSoftHardV)\n    newSubTask.setCustomFieldValue(SoftHardAppr, fieldSoftHardV)\n    newSubTask.setCustomFieldValue(ReporterCompany, ReporterCompanyV)\n\n    newSubTask.setParentObject(issue)\n    newSubTask.setProjectObject(issue.getProjectObject())\n\n    newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{\n        it.getName() == \"Sub-ApprAccount\"\n    }.id)\n\n    def newIssueParams = [\"issue\" : newSubTask] as Map&lt;String,Object&gt;\n\n    issueManager.createIssueObject(LoggedInUser, newIssueParams)\n    subTaskManager.createSubTaskIssueLink(issue, newSubTask, LoggedInUser)\n    issueIndexingService.reIndex(newSubTask)\n    //Software/Hardware PROD 22253 - TEST 22023\n    //CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong(\"22253\"))\n    //def SoftHardV = issue.getCustomFieldValue(SoftHard)\n    //issue.setCustomFieldValue(SoftHardAppr, SoftHard)\n\n    issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)\n    issueIndexingService.reIndex(issue)\n}\n\n\n","scriptPath":null,"parameters":{}}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()
def subTaskManager = ComponentAccessor.getSubTaskManager()
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()
/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()

def groupManager = ComponentAccessor.getGroupManager()

if(!groupManager.getUsersInGroup("Helpdesk VIP").contains(issue.getReporter())){
    //MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6118")
    Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
    log.setLevel(org.apache.log4j.Level.DEBUG)
    // Employee System ID uguale PROD E TEST
    CustomField IDTEAMS = customFieldManager.getCustomFieldObject(Long.parseLong("20500"))
    def IDTEAMSV = issue.getCustomFieldValue(IDTEAMS)

    //Reference Employee ID PROD 22301 - TEST 23001
    CustomField EmployeeReference = customFieldManager.getCustomFieldObject(Long.parseLong("22301"))
    def EmployeeReferenceMailV = issue.getCustomFieldValue(EmployeeReference)
    def EmployeeReferenceMail = ""

    if (IDTEAMSV == null)
    {
        if (EmployeeReferenceMailV == null || EmployeeReferenceMailV=="")
        {
            EmployeeReferenceMail = issue.reporter.getEmailAddress()
            log.debug "EmployeeReferenceMail" + EmployeeReferenceMail
        }
        else {
        	def idTeamsEmployee= EmployeeReferenceMailV[0].getName().split("-")
        	IDTEAMSV = idTeamsEmployee[0].trim()
       }     
    }

    def requestMethod = "GET";

    def baseURL=""
    //se ho IDTEAMS perchè arrivo da WF di TEAMS allora chiamo questo:
    //TEST http://172.30.3.230:8080
    //PROD https://gems.faacgroup.com

    if (IDTEAMSV == null)
    	baseURL = "https://gems.faacgroup.com/faac-hrportal-web/rest/jira/directManager?email=" + EmployeeReferenceMail	
    else
    	baseURL = "https://gems.faacgroup.com/faac-hrportal-web/rest/jira/employee/" + IDTEAMSV.toString() + "/directManager"

    URL url
    url = new URL(baseURL)
    HttpURLConnection connection = (HttpURLConnection)url.openConnection();

    connection.setRequestMethod(requestMethod);
    connection.setRequestProperty("Content-Type", "application/json");
    connection.setRequestProperty("Accept", "*/*");
    connection.setDoOutput(true);
    connection.setDoInput(true);
    log.debug connection
    connection.connect();

    log.debug "ResponseCode:" + connection.getResponseCode();

    def httpResponseScanner = new Scanner(connection.getInputStream())

    def jsonResp =  httpResponseScanner.nextLine()
    def json = new JsonSlurper().parseText(jsonResp)

    def userPropertyManager = ComponentAccessor.getUserPropertyManager()
    def userManager = ComponentAccessor.getUserManager()
    def userSearchService = ComponentAccessor.getComponent(UserSearchService.class)

    def dManagerList = []
    dManagerList = userSearchService.findUsersByEmail(json.email)
    ApplicationUser directManager
	
    //se ho piu user utilizzo quello che ha il gruppo IDTS-customers altrimenti uso l'unico utente che c'è
    if (dManagerList.size()&gt;1) {
        for (directM in dManagerList){
           if (groupManager.getUsersInGroup("IDTS-customers").contains(directM)){
                directManager=(ApplicationUser) directM
            }	
       } 
    }
    else {
        directManager=dManagerList.getAt(0)
    }
	
    //se ho piu user e non ne ho nemmeno uno con IDTS-customers allora prendo quello che appartiere alla directory di crowd
    if (directManager == null){
        for (directM in dManagerList){

           log.debug (directM.getDirectoryId() == 10000)
            if (directM.getDirectoryId() == 10000){
                directManager=(ApplicationUser) directM
            }	
        } 
    }
    
    //ApplicationUser directManager = userSearchService.findUsersByEmail(json.email).getAt(0)
    httpResponseScanner.close()

    /* Create sub-task to be assigned to user */
    MutableIssue newSubTask = issueFactory.getIssue()
    //dobbiamo mettere il direct manager proveniente da teams
    def directManagerList = []
    directManagerList.add(directManager)
    // IDTS WF Account PROD 22256 - TEST 22100
    CustomField WFAccount = customFieldManager.getCustomFieldObject(Long.parseLong("22256"))
    issue.setCustomFieldValue(WFAccount, directManagerList)
    issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)

    newSubTask.setAssignee(directManager)
    newSubTask.setReporter(LoggedInUser)
    newSubTask.setSummary(directManager.getKey() + " - " + issue.getSummary())
    // Software/Hardware PROD 22253 - TYEST 22023
    CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
    //Software/Hardware Approvation PROD 22260 - TEST 22343
    CustomField SoftHardAppr = customFieldManager.getCustomFieldObject(Long.parseLong("22260"))

    CustomField ReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong("20104"))
    def ReporterCompanyV = issue.getCustomFieldValue(ReporterCompany)

    def fieldSoftHardV = issue.getCustomFieldValue(fieldSoftHard)

    newSubTask.setCustomFieldValue(fieldSoftHard, fieldSoftHardV)
    newSubTask.setCustomFieldValue(SoftHardAppr, fieldSoftHardV)
    newSubTask.setCustomFieldValue(ReporterCompany, ReporterCompanyV)

    newSubTask.setParentObject(issue)
    newSubTask.setProjectObject(issue.getProjectObject())

    newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{
        it.getName() == "Sub-ApprAccount"
    }.id)

    def newIssueParams = ["issue" : newSubTask] as Map&lt;String,Object&gt;

    issueManager.createIssueObject(LoggedInUser, newIssueParams)
    subTaskManager.createSubTaskIssueLink(issue, newSubTask, LoggedInUser)
    issueIndexingService.reIndex(newSubTask)
    //Software/Hardware PROD 22253 - TEST 22023
    //CustomField SoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
    //def SoftHardV = issue.getCustomFieldValue(SoftHard)
    //issue.setCustomFieldValue(SoftHardAppr, SoftHard)

    issueManager.updateIssue(LoggedInUser, issue, EventDispatchOption.DO_NOT_DISPATCH, false)
    issueIndexingService.reIndex(issue)
}


</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="v+nWù">¶»ž</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="201" name=":—§">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "atlassian_faac_service_desk"|||</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="53">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="211" name="To Open">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <restrict-to>
            <conditions>
              <condition type="class">
                <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.conditions.SimpleScriptedCondition</arg>
                <arg name="FIELD_CONDITION">currentUser.name == "katia.chinaglia"|||</arg>
                <arg name="class.name">com.onresolve.jira.groovy.GroovyCondition</arg>
                <arg name="FIELD_PREVIEW_ISSUE" />
              </condition>
            </conditions>
          </restrict-to>
          <results>
            <unconditional-result old-status="žée" status="žée" step="53">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="51" name="EèÞr×">
      <meta name="jira.status.id">11436</meta>
    </step>
    <step id="52" name="k¢÷">
      <meta name="jira.status.id">10932</meta>
      <actions>
<common-action id="51" />
      </actions>
    </step>
    <step id="53" name=":—§">
      <meta name="jira.status.id">1</meta>
      <actions>
<common-action id="231" />
        <action id="191" name="In Progress">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="22">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">íæ»w®\ÑöÝý¼k]uu­tÓ½öïµoO^wÏ]</arg>
                  <arg name="FIELD_NOTES">Creo sub task attività</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.workflow.WorkflowTransitionUtil;
import com.atlassian.jira.workflow.WorkflowTransitionUtilImpl;
import com.atlassian.jira.util.JiraUtils;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import com.atlassian.jira.issue.Issue;
import org.apache.commons.codec.binary.Base64;
import groovy.json.JsonSlurper;
import groovy.json.StreamingJsonBuilder;
import org.apache.log4j.Category
import com.atlassian.jira.user.util.UserManager

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()
def subTaskManager = ComponentAccessor.getSubTaskManager()
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()
/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

/* Get issue "Group Assignee" custom field value */
IssueManager issueManager = ComponentAccessor.getIssueManager()

MutableIssue parentIssue = issue
//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("IDTS-6247")

Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

//Software/Hardware Approvation PROD 22260 - TEST 22343
CustomField fieldSoftHard = customFieldManager.getCustomFieldObject(Long.parseLong("22260"))
//Software/Hardware PROD 22253 - TEST 22023
CustomField fieldSoftHard2 = customFieldManager.getCustomFieldObject(Long.parseLong("22253"))
//Type Account PROD 22259 - TEST 22417
CustomField fieldTypeAccount = customFieldManager.getCustomFieldObject(Long.parseLong("22259"))
//Reporter Company PROD 20104 - TEST 20104
CustomField fieldReporterCompany = customFieldManager.getCustomFieldObject(Long.parseLong("20104"))

def fieldSoftHardV = parentIssue.getCustomFieldValue(fieldSoftHard2)
def fieldReporterCompanyV = parentIssue.getCustomFieldValue(fieldReporterCompany)

log.debug fieldSoftHardV
for (sofHard in fieldSoftHardV){
    MutableIssue newSubTask = issueFactory.getIssue()
    log.debug "sofHard " +  sofHard
    def sofHardList = []
	sofHardList.add(sofHard)
    
    if (sofHard != null &amp;&amp; sofHard != ""){
        
        /* Specify the schema id as well as the IQL that will fetch objects. In this case all objects with Name matching the valueCF, be sure to include " around value */
        
        def queryParam = "\"" + sofHard.getName() + "\""

        //Recupero il funzionario legato al site selezionato
        def objects = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"TypeAccounts\" AND \"Name\" IN (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
		log.debug "1"
        def userPropertyManager = ComponentAccessor.getUserPropertyManager()
        def userManager = ComponentAccessor.getUserManager()
        def userSearchService = ComponentAccessor.getComponent(UserSearchService.class)
        
        def assigneeList = [];
        ApplicationUser assignee = null;
        
        //Assignee su insight nella tabella TypeAccounts PROD 2205 - TEST 2451
        if (objectFacade.loadObjectAttributeBean(objects[0].getId(), 2205) != null){
        	assigneeList = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objects[0].getId(), 2205).getObjectAttributeValueBeans()[0].getValue())
        	for (ass in assigneeList){
                if (ComponentAccessor.groupManager.getUsersInGroup("IDTS-agents").contains(ass) || ComponentAccessor.groupManager.getUsersInGroup("IDTS-external-agents").contains(ass)){
                    assignee=(ApplicationUser) ass
                }	
            } 
        }
        
        ApplicationUser assigneeCompany
        
        if (assignee != null &amp;&amp; assignee!=""){
        	newSubTask.setAssignee(assignee)
        }
        else {
            //se assignee non è valorizzato allora vado per company a vedere la tabella AssigneeInfrastructureCompany
            if (fieldReporterCompanyV != null &amp;&amp; fieldReporterCompanyV!=""){
                queryParam = "\"" + fieldReporterCompanyV + "\""
                def objectsAssignee = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"AssigneeInfrastructureCompany\" AND \"CompanyAD\" = (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
				if (objectsAssignee.size()&gt;0){
                    if (objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != ""){
                        assigneeList = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232).getObjectAttributeValueBeans()[0].getValue())
				
                    	for (ass in assigneeList){
                            if (ComponentAccessor.groupManager.getUsersInGroup("IDTS-agents").contains(ass) || ComponentAccessor.groupManager.getUsersInGroup("IDTS-external-agents").contains(ass)){
                                assigneeCompany=(ApplicationUser) ass
                            }	
                        } 
                    }
                    
                    if (assigneeCompany != null &amp;&amp; assigneeCompany!="")
                        newSubTask.setAssignee(assigneeCompany)
               	}
        	} 
        }
        
        /*if (assignee != null &amp;&amp; assignee!=""){
        	newSubTask.setAssignee(assignee)
        }
        else {
            //se assignee non è valorizzato allora vado per company a vedere la tabella AssigneeInfrastructureCompany
            if (fieldReporterCompanyV != null &amp;&amp; fieldReporterCompanyV!=""){
                queryParam = "\"" + fieldReporterCompanyV + "\""
                def objectsAssignee = iqlFacade.findObjectsByIQLAndSchema(9, "objectType=\"AssigneeInfrastructureCompany\" AND \"CompanyAD\" = (" + queryParam + ")"); // See the complete list of possible IQL on the Insight Query Language documentation page
				if (objectsAssignee.size()&gt;0){
                    if (objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != null &amp;&amp; objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232) != "")
                        assigneeCompany = userSearchService.findUsersByEmail(objectFacade.loadObjectAttributeBean(objectsAssignee[0].getId(), 2232).getObjectAttributeValueBeans()[0].getValue()).getAt(0)

                    if (assigneeCompany != null &amp;&amp; assigneeCompany!="")
                        newSubTask.setAssignee(assigneeCompany)
                } 
        	} 
        }*/
        
        newSubTask.setReporter(LoggedInUser)
        newSubTask.setSummary(sofHard.getName() + " - " + parentIssue.getSummary())
        newSubTask.setParentObject(parentIssue)
        newSubTask.setProjectObject(parentIssue.getProjectObject())
        newSubTask.setCustomFieldValue(fieldSoftHard2, sofHardList)
        newSubTask.setCustomFieldValue(fieldReporterCompany, fieldReporterCompanyV)
        //type su insight nella tabella TypeAccounts PROD 2204 - TEST 2450
        newSubTask.setCustomFieldValue(fieldTypeAccount, objectFacade.loadObjectAttributeBean(objects[0].getId(), 2204).getObjectAttributeValueBeans()[0].getValue())
       
        newSubTask.setIssueTypeId(constantManager.getAllIssueTypeObjects().find{
            it.getName() == "Sub-TaskAccount"
        }.id)
        
		def newIssueParams = ["issue" : newSubTask] as Map&lt;String,Object&gt;
        issueManager.createIssueObject(LoggedInUser, newIssueParams)
        log.debug newIssueParams
       
        subTaskManager.createSubTaskIssueLink(parentIssue, newSubTask, LoggedInUser)
        issueIndexingService.reIndex(newSubTask)
    }
    
}
</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE" />
                </function>
                <function type="class">
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">faacithelpdesk@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS" />
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS">­êh®×«</arg>
                  <arg name="FIELD_FUNCTION_ID">q¯&lt;é½^åÇ:íöž]=åÏyuþžóVºyöšÍ7</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26"&gt;
                                                              &lt;b&gt;IDTS Support Portal&lt;/b&gt;
															&lt;/a&gt; - Account
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; in progress &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
                                		&lt;br /&gt;
                                        Dear &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        The ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; is in progress&lt;% if (issue.assignee!=null) out &lt;&lt; " and assigned to " + issue.assignee?.displayName %&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Kind regards&lt;br /&gt;
                                        &lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        Below repeated in italian&lt;br /&gt;
                                        --------------------------------&lt;br /&gt;
                                        &lt;br /&gt;
                                        Gentile &lt;% out &lt;&lt; issue.reporter?.displayName %&gt;,
                                        &lt;br /&gt;&lt;br /&gt;
                                        il ticket &lt;a href="https://helpdesk.faacgroup.com/servicedesk-ui/customer/portal/26/myrequests/$issue"&gt;$issue&lt;/a&gt; è in lavorazione&lt;% if (issue.assignee!=null) out &lt;&lt; " ed è stato preso in carico da " + issue.assignee?.displayName %&gt;.
                                        &lt;br /&gt;&lt;br /&gt;
                                        Cordiali saluti
                                        &lt;br /&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC IDTS Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">Ticket [$issue.key] $issue.summary: in progress</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">mail.setFrom("faacithelpdesk@faacgroup.com")|||</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">IDTS-11997</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
  </steps>
</workflow>