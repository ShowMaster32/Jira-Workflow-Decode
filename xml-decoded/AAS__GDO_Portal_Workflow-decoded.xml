<?xml version='1.0' encoding='UTF-8'?>
<workflow>
  <meta name="jira.description" />
  <meta name="jira.update.author.key">katia.chinaglia</meta>
  <meta name="jira.updated.date">1691398330172</meta>
  <initial-actions>
    <action id="1" name="Create">
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="žée" status="¢—§" step="1">
          <post-functions>
            <function type="class">
              <arg name="FIELD_SECURITY_LEVEL_ID">11500</arg>
              <arg name="FIELD_NOTES">`!`</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SetIssueSecurity</arg>
              <arg name="FIELD_CONDITION">issue.getIssueType().name.equals("Repair")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetCustomerRequestDescription.groovy</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetNextStatusDescription.groovy</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">yкш▀очs┐{Н»;qь\ьдч█vчoъ▀mэ[uд┌</arg>
              <arg name="FIELD_NOTES">Valorizza campo insight GDO Salesman</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.bc.user.search.UserSearchService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)

def issueFactory = ComponentAccessor.getIssueFactory()
def constantManager = ComponentAccessor.getConstantsManager()
def LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()
def subTaskManager = ComponentAccessor.getSubTaskManager()

/* Get Insight IQL Facade from plugin accessor */
Class iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade"); 
def iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);
/* Get Insight Object Facade from plugin accessor */
Class objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass("com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade");
def objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)


/* Get issue "Group Assignee" custom field value */
//IssueManager issueManager = ComponentAccessor.getIssueManager()
// Test console
//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("AAS-1512")

//21843 - GDO Site
//21852 - Funzionario FAAC
def value = issue.getCustomFieldValue(ComponentAccessor.getCustomFieldManager().getCustomFieldObject(22223))

def userSearchService = ComponentAccessor.getComponent(UserSearchService)

if (value != null &amp;&amp; value != ""){
    /* Specify the schema id as well as the IQL that will fetch objects. In this case all objects with Name matching the valueCF, be sure to include " around value */
    log.debug "value[0].name = " + value[0].getName()
    log.debug "value.size: " + value.size
    log.debug "value: " + value
    String queryParam
    
    queryParam = "\"" + value[0].getName() + "\""
    
    //Recupero il funzionario legato al site selezionato
    def objects = iqlFacade.findObjectsByIQLAndSchema(16, "objectType=\"Funzionari FAAC\" AND object HAVING inboundReferences(\"Name\" IN (" + queryParam + "))"); // See the complete list of possible IQL on the Insight Query Language documentation page
    
    log.debug objectFacade.loadObjectBean(objects[0].getId())
    def user = ComponentAccessor.jiraAuthenticationContext.loggedInUser
    
    issue.setCustomFieldValue(ComponentAccessor.getCustomFieldManager().getCustomFieldObject(22226), [objectFacade.loadObjectBean(objects[0].getId())])
    ComponentAccessor.getIssueManager().updateIssue(user, issue, EventDispatchOption.DO_NOT_DISPATCH, false);
    issueIndexingService.reIndex(issue)
    
    log.debug "Funzionario: " + objects
            
    log.debug "Email address: " + objectFacade.loadObjectAttributeBean(objects[0].getId(), 1526).getObjectAttributeValueBeans()[0].getValue()

}
</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">Ч¶ЬуЌґбЮэsN4ЧЯ_йжњЭЭ=}¦ъхЗУ¶Ѕ</arg>
              <arg name="FIELD_NOTES">Numero richieste fatte dallo stesso reporter nello stesso anno (numero/Anno) - Numero di richieste con lo stesso numero documento fiscale</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.bc.issue.search.SearchService
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.IssueManager
import com.atlassian.jira.user.util.UserUtil
import com.atlassian.jira.web.bean.PagerFilter
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.OrderableField
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.jira.issue.index.IssueIndexingService
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.jira.issue.MutableIssue
import com.atlassian.jira.jql.parser.JqlQueryParser
import com.atlassian.jira.web.bean.PagerFilter
import org.apache.log4j.Category

Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")

log.setLevel(org.apache.log4j.Level.DEBUG)

//IssueManager issueManager = ComponentAccessor.getIssueManager()
//MutableIssue issue = issueManager.getIssueByKeyIgnoreCase("AAS-1407")

//###### Determinazione progetto ######
String PrjKey = issue.getProjectObject().key
SearchService 		searchService 		= ComponentAccessor.getComponent(SearchService.class)
UserUtil 			userUtil 			= ComponentAccessor.getUserUtil()
IssueManager 		issueManager 		= ComponentAccessor.getIssueManager()
CustomFieldManager 	customFieldManager 	= ComponentAccessor.getCustomFieldManager()
IssueChangeHolder 	changeHolder 		= new DefaultIssueChangeHolder()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)

def jqlQueryParser = ComponentAccessor.getComponent(JqlQueryParser)



//Filtro di ricerca
def jqlSearch = "project = '" + issue.getProjectObject().name + "' AND issuetype = 'Repair' AND reporter IN ('" + issue.reporter.name + "') AND created &lt;= endOfYear() AND CREATED &gt;= startOfYear()"
def query = jqlQueryParser.parseQuery(jqlSearch)
/* ----------- LOG PER DEBUG ----------- */
//log.debug "Update Issue EC Number - JQL Search: " + jqlSearch

//Poichè l'utente che sta creando la nuova EC potrebbe non avere le permission per vedere tutte le EC del progetto, impostiamo come utente loggato per effettuare la ricerca con filtro un utente 
//amministratore di progetto con piena visibilità. Scegliamo un utente non nominale, l'utente interno atlassian
ApplicationUser oldUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian"))
ApplicationUser user = ComponentAccessor.jiraAuthenticationContext.loggedInUser

List&lt;MutableIssue&gt; issues = null

//Precarico i dati che mi servono per la nuova issue appena creata. In particolare andrò ad aggiornare i campi EC Number, EC Counter e Summary
CustomField counter = customFieldManager.getCustomFieldObject(Long.parseLong("22221"))


//Eseguo la ricerca con filtro
def search = searchService.search(user, query, PagerFilter.getUnlimitedFilter())

//if (search.results) {
    //log.debug "size" + search.results.size()
	/* ----------- LOG PER DEBUG ----------- */
	//log.debug "risultato " + issues.size()
int newCounter =0

if(search.results.size() &gt; 0){
    newCounter = search.results.size() + 1
}else{
    newCounter = 1
}

def newNumber
newNumber = newCounter.toString().padLeft(3, '0') + '/' + Calendar.getInstance().get(Calendar.YEAR)

//Aggiorno i campi della nuova issue appena creata
counter.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(counter),newNumber),changeHolder)
issueManager.updateIssue(user, issue, EventDispatchOption.DO_NOT_DISPATCH, false)


//calcolo receipt request number
CustomField receiptNumber = customFieldManager.getCustomFieldObjectByName( "Receipt Number" );

//Filtro di ricerca: estraggo tutti i task del progetto ordinandoli in modo decrescente in base al campo (nascosto) EC Counter
jqlSearch = "project = '" + issue.getProjectObject().name + "' AND issuetype = 'Repair' AND 'Receipt number' ='" + issue.getCustomFieldValue(receiptNumber) + "' " 
query = jqlQueryParser.parseQuery(jqlSearch)

issues = null

//Precarico i dati che mi servono per la nuova issue appena creata. In particolare andrò ad aggiornare i campi EC Number, EC Counter e Summary
counter = customFieldManager.getCustomFieldObject(Long.parseLong("22216"))


//Eseguo la ricerca con filtro
search = searchService.search(user, query, PagerFilter.getUnlimitedFilter())


newCounter = 0

if(search.results.size() &gt; 0){
    newCounter = search.results.size() + 1
}else{
    newCounter = 1
}

//Aggiorno i campi della nuova issue appena creata
counter.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(counter),newCounter.toDouble()),changeHolder)
//issue.summary = newSummary

issueManager.updateIssue(user, issue, EventDispatchOption.DO_NOT_DISPATCH, false)


issueIndexingService.reIndex(issue)
/*} else {
    log.error("Invalid JQL: " + jqlSearch);
} */

//una volta terminata la ricerca e l'aggiornamento dei campi EC Number, EC Counter e summary reimposto il corretto user loggato (quello che ha richiesto la creazione della nuova EC)
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(oldUser)
</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">1</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Invio notifica email in CCN a email utente che ha creato + CCN email richiedente (se compilata e diversa dalla precedente)</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">assistenza.gdo@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_ALL</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">customfield_12200</arg>
              <arg name="FIELD_FUNCTION_ID">i·ßé½m§¼om÷V½su{]õá½{kÍ5Ût</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30"&gt;
                                                              &lt;b&gt;GDO Support Portal&lt;/b&gt;
															&lt;/a&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15800"))%&gt;
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15801"))%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="comment-box"&gt;									
									
									&lt;p class="details-box-title"&gt;
										&lt;b&gt;&lt;span style='font-family:"Verdana"'&gt;Details&lt;/span&gt;&lt;/b&gt;
										
									&lt;/p&gt;
									&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%;'&gt;
										&lt;!-- Custom field: Installation Address --&gt;
										&lt;!-- ID Svil: 21813 --&gt;
										&lt;!-- ID Prod:  22207--&gt;
										&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22207")) != null) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Installation Address &lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
												  &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22207"))%&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
										&lt;!-- Custom field:  Installation ZIP code --&gt;
										&lt;!-- ID Svil: 21814 --&gt;
										&lt;!-- ID Prod: 22208--&gt;
										&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22208")) != null) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Installation ZIP Code &lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
												  &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22208"))%&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
										&lt;!-- Custom field: Installation City --&gt;
										&lt;!-- ID Svil: 21815 --&gt;
										&lt;!-- ID Prod: 22209 --&gt;
										&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22209")) != null) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Installation City &lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
												  &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22209"))%&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
										&lt;!-- Custom field: Installation Province --&gt;
										&lt;!-- ID Svil: 21816 --&gt;
										&lt;!-- ID Prod:  22210--&gt;
										&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22210")) != null) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Installation Province &lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
												  &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22210"))%&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
										
										&lt;!-- Custom field: Receipt Number --&gt;
										&lt;!-- ID Svil: 21817 --&gt;
										&lt;!-- ID Prod:  --&gt;
										&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22211")) != null) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Receipt Number &lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
													&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22211"))%&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
										&lt;!-- Custom field: Receipt Date --&gt;
										&lt;!-- ID Svil: 21818 --&gt;
										&lt;!-- ID Prod:  --&gt;
										&lt;% if(issue.getProjectObject().key == "AAS" &amp;&amp; issue.issueTypeObject.name == "Fault"){ %&gt;
											&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22212")) != null) { %&gt;
												&lt;tr&gt;
													&lt;td width="30%" class="details-field-name"&gt;
													  &lt;b&gt;Receipt Date &lt;/b&gt;
													&lt;/td&gt;
													&lt;td class="details-field-value"&gt;
														&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22212")).toString().substring(0,10)%&gt;
													&lt;/td&gt;
												&lt;/tr&gt;
											&lt;% } %&gt;
										&lt;% } %&gt;
										
										&lt;!-- Custom field: KIT Model --&gt;
										&lt;!-- ID Svil: 21819 --&gt;
										&lt;!-- ID Prod:  --&gt;
										
										&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22213")) != null) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;KIT Model &lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
													&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22213"))%&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
																				
										&lt;!-- Custom field: Request description --&gt;
                                        &lt;tr&gt;
                                        	&lt;td width="30%" class="details-field-name"&gt;
                                        		&lt;b&gt;Request description&lt;/b&gt;
                                        	&lt;/td&gt;
                                        	&lt;td class="details-field-value"&gt;
                                            &lt;% if (issue.description) { %&gt;
                                        		&lt;% if (issue.description.contains("{html}")) { %&gt;
                                        			&lt;% out &lt;&lt; issue.description.toString().substring(issue.description.toString().indexOf("{html}")+6, issue.description.toString().lastIndexOf("{html}")) %&gt;
                                        		&lt;% }else{ %&gt;
                                        			&lt;% out &lt;&lt; issue.description %&gt;
                                        		&lt;% } %&gt;
                                            &lt;% } %&gt;
                                        	&lt;/td&gt;
                                        &lt;/tr&gt;
										
										
										
									&lt;/table&gt;
									
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC GDO Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"assistenza.gdo@faacgroup.com\")\n\nimport com.atlassian.jira.component.ComponentAccessor\n\nimport com.atlassian.jira.issue.fields.CustomField\n\nmail.setBcc(issue.getReporter().getEmailAddress().toString()+ \",Luca.Massari@faacgroup.com\")\n\nissue.getIssueType().name.equals(\"Repair\")","scriptPath":null,"parameters":{}}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">AAS-1578</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <common-actions>
    <action id="71" name="Reopen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="žée" status="žée" step="1">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetCustomerRequestDescription.groovy</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetNextStatusDescription.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="31" name="Closed" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">19408</meta>
      <results>
        <unconditional-result old-status="žée" status="žée" step="5">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetCustomerRequestDescription.groovy</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetNextStatusDescription.groovy</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Update public comments and attachments tables on DB</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_UpdatePublicCommentsAttachments.groovy</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">invio mail con allegati e commenti agli stessi utenti della creazione</arg>
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">assistenza.gdo@faacgroup.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NEW</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">customfield_12200</arg>
              <arg name="FIELD_FUNCTION_ID">omºó¶·yöÛõ®\iï6Ñç4w÷×ÛçÏZÓ¦</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:10pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:9pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30"&gt;
                                                              &lt;b&gt;GDO Support Portal&lt;/b&gt;
															&lt;/a&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15800"))%&gt;
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
                                        &lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15801"))%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/table&gt;
                            &lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
                            	&lt;!-- Custom field: Warranty (yes/no)--&gt;
								&lt;!-- ID Svil: 21849 --&gt;
								&lt;!-- ID Prod:  --&gt;
								
								&lt;% if (issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22228")) != null) { %&gt;
									&lt;tr&gt;
										&lt;td width="30%" class="details-field-name"&gt;
										  &lt;b&gt;Warranty &lt;/b&gt;
										&lt;/td&gt;
										&lt;td class="details-field-value"&gt;
											&lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_22228"))%&gt;
										&lt;/td&gt;
									&lt;/tr&gt;
								&lt;% } %&gt;
                                &lt;tr &gt;
                                    &lt;td colspan=2 class="comment-box"&gt;									
                                        &lt;% if (com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).size() != 0 &amp;&amp; lastComment != null &amp;&amp; lastComment != "") { %&gt;
                                            &lt;p class="title-comment"&gt;
                                                &lt;b&gt;&lt;u&gt;New comment added to the request&lt;/u&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p class="author-comment"&gt;
                                                &lt;b&gt;&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).last().authorFullName %&gt;&lt;/b&gt;
                                                &lt;b&gt;&lt;span style='font-size:10.0pt;font-family:"Segoe UI Symbol";color:#1F497D'&gt;&lt;/span&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p style='margin-top:6.0pt'&gt;
                                                &lt;span style='font-family:"Segoe UI Symbol";color:#003050'&gt;
                                                    &lt;% out &lt;&lt; lastComment %&gt;
                                                &lt;/span&gt;
                                            &lt;/p&gt;
                                        &lt;% } %&gt;
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                                
                           	&lt;/table&gt;
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC GDO Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"assistenza.gdo@faacgroup.com\")\n\nimport com.atlassian.jira.component.ComponentAccessor\n\nimport com.atlassian.jira.issue.fields.CustomField\n\nmail.setBcc(issue.getReporter().getEmailAddress().toString())\n\nissue.getIssueType().name.equals(\"Repair\")","scriptPath":null,"parameters":{}}</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE" />
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </common-actions>
  <steps>
    <step id="1" name=":—§">
      <meta name="jira.status.id">1</meta>
      <actions>
<common-action id="31" />
        <action id="11" name="Assign to Installer" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">19406</meta>
          <validators>
            <validator name="" type="class">
              <arg name="contextHandling" />
              <arg name="hidFieldsList">customfield_22226@@customfield_22225@@</arg>
              <arg name="jsuWorkflowParamsVersion-textValue">2.15.1</arg>
              <arg name="class.name">com.googlecode.jsu.workflow.validator.FieldsRequiredValidator</arg>
              <arg name="customErrorMessage-textValue" />
            </validator>
          </validators>
          <results>
            <unconditional-result old-status="žée" status="žée" step="2">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetCustomerRequestDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetNextStatusDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Update public comments and attachments tables on DB</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_UpdatePublicCommentsAttachments.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Invio notifica email a installatore e in CC al funzionario di riferimento del punto vendita</arg>
                  <arg name="FIELD_DISABLE_VALIDATION">on</arg>
                  <arg name="FIELD_FROM">assistenza.gdo@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_ALL</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">г^ЅЯwыw­]зЭџuя=kѕ4yї{езw{FёwЧ;</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:10pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:9pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30"&gt;
                                                              &lt;b&gt;GDO Support Portal&lt;/b&gt;
															&lt;/a&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15800"))%&gt;
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
                                        &lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15801"))%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/table&gt;
                            &lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
                                &lt;tr&gt;
                                    &lt;td class="comment-box"&gt;									
                                        &lt;% if (com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).size() != 0 &amp;&amp; lastComment != null &amp;&amp; lastComment != "") { %&gt;
                                            &lt;p class="title-comment"&gt;
                                                &lt;b&gt;&lt;u&gt;New comment added to the request&lt;/u&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p class="author-comment"&gt;
                                                &lt;b&gt;&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).last().authorFullName %&gt;&lt;/b&gt;
                                                &lt;b&gt;&lt;span style='font-size:10.0pt;font-family:"Segoe UI Symbol";color:#1F497D'&gt;&lt;/span&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p style='margin-top:6.0pt'&gt;
                                                &lt;span style='font-family:"Segoe UI Symbol";color:#003050'&gt;
                                                    &lt;% out &lt;&lt; lastComment %&gt;
                                                &lt;/span&gt;
                                            &lt;/p&gt;
                                        &lt;% } %&gt;
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                           	&lt;/table&gt;

   							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="details-field-value"&gt;									
										Gentile Cliente, &lt;br&gt;
										la documentazione inserita è corretta.&lt;br&gt;
										Le è stato assegnato Installatore, &lt;br&gt;
										verrà contattato per fissare appuntamento, &lt;br&gt;
										si assicuri di rispondere alle telefonate, anche con numero sconosciuto.&lt;br&gt;
										Cordiali saluti.&lt;br&gt;
										Assistenza GDO 
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;








							
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;			
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC GDO Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"assistenza.gdo@faacgroup.com\")\n\n\nimport com.atlassian.jira.component.ComponentAccessor\n\nimport com.atlassian.jira.issue.fields.CustomField\n\n\nimport com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.issue.MutableIssue\nimport com.atlassian.jira.issue.IssueManager\nimport com.atlassian.jira.bc.user.search.UserSearchService\nimport com.atlassian.jira.user.ApplicationUser\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport org.apache.log4j.Category\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\nlog.setLevel(org.apache.log4j.Level.DEBUG)\n\ndef issueFactory = ComponentAccessor.getIssueFactory()\ndef constantManager = ComponentAccessor.getConstantsManager()\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\ndef subTaskManager = ComponentAccessor.getSubTaskManager()\n\n/* Get Insight IQL Facade from plugin accessor */\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\n/* Get Insight Object Facade from plugin accessor */\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\n\n\n//salesman\ndef value = issue.getCustomFieldValue(ComponentAccessor.getCustomFieldManager().getCustomFieldObject(22226))\n\ndef userSearchService = ComponentAccessor.getComponent(UserSearchService)\n\nif (value != null &amp;&amp; value != \"\"){\n    /* Specify the schema id as well as the IQL that will fetch objects. In this case all objects with Name matching the valueCF, be sure to include \" around value */\n    log.debug \"value[0].name = \" + value[0].getName()\n    log.debug \"value.size: \" + value.size\n    log.debug \"value: \" + value\n    String queryParam\n    \n    queryParam = \"\\\"\" + value[0].getName() + \"\\\"\"\n    \n    //Recupero il funzionario legato al site selezionato\n    def objects = iqlFacade.findObjectsByIQLAndSchema(16, \"objectType=\\\"Funzionari FAAC\\\" AND \\\"Name\\\" IN (\" + queryParam + \")\"); // See the complete list of possible IQL on the Insight Query Language documentation page\n    \n    log.debug objectFacade.loadObjectBean(objects[0].getId())\n    def user = ComponentAccessor.jiraAuthenticationContext.loggedInUser\n    \n    \n            \n    log.debug \"Email address: \" + objectFacade.loadObjectAttributeBean(objects[0].getId(), 1526).getObjectAttributeValueBeans()[0].getValue()\n\n\tmail.setCc(objectFacade.loadObjectAttributeBean(objects[0].getId(), 1526).getObjectAttributeValueBeans()[0].getValue().toString())\n}\n\n//22225 - GDO Supplier\nvalue = issue.getCustomFieldValue(ComponentAccessor.getCustomFieldManager().getCustomFieldObject(22225))\n\nuserSearchService = ComponentAccessor.getComponent(UserSearchService)\n\nif (value != null &amp;&amp; value != \"\"){\n    /* Specify the schema id as well as the IQL that will fetch objects. In this case all objects with Name matching the valueCF, be sure to include \" around value */\n    log.debug \"value[0].name = \" + value[0].getName()\n    log.debug \"value.size: \" + value.size\n    log.debug \"value: \" + value\n    String queryParam\n    \n    queryParam = \"\\\"\" + value[0].getName() + \"\\\"\"\n    \n    //Recupero il funzionario legato al site selezionato\n    def objects = iqlFacade.findObjectsByIQLAndSchema(16, \"objectType=\\\"Installatori\\\" AND (\\\"Name\\\" IN (\" + queryParam + \"))\"); // See the complete list of possible IQL on the Insight Query Language documentation page\n    \n    log.debug objectFacade.loadObjectBean(objects[0].getId())\n    def user = ComponentAccessor.jiraAuthenticationContext.loggedInUser\n            \n    log.debug \"Email address installatore: \" + objectFacade.loadObjectAttributeBean(objects[0].getId(), 1529).getObjectAttributeValueBeans()[0].getValue()\n\n\tmail.setTo(objectFacade.loadObjectAttributeBean(objects[0].getId(), 1529).getObjectAttributeValueBeans()[0].getValue().toString())\n\t\n}\n\n\nissue.getIssueType().name.equals(\"Repair\")","scriptPath":null,"parameters":{}}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">AAS-375385</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="81" name="Ask Customer For Documentation " view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">19407</meta>
          <results>
            <unconditional-result old-status="žée" status="žée" step="6">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">810646da-0fbb-4cf0-a318-c6d954aff598</arg>
                  <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":null,"scriptPath":"customScripts/GDO_SetCustomerRequestDescription.groovy"}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">1df47e6f-e803-4823-8a33-50ae98bb68be</arg>
                  <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":null,"scriptPath":"customScripts/GDO_SetNextStatusDescription.groovy"}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">df291d5c-213e-49c2-8a65-8d078ca32eec</arg>
                  <arg name="FIELD_NOTES">Update public comments and attachments tables on DB</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":null,"scriptPath":"customScripts/GDO_UpdatePublicCommentsAttachments.groovy"}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">invio mail con allegati e commenti agli stessi utenti della creazione</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">assistenza.gdo@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NEW</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS">customfield_12200</arg>
                  <arg name="FIELD_FUNCTION_ID">8c26497d-ca00-48f2-a55e-2b6cbff0af7c</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:10pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:9pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30"&gt;
                                                              &lt;b&gt;GDO Support Portal&lt;/b&gt;
															&lt;/a&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15800"))%&gt;
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
                                        &lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15801"))%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/table&gt;
                            &lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
                                &lt;tr&gt;
                                    &lt;td class="comment-box"&gt;									
                                        &lt;% if (com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).size() != 0 &amp;&amp; lastComment != null &amp;&amp; lastComment != "") { %&gt;
                                            &lt;p class="title-comment"&gt;
                                                &lt;b&gt;&lt;u&gt;New comment added to the request&lt;/u&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p class="author-comment"&gt;
                                                &lt;b&gt;&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).last().authorFullName %&gt;&lt;/b&gt;
                                                &lt;b&gt;&lt;span style='font-size:10.0pt;font-family:"Segoe UI Symbol";color:#1F497D'&gt;&lt;/span&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p style='margin-top:6.0pt'&gt;
                                                &lt;span style='font-family:"Segoe UI Symbol";color:#003050'&gt;
                                                    &lt;% out &lt;&lt; lastComment %&gt;
                                                &lt;/span&gt;
                                            &lt;/p&gt;
                                        &lt;% } %&gt;
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                           	&lt;/table&gt;
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC GDO Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"assistenza.gdo@faacgroup.com\")\r\n\r\nimport com.atlassian.jira.component.ComponentAccessor\r\n\r\nimport com.atlassian.jira.issue.fields.CustomField\r\n\r\nmail.setBcc(issue.getReporter().getEmailAddress().toString())\r\n\r\nissue.getIssueType().name.equals(\"Repair\")","scriptPath":null,"parameters":{}}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">AAS-48762</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="2" name="In Progress">
      <meta name="jira.status.id">3</meta>
      <actions>
<common-action id="31" />
<common-action id="71" />
        <action id="21" name="Expired Request">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="3">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetCustomerRequestDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetNextStatusDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="41" name="Send Comment to Customer" view="fieldscreen">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id">19407</meta>
          <results>
            <unconditional-result old-status="žée" status="žée" step="4">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetNextStatusDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetCustomerRequestDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Update public comments and attachments tables on DB</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_UpdatePublicCommentsAttachments.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">invio mail con allegati e commenti agli stessi utenti della creazione</arg>
                  <arg name="FIELD_DISABLE_VALIDATION" />
                  <arg name="FIELD_FROM">assistenza.gdo@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NEW</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS">customfield_12200</arg>
                  <arg name="FIELD_FUNCTION_ID">çtq­woÛ®ôknßÓ^}s_[m¦ûwN{w_t</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:10pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:9pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30"&gt;
                                                              &lt;b&gt;GDO Support Portal&lt;/b&gt;
															&lt;/a&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15800"))%&gt;
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
                                        &lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15801"))%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/table&gt;
                            &lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
                                &lt;tr&gt;
                                    &lt;td class="comment-box"&gt;									
                                        &lt;% if (com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).size() != 0 &amp;&amp; lastComment != null &amp;&amp; lastComment != "") { %&gt;
                                            &lt;p class="title-comment"&gt;
                                                &lt;b&gt;&lt;u&gt;New comment added to the request&lt;/u&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p class="author-comment"&gt;
                                                &lt;b&gt;&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).last().authorFullName %&gt;&lt;/b&gt;
                                                &lt;b&gt;&lt;span style='font-size:10.0pt;font-family:"Segoe UI Symbol";color:#1F497D'&gt;&lt;/span&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p style='margin-top:6.0pt'&gt;
                                                &lt;span style='font-family:"Segoe UI Symbol";color:#003050'&gt;
                                                    &lt;% out &lt;&lt; lastComment %&gt;
                                                &lt;/span&gt;
                                            &lt;/p&gt;
                                        &lt;% } %&gt;
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                           	&lt;/table&gt;
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC GDO Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"assistenza.gdo@faacgroup.com\")\n\nimport com.atlassian.jira.component.ComponentAccessor\n\nimport com.atlassian.jira.issue.fields.CustomField\n\nmail.setBcc(issue.getReporter().getEmailAddress().toString())\n\nissue.getIssueType().name.equals(\"Repair\")","scriptPath":null,"parameters":{}}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">AAS-375385</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="3" name="Expired Request">
      <meta name="jira.status.id">11927</meta>
    </step>
    <step id="4" name="Waiting for Customer">
      <meta name="jira.status.id">10024</meta>
      <actions>
        <action id="51" name="Expired Request">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="3">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetCustomerRequestDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetNextStatusDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
        <action id="61" name="Back to Progress">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="2">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetNextStatusDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="FIELD_INLINE_SCRIPT" />
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_SCRIPT_FILE">customScripts/GDO_SetCustomerRequestDescription.groovy</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Invio notifica email a installatore e in CC a massari</arg>
                  <arg name="FIELD_DISABLE_VALIDATION">on</arg>
                  <arg name="FIELD_FROM">assistenza.gdo@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_ALL</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES">luca.massari@faacgroup.com</arg>
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_TO_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">i­υαξω¦φi·5υΎωγ~½Ρέ›uΎρήίoN=</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:10pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:9pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30"&gt;
                                                              &lt;b&gt;GDO Support Portal&lt;/b&gt;
															&lt;/a&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15800"))%&gt;
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
                                        &lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15801"))%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/table&gt;
                            &lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
                                &lt;tr&gt;
                                    &lt;td class="comment-box"&gt;									
                                        &lt;% if (com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).size() != 0 &amp;&amp; lastComment != null &amp;&amp; lastComment != "") { %&gt;
                                            &lt;p class="title-comment"&gt;
                                                &lt;b&gt;&lt;u&gt;New comment added to the request&lt;/u&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p class="author-comment"&gt;
                                                &lt;b&gt;&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).last().authorFullName %&gt;&lt;/b&gt;
                                                &lt;b&gt;&lt;span style='font-size:10.0pt;font-family:"Segoe UI Symbol";color:#1F497D'&gt;&lt;/span&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p style='margin-top:6.0pt'&gt;
                                                &lt;span style='font-family:"Segoe UI Symbol";color:#003050'&gt;
                                                    &lt;% out &lt;&lt; lastComment %&gt;
                                                &lt;/span&gt;
                                            &lt;/p&gt;
                                        &lt;% } %&gt;
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                           	&lt;/table&gt;
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC GDO Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="v+nWù">false</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"assistenza.gdo@faacgroup.com\")\n\n\nimport com.atlassian.jira.component.ComponentAccessor\n\nimport com.atlassian.jira.issue.fields.CustomField\n\n\nimport com.atlassian.jira.component.ComponentAccessor\nimport com.atlassian.jira.issue.MutableIssue\nimport com.atlassian.jira.issue.IssueManager\nimport com.atlassian.jira.bc.user.search.UserSearchService\nimport com.atlassian.jira.user.ApplicationUser\nimport com.atlassian.jira.event.type.EventDispatchOption\nimport com.atlassian.jira.issue.index.IssueIndexingService\nimport org.apache.log4j.Category\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\nlog.setLevel(org.apache.log4j.Level.DEBUG)\n\ndef issueFactory = ComponentAccessor.getIssueFactory()\ndef constantManager = ComponentAccessor.getConstantsManager()\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\ndef subTaskManager = ComponentAccessor.getSubTaskManager()\n\n/* Get Insight IQL Facade from plugin accessor */\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\n/* Get Insight Object Facade from plugin accessor */\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\n\ndef userSearchService = ComponentAccessor.getComponent(UserSearchService)\n\n//22225 - GDO Supplier\ndef value = issue.getCustomFieldValue(ComponentAccessor.getCustomFieldManager().getCustomFieldObject(22225))\n\nuserSearchService = ComponentAccessor.getComponent(UserSearchService)\n\nif (value != null &amp;&amp; value != \"\"){\n    /* Specify the schema id as well as the IQL that will fetch objects. In this case all objects with Name matching the valueCF, be sure to include \" around value */\n    log.debug \"value[0].name = \" + value[0].getName()\n    log.debug \"value.size: \" + value.size\n    log.debug \"value: \" + value\n    String queryParam\n    \n    queryParam = \"\\\"\" + value[0].getName() + \"\\\"\"\n    \n    //Recupero il funzionario legato al site selezionato\n    def objects = iqlFacade.findObjectsByIQLAndSchema(16, \"objectType=\\\"Installatori\\\" AND (\\\"Name\\\" IN (\" + queryParam + \"))\"); // See the complete list of possible IQL on the Insight Query Language documentation page\n    \n    log.debug objectFacade.loadObjectBean(objects[0].getId())\n    def user = ComponentAccessor.jiraAuthenticationContext.loggedInUser\n            \n    log.debug \"Email address installatore: \" + objectFacade.loadObjectAttributeBean(objects[0].getId(), 1529).getObjectAttributeValueBeans()[0].getValue()\n\n\tmail.setTo(objectFacade.loadObjectAttributeBean(objects[0].getId(), 1529).getObjectAttributeValueBeans()[0].getValue().toString())\n\t\n}\n\nissue.getIssueType().name.equals(\"Repair\")","scriptPath":null,"parameters":{}}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE">AAS-2777</arg>
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="5" name="Closed">
      <meta name="jira.status.id">6</meta>
      <actions>
<common-action id="71" />
      </actions>
    </step>
    <step id="6" name="WAITING FOR DOCUMENTATION">
      <meta name="jira.status.id">15027</meta>
      <actions>
        <action id="91" name="Back To Open">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="žée" status="žée" step="1">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">31e4331d-dfa6-4805-a81c-97961b8bb26f</arg>
                  <arg name="FIELD_NOTES">Set Next Status Description - customer portal description</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":null,"scriptPath":"customScripts/GDO_SetNextStatusDescription.groovy"}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_FUNCTION_ID">f2bf43f9-9991-452f-8fb9-9abd7f4a3eff</arg>
                  <arg name="FIELD_NOTES">Set custom field "Customer request description" with the description of the selected request type</arg>
                  <arg name="FIELD_SCRIPT_FILE_OR_SCRIPT">{"script":null,"scriptPath":"customScripts/GDO_SetCustomerRequestDescription.groovy"}</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
                <function type="class">
                  <arg name="FIELD_NOTES">Invio notifica email a installatore e in CC a massari</arg>
                  <arg name="FIELD_DISABLE_VALIDATION">on</arg>
                  <arg name="FIELD_FROM">assistenza.gdo@faacgroup.com</arg>
                  <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_ALL</arg>
                  <arg name="FIELD_TO_ADDRESSES" />
                  <arg name="FIELD_CC_ADDRESSES" />
                  <arg name="FIELD_CC_USER_FIELDS" />
                  <arg name="FIELD_FUNCTION_ID">e9c5834f-9b34-48b0-bf01-f927d12424dc</arg>
                  <arg name="FIELD_TO_USER_FIELDS" />
                  <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
                  <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"Verdana";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.aa-summary{
        	color:#000000;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Verdana";
            font-size:14pt;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"Verdana";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Verdana";
            font-size:10pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Verdana";
            font-size:9pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#FFFFFF;
			padding:10px 10px 10px 10px;
			font-family:"Verdana";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Verdana";
			font-size:11pt;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:11pt;
			font-family:"Verdana";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		a.title-mail-reference{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		a.title-mail-portal{
			font-family:"Verdana";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#CF6400;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"Verdana";
			font-size:11pt;
			display: inline-block;
			color:#000000;
		}
		p.type-above{
			font-family:"Verdana";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-aa{
			border-radius: 3px; 
			font-size: 8pt; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #FFFFFF; 
			border: 1px solid #CF6400; 
			color: #000000; 
			margin-left: 5px; 
			font-weight: bold; 
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td colspan="2"&gt;
													&lt;img src="&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.getApplicationProperties().getString("jira.baseurl") %&gt;/images/loghi/logo_Access_Automation.png"/&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td colspan="2" width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-portal" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30"&gt;
                                                              &lt;b&gt;GDO Support Portal&lt;/b&gt;
															&lt;/a&gt; - &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15800"))%&gt;
															
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
											&lt;tr&gt;
												&lt;td&gt;&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold;font-size:11pt;color:#CF6400;"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="aa-summary" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
                                        &lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15801 --&gt;
										&lt;!-- ID Prod: ????? --&gt;
										&lt;span class="status-name-aa"&gt; &lt;% out &lt;&lt; issue.getCustomFieldValue(com.atlassian.jira.component.ComponentAccessor.getCustomFieldManager().getCustomFieldObject("customfield_15801"))%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://gdo-support.faacgroup.com/servicedesk-ui/customer/portal/30/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
							&lt;/table&gt;
                            &lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
                                &lt;tr&gt;
                                    &lt;td class="comment-box"&gt;									
                                        &lt;% if (com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).size() != 0 &amp;&amp; lastComment != null &amp;&amp; lastComment != "") { %&gt;
                                            &lt;p class="title-comment"&gt;
                                                &lt;b&gt;&lt;u&gt;New comment added to the request&lt;/u&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p class="author-comment"&gt;
                                                &lt;b&gt;&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).last().authorFullName %&gt;&lt;/b&gt;
                                                &lt;b&gt;&lt;span style='font-size:10.0pt;font-family:"Segoe UI Symbol";color:#1F497D'&gt;&lt;/span&gt;&lt;/b&gt;
                                            &lt;/p&gt;
                                            &lt;p style='margin-top:6.0pt'&gt;
                                                &lt;span style='font-family:"Segoe UI Symbol";color:#003050'&gt;
                                                    &lt;% out &lt;&lt; lastComment %&gt;
                                                &lt;/span&gt;
                                            &lt;/p&gt;
                                        &lt;% } %&gt;
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                           	&lt;/table&gt;
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Verdana";color:#000000'&gt;This message is automatically generated by FAAC GDO Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
                  <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[$issue.project.name Portal][$issue.key] $issue.summary</arg>
                  <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerscriptrunner-workflow-function-com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
                  <arg name="FIELD_CONDITION">{"script":"mail.setFrom(\"assistenza.gdo@faacgroup.com\")\r\n\r\n\r\nimport com.atlassian.jira.component.ComponentAccessor\r\n\r\nimport com.atlassian.jira.issue.fields.CustomField\r\n\r\n\r\nimport com.atlassian.jira.component.ComponentAccessor\r\nimport com.atlassian.jira.issue.MutableIssue\r\nimport com.atlassian.jira.issue.IssueManager\r\nimport com.atlassian.jira.bc.user.search.UserSearchService\r\nimport com.atlassian.jira.user.ApplicationUser\r\nimport com.atlassian.jira.event.type.EventDispatchOption\r\nimport com.atlassian.jira.issue.index.IssueIndexingService\r\nimport org.apache.log4j.Category\r\nCategory log = Category.getInstance(\"com.onresolve.jira.groovy.PostFunction\")\r\nlog.setLevel(org.apache.log4j.Level.DEBUG)\r\n\r\ndef issueFactory = ComponentAccessor.getIssueFactory()\r\ndef constantManager = ComponentAccessor.getConstantsManager()\r\ndef LoggedInUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser()\r\ndef subTaskManager = ComponentAccessor.getSubTaskManager()\r\n\r\n/* Get Insight IQL Facade from plugin accessor */\r\nClass iqlFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.IQLFacade\"); \r\ndef iqlFacade = ComponentAccessor.getOSGiComponentInstanceOfType(iqlFacadeClass);\r\n/* Get Insight Object Facade from plugin accessor */\r\nClass objectFacadeClass = ComponentAccessor.getPluginAccessor().getClassLoader().findClass(\"com.riadalabs.jira.plugins.insight.channel.external.api.facade.ObjectFacade\");\r\ndef objectFacade = ComponentAccessor.getOSGiComponentInstanceOfType(objectFacadeClass);\r\nIssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)\r\n\r\ndef userSearchService = ComponentAccessor.getComponent(UserSearchService)\r\n\r\n//22225 - GDO Supplier\r\ndef value = issue.getCustomFieldValue(ComponentAccessor.getCustomFieldManager().getCustomFieldObject(22225))\r\n\r\nuserSearchService = ComponentAccessor.getComponent(UserSearchService)\r\n\r\nif (value != null &amp;&amp; value != \"\"){\r\n    /* Specify the schema id as well as the IQL that will fetch objects. In this case all objects with Name matching the valueCF, be sure to include \" around value */\r\n    log.debug \"value[0].name = \" + value[0].getName()\r\n    log.debug \"value.size: \" + value.size\r\n    log.debug \"value: \" + value\r\n    String queryParam\r\n    \r\n    queryParam = \"\\\"\" + value[0].getName() + \"\\\"\"\r\n    \r\n    //Recupero il funzionario legato al site selezionato\r\n    def objects = iqlFacade.findObjectsByIQLAndSchema(16, \"objectType=\\\"Installatori\\\" AND (\\\"Name\\\" IN (\" + queryParam + \"))\"); // See the complete list of possible IQL on the Insight Query Language documentation page\r\n    \r\n    log.debug objectFacade.loadObjectBean(objects[0].getId())\r\n    def user = ComponentAccessor.jiraAuthenticationContext.loggedInUser\r\n            \r\n    log.debug \"Email address installatore: \" + objectFacade.loadObjectAttributeBean(objects[0].getId(), 1529).getObjectAttributeValueBeans()[0].getValue()\r\n\r\n\tmail.setTo(objectFacade.loadObjectAttributeBean(objects[0].getId(), 1529).getObjectAttributeValueBeans()[0].getValue().toString())\r\n\t\r\n}\r\n\r\nissue.getIssueType().name.equals(\"Repair\")","scriptPath":null,"parameters":{}}</arg>
                  <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
                  <arg name="FIELD_PREVIEW_ISSUE" />
                  <arg name="FIELD_EMAIL_FORMAT">3</arg>
                  <arg name="events" />
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
  </steps>
</workflow>