<?xml version='1.0' encoding='UTF-8'?>
<workflow>
  <meta name="jira.description" />
  <meta name="jira.update.author.key">katia.chinaglia</meta>
  <meta name="jira.updated.date">1613726462882</meta>
  <initial-actions>
    <action id="1" name="Create">
      <validators>
        <validator name="" type="class">
          <arg name="permission">Create Issue</arg>
          <arg name="class.name">com.atlassian.jira.workflow.validator.PermissionValidator</arg>
        </validator>
      </validators>
      <results>
        <unconditional-result old-status="≈æ√©e" status="¬¢‚Äî¬ß" step="1">
          <post-functions>
            <function type="class">
              <arg name="FIELD_SECURITY_LEVEL_ID">11602</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SetIssueSecurity</arg>
              <arg name="FIELD_CONDITION" />
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueCreateFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">√ü^[k¬ø√µ√ó\√õ~¬∂√±√ç¬∫u√æ√¥{}√≥v√º√∑W√πo¬è4</arg>
              <arg name="FIELD_NOTES">Define Request Participants &amp; CC Addresses</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">//Aggiornamento "Request Participants"
import com.atlassian.jira.util.ImportUtils
import com.atlassian.jira.issue.util.IssueChangeHolder
import com.atlassian.jira.issue.util.DefaultIssueChangeHolder
import com.atlassian.jira.issue.Issue
import com.atlassian.jira.issue.ModifiedValue
import com.atlassian.jira.issue.CustomFieldManager
import com.atlassian.jira.issue.fields.CustomField
import com.atlassian.jira.issue.index.IssueIndexManager
import com.atlassian.jira.index.Index.Manager
import com.atlassian.jira.event.type.EventDispatchOption
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.ApplicationUser
import com.atlassian.crowd.embedded.api.User
import com.atlassian.jira.component.ComponentAccessor
import com.atlassian.jira.user.util.UserManager
import com.atlassian.crowd.embedded.api.Group
import com.atlassian.jira.issue.index.IssueIndexingService

import org.apache.log4j.Category
Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")

log.setLevel(org.apache.log4j.Level.DEBUG)

def groupManager = ComponentAccessor.getGroupManager()

def customFieldManager = ComponentAccessor.getCustomFieldManager()
IssueIndexingService issueIndexingService = ComponentAccessor.getComponent(IssueIndexingService)
IssueChangeHolder changeHolder = new DefaultIssueChangeHolder()

//27.12.2016: sostituito campo Request participants - 14100 - del plugin Service Desk con il nuovo campo custom 17100
CustomField requestParticipants = customFieldManager.getCustomFieldObject("17100".toLong())
CustomField ccAddresses = customFieldManager.getCustomFieldObject("14404".toLong())

//In produzione aggiungere il cambio utente in modo che la modifica la faccia 'atlassian'
def oldUser = ComponentAccessor.jiraAuthenticationContext.loggedInUser
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(ComponentAccessor.getUserManager().getUserByKey("atlassian_faac_service_desk"))

def userUtil = ComponentAccessor.getUserUtil()
List&lt;ApplicationUser&gt; requestParticipantsList = []
List&lt;ApplicationUser&gt; ccAddressesList = []
def v_jiraGroup = ""
def n_jiraGroup = null
com.atlassian.crowd.embedded.api.Group not_jiraGroup = null
def retValue

userUtil.getGroupNamesForUser(issue.reporter.name).each { group -&gt;
    // Ricerco il gruppo di appartenenza dell'utente - non HS-customers a cui appartengono tutti gli utenti ma quello specifico del team di visibilitÔøΩ
	if(group != "HS-customers" &amp;&amp; group.contains("HS-Visibility-CPQ")){
        v_jiraGroup = group
        retValue = groupManager.getUsersInGroup(group).each{ user -&gt;
            if(user.getName() != issue.reporter.name){
            	requestParticipantsList.add(ComponentAccessor.getUserManager().getUserByName(user.getName()));
            }
        }
    }
}

/*
if (v_jiraGroup != null &amp;&amp; v_jiraGroup.contains("Visibility-")){
	n_jiraGroup = "HS-Notifications-" + v_jiraGroup.substring(0+v_jiraGroup.indexOf("Visibility-")+11,v_jiraGroup.size())
	not_jiraGroup = ComponentAccessor.getUserManager().getGroup(n_jiraGroup);
}    

if (not_jiraGroup != null){
    retValue = groupManager.getUsersInGroup(not_jiraGroup).each{ user -&gt;
           	ccAddressesList.add(ComponentAccessor.getUserManager().getUserByName(user.getName()));
    }
}
*/

if(requestParticipantsList.size() &gt; 0){
	requestParticipants.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(requestParticipants),requestParticipantsList),changeHolder)
    issue.setCustomFieldValue(requestParticipants, requestParticipantsList)
    issueIndexingService.reIndex(issue)
}

/*
if(ccAddressesList.size() &gt; 0){
	ccAddresses.updateValue(null, issue, new ModifiedValue(issue.getCustomFieldValue(ccAddresses),ccAddressesList),changeHolder)
    issue.setCustomFieldValue(ccAddresses, ccAddressesList)
    issueIndexingService.reIndex(issue)
}
*/
ComponentAccessor.jiraAuthenticationContext.setLoggedInUser(oldUser)</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="eventTypeId">1</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">support@hubparking.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS">customfield_17100</arg>
              <arg name="FIELD_TO_USER_FIELDS">¬≠√™h¬Æ√ó¬´</arg>
              <arg name="FIELD_FUNCTION_ID">√ü¬ü;√Ø¬ø]√ì¬ß√Ω√©√ß¬∑√£¬æ¬Ω¬ùw√•¬≠√ë¬¶√õ√´¬Æ_√Ø¬óZ</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"calibri";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.hub-summary{
        	color:#6BA539;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Segoe UI Symbol";
            font-size:18pt;
            font-weight:bold;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"calibri";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"calibri";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Segoe UI Symbol";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Segoe UI Symbol";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#F2F2F2;
			padding:10px 10px 10px 10px;
			font-family:"calibri";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Segoe UI Symbol";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Segoe UI Symbol";
			font-size:11pt;
			font-weight:bold;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:10pt;
			font-family:"Segoe UI Symbol";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.hub-header-firma{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			padding-bottom: 0px;
		}
		span.hub-content-firma{
			font-family:"Segoe UI Symbol";
			font-size:8pt;
			padding-top: 0px;
			padding-left: 10px;
		}
		span.hub-header-firma-blue{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			font-weight:bold;
			color:#003050;
			padding-left: 10px;
		}
		span.hub-header-firma-green{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			font-weight:bold;
			color:#6BA539;
		}
		a.title-mail-reference{
			font-family:"calibri";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#003050;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"calibri";
			font-size:11pt;
			display: inline-block;
			color:#003050;
		}
		p.type-above{
			font-family:"calibri";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-yellow{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #ffd351; 
			border: 1px solid #ffd351; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
		span.status-name-green{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #14892C; 
			border: 1px solid #14892C; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
		span.status-name-blue{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #4A6785; 
			border: 1px solid #4A6785; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-reference" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24"&gt;
                                                              &lt;b&gt;HUB Support Portal&lt;/b&gt;	- Support Request
															&lt;/a&gt;
													&lt;/p&gt;
												&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="hub-summary" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15602 --&gt;
										&lt;!-- ID Prod: 15801 --&gt;
										&lt;!-- Custom field: Next Status Color --&gt;
										&lt;!-- ID Svil: 16500 --&gt;
										&lt;!-- ID Prod: 17111 --&gt;
										&lt;span class="status-name-blue"&gt; &lt;% out &lt;&lt; "OPEN"%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="comment-box"&gt;									
									
									&lt;p class="details-box-title"&gt;
										&lt;b&gt;&lt;span style='font-family:"Segoe UI Symbol"'&gt;Details&lt;/span&gt;&lt;/b&gt;
										
									&lt;/p&gt;
									&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%;'&gt;
										&lt;% if (issue.description.toString().contains("{html}")) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Description&lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
													&lt;% out &lt;&lt; issue.description.toString().substring(issue.description.toString().indexOf("{html}")+6, issue.description.toString().lastIndexOf("{html}")) %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
                                        &lt;% if (!issue.description.toString().contains("{html}")) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Description&lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
													$issue.description
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
										
									&lt;/table&gt;
									
								&lt;/td&gt;
							&lt;/tr&gt;
							&lt;tr&gt;
								&lt;td&gt;
								&lt;p class="hub-header-firma"&gt;
									&lt;span class="hub-header-firma-blue"&gt;HUB Parking &lt;/span&gt;&lt;span class="hub-header-firma-green"&gt;Technology&lt;/span&gt;&lt;br/&gt;
									&lt;span class="hub-content-firma"&gt;a Business Unit of the FAAC Group&lt;/span&gt;
								&lt;/p&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Segoe UI Symbol";color:#003050'&gt;This message is automatically generated by HUB Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[HUB Support Portal - New Request Created][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="v+nW√π">false</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("support@hubparking.com")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">HS-14847</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </initial-actions>
  <common-actions>
    <action id="81" name="To Be Tested SBX">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="4">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="51" name="In progress PDM/ERP">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="3">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="71" name="Waiting for Customer" view="fieldscreen">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id">15000</meta>
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="7">
          <post-functions>
            <function type="class">
              <arg name="FIELD_FUNCTION_ID">√ë√á√∑]¬π√≠¬Ω√∏√ØG¬∫√£^√Ω√ó√é√Ω√ô√∂√ú√óM6i¬ß{√ù√Æ√ù</arg>
              <arg name="FIELD_NOTES">Set PreStatus</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT">import com.atlassian.jira.component.ComponentAccessor;
import com.atlassian.jira.issue.CustomFieldManager;
import com.atlassian.jira.issue.fields.CustomField;
import com.atlassian.jira.issue.IssueManager;
import com.atlassian.jira.issue.Issue;
import org.apache.log4j.Category

Category log = Category.getInstance("com.onresolve.jira.groovy.PostFunction")
log.setLevel(org.apache.log4j.Level.DEBUG)


CustomFieldManager customFieldManager = ComponentAccessor.getCustomFieldManager();

CustomField preStatus = customFieldManager.getCustomFieldObjectsByName("PreStatus")[0]
def originalIssue = ComponentAccessor.getIssueManager().getIssueObject(issue.id)

log.debug "originalIssue: " + originalIssue.getStatus().name
log.debug "preStatus " + preStatus

if (originalIssue.getStatus().name == "Analisys"){
    issue.setCustomFieldValue(preStatus,"Analisys".toString())
}
else{
    if(originalIssue.getStatus().name == "IN PROGRESS PDM/ERP"){
        issue.setCustomFieldValue(preStatus,"IN PROGRESS PDM/ERP".toString())
    }
    else{   
        issue.setCustomFieldValue(preStatus,"IN PROGRESS CPQ".toString())
    }
}</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE" />
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_NOTES">Update public comments and attachments tables on DB</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="FIELD_INLINE_SCRIPT" />
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CustomScriptFunction</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_SCRIPT_FILE">customScripts/IDTS_UpdatePublicCommentsAttachments.groovy</arg>
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">support@hubparking.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS" />
              <arg name="FIELD_TO_USER_FIELDS">¬≠√™h¬Æ√ó¬´</arg>
              <arg name="FIELD_FUNCTION_ID">√õ√Ü¬∫oGt√Ø¬ç√∑√ç¬ú√ô¬Æ:m√ß5√ß¬ù√∂√≥¬û:√Ø¬Ω^√ì¬ñ√ª</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"calibri";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.hub-summary{
        	color:#6BA539;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Segoe UI Symbol";
            font-size:18pt;
            font-weight:bold;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"calibri";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"calibri";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Segoe UI Symbol";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Segoe UI Symbol";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#F2F2F2;
			padding:10px 10px 10px 10px;
			font-family:"calibri";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Segoe UI Symbol";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Segoe UI Symbol";
			font-size:11pt;
			font-weight:bold;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:10pt;
			font-family:"Segoe UI Symbol";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.hub-header-firma{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			padding-bottom: 0px;
		}
		span.hub-content-firma{
			font-family:"Segoe UI Symbol";
			font-size:8pt;
			padding-top: 0px;
			padding-left: 10px;
		}
		span.hub-header-firma-blue{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			font-weight:bold;
			color:#003050;
			padding-left: 10px;
		}
		span.hub-header-firma-green{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			font-weight:bold;
			color:#6BA539;
		}
		a.title-mail-reference{
			font-family:"calibri";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#003050;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"calibri";
			font-size:11pt;
			display: inline-block;
			color:#003050;
		}
		p.type-above{
			font-family:"calibri";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-yellow{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #ffd351; 
			border: 1px solid #ffd351; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
		span.status-name-green{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #14892C; 
			border: 1px solid #14892C; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
		span.status-name-blue{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #4A6785; 
			border: 1px solid #4A6785; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-reference" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24"&gt;
                                                              &lt;b&gt;HUB Support Portal&lt;/b&gt;	- Support Request
															&lt;/a&gt;
													&lt;/p&gt;
												&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
												&lt;a class="hub-summary" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24/myrequests/$issue"&gt;
													$issue.summary
												&lt;/a&gt;
												&lt;!-- Custom field: Next Status Description --&gt;
												&lt;!-- ID Svil: 15602 --&gt;
												&lt;!-- ID Prod: 15801 --&gt;
												&lt;!-- Custom field: Next Status Color --&gt;
												&lt;!-- ID Svil: 16500 --&gt;
												&lt;!-- ID Prod: 17111 --&gt;
												
												&lt;span class="status-name-blue"&gt; &lt;% out &lt;&lt; "WAITING FOR CUSTOMER"%&gt; &lt;/span&gt;
												
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="comment-box"&gt;									
									&lt;% if (com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue).size() != 0 &amp;&amp; lastComment != null &amp;&amp; lastComment != "") { %&gt;
										&lt;p class="title-comment"&gt;
											&lt;b&gt;&lt;u&gt;New comment added to the request&lt;/u&gt;&lt;/b&gt;
										&lt;/p&gt;
										&lt;p class="author-comment"&gt;
											&lt;b&gt;&lt;% out &lt;&lt; com.atlassian.jira.component.ComponentAccessor.userUtil.getUserObject(com.atlassian.jira.component.ComponentAccessor.commentManager.getComments(issue)?.last()?.author.toString()).getDisplayName() %&gt;&lt;/b&gt;
											&lt;b&gt;&lt;span style='font-size:10.0pt;font-family:"Segoe UI Symbol";color:#1F497D'&gt;&lt;/span&gt;&lt;/b&gt;
										&lt;/p&gt;
										&lt;p style='margin-top:6.0pt'&gt;
											&lt;span style='font-family:"Segoe UI Symbol";color:#003050'&gt;
												&lt;% out &lt;&lt; lastComment %&gt;
											&lt;/span&gt;
										&lt;/p&gt;
									&lt;% } %&gt;
									&lt;p class="details-box-title"&gt;
										&lt;b&gt;&lt;span style='font-family:"Segoe UI Symbol"'&gt;Details&lt;/span&gt;&lt;/b&gt;
										
									&lt;/p&gt;
									&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%;'&gt;
									
										&lt;% if (issue.description != null) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Description&lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
													&lt;% if(issue.description.toString().contains("{html}")) { %&gt;
														&lt;% out &lt;&lt; issue.description.toString().substring(issue.description.toString().indexOf("{html}")+6, issue.description.toString().lastIndexOf("{html}")) %&gt;
													&lt;% } %&gt;
													&lt;% if(!issue.description.toString().contains("{html}")) { %&gt;
														$issue.description
													&lt;% } %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
	
					
						
									&lt;/table&gt;
									
								&lt;/td&gt;
							&lt;/tr&gt;
							&lt;tr&gt;
								&lt;td&gt;
								&lt;p class="hub-header-firma"&gt;
									&lt;span class="hub-header-firma-blue"&gt;HUB Parking &lt;/span&gt;&lt;span class="hub-header-firma-green"&gt;Technology&lt;/span&gt;&lt;br/&gt;
									&lt;span class="hub-content-firma"&gt;a Business Unit of the FAAC Group&lt;/span&gt;
								&lt;/p&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Segoe UI Symbol";color:#003050'&gt;This message is automatically generated by HUB Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[HUB Support Portal - New Comment][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("support@hubparking.com")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE" />
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="41" name="Back To Analisys">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="2">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="91" name="SBX TESTED">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="5">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="61" name="In Progress CPQ">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="6">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
    <action id="31" name="Closed">
      <meta name="jira.description" />
      <meta name="jira.fieldscreen.id" />
      <results>
        <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="8">
          <post-functions>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
            </function>
            <function type="class">
              <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
            </function>
            <function type="class">
              <arg name="eventTypeId">13</arg>
              <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
            </function>
            <function type="class">
              <arg name="FIELD_DISABLE_VALIDATION" />
              <arg name="FIELD_FROM">support@hubparking.com</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS">FIELD_INCLUDE_ATTACHMENTS_NONE</arg>
              <arg name="FIELD_TO_ADDRESSES" />
              <arg name="FIELD_CC_ADDRESSES" />
              <arg name="FIELD_CC_USER_FIELDS">customfield_17100</arg>
              <arg name="FIELD_TO_USER_FIELDS">¬≠√™h¬Æ√ó¬´</arg>
              <arg name="FIELD_FUNCTION_ID">q√ù¬ª¬ù√öo~}√ß}¬µ√õW}¬á√ß√ó&lt;√±√év¬≠{s¬∑</arg>
              <arg name="FIELD_INCLUDE_ATTACHMENTS_CALLBACK">`!`</arg>
              <arg name="FIELD_EMAIL_TEMPLATE">&lt;html&gt;
&lt;head&gt;
	&lt;style&gt;
    	table.custom-outgoing-mail{
        	font-family:"calibri";
        	width:100%;
        	border-spacing: 8px 2px;
        }
        a.hub-summary{
        	color:#6BA539;
        	text-decoration:none;
        }
        td.td-spaced{
        	padding:15.0pt 7.5pt 7.5pt 7.5pt;
        }
        td.td-summary{
        	font-family:"Segoe UI Symbol";
            font-size:18pt;
            font-weight:bold;
        	border-top:whitesmoke 1.0pt;
        	border-left:#DDDDDD 1.0pt;
        	border-bottom:#DDDDDD 1.0pt;
        	border-right:#DDDDDD 1.5pt;
        	border-style:solid;
        	background:white;
			padding-left:10px;
        }
		td.td-reference{
			border-top:white 1.0pt;
			border-left:#DDDDDD 1.0pt;
			border-bottom:#DDDDDD 1.5pt;
			border-right:#DDDDDD 1.5pt;
			border-style:solid;
			background:white;
			padding:10px 10px 10px 10px;
			font-family:"calibri";
			color:#003050;
			font-size:11pt;
		}
		a.td-reference{
			font-family:"calibri";
			color:#003050;
			font-size:11pt;
			text-decoration:underline;
		}
		p.title-comment{
			font-family:"Segoe UI Symbol";
            font-size:12pt;
            font-weight:bold;
			text-decoration:underline;
		}
		p.author-comment{
			font-family:"Segoe UI Symbol";
            font-size:11pt;
            font-weight:bold;
		}
		td.comment-box{
			background:#F2F2F2;
			padding:10px 10px 10px 10px;
			font-family:"calibri";
			font-size:11pt;
		}
		td.details-field-name{
			font-size:10pt;
			font-family:"Segoe UI Symbol";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.details-box-title{
			font-family:"Segoe UI Symbol";
			font-size:11pt;
			font-weight:bold;
			padding-top: 15px;
			padding-bottom: 10px;
		}
		td.details-field-value{
			font-size:10pt;
			font-family:"Segoe UI Symbol";
			vertical-align:middle;
			padding-top: 2px;
			padding-bottom: 2px;
		}
		p.hub-header-firma{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			padding-bottom: 0px;
		}
		span.hub-content-firma{
			font-family:"Segoe UI Symbol";
			font-size:8pt;
			padding-top: 0px;
			padding-left: 10px;
		}
		span.hub-header-firma-blue{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			font-weight:bold;
			color:#003050;
			padding-left: 10px;
		}
		span.hub-header-firma-green{
			font-family:"Segoe UI Symbol";
			font-size:10pt;
			font-weight:bold;
			color:#6BA539;
		}
		a.title-mail-reference{
			font-family:"calibri";
			padding-top: 5px;
			padding-bottom: 5px;
			padding-left: 10px;
			display: inline-block;
			font-size:11pt;
			color:#003050;
		}
		p.title-mail-reference{
			padding-top: 5px;
			padding-bottom: 5px;
			padding-right: 10px;
			text-align:right;
			line-height:13pt;
			font-family:"calibri";
			font-size:11pt;
			display: inline-block;
			color:#003050;
		}
		p.type-above{
			font-family:"calibri";
			font-size:8pt;
			font-weight:bold;
			color:#505050;
		}
		span.status-name-yellow{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #ffd351; 
			border: 1px solid #ffd351; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
		span.status-name-green{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #14892C; 
			border: 1px solid #14892C; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
		span.status-name-blue{
			border-radius: 3px; 
			font-size: 11px; 
			text-align: center; 
			text-transform: uppercase; 
			background-color: #4A6785; 
			border: 1px solid #4A6785; 
			color: #ffffff; 
			margin-left: 5px; 
			font-weight: bold; 
			font-size: 14px;
		}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div align="center"&gt;
	&lt;p class="type-above"&gt;##Please type your reply above this line##&lt;/p&gt;
&lt;/div&gt;
&lt;div align="center"&gt;
&lt;table class="custom-outgoing-mail" border=0 cellspacing=0 cellpadding=0 width="100%"&gt;
	&lt;tr&gt;
		&lt;td class="td-spaced"&gt;
			&lt;div align="center"&gt;
				&lt;table border=0 cellspacing=0 cellpadding=0 width=600 style='width:450pt'&gt;
					&lt;tr&gt;
						&lt;td style='padding:0cm 0cm 0cm 0cm'&gt;
							&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
								&lt;tr&gt;
									&lt;td&gt;
										&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
											&lt;tr&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm'&gt;
													&lt;p&gt;
															&lt;a class="title-mail-reference" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24"&gt;
                                                              &lt;b&gt;HUB Support Portal&lt;/b&gt;	- Support Request
															&lt;/a&gt;
													&lt;/p&gt;
												&lt;/td&gt;
												&lt;td width="50%" style='width:50.0%;padding:0cm 0cm 0cm 0cm;text-align:right;'&gt;
													&lt;p class="title-mail-reference" &gt;
															Reference: &lt;strong style="font-weight: bold"&gt;$issue&lt;/strong&gt;
													&lt;/p&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;/table&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-summary"&gt;
										&lt;br/&gt;
										&lt;a class="hub-summary" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24/myrequests/$issue"&gt;
											$issue.summary
										&lt;/a&gt;
										&lt;!-- Custom field: Next Status Description --&gt;
										&lt;!-- ID Svil: 15602 --&gt;
										&lt;!-- ID Prod: 15801 --&gt;
										&lt;!-- Custom field: Next Status Color --&gt;
										&lt;!-- ID Svil: 16500 --&gt;
										&lt;!-- ID Prod: 17111 --&gt;
										&lt;span class="status-name-blue"&gt; &lt;% out &lt;&lt; "CLOSED"%&gt; &lt;/span&gt;
									&lt;/td&gt;
								&lt;/tr&gt;
								&lt;tr&gt;
									&lt;td class="td-reference"&gt;
										You can 										
											&lt;a class="td-reference" href="https://support.hubparking.com/servicedesk-ui/customer/portal/24/myrequests/$issue"&gt;
												view the full request
											&lt;/a&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;

						&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%'&gt;
							&lt;tr&gt;
								&lt;td class="comment-box"&gt;									
									
									&lt;p class="details-box-title"&gt;
										&lt;b&gt;&lt;span style='font-family:"Segoe UI Symbol"'&gt;Details&lt;/span&gt;&lt;/b&gt;
										
									&lt;/p&gt;
									&lt;table border=0 cellspacing=0 cellpadding=0 width="100%" style='width:100%;'&gt;
										&lt;% if (issue.description.toString().contains("{html}")) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Description&lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
													&lt;% out &lt;&lt; issue.description.toString().substring(issue.description.toString().indexOf("{html}")+6, issue.description.toString().lastIndexOf("{html}")) %&gt;
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
                                        &lt;% if (!issue.description.toString().contains("{html}")) { %&gt;
											&lt;tr&gt;
												&lt;td width="30%" class="details-field-name"&gt;
												  &lt;b&gt;Description&lt;/b&gt;
												&lt;/td&gt;
												&lt;td class="details-field-value"&gt;
													$issue.description
												&lt;/td&gt;
											&lt;/tr&gt;
										&lt;% } %&gt;
										
										
									&lt;/table&gt;
									
								&lt;/td&gt;
							&lt;/tr&gt;
							&lt;tr&gt;
								&lt;td&gt;
								&lt;p class="hub-header-firma"&gt;
									&lt;span class="hub-header-firma-blue"&gt;HUB Parking &lt;/span&gt;&lt;span class="hub-header-firma-green"&gt;Technology&lt;/span&gt;&lt;br/&gt;
									&lt;span class="hub-content-firma"&gt;a Business Unit of the FAAC Group&lt;/span&gt;
								&lt;/p&gt;
								&lt;/td&gt;
							&lt;/tr&gt;
						&lt;/table&gt;
						
						&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/table&gt;
			&lt;/div&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td style='padding:0cm 0cm 15.0pt 0cm;'&gt;
			&lt;p align=center style='margin:0cm;margin-bottom:.0001pt;text-align:center'&gt;
				&lt;span style='font-size:9.0pt;font-family:"Segoe UI Symbol";color:#003050'&gt;This message is automatically generated by HUB Support Portal.&lt;/span&gt;
			&lt;/p&gt;
		&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</arg>
              <arg name="FIELD_EMAIL_SUBJECT_TEMPLATE">[HUB Support Portal - Request Closed][$issue.key] $issue.summary</arg>
              <arg name="full.module.key">com.onresolve.jira.groovy.groovyrunnerrungroovy-function</arg>
              <arg name="canned-script">com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.SendCustomEmail</arg>
              <arg name="FIELD_CONDITION">mail.setFrom("support@hubparking.com")|||</arg>
              <arg name="class.name">com.onresolve.jira.groovy.GroovyFunctionPlugin</arg>
              <arg name="FIELD_PREVIEW_ISSUE">HS-20111</arg>
              <arg name="FIELD_EMAIL_FORMAT">3</arg>
              <arg name="events" />
            </function>
          </post-functions>
        </unconditional-result>
      </results>
    </action>
  </common-actions>
  <steps>
    <step id="1" name=":‚Äî¬ß">
      <meta name="jira.status.id">1</meta>
      <actions>
<common-action id="31" />
        <action id="11" name="To Analysis">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="2">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="2" name="v¬•≈†√å¬¨">
      <meta name="jira.status.id">10010</meta>
      <actions>
<common-action id="31" />
<common-action id="51" />
<common-action id="61" />
<common-action id="71" />
        <action id="21" name="Back to Open">
          <meta name="jira.description" />
          <meta name="jira.fieldscreen.id" />
          <results>
            <unconditional-result old-status="≈æ√©e" status="≈æ√©e" step="1">
              <post-functions>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.UpdateIssueStatusFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.misc.CreateCommentFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.GenerateChangeHistoryFunction</arg>
                </function>
                <function type="class">
                  <arg name="class.name">com.atlassian.jira.workflow.function.issue.IssueReindexFunction</arg>
                </function>
                <function type="class">
                  <arg name="eventTypeId">13</arg>
                  <arg name="class.name">com.atlassian.jira.workflow.function.event.FireIssueEventFunction</arg>
                </function>
              </post-functions>
            </unconditional-result>
          </results>
        </action>
      </actions>
    </step>
    <step id="3" name="In progress PDM/ERP">
      <meta name="jira.status.id">14439</meta>
      <actions>
<common-action id="41" />
<common-action id="71" />
<common-action id="81" />
      </actions>
    </step>
    <step id="4" name="TO BE TESTED SBX">
      <meta name="jira.status.id">14440</meta>
      <actions>
<common-action id="51" />
<common-action id="61" />
<common-action id="91" />
      </actions>
    </step>
    <step id="5" name="SBX TESTED">
      <meta name="jira.status.id">14441</meta>
      <actions>
<common-action id="31" />
<common-action id="51" />
<common-action id="61" />
<common-action id="81" />
      </actions>
    </step>
    <step id="6" name="IN PROGRESS CPQ">
      <meta name="jira.status.id">14442</meta>
      <actions>
<common-action id="41" />
<common-action id="71" />
<common-action id="81" />
      </actions>
    </step>
    <step id="7" name="Waiting for Customer">
      <meta name="jira.status.id">10024</meta>
      <actions>
<common-action id="41" />
<common-action id="51" />
<common-action id="61" />
      </actions>
    </step>
    <step id="8" name="Closed">
      <meta name="jira.status.id">6</meta>
      <actions>
<common-action id="41" />
<common-action id="91" />
      </actions>
    </step>
  </steps>
</workflow>